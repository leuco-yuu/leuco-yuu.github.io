+++
title= "渗透测试基础"
date= "2025-12-30T14:51:56+08:00"
lastmod= "2025-12-30T14:51:56+08:00"
draft=false
author= "leuco"
description= "【网络空间安全】网络安全入门-渗透测试基础"
keywords= ["网络空间安全", "渗透测试"]
categories= ["网络空间安全", "学习笔记"]
tags= ["网络空间安全", "渗透测试"]
math=true
+++

# 渗透测试基础
- **概述**：通过各种手段对目标进行渗透攻击，通过渗透来测试目标的安全防护能力
- **底层基础**：目标系统中存在安全漏洞（Loophole，指信息系统中存在的缺陷或不适当的配置，其可使攻击者在未授权情况下访问或破坏系统，导致信息系统面临安全风险）
- **渗透代码（Exploit）**：利用安全漏洞来造成入侵或破坏效果的程序或者漏洞利用代码

## 测试分类

### 黑盒测试

- **概念：** 测试人员在**完全不了解**目标系统内部结构、源代码、网络拓扑、技术栈等信息的情况下进行测试。他们仅拥有一个公开的访问点（例如一个网站URL或公司名称）。
- **信息来源：** 完全依赖公开信息收集，如搜索引擎、Whois查询、社交媒体、公开端口扫描等。
- **优点：**
  - **模拟真实攻击：** 最接近恶意黑客的真实攻击场景。
  - **测试外部防御：** 能有效评估边界安全防护（如防火墙、WAF）和暴露在外的服务的安全性。
  - **关注业务逻辑漏洞：** 更容易从用户视角发现业务逻辑缺陷。
- **缺点：**
  - **效率较低：** 需要大量时间进行信息收集和摸索，可能无法覆盖深层次漏洞。
  - **覆盖面有限：** 很难在有限时间内测试到所有内部接口和路径，可能遗漏隐藏漏洞。
  - **深度不足：** 难以发现由糟糕的代码实现、错误的配置等引起的深层安全问题。
- **适用场景：** 外部网络渗透测试、红队演练、模拟APT攻击、对已上线系统进行外部风险评估。

### 白盒测试

- **概念：** 测试人员在**拥有目标系统全部或近乎全部信息**的情况下进行测试。这通常包括源代码、架构设计文档、网络拓扑图、数据库 schema、API接口文档，甚至开发团队的直接沟通。
- **信息来源：** 客户或开发团队提供的所有内部资料。
- **优点：**
  - **全面深入：** 可以系统性地审查所有代码路径、配置和接口，漏洞发现率最高。
  - **效率极高：** 无需猜测和盲目探测，可直接定位可能存在问题的代码模块。
  - **发现根源问题：** 不仅能找到漏洞，还能精准定位漏洞的代码行和根本原因，便于修复。
  - **早期介入：** 可以在开发阶段（如SAST，静态应用安全测试）或上线前进行。
- **缺点：**
  - **不模拟真实攻击：** 无法评估系统在外部攻击者视角下的真实表现。
  - **可能忽略配置漏洞：** 过于关注代码，可能忽略运行时环境、网络配置等导致的问题。
  - **依赖测试人员技术深度：** 需要测试人员具备很强的代码审计和架构理解能力。
- **适用场景：** 代码安全审计、SDL（安全开发生命周期）中的安全测试、内部安全评估、对特定复杂应用进行深度检查。

### 灰盒测试

- **概念：** 介于黑盒与白盒之间。测试人员拥有**部分、有限的内部信息**。例如，一个低权限的用户账号、部分API文档、系统使用的技术框架信息，或者基本的网络架构图。
- **信息来源：** 客户提供有限信息 + 测试人员自身信息收集。
- **优点：**
  - **平衡效率与真实性：** 在模拟一定真实攻击的同时，利用有限信息提高测试的深度和效率。
  - **聚焦特权升级：** 非常适合测试从低权限用户到高权限（垂直越权）或跨用户访问（水平越权）的漏洞。
  - **评估内部威胁：** 模拟内部员工或供应链攻击的场景。
- **缺点：**
  - **范围难以界定：** 提供多少信息算“灰盒”需要与客户事先清晰约定。
  - **可能遗漏两方面问题：** 既可能不如白盒全面，也可能不如黑盒真实。
- **适用场景：** 最常见的渗透测试类型。适用于大多数需要对已上线系统进行内部和外部综合评估的项目，如Web应用渗透测试、移动应用测试（已知部分后端API）。

## 目标分类

### 主机操作系统渗透

​	如Windows、Solaris、AIX、Linux、SCO、SGI等操作系统本身进行渗透测试

### 数据库系统渗透

​	对MS-SQL、Oracle、MySQL、Informix、Sybase、DB2、Access等数据库应用系统进行渗透测试

### 应用系统渗透

​	对渗透目标提供的各种应用，如ASP、CGI、JSP、PHP等组成的WWW应用进行渗透测试

### 网络设备渗透

​	对各种防火墙、入侵检测系统、网络设备进行渗透测试

##  渗透测试过程环节

1. 前期交互阶段（Pre-Engagement Interaction）

2. 情报搜集阶段（Information Gathering）

3. 威胁建模阶段（Threat Modeling）

4. 漏洞分析阶段（Vulnerability Analysis）

5. 渗透攻击阶段（Exploitation）

6. 后渗透攻击阶段（Post Exploitation）

7. 报告阶段（Reporting）

### **1. 前期交互阶段**

正式测试开始前的规划和约定阶段，旨在明确测试的范围、规则和目标，确保测试合法、有效且可控。

- **核心活动**：
  - **确定范围**：与客户共同商定哪些系统、网络、应用程序或IP地址可以测试，哪些是绝对禁止的（如生产数据库、客户数据等）。
  - **确定规则**：定义测试方法（黑盒、白盒还是灰盒）、攻击强度（是否允许造成服务中断、社会工程攻击等）、测试时间窗口（是否只能在非工作时间进行）。
  - **法律授权**：签署**渗透测试授权书**，这是最重要的法律文件，确保测试行为合法，保护测试方和客户。
  - **确定目标**：明确测试的最终目的是什么（如：验证特定防火墙策略、评估新上线的Web应用安全、满足合规性要求等）。
- **输出物**：授权书、范围定义文档、沟通计划。

### **2. 情报搜集阶段**

“信息收集”，是测试的基石。尽可能多地收集关于目标的各种信息，为后续攻击寻找入口。情报分为两类：

- **被动情报搜集**：在不与目标系统直接交互的情况下，通过公开渠道获取信息。例如：搜索引擎、社交媒体、Whois域名信息、DNS记录、公开的代码仓库、新闻稿等。
- **主动情报搜集**：通过与目标系统直接交互来获取信息，但可能被记录。例如：端口扫描、服务指纹识别、网络拓扑探测等。
- **关键目标**：发现目标的所有网络资产、域名、子域名、IP地址、开放端口、运行的服务版本、员工信息、技术栈等。

### **3. 威胁建模阶段**

对收集到的信息进行分析和提炼，识别出可能被利用的资产、潜在的安全漏洞和攻击路径。这是一个分析规划阶段。

- **核心活动**：
  - **资产识别**：梳理出高价值的攻击目标（如数据库服务器、文件服务器、Web应用后台）。
  - **攻击面分析**：分析目标暴露的所有可能被攻击的点（如开放的远程管理端口、未认证的Web API、过时的框架）。
  - **攻击向量规划**：基于情报，构思可能的攻击路径和方法。例如：“通过钓鱼邮件获取员工凭证 -> 登录VPN -> 利用内部文件服务器的漏洞获取域控权限”。
  - **工具与技术选择**：根据分析结果，准备下一阶段所需的漏洞扫描工具、攻击载荷等。

### **4. 漏洞分析阶段**

对已识别的攻击面进行深入探测，以发现和验证具体的安全漏洞。

- **核心活动**：
  - **自动化扫描**：使用Nessus、Nexpose、AWVS等漏洞扫描器进行系统性扫描，生成初步漏洞报告。
  - **手动验证与分析**：**这是体现测试人员技术的关键**。对扫描器报告的结果进行去误报、分析漏洞的可利用性和实际风险等级。扫描器找不到的逻辑漏洞、业务逻辑缺陷、配置错误等，需要在此阶段通过手动测试发现。
  - **漏洞优先级排序**：根据CVSS分数、利用难度、对业务的影响等因素，对漏洞进行排序，决定后续攻击的优先级。

### **5. 渗透攻击阶段**

这是模拟真实攻击者的核心环节，尝试利用已发现的漏洞来突破安全防线，获取对系统或数据的未授权访问。

- **核心活动**：
  - **漏洞利用**：使用Metasploit、定制化的EXP或手动攻击方式，利用漏洞获取初始访问权限。例如：利用SQL注入获取数据库数据、利用文件上传漏洞上传Webshell、利用缓冲区溢出漏洞获取系统Shell。
  - **突破边界**：成功从一个外部点（如Web服务器）攻入内部网络。
  - **权限提升**：在已控制的主机上，从普通用户权限提升为管理员/系统权限。
- **关键点**：此阶段需要谨慎操作，避免对目标系统造成意外损害。

### **6. 后渗透攻击阶段**

在成功渗透进入目标系统后，模拟高级持续性威胁的攻击行为，目标是展示漏洞被利用后可能造成的实际业务影响。

- **核心活动**：
  - **权限维持**：在目标系统上安装后门、创建隐藏账户等，以维持长期控制。
  - **横向移动**：以已控制的机器为跳板，探测和攻击内网中的其他重要主机（如数据库服务器、域控制器）。
  - **目标达成**：窃取或篡改敏感数据（在授权范围内）、完全控制核心系统、访问关键业务功能等，以证明漏洞的严重性。
  - **足迹清理**：根据测试规则，可能需要清除测试过程中留下的日志、工具等痕迹（模拟真实攻击者），也可能保留用于报告证据。

### **7. 报告阶段**

将整个测试过程、发现、影响和建议以清晰、专业的形式呈现给客户，这是渗透测试价值最终交付的体现。

- **报告内容**：
  - **执行摘要**：用非技术语言向管理层阐述测试概述、发现的高风险问题及其对业务的潜在影响。
  - **技术细节**：详细描述每个漏洞的发现过程（步骤、截图）、原理、影响范围和修复建议。这部分是给技术人员看的。
  - **风险评级**：对每个漏洞进行严重程度评级（如高、中、低）。
  - **修复建议**：提供具体、可操作的修复方案或缓解措施。
  - **附录**：可能包含工具输出、日志片段等证据材料。

## 渗透实践-Metasploit开源的渗透测试框架

- **Exploit（渗透攻击）**：渗透攻击是指由攻击者或渗透测试者利用一个系统、应用或服务中的安全漏洞，所进行的攻击行为。流行的渗透攻击技术包括缓冲区溢出、WEB应用程序漏洞攻击（SQL注入、XSS等），以及利用配置错误等
- **Palyload（攻击载荷）**攻击载荷是我们期望目标系统在被渗透攻击之后执行的代码。在Metasploit框架中可以自由选择、传送和植入
- **ShellCode**：SellCode是渗透攻击时作为攻击载荷运行的一组机器指令，通常用汇编语言编写
- **Module（模块）**：Metasploit中一个模块是指Metasploit框架中所使用的一段软件代码组件
- **Listener（监听器）**：监听器是Metasploit中用来等待接入网络连接主机的组件
