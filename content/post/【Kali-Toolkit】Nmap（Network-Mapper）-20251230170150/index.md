+++
title= "【Kali Toolkit】Nmap（Network Mapper）"
date= "2025-12-30T16:27:59+08:00"
lastmod= "2025-12-30T16:27:59+08:00"
draft=false
author= "leuco"
description= "【1】Namp是Kali Linux中最强大的网络探测和安全审计工具之一。待续"
keywords= ["Kali", "Nmap", "TCP", "Namp"]
categories= ["网络空间安全", "工具集", "Kali Toolkit"]
tags= ["Kali", "Nmap", "TCP", "Namp"]
math=true

+++

# Nmap：网络扫描工具

{{<toc>}}

## 主机发现

### `-sn`

- **功能**：探测主机是否在线，不扫描端口
- **示例**：`nmap -sn 192.168.1.0/24`

### `-sP`

- **功能**：存活主机探测（已被`-sn`取代）
- **示例**：`nmap -sP 192.168.1.0/24`

### `-Pn`

- **功能**：跳过主机发现，将所有主机视为在线状态
- **示例**：`nmap -Pn 192.168.1.100`

## 端口扫描

### `-sS`

- **功能**：TCP SYN半开扫描，相对隐蔽
- **示例**：`nmap -Pn 192.168.1.100`

### `-sT`

- **功能**：TCP全开扫描，建立完整的TCP链接，更容易被发现
- **示例**：`nmap -sT -p- 192.168.1.100`

### `-sU`

- **功能**：UDP端口扫描
- **示例**：`nmap -sU 192.168.1.100`

### `-sN`

- **功能**：TCP Null扫描，发送没有任何标志位的TCP包
- **示例**：`nmap -sN 192.168.1.100`

### `-sF`

- **功能**：TCP FIN扫描，发送FIN标志位的TCP包
- **示例**：`nmap -sF 192.168.1.100`

### `-sX`

- **功能**：TCP Xmas扫描，发送FIN、PSH和URG标志位的TCP包
- **示例**：`nmap -sX 192.168.1.100`

### `-sＩ`

- **功能**：空闲扫描．通过"僵尸主机"进行隐蔽扫描
- **示例**：`nmap -sI zombiehost:port target`

### `-p`

- **功能**：指定端口号
- **示例**：`nmap -p 1-80 192.168.1.100`、`nmap -p 80,443 192.168.1.100`

### `-P0`

- **功能**：指定端口号，无ping扫描。此参数已过时，使用`-Pn`替代
- **示例**：`nmap -P0 192.168.1.100`

### `-PU`

- **功能**：指定端口号，UDP ping扫描。向目标UDP端口发送空包，根据响应判断主机是否在线
- **示例**：`nmap -PU 53,161 192.168.1.0/24`

### `-PS`

- **功能**：指定端口号，TCP SYN ping扫描。向指定端口发送SYN包进行主机发现
- **示例**：`nmap -PS 80,443 192.168.1.0/24`

### `-PA`

- **功能**：指定端口号，TCP ACK ping扫描。向指定端口发送ACK包，常用于穿透防火墙
- **示例**：`nmap -PA 80,443 192.168.1.0/24`

### `-PI`

- **功能**：指定端口号，使用真正的ping ICMP echo请求扫描目标主机是否正在运行
- **示例**：`nmap -PI 192.168.1.0/24`

### `-p-`

- **功能**：扫描所有端口
- **示例**：`nmap -p- 192.168.1.100`

### `--top-ports`

- **功能**：扫描最常用的前指定数量的端口
- **示例**：`nmap --top-ports 100 192.168.1.100`

### `-F`

- **功能**：快速扫描，减少扫描的端口数量
- **示例**：`nmap -F 192.168.1.100`

### `-iL`

- **功能**：指定扫描主机列表

- **示例**：`nmap -iL targets.txt`

- `targets.txt`内容示例：

  ```txt
  192.168.1.100
  192.168.1.101
  scanme.nmap.org
  ```

### `-iR`

- **功能**：随机选择扫描目标。随机扫描10个IP地址
- **示例**：`nmap -iR 10 -Pn`

### `-exclude`

- **功能**：排除扫描目标
- **示例**：`nmap 192.168.1.0/24 --exclude 192.168.1.100,192.168.1.101`

### `-excludefile`

- **功能**：排除文件中目标列表
- **示例**：`nmap 192.168.1.0/24 --excludefile exclude.txt`

### `-n`

- **功能**：不用域名解析（加快扫描速度，不进行反向DNS查询。）
- **示例**：`nmap -n 192.168.1.100`

### `-R`

- **功能**：为所有目标解析域名。即使目标以IP形式给出，也进行DNS解析。
- **示例**：`nmap -R scanme.nmap.org`

### `-e`

- **功能**：指定网络接口
- **示例**：`nmap -e eth0 192.168.1.0/24`、`nmap -e eth0 192.168.1.0/24`

### `-6`

- **功能**：IPv6扫描
- **示例**：`nmap --traceroute 192.168.1.100`

### `--traceroute`

- **功能**：路由跟踪
- **示例**：`nmap --iflist`

### `--system-dns`

- **功能**：使用系统DNS解析器而不是内置解析器
- **示例**：`nmap --system-dns 192.168.1.100`

### `--spoof-mac`

- **功能**：MAC地址欺骗
- **示例**：`nmap --spoof-mac 00:11:22:33:44:55 192.168.1.100`、`nmap --spoof-mac 0  # 随机MAC地址`

### `--badsum`

- **功能**：发送错误校验和
- **示例**：`nmap --badsum 192.168.1.100`

### `--resume`

- **功能**：从上次中断的地方继续扫描。
- **示例**：`nmap --resume scan.log`

### `--privileged / --unprivileged`

- **功能**：当以非root用户运行时模拟原始套接字。
- **示例**：`nmap --unprivileged 192.168.1.100  # 非特权模式`

### `--source-port`

- **功能**：使用特定源端口（如53端口可能被防火墙允许）
- **示例**：`nmap --source-port 53 192.168.1.100`

### `--data-length`

- **功能**：添加随机数据,在每个包后添加指定长度的随机数据。
- **示例**：`nmap --data-length 100 192.168.1.100`

## 服务/版本探测

### `-sV`

- **功能**：识别服务类型（HTTP、FTP等）和服务版本号，获取详细服务信息
- **示例**：`nmap -sV 192.168.1.100`

### `--version-intensity`

- **功能**：指定版本探测强度（0-9）
- **示例**：`nmap -sV --version-intensity 9 192.168.1.100`

## 操作系统探测

### `-O`

- **功能**：探测目标主机的操作系统类型
- **示例**：`nmap -O 192.168.1.100`

### `-A`

- **功能**：探测目标主机的操作系统类型
- **示例**：`nmap -A 192.168.1.100`

## NSE脚本引擎

### `-sC` /`--script=default`

- **功能**：使用默认脚本进行扫描
- **示例**：`nmap -sC 192.168.1.100`

### `-script=<Lua scripts>`

- **功能**：<Lua scripts>使用某个或某类脚本进行扫描，支持通配符描述
- **示例**：`nmap -script=vuln 192.168.1.100`
- **脚本分类**：
  - **auth**: 负责处理鉴权证书（绕开鉴权）的脚本
  - **broadcast**: 在局域网内探查更多服务开启状况，如dhcp/dns/sqlserver等服务
  - **brute**: 提供暴力破解方式，针对常见的应用如http/snmp等 
  - **default**: 使用-sC或-A选项扫描时候默认的脚本，提供基本脚本扫描能力 
  - **discovery**: 对网络进行更多的信息，如SMB枚举、SNMP查询等 
  - **dos**: 用于进行拒绝服务攻击 
  - **exploit**: 利用已知的漏洞入侵系统 
  - **external**: 利用第三方的数据库或资源，例如进行whois解析 
  - **fuzzer**: 模糊测试的脚本，发送异常的包到目标机，探测出潜在漏洞  
  - **intrusive**: 入侵性的脚本，此类脚本可能引发对方的IDS/IPS的记录或屏蔽 
  - **malware**: 探测目标机是否感染了病毒、开启了后门等信息 
  - **safe**: 此类与intrusive相反，属于安全性脚本 
  - **version**: 负责增强服务与版本扫描（Version Detection）功能的脚本 
  - **vuln**: 负责检查目标机是否有常见的漏洞（Vulnerability），如是否有MS08_067 

### `-script-args=<n1=v1,[n2=v2,...]>`

- **功能**：为脚本提供默认参数，使用指定类别或脚本进行扫描
- **示例**：`nmap --script http-title --script-args http.useragent="Mozilla/5.0" 192.168.1.100`

### `–script-args-file=filename`

- **功能**：使用文件来为脚本提供参数
- **示例**：`nmap --script smb-enum-shares --script-args-file smb-args.txt 192.168.1.100`
- `smb-args.txt`内容

```TEXT
smbuser=admin
smbpass=password123
```

### `–script-trace`

- **功能**：显示脚本执行过程中发送与接收的数据
- **示例**：`nmap -O -script-trace 192.168.1.100`

### `–script-updatedb`

- **功能**：更新脚本数据库（root）
- **示例**：`nmap –script-updatedb`

### `–script-help=<scripts>`

- **功能**：显示脚本的帮助信息，其中<scripts>部分可以逗号分隔的文件或脚本类别。查看所有http漏洞相关脚本的帮助信息：
- **示例**：`nmap -script-help http-voln-*`

## 输出选项

### `-oN`

- **功能**：输出至普通文本文件
- **示例**：`nmap -oN result.txt 192.168.1.100`

### `-oX`

- **功能**：输出至XML文件，便于工具处理
- **示例**：`nmap -oX result.xml 192.168.1.100`

### `-oA`

- **功能**：一次性输出所有主要格式
- **示例**：`nmap -oA result 192.168.1.100`

### `--open`

- **功能**：只显示开放端口
- **示例**：`nmap --open 192.168.1.0/24`

### `--reason`

- **功能**：显示端口状态原因.显示为什么端口被标记为开放/关闭/过滤。
- **示例**：`nmap --reason 192.168.1.100`

### `--packet-trace`

- **功能**：数据包跟踪,显示发送和接收的每个数据包。
- **示例**：`nmap --packet-trace 192.168.1.100`

### `--iflist`

- **功能**：列出接口和路由
- **示例**：`nmap --iflist`

### `--append-output`

- **功能**：追加输出,追加到现有日志文件而不是覆盖。
- **示例**：`nmap -oN scan.log --append-output 192.168.1.100`

### `-v`/` -vv `/` -d `/` -dd`

- **功能**：详细/调试输出
- **示例**：

```bash
nmap -v 192.168.1.100      # 详细输出
nmap -vv 192.168.1.100     # 更详细
nmap -d 192.168.1.100      # 调试级别1
nmap -dd 192.168.1.100     # 调试级别2
```

## 性能与防火墙规避

### `-T<0-5>`

- **功能**：时序模板，数字越大越快,也越易被发现
- **示例**：`nmap -T4 192.168.1.100`

### `-f`

- **功能**：使用小数据包分片
- **示例**：`nmap -f 192.168.1.100`

### `-D`

- **功能**：使用诱饵IP进行隐藏
- **示例**：`nmap -D RND:10 192.168.1.100`

### `--scan-delay`

- **功能**：探测速率控制.每次探测间隔100ms
- **示例**：`nmap --scan-delay 100ms 192.168.1.100`

### `--max-rate`

- **功能**：探测速率控制.每次探测间隔100ms
- **示例**：`nmap --max-rate 10 192.168.1.100`

### `--min-rate`

- **功能**：最小速率.确保扫描速度不低于每秒100个包。
- **示例**：`nmap --min-rate 100 192.168.1.100`

### `--max-retries`

- **功能**：最大重试次数
- **示例**：`nmap --max-retries 1 192.168.1.100`

### `--max-retries`

- **功能**：最大重试次数
- **示例**：`nmap --max-retries 1 192.168.1.100`

### `--min-parallelism / --max-parallelism`

- **功能**：并行度
- **示例**：`nmap --min-parallelism 10 --max-parallelism 100 192.168.1.100`

### `--ttl`

- **功能**：设置TTL值
- **示例**：`nmap --ttl 64 192.168.1.100`
