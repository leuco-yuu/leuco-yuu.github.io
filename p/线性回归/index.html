<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="零基础 机器学习 第一部分"><meta name=keywords content="梯度下降,SGD,sk-learn,归一化,正则化,多项式升维,EDA"><title>线性回归</title><link rel=canonical href=http://localhost:1313/p/%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/><link rel=stylesheet href=/scss/style.min.39f66eee2137f14e0d91840819c8cfd03515b6bfd0c49a479109ee615bf8a99a.css><meta property='og:title' content="线性回归"><meta property='og:description' content="零基础 机器学习 第一部分"><meta property='og:url' content='http://localhost:1313/p/%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/'><meta property='og:site_name' content="Lecuo's Blog"><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='梯度下降'><meta property='article:tag' content='SGD'><meta property='article:tag' content='sk-learn'><meta property='article:tag' content='归一化'><meta property='article:tag' content='正则化'><meta property='article:tag' content='多项式升维'><meta property='article:tag' content='EDA'><meta property='article:published_time' content='2025-12-02T13:16:53+08:00'><meta property='article:modified_time' content='2025-12-02T00:00:00+00:00'><meta name=twitter:title content="线性回归"><meta name=twitter:description content="零基础 机器学习 第一部分"></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_f6aa26e80a833272.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>Lecuo's Blog</a></h1><h2 class=site-description></h2></div></header><ol class=menu-social><li><a href=https://github.com/leuco-yuu/ target=_blank title=GitHub rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li><a href='https://mail.google.com/mail/u/0/?tf=cm&amp;to=leucoyuu@gmail.com&amp;fs=1' target=_blank title=Gmail rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="4" width="20" height="16" rx="2"/><polyline points="3,5 12,14 21,5"/></svg></a></li><li><a href='https://wpa.qq.com/msgrd?v=3&amp;uin=1286938728&amp;site=qq&amp;menu=yes/' target=_blank title=QQ rel=me><svg height="32" viewBox="0 0 32 32" width="32"><g fill="none" fill-rule="evenodd"><path d="m15.9998867.0-.3175962.00373031C8.84822.16478688 5.08430177 5.52571032 5.05900841 13.1032973L5.06 13.376l-.86256398 2.1053645c-.34339269.8459887-.59479858 1.4918602-.8236549 2.1249911-.16246446.4494579-.31092035.8862129-.4515632 1.3302912-1.41043336 4.4529342-1.46997142 7.7313526 1.14979123 8.0424546l.19586827.0182568c.69853306.0462522 1.18775172-.1357889 1.69345756-.5695745L6.008 26.385l.10703497.1859114.16295747.2641667L6.368 26.972l-.10203891.0725127c-1.18457469.8599516-1.78515849 2.0422997-.8749963 3.5478041.72014893 1.1919865 1.68579016 1.3851809 4.67654251 1.4059241h1.2781117l.7210113-.0101194c1.4578857-.0287327 2.9764342-.1065736 3.9343697-.2001215l.2555297.0243167c1.1291243.09698 2.8606159.1735357 4.3993902.1859242h1.2781118c2.9907546-.0207471 3.95642-.2139816 4.6768437-1.4064227l.0983227-.1723424c.764361-1.4241985.1648309-2.548721-.9747412-3.3755348L25.631 26.971l.0912293-.1362605.1629318-.2641511L25.992 26.385l.0466679.0427821c.5516504.4732059 1.0836451.6468525 1.8890001.5513616 2.6200145-.3116105 2.5604594-3.5895097 1.1502083-8.0424822-.136678-.4315245-.2810058-.8567817-.4385987-1.2939849l-.1781698-.4846461c-.0923296-.2464665-.1903348-.5013359-.2976536-.7744519l-.3954267-.9868956L26.939 13.376l9399e-7-.279262c-.038761-7.60576089-3.8169423-12.93053326-10.6187985-13.09291824zm1023e-7 2c6.339972 32813e-8 9.0947051 5.25726658 8.9334981 11.7557738l.8516442 2.0748544c.5606846 1.3708665.9939584 2.4718584 1.3860782 3.7098724 1.2134003 3.8314013.8203049 5.4169539.5209683 5.4525554-.6424867.0761796-2.5006035-2.8842697-2.5006035-2.8842697.0 1.7141775-.8994592 3.9510027-2.8457046 5.5664147l.3377045.1073023c1.0249215.341207 2.6653848 1.0302704 2.2154641 1.7750936-.4078113.675007-6.9962271.4309917-8.8982689.2207732l-.4753503.0452169c-2.33636.195172-8.04423656.3608021-8.42291849-.2659901-.50418989-.8339832 1.61195836-1.5976385 2.55205373-1.8820678-1.94652419-1.615412-2.84615056-3.852456-2.84615056-5.5667428l-.32111727.4924567c-.56063792.838483-1.70355568 2.4482423-2.17943051 2.391813-.29933663-.0355468-.69254342-1.6211541.52102408-5.4525554l.21887662-.6654718c.52220361-1.5311231 1.13363576-2.9515889 2.01884579-5.1193097C6.8963095 7.36281332 9.58861109 2.00032813 15.999989 2z" fill="currentColor" fill-rule="nonzero"/></g></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>主页</span></a></li><li><a href=/%E5%8D%9A%E4%B8%BB/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>博主</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>博文</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>搜索</span></a></li><li><a href=/%E9%93%BE%E6%8E%A5/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>链接</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>暗色模式</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ul><li><a href=#一正规方程normal-equation>一、正规方程（Normal Equation）</a><ul><li><a href=#1一维线性回归代码实现>1、一维线性回归（代码实现）</a></li><li><a href=#2高维线性回归代码实现>2、高维线性回归（代码实现）</a></li><li><a href=#3高维线性回归sklearn库>3、高维线性回归（sklearn库）</a></li></ul></li><li><a href=#二梯度下降gradient-descent>二、梯度下降（Gradient Descent）</a><ul><li><a href=#1批量梯度下降gd>1、批量梯度下降（GD）</a><ul><li><a href=#代码实现>代码实现</a></li></ul></li><li><a href=#2随机梯度下降sgd>2、随机梯度下降（SGD）</a><ul><li><a href=#1代码实现>(1)、代码实现</a></li><li><a href=#2小幅优化打乱数据索引顺序选取向量>(2)、小幅优化：打乱数据索引，顺序选取向量</a></li></ul></li><li><a href=#3小批量梯度下降mini-batch-sgd>3、小批量梯度下降（Mini-batch SGD）</a><ul><li><a href=#1代码实现-1>(1)、代码实现</a></li><li><a href=#2小幅优化打乱数据索引顺序批量选取向量>(2)、小幅优化：打乱数据索引，顺序批量选取向量</a></li></ul></li><li><a href=#4sgd的sklearn库实现>4、SGD的sklearn库实现</a></li><li><a href=#5梯度下降法的问题与解决思路>5、梯度下降法的问题与解决思路</a><ul><li><a href=#1确定速率调整函数>（1）、确定速率调整函数</a></li><li><a href=#2更改学习速率>（2）、更改学习速率</a></li></ul></li></ul></li><li><a href=#三坐标下降coordinate-descent>三、坐标下降（Coordinate Descent）</a><ul><li><a href=#代码实现-1>代码实现</a></li></ul></li><li><a href=#四归一化normalization>四、归一化（Normalization）</a></li><li><a href=#五正则化regularization>五、正则化（Regularization）</a><ul><li><a href=#1lasso回归sklearn库>1、Lasso回归（sklearn库）</a></li><li><a href=#2ridge回归sklearn库>2、Ridge回归（sklearn库）</a></li><li><a href=#3elasticnet回归sklearn库>3、ElasticNet回归（sklearn库）</a></li><li><a href=#4随机梯度下降实现elasticnet正则化sklearn库>4、随机梯度下降实现elasticnet正则化（sklearn库）</a></li></ul></li><li><a href=#六升维方法--多项式回归polynomial-regression>六、升维方法 — 多项式回归（Polynomial Regression）</a></li><li><a href=#七实践--保险花销预测>七、实践 — 保险花销预测</a><ul><li><a href=#1数据提取>1、数据提取</a></li><li><a href=#2edaexploratory-data-analysis探索性数据分析>2、EDA（Exploratory Data Analysis，探索性数据分析）</a></li><li><a href=#3特征工程>3、特征工程</a></li><li><a href=#4模型训练>4、模型训练</a></li><li><a href=#5模型评估>5、模型评估</a></li><li><a href=#6进阶>6、进阶</a></li></ul></li></ul></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/>机器学习
</a><a href=/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/>学习笔记</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/>线性回归</a></h2><h3 class=article-subtitle>零基础 机器学习 第一部分</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published datetime=2025-12-02T13:16:53+08:00>Dec 02, 2025</time></div></footer></div></header><section class=article-content><h1 id=线性回归linear-regression>线性回归（Linear Regression）</h1><ul><li>任务类型分类：有监督学习</li><li>定义：拟合因变量(向量) <strong>y</strong> 与 <strong>x</strong> 之间呈线性关系，即 $\mathbf{y} = \mathbf{w}^T\mathbf{x} + \mathbf{b}$，其中 $\mathbf{x,y,w,b \in \mathbb{R}^n}$</li><li>目标：寻找参数最优解使得$\operatorname{Loss}$函数最小。$(\hat{\mathbf{w}}, \hat{\mathbf{b}}) = \operatorname{Loss}(\mathbf{y}, \hat{\mathbf{y}}) \Leftrightarrow\operatorname{Argmin}(\operatorname{Loss}(\mathbf{w}, \mathbf{b}))$<ul><li>多元线性回归常用损失函数 —— MSE(均方误差，由似然函数推导而来): $\displaystyle{\operatorname{\mathit{J}(\theta)} = \frac{1}{2} \displaystyle \sum_{i=1}^{m} (h_\theta(x^{(i)}) - y^{(i)})^2 = \frac{1}{2}(X\theta - y)^T(X\theta - y) = \frac{1}{2}(\theta^TX^TX\theta - \theta^TX^Ty - y^TX\theta + y^Ty)},系数可为\displaystyle{\frac{1}{2}、\frac{1}{n}、\frac{1}{2n}}$</li><li>MSE对 $\theta$ 的梯度: $\displaystyle{\frac{\partial{J}(\theta)}{\partial\theta} = X^TX\theta - X^Ty = 0 \Rightarrow \theta = (X^TX)^{-1}X^Ty}$</li></ul></li></ul><h2 id=一正规方程normal-equation>一、正规方程（Normal Equation）</h2><ul><li>参数解析解： $\hat{\theta} = (X^TX)^{-1}X^Ty$</li><li>可能存在的问题：$(X^TX)^{-1}$的求解可能比较困难</li></ul><h3 id=1一维线性回归代码实现>1、一维线性回归（代码实现）</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>matplotlib.pyplot</span> <span class=k>as</span> <span class=nn>plt</span>
</span></span><span class=line><span class=cl><span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>seed</span><span class=p>(</span><span class=mi>20030428</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 数据量</span>
</span></span><span class=line><span class=cl><span class=n>m</span> <span class=o>=</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 随机生成 x 序列</span>
</span></span><span class=line><span class=cl><span class=n>x</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>rand</span><span class=p>(</span><span class=n>m</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=c1># 模拟 x 对应的 y 标签，误差呈正态分布</span>
</span></span><span class=line><span class=cl><span class=n>y</span> <span class=o>=</span> <span class=mi>5</span> <span class=o>+</span> <span class=n>x</span><span class=o>*</span><span class=mi>4</span> <span class=o>+</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randn</span><span class=p>(</span><span class=n>m</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># 补充 x0 列</span>
</span></span><span class=line><span class=cl><span class=n>X</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>c_</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ones</span><span class=p>((</span><span class=n>m</span><span class=p>,</span><span class=mi>1</span><span class=p>)),</span><span class=n>x</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 参数的求解公式</span>
</span></span><span class=line><span class=cl><span class=n>w_hat</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>linalg</span><span class=o>.</span><span class=n>inv</span><span class=p>(</span><span class=n>X</span><span class=o>.</span><span class=n>T</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>X</span><span class=p>))</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>X</span><span class=o>.</span><span class=n>T</span><span class=p>)</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 预测</span>
</span></span><span class=line><span class=cl><span class=n>x_pre</span> <span class=o>=</span> <span class=p>[[</span><span class=mf>0.5</span><span class=p>],[</span><span class=mf>1.5</span><span class=p>]]</span>
</span></span><span class=line><span class=cl><span class=n>X_pre</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>c_</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ones</span><span class=p>((</span><span class=mi>2</span><span class=p>,</span><span class=mi>1</span><span class=p>)),</span><span class=n>x_pre</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>y_pre</span> <span class=o>=</span> <span class=n>X_pre</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>w_hat</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>scatter</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>label</span><span class=o>=</span><span class=s1>&#39;Original Data&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>scatter</span><span class=p>(</span><span class=n>x_pre</span><span class=p>,</span><span class=n>y_pre</span><span class=p>,</span><span class=n>label</span><span class=o>=</span><span class=s1>&#39;Predicted Data&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>X</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>w_hat</span><span class=p>),</span><span class=n>label</span><span class=o>=</span><span class=s1>&#39;Regression Model&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>legend</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/p/%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/output_3_0.png width=550 height=413 srcset="/p/%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/output_3_0_hu_f8da8d7f1abeca57.png 480w, /p/%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/output_3_0_hu_b02eb907fa49b87d.png 1024w" loading=lazy alt=png class=gallery-image data-flex-grow=133 data-flex-basis=319px></p><h3 id=2高维线性回归代码实现>2、高维线性回归（代码实现）</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl><span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>seed</span><span class=p>(</span><span class=mi>20030428</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 维度</span>
</span></span><span class=line><span class=cl><span class=n>n</span> <span class=o>=</span> <span class=mi>4</span> 
</span></span><span class=line><span class=cl><span class=c1># 数据量</span>
</span></span><span class=line><span class=cl><span class=n>m</span> <span class=o>=</span> <span class=mi>1000</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 设置预测值</span>
</span></span><span class=line><span class=cl><span class=n>x_pre</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>random</span><span class=p>(</span><span class=n>size</span> <span class=o>=</span> <span class=p>(</span><span class=mi>3</span><span class=p>,</span><span class=n>n</span><span class=p>))</span><span class=o>*</span><span class=mi>10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 随机生成 x 序列</span>
</span></span><span class=line><span class=cl><span class=n>x</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>rand</span><span class=p>(</span><span class=n>m</span><span class=p>,</span><span class=n>n</span><span class=p>)</span> <span class=o>*</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=c1># 补充 x0 列</span>
</span></span><span class=line><span class=cl><span class=n>X</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>c_</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ones</span><span class=p>((</span><span class=n>m</span><span class=p>,</span><span class=mi>1</span><span class=p>)),</span><span class=n>x</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=c1># 模拟 x 对应的 y 标签，误差呈正态分布</span>
</span></span><span class=line><span class=cl><span class=n>w</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>6</span><span class=p>,</span><span class=n>size</span><span class=o>=</span><span class=p>(</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>y</span> <span class=o>=</span> <span class=n>X</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>w</span><span class=p>)</span> <span class=o>+</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randn</span><span class=p>(</span><span class=n>m</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 参数的求解公式</span>
</span></span><span class=line><span class=cl><span class=n>w_hat</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>linalg</span><span class=o>.</span><span class=n>inv</span><span class=p>(</span><span class=n>X</span><span class=o>.</span><span class=n>T</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>X</span><span class=p>))</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>X</span><span class=o>.</span><span class=n>T</span><span class=p>)</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;W_hat:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>w_hat</span><span class=o>.</span><span class=n>reshape</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 预测</span>
</span></span><span class=line><span class=cl><span class=n>X_pre</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>c_</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ones</span><span class=p>((</span><span class=mi>3</span><span class=p>,</span><span class=mi>1</span><span class=p>)),</span><span class=n>x_pre</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>y_pre</span> <span class=o>=</span> <span class=n>X_pre</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>w_hat</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;X_pre: &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>x_pre</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Y_pre: &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>y_pre</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><pre><code>W_hat:
[[5.02671056 3.98404888 4.00452019 4.9783491  1.02490084]]
X_pre: 
[[0.03016482 4.79096225 5.74410225 4.2038564 ]
 [0.0650456  9.53496505 3.37288732 7.77475153]
 [2.68648726 5.44484467 6.07293252 8.00564199]]
Y_pre: 
[[57.23707594]
 [68.2285754 ]
 [75.97196488]]
</code></pre><h3 id=3高维线性回归sklearn库>3、高维线性回归（sklearn库）</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.linear_model</span> <span class=kn>import</span> <span class=n>LinearRegression</span>
</span></span><span class=line><span class=cl><span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>seed</span><span class=p>(</span><span class=mi>20030428</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 维度</span>
</span></span><span class=line><span class=cl><span class=n>n</span> <span class=o>=</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl><span class=c1># 数据量</span>
</span></span><span class=line><span class=cl><span class=n>m</span> <span class=o>=</span> <span class=mi>1000</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 设置预测值</span>
</span></span><span class=line><span class=cl><span class=n>x_pre</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>random</span><span class=p>(</span><span class=n>size</span> <span class=o>=</span> <span class=p>(</span><span class=mi>3</span><span class=p>,</span><span class=n>n</span><span class=p>))</span><span class=o>*</span><span class=mi>10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 随机生成 x 序列</span>
</span></span><span class=line><span class=cl><span class=n>x</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>rand</span><span class=p>(</span><span class=n>m</span><span class=p>,</span><span class=n>n</span><span class=p>)</span> <span class=o>*</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=c1># 补充 x0 列</span>
</span></span><span class=line><span class=cl><span class=n>X</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>c_</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ones</span><span class=p>((</span><span class=n>m</span><span class=p>,</span><span class=mi>1</span><span class=p>)),</span><span class=n>x</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=c1># 模拟 x 对应的 y 标签，误差呈正态分布</span>
</span></span><span class=line><span class=cl><span class=n>w</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>6</span><span class=p>,</span><span class=n>size</span><span class=o>=</span><span class=p>(</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>y</span> <span class=o>=</span> <span class=n>X</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>w</span><span class=p>)</span> <span class=o>+</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randn</span><span class=p>(</span><span class=n>m</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>reg</span> <span class=o>=</span> <span class=n>LinearRegression</span><span class=p>(</span><span class=n>fit_intercept</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>reg</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;W_hat:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>c_</span><span class=p>[</span><span class=n>reg</span><span class=o>.</span><span class=n>intercept_</span><span class=p>,</span><span class=n>reg</span><span class=o>.</span><span class=n>coef_</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 预测</span>
</span></span><span class=line><span class=cl><span class=n>y_pre</span> <span class=o>=</span> <span class=n>reg</span><span class=o>.</span><span class=n>predict</span><span class=p>(</span><span class=n>x_pre</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;X_pre: &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>x_pre</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Y_pre: &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>y_pre</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><pre><code>W_hat:
[[5.02671056 3.98404888 4.00452019 4.9783491  1.02490084]]
X_pre: 
[[0.03016482 4.79096225 5.74410225 4.2038564 ]
 [0.0650456  9.53496505 3.37288732 7.77475153]
 [2.68648726 5.44484467 6.07293252 8.00564199]]
Y_pre: 
[[57.23707594]
 [68.2285754 ]
 [75.97196488]]
</code></pre><h2 id=二梯度下降gradient-descent>二、梯度下降（Gradient Descent）</h2><ul><li>梯度下降法迭代公式：$\hat\theta_{k+1} = \hat\theta_k - \alpha \nabla_{\theta}J(\hat\theta)$, $\alpha$为学习率</li><li>学习率 $\alpha$ ：$\alpha$ 设置过大容易造成震荡，$\alpha$ 设置太小容易造成迭代次数增加，也可能落到局部最优解。一般设置为0.1、0.01、0.001、0.0001</li></ul><h3 id=1批量梯度下降gd>1、批量梯度下降（GD）</h3><ul><li>$$\displaystyle{\nabla_{\theta}J(\theta) = \frac{\partial}{\partial{\theta}}J(\theta) = \displaystyle \sum^{m}_{i=1}(h_\theta(x^{(i)}) - y^{(i)})x^{(i)} = X^T(X\theta-y)}$$</li></ul><h4 id=代码实现>代码实现</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>seed</span><span class=p>(</span><span class=mi>20030428</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 维度</span>
</span></span><span class=line><span class=cl><span class=n>n</span> <span class=o>=</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl><span class=c1># 数据量</span>
</span></span><span class=line><span class=cl><span class=n>m</span> <span class=o>=</span> <span class=mi>1000</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 设置预测值</span>
</span></span><span class=line><span class=cl><span class=n>x_pre</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>random</span><span class=p>(</span><span class=n>size</span> <span class=o>=</span> <span class=p>(</span><span class=mi>3</span><span class=p>,</span><span class=n>n</span><span class=p>))</span><span class=o>*</span><span class=mi>10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 超参数</span>
</span></span><span class=line><span class=cl><span class=n>learning_rate</span> <span class=o>=</span> <span class=mf>0.0001</span> <span class=c1># 学习率 α</span>
</span></span><span class=line><span class=cl><span class=n>n_iterations</span> <span class=o>=</span> <span class=mi>1000</span> <span class=c1># 迭代次数</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 随机生成 x 序列</span>
</span></span><span class=line><span class=cl><span class=n>x</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>rand</span><span class=p>(</span><span class=n>m</span><span class=p>,</span><span class=n>n</span><span class=p>)</span> <span class=o>*</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=c1># 补充 x0 列</span>
</span></span><span class=line><span class=cl><span class=n>X</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>c_</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ones</span><span class=p>((</span><span class=n>m</span><span class=p>,</span><span class=mi>1</span><span class=p>)),</span><span class=n>x</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=c1># 模拟 x 对应的 y 标签，误差呈正态分布</span>
</span></span><span class=line><span class=cl><span class=n>w</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>6</span><span class=p>,</span><span class=n>size</span><span class=o>=</span><span class=p>(</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>y</span> <span class=o>=</span> <span class=n>X</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>w</span><span class=p>)</span> <span class=o>+</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randn</span><span class=p>(</span><span class=n>m</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 初始化参数向量</span>
</span></span><span class=line><span class=cl><span class=n>w_init</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randn</span><span class=p>(</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># 求梯度</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>n_iteration</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>n_iterations</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>gradient</span> <span class=o>=</span> <span class=n>X</span><span class=o>.</span><span class=n>T</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>X</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>w_init</span><span class=p>)</span><span class=o>-</span><span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>w_init</span> <span class=o>=</span> <span class=n>w_init</span> <span class=o>-</span> <span class=n>learning_rate</span><span class=o>*</span><span class=n>gradient</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;W_hat:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>w_init</span><span class=o>.</span><span class=n>reshape</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 预测</span>
</span></span><span class=line><span class=cl><span class=n>y_pre</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>c_</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ones</span><span class=p>((</span><span class=mi>3</span><span class=p>,</span><span class=mi>1</span><span class=p>)),</span><span class=n>x_pre</span><span class=p>]</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>w_init</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;X_pre: &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>x_pre</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Y_pre: &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>y_pre</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><pre><code>W_hat:
[[5.02631227 3.98414324 4.00461388 4.97843832 1.02499615]]
X_pre: 
[[0.03016482 4.79096225 5.74410225 4.2038564 ]
 [0.0650456  9.53496505 3.37288732 7.77475153]
 [2.68648726 5.44484467 6.07293252 8.00564199]]
Y_pre: 
[[57.23804251]
 [68.23011847]
 [75.97363505]]
</code></pre><h3 id=2随机梯度下降sgd>2、随机梯度下降（SGD）</h3><ul><li>$$
\displaystyle {\nabla_{\theta}J(\theta) = \frac{\partial}{\partial\theta}J(\theta) = (h_\theta(x^{(i)})-y^{(i)})x^{(i)} = ({x^{(i)}})^T(x^{(i)}\theta-y^{(i)}) , i \sim \text{Uniform}\bigl(\{1,2,\dots,m\}\bigr)}
$$</li></ul><h4 id=1代码实现>(1)、代码实现</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>seed</span><span class=p>(</span><span class=mi>20030428</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 维度</span>
</span></span><span class=line><span class=cl><span class=n>n</span> <span class=o>=</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl><span class=c1># 数据量</span>
</span></span><span class=line><span class=cl><span class=n>m</span> <span class=o>=</span> <span class=mi>1000</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 设置预测值</span>
</span></span><span class=line><span class=cl><span class=n>x_pre</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>random</span><span class=p>(</span><span class=n>size</span> <span class=o>=</span> <span class=p>(</span><span class=mi>3</span><span class=p>,</span><span class=n>n</span><span class=p>))</span><span class=o>*</span><span class=mi>10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 超参数</span>
</span></span><span class=line><span class=cl><span class=n>learning_rate</span> <span class=o>=</span> <span class=mf>0.0001</span> <span class=c1># 学习率 α</span>
</span></span><span class=line><span class=cl><span class=n>n_iterations</span> <span class=o>=</span> <span class=mi>1000</span> <span class=c1># 迭代次数</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 随机生成 x 序列</span>
</span></span><span class=line><span class=cl><span class=n>x</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>rand</span><span class=p>(</span><span class=n>m</span><span class=p>,</span><span class=n>n</span><span class=p>)</span> <span class=o>*</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=c1># 补充 x0 列</span>
</span></span><span class=line><span class=cl><span class=n>X</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>c_</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ones</span><span class=p>((</span><span class=n>m</span><span class=p>,</span><span class=mi>1</span><span class=p>)),</span><span class=n>x</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=c1># 模拟 x 对应的 y 标签，误差呈正态分布</span>
</span></span><span class=line><span class=cl><span class=n>w</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>6</span><span class=p>,</span><span class=n>size</span><span class=o>=</span><span class=p>(</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>y</span> <span class=o>=</span> <span class=n>X</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>w</span><span class=p>)</span> <span class=o>+</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randn</span><span class=p>(</span><span class=n>m</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 初始化参数向量</span>
</span></span><span class=line><span class=cl><span class=n>w_init</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randn</span><span class=p>(</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># 求梯度</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>n_iteration</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>n_iterations</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>m</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>random_index</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=n>m</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>x_i</span> <span class=o>=</span> <span class=n>X</span><span class=p>[</span><span class=n>random_index</span><span class=p>:</span><span class=n>random_index</span><span class=o>+</span><span class=mi>1</span><span class=p>,:]</span>
</span></span><span class=line><span class=cl>        <span class=n>y_i</span> <span class=o>=</span> <span class=n>y</span><span class=p>[</span><span class=n>random_index</span><span class=p>:</span><span class=n>random_index</span><span class=o>+</span><span class=mi>1</span><span class=p>,:]</span>
</span></span><span class=line><span class=cl>        <span class=n>gradient</span> <span class=o>=</span> <span class=n>x_i</span><span class=o>.</span><span class=n>T</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>x_i</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>w_init</span><span class=p>)</span><span class=o>-</span><span class=n>y_i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>w_init</span> <span class=o>=</span> <span class=n>w_init</span> <span class=o>-</span> <span class=n>learning_rate</span><span class=o>*</span><span class=n>gradient</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;W_hat:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>w_init</span><span class=o>.</span><span class=n>reshape</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 预测</span>
</span></span><span class=line><span class=cl><span class=n>y_pre</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>c_</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ones</span><span class=p>((</span><span class=mi>3</span><span class=p>,</span><span class=mi>1</span><span class=p>)),</span><span class=n>x_pre</span><span class=p>]</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>w_init</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;X_pre: &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>x_pre</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Y_pre: &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>y_pre</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><pre><code>W_hat:
[[5.01922912 3.97831998 4.00264292 4.96386168 1.01662312]]
X_pre: 
[[0.03016482 4.79096225 5.74410225 4.2038564 ]
 [0.0650456  9.53496505 3.37288732 7.77475153]
 [2.68648726 5.44484467 6.07293252 8.00564199]]
Y_pre: 
[[57.1024122 ]
 [68.08959999]
 [75.78462184]]
</code></pre><h4 id=2小幅优化打乱数据索引顺序选取向量>(2)、小幅优化：打乱数据索引，顺序选取向量</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>seed</span><span class=p>(</span><span class=mi>20030428</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 维度</span>
</span></span><span class=line><span class=cl><span class=n>n</span> <span class=o>=</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl><span class=c1># 数据量</span>
</span></span><span class=line><span class=cl><span class=n>m</span> <span class=o>=</span> <span class=mi>1000</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 设置预测值</span>
</span></span><span class=line><span class=cl><span class=n>x_pre</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>random</span><span class=p>(</span><span class=n>size</span> <span class=o>=</span> <span class=p>(</span><span class=mi>3</span><span class=p>,</span><span class=n>n</span><span class=p>))</span><span class=o>*</span><span class=mi>10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 超参数</span>
</span></span><span class=line><span class=cl><span class=n>learning_rate</span> <span class=o>=</span> <span class=mf>0.0001</span> <span class=c1># 学习率 α</span>
</span></span><span class=line><span class=cl><span class=n>n_iterations</span> <span class=o>=</span> <span class=mi>1000</span> <span class=c1># 迭代次数</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 随机生成 x 序列</span>
</span></span><span class=line><span class=cl><span class=n>x</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>rand</span><span class=p>(</span><span class=n>m</span><span class=p>,</span><span class=n>n</span><span class=p>)</span> <span class=o>*</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=c1># 补充 x0 列</span>
</span></span><span class=line><span class=cl><span class=n>X</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>c_</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ones</span><span class=p>((</span><span class=n>m</span><span class=p>,</span><span class=mi>1</span><span class=p>)),</span><span class=n>x</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=c1># 模拟 x 对应的 y 标签，误差呈正态分布</span>
</span></span><span class=line><span class=cl><span class=n>w</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>6</span><span class=p>,</span><span class=n>size</span><span class=o>=</span><span class=p>(</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>y</span> <span class=o>=</span> <span class=n>X</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>w</span><span class=p>)</span> <span class=o>+</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randn</span><span class=p>(</span><span class=n>m</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 初始化参数向量</span>
</span></span><span class=line><span class=cl><span class=n>w_init</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randn</span><span class=p>(</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># 求梯度</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>n_iteration</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>n_iterations</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># 打乱顺序，顺序读取</span>
</span></span><span class=line><span class=cl>    <span class=n>index</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=n>m</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>shuffle</span><span class=p>(</span><span class=n>index</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>X</span> <span class=o>=</span> <span class=n>X</span><span class=p>[</span><span class=n>index</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>y</span> <span class=o>=</span> <span class=n>y</span><span class=p>[</span><span class=n>index</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>m</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>x_i</span> <span class=o>=</span> <span class=n>X</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>,:]</span>
</span></span><span class=line><span class=cl>        <span class=n>y_i</span> <span class=o>=</span> <span class=n>y</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>,:]</span>
</span></span><span class=line><span class=cl>        <span class=n>gradient</span> <span class=o>=</span> <span class=n>x_i</span><span class=o>.</span><span class=n>T</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>x_i</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>w_init</span><span class=p>)</span><span class=o>-</span><span class=n>y_i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>w_init</span> <span class=o>=</span> <span class=n>w_init</span> <span class=o>-</span> <span class=n>learning_rate</span><span class=o>*</span><span class=n>gradient</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;W_hat:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>w_init</span><span class=o>.</span><span class=n>reshape</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 预测</span>
</span></span><span class=line><span class=cl><span class=n>y_pre</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>c_</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ones</span><span class=p>((</span><span class=mi>3</span><span class=p>,</span><span class=mi>1</span><span class=p>)),</span><span class=n>x_pre</span><span class=p>]</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>w_init</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;X_pre: &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>x_pre</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Y_pre: &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>y_pre</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><pre><code>W_hat:
[[5.02675441 3.98450041 4.00505391 4.9789357  1.02541193]]
X_pre: 
[[0.03016482 4.79096225 5.74410225 4.2038564 ]
 [0.0650456  9.53496505 3.37288732 7.77475153]
 [2.68648726 5.44484467 6.07293252 8.00564199]]
Y_pre: 
[[57.24520848]
 [68.23968977]
 [75.98378179]]
</code></pre><h3 id=3小批量梯度下降mini-batch-sgd>3、小批量梯度下降（Mini-batch SGD）</h3><ul><li>$$
\displaystyle{\nabla_{\theta}J(\theta) = \frac{\partial}{\partial{\theta}}J(\theta) = \displaystyle \sum_{i\in S}(h_\theta(x^{(i)}) - y^{(i)})x^{(i)} = ({x^{(S)}})^T(x^{(S)}\theta-y^{(S)}) , |S|=\text{batch\_size} < m,\; S\subseteq \{1,2,\dots ,m\},\; S\text{均匀随机选取}}
$$</li></ul><h4 id=1代码实现-1>(1)、代码实现</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>seed</span><span class=p>(</span><span class=mi>20030428</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>x_pre</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>random</span><span class=p>(</span><span class=n>size</span> <span class=o>=</span> <span class=p>(</span><span class=mi>3</span><span class=p>,</span><span class=n>n</span><span class=p>))</span><span class=o>*</span><span class=mi>10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 维度</span>
</span></span><span class=line><span class=cl><span class=n>n</span> <span class=o>=</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl><span class=c1># 数据量</span>
</span></span><span class=line><span class=cl><span class=n>m</span> <span class=o>=</span> <span class=mi>1000</span>
</span></span><span class=line><span class=cl><span class=c1># 分批大小</span>
</span></span><span class=line><span class=cl><span class=n>batch_size</span> <span class=o>=</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl><span class=c1># 批次数</span>
</span></span><span class=line><span class=cl><span class=n>num_batches</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>m</span><span class=o>/</span><span class=n>batch_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 超参数</span>
</span></span><span class=line><span class=cl><span class=n>learning_rate</span> <span class=o>=</span> <span class=mf>0.0001</span> <span class=c1># 学习率 α</span>
</span></span><span class=line><span class=cl><span class=n>n_iterations</span> <span class=o>=</span> <span class=mi>1000</span> <span class=c1># 迭代次数</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 随机生成 x 序列</span>
</span></span><span class=line><span class=cl><span class=n>x</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>rand</span><span class=p>(</span><span class=n>m</span><span class=p>,</span><span class=n>n</span><span class=p>)</span> <span class=o>*</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=c1># 补充 x0 列</span>
</span></span><span class=line><span class=cl><span class=n>X</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>c_</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ones</span><span class=p>((</span><span class=n>m</span><span class=p>,</span><span class=mi>1</span><span class=p>)),</span><span class=n>x</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=c1># 模拟 x 对应的 y 标签，误差呈正态分布</span>
</span></span><span class=line><span class=cl><span class=n>w</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>6</span><span class=p>,</span><span class=n>size</span><span class=o>=</span><span class=p>(</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>y</span> <span class=o>=</span> <span class=n>X</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>w</span><span class=p>)</span> <span class=o>+</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randn</span><span class=p>(</span><span class=n>m</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 初始化参数向量</span>
</span></span><span class=line><span class=cl><span class=n>w_init</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randn</span><span class=p>(</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># 求梯度</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>n_iteration</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>n_iterations</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>num_batches</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>random_index</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=n>m</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>x_s</span> <span class=o>=</span> <span class=n>X</span><span class=p>[</span><span class=n>random_index</span><span class=p>:</span><span class=n>random_index</span><span class=o>+</span><span class=n>batch_size</span><span class=p>,:]</span>
</span></span><span class=line><span class=cl>        <span class=n>y_s</span> <span class=o>=</span> <span class=n>y</span><span class=p>[</span><span class=n>random_index</span><span class=p>:</span><span class=n>random_index</span><span class=o>+</span><span class=n>batch_size</span><span class=p>,:]</span>
</span></span><span class=line><span class=cl>        <span class=n>gradient</span> <span class=o>=</span> <span class=n>x_s</span><span class=o>.</span><span class=n>T</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>x_s</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>w_init</span><span class=p>)</span><span class=o>-</span><span class=n>y_s</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>w_init</span> <span class=o>=</span> <span class=n>w_init</span> <span class=o>-</span> <span class=n>learning_rate</span><span class=o>*</span><span class=n>gradient</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;W_hat:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>w_init</span><span class=o>.</span><span class=n>reshape</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 预测</span>
</span></span><span class=line><span class=cl><span class=n>y_pre</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>c_</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ones</span><span class=p>((</span><span class=mi>3</span><span class=p>,</span><span class=mi>1</span><span class=p>)),</span><span class=n>x_pre</span><span class=p>]</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>w_init</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;X_pre: &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>x_pre</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Y_pre: &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>y_pre</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><pre><code>W_hat:
[[5.04016211 3.9927612  4.01168955 4.96684374 1.00728303]]
X_pre: 
[[0.03016482 4.79096225 5.74410225 4.2038564 ]
 [0.0650456  9.53496505 3.37288732 7.77475153]
 [2.68648726 5.44484467 6.07293252 8.00564199]]
Y_pre: 
[[57.14498768]
 [68.13517282]
 [75.83694482]]
</code></pre><h4 id=2小幅优化打乱数据索引顺序批量选取向量>(2)、小幅优化：打乱数据索引，顺序批量选取向量</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>seed</span><span class=p>(</span><span class=mi>20030428</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>x_pre</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>random</span><span class=p>(</span><span class=n>size</span> <span class=o>=</span> <span class=p>(</span><span class=mi>3</span><span class=p>,</span><span class=n>n</span><span class=p>))</span><span class=o>*</span><span class=mi>10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 维度</span>
</span></span><span class=line><span class=cl><span class=n>n</span> <span class=o>=</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl><span class=c1># 数据量</span>
</span></span><span class=line><span class=cl><span class=n>m</span> <span class=o>=</span> <span class=mi>1000</span>
</span></span><span class=line><span class=cl><span class=c1># 分批大小</span>
</span></span><span class=line><span class=cl><span class=n>batch_size</span> <span class=o>=</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl><span class=c1># 批次数</span>
</span></span><span class=line><span class=cl><span class=n>num_batches</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>m</span><span class=o>/</span><span class=n>batch_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 超参数</span>
</span></span><span class=line><span class=cl><span class=n>learning_rate</span> <span class=o>=</span> <span class=mf>0.0001</span> <span class=c1># 学习率 α</span>
</span></span><span class=line><span class=cl><span class=n>n_iterations</span> <span class=o>=</span> <span class=mi>1000</span> <span class=c1># 迭代次数</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 随机生成 x 序列</span>
</span></span><span class=line><span class=cl><span class=n>x</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>rand</span><span class=p>(</span><span class=n>m</span><span class=p>,</span><span class=n>n</span><span class=p>)</span> <span class=o>*</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=c1># 补充 x0 列</span>
</span></span><span class=line><span class=cl><span class=n>X</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>c_</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ones</span><span class=p>((</span><span class=n>m</span><span class=p>,</span><span class=mi>1</span><span class=p>)),</span><span class=n>x</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=c1># 模拟 x 对应的 y 标签，误差呈正态分布</span>
</span></span><span class=line><span class=cl><span class=n>w</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>6</span><span class=p>,</span><span class=n>size</span><span class=o>=</span><span class=p>(</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>y</span> <span class=o>=</span> <span class=n>X</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>w</span><span class=p>)</span> <span class=o>+</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randn</span><span class=p>(</span><span class=n>m</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 初始化参数向量</span>
</span></span><span class=line><span class=cl><span class=n>w_init</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randn</span><span class=p>(</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># 求梯度</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>n_iteration</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>n_iterations</span><span class=p>):</span>
</span></span><span class=line><span class=cl>     <span class=c1># 打乱顺序，顺序读取</span>
</span></span><span class=line><span class=cl>    <span class=n>index</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=n>m</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>shuffle</span><span class=p>(</span><span class=n>index</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>X</span> <span class=o>=</span> <span class=n>X</span><span class=p>[</span><span class=n>index</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>y</span> <span class=o>=</span> <span class=n>y</span><span class=p>[</span><span class=n>index</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>num_batches</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>x_s</span> <span class=o>=</span> <span class=n>X</span><span class=p>[</span><span class=n>i</span><span class=o>*</span><span class=n>batch_size</span><span class=p>:</span><span class=n>i</span><span class=o>*</span><span class=n>batch_size</span><span class=o>+</span><span class=n>batch_size</span><span class=p>,:]</span>
</span></span><span class=line><span class=cl>        <span class=n>y_s</span> <span class=o>=</span> <span class=n>y</span><span class=p>[</span><span class=n>i</span><span class=o>*</span><span class=n>batch_size</span><span class=p>:</span><span class=n>i</span><span class=o>*</span><span class=n>batch_size</span><span class=o>+</span><span class=n>batch_size</span><span class=p>,:]</span>
</span></span><span class=line><span class=cl>        <span class=n>gradient</span> <span class=o>=</span> <span class=n>x_s</span><span class=o>.</span><span class=n>T</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>x_s</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>w_init</span><span class=p>)</span><span class=o>-</span><span class=n>y_s</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>w_init</span> <span class=o>=</span> <span class=n>w_init</span> <span class=o>-</span> <span class=n>learning_rate</span><span class=o>*</span><span class=n>gradient</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;W_hat:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>w_init</span><span class=o>.</span><span class=n>reshape</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 预测</span>
</span></span><span class=line><span class=cl><span class=n>y_pre</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>c_</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ones</span><span class=p>((</span><span class=mi>3</span><span class=p>,</span><span class=mi>1</span><span class=p>)),</span><span class=n>x_pre</span><span class=p>]</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>w_init</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;X_pre: &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>x_pre</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Y_pre: &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>y_pre</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><pre><code>W_hat:
[[5.0267601  3.98450244 4.00504673 4.978934   1.02541437]]
X_pre: 
[[0.03016482 4.79096225 5.74410225 4.2038564 ]
 [0.0650456  9.53496505 3.37288732 7.77475153]
 [2.68648726 5.44484467 6.07293252 8.00564199]]
Y_pre: 
[[57.24518034]
 [68.23964038]
 [75.98376306]]
</code></pre><h3 id=4sgd的sklearn库实现>4、SGD的sklearn库实现</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.linear_model</span> <span class=kn>import</span> <span class=n>SGDRegressor</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>seed</span><span class=p>(</span><span class=mi>20030428</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>x_pre</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>random</span><span class=p>(</span><span class=n>size</span> <span class=o>=</span> <span class=p>(</span><span class=mi>3</span><span class=p>,</span><span class=n>n</span><span class=p>))</span><span class=o>*</span><span class=mi>10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 维度</span>
</span></span><span class=line><span class=cl><span class=n>n</span> <span class=o>=</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl><span class=c1># 数据量</span>
</span></span><span class=line><span class=cl><span class=n>m</span> <span class=o>=</span> <span class=mi>1000</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 超参数</span>
</span></span><span class=line><span class=cl><span class=n>learning_rate</span> <span class=o>=</span> <span class=mf>0.001</span> <span class=c1># 学习率 α</span>
</span></span><span class=line><span class=cl><span class=n>n_iterations</span> <span class=o>=</span> <span class=mi>10000</span> <span class=c1># 迭代轮次</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 随机生成 x 序列</span>
</span></span><span class=line><span class=cl><span class=n>x</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>rand</span><span class=p>(</span><span class=n>m</span><span class=p>,</span><span class=n>n</span><span class=p>)</span> <span class=o>*</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=c1># 补充 x0 列</span>
</span></span><span class=line><span class=cl><span class=n>X</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>c_</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ones</span><span class=p>((</span><span class=n>m</span><span class=p>,</span><span class=mi>1</span><span class=p>)),</span><span class=n>x</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=c1># 模拟 x 对应的 y 标签，误差呈正态分布</span>
</span></span><span class=line><span class=cl><span class=n>w</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>6</span><span class=p>,</span><span class=n>size</span><span class=o>=</span><span class=p>(</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>y</span> <span class=o>=</span> <span class=n>X</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>w</span><span class=p>)</span> <span class=o>+</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randn</span><span class=p>(</span><span class=n>m</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sgd_reg</span> <span class=o>=</span> <span class=n>SGDRegressor</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>loss</span><span class=o>=</span><span class=s1>&#39;squared_error&#39;</span><span class=p>,</span> <span class=c1># MSE</span>
</span></span><span class=line><span class=cl>    <span class=n>penalty</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=c1># 无正则项</span>
</span></span><span class=line><span class=cl>    <span class=n>alpha</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span> <span class=c1># 无正则强度</span>
</span></span><span class=line><span class=cl>    <span class=n>learning_rate</span> <span class=o>=</span> <span class=s1>&#39;constant&#39;</span><span class=p>,</span> <span class=c1># 学习率</span>
</span></span><span class=line><span class=cl>    <span class=n>eta0</span> <span class=o>=</span> <span class=n>learning_rate</span><span class=p>,</span> <span class=c1># 固定学习率</span>
</span></span><span class=line><span class=cl>    <span class=n>fit_intercept</span> <span class=o>=</span> <span class=kc>True</span><span class=p>,</span> <span class=c1># 增加偏置列</span>
</span></span><span class=line><span class=cl>    <span class=n>max_iter</span> <span class=o>=</span> <span class=n>n_iterations</span> <span class=o>*</span> <span class=n>m</span><span class=p>,</span> <span class=c1># 迭代次数</span>
</span></span><span class=line><span class=cl>    <span class=n>warm_start</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span> <span class=c1># 不进行手动迭代，直接迭代完成</span>
</span></span><span class=line><span class=cl>    <span class=n>random_state</span> <span class=o>=</span> <span class=mi>20030428</span><span class=p>,</span> <span class=c1># 打乱样本的随机种子</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sgd_reg</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=o>.</span><span class=n>flatten</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;W_hat:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>c_</span><span class=p>[</span><span class=n>sgd_reg</span><span class=o>.</span><span class=n>intercept_</span><span class=p>,</span><span class=n>sgd_reg</span><span class=o>.</span><span class=n>coef_</span><span class=o>.</span><span class=n>reshape</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>)])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 预测</span>
</span></span><span class=line><span class=cl><span class=n>y_pre</span> <span class=o>=</span> <span class=n>sgd_reg</span><span class=o>.</span><span class=n>predict</span><span class=p>(</span><span class=n>x_pre</span><span class=p>)</span><span class=o>.</span><span class=n>reshape</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;X_pre: &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>x_pre</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Y_pre: &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>y_pre</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><pre><code>W_hat:
[[4.78413833 4.04362443 4.06423645 5.03733553 1.08352435]]
X_pre: 
[[0.03016482 4.79096225 5.74410225 4.2038564 ]
 [0.0650456  9.53496505 3.37288732 7.77475153]
 [2.68648726 5.44484467 6.07293252 8.00564199]]
Y_pre: 
[[57.86766804]
 [69.21400854]
 [77.04212681]]
</code></pre><h3 id=5梯度下降法的问题与解决思路>5、梯度下降法的问题与解决思路</h3><ul><li>学习速率调整（学习速率调度，Learning rate schedules）：该方法试图在每次更新参数的过程中，改变学习速率。一般使用某种事先设定的策略或者在每次迭代中衰减一个较小的阈值</li><li>在稀疏特征数据中：很少出现的特征应该使用一个相对较大的学习速率</li><li>对于非凸目标函数：可能落入鞍点或平滑点</li></ul><h4 id=1确定速率调整函数>（1）、确定速率调整函数</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>matplotlib.pyplot</span> <span class=k>as</span> <span class=nn>plt</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>t0</span><span class=p>,</span><span class=n>t1</span> <span class=o>=</span> <span class=mi>5</span><span class=p>,</span><span class=mi>50000</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>learning_rate_schedule</span><span class=p>(</span><span class=n>alpha</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>t0</span><span class=o>/</span><span class=p>(</span><span class=n>alpha</span> <span class=o>*</span> <span class=mi>1000</span> <span class=o>+</span> <span class=n>t1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>x_show</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>linspace</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>1000</span><span class=p>,</span><span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>y_show</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=n>learning_rate_schedule</span><span class=p>(</span><span class=n>x_show</span><span class=p>[</span><span class=n>i</span><span class=p>])</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>x_show</span><span class=p>))])</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>x_show</span><span class=p>,</span><span class=n>y_show</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><pre><code>[&lt;matplotlib.lines.Line2D at 0x1a768afe390&gt;]
</code></pre><p><img src=/p/%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/output_26_1.png width=583 height=413 srcset="/p/%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/output_26_1_hu_c0e8219bab56abc5.png 480w, /p/%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/output_26_1_hu_68cf1c8707aab9d7.png 1024w" loading=lazy alt=png class=gallery-image data-flex-grow=141 data-flex-basis=338px></p><h4 id=2更改学习速率>（2）、更改学习速率</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>seed</span><span class=p>(</span><span class=mi>20030428</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 维度</span>
</span></span><span class=line><span class=cl><span class=n>n</span> <span class=o>=</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl><span class=c1># 数据量</span>
</span></span><span class=line><span class=cl><span class=n>m</span> <span class=o>=</span> <span class=mi>1000</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 设置预测值</span>
</span></span><span class=line><span class=cl><span class=n>x_pre</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>random</span><span class=p>(</span><span class=n>size</span> <span class=o>=</span> <span class=p>(</span><span class=mi>3</span><span class=p>,</span><span class=n>n</span><span class=p>))</span><span class=o>*</span><span class=mi>10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 超参数</span>
</span></span><span class=line><span class=cl><span class=c1># learning_rate = 0.0001 # 学习率 α</span>
</span></span><span class=line><span class=cl><span class=n>n_iterations</span> <span class=o>=</span> <span class=mi>1000</span> <span class=c1># 迭代次数</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 随机生成 x 序列</span>
</span></span><span class=line><span class=cl><span class=n>x</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>rand</span><span class=p>(</span><span class=n>m</span><span class=p>,</span><span class=n>n</span><span class=p>)</span> <span class=o>*</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=c1># 补充 x0 列</span>
</span></span><span class=line><span class=cl><span class=n>X</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>c_</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ones</span><span class=p>((</span><span class=n>m</span><span class=p>,</span><span class=mi>1</span><span class=p>)),</span><span class=n>x</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=c1># 模拟 x 对应的 y 标签，误差呈正态分布</span>
</span></span><span class=line><span class=cl><span class=n>w</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>6</span><span class=p>,</span><span class=n>size</span><span class=o>=</span><span class=p>(</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>y</span> <span class=o>=</span> <span class=n>X</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>w</span><span class=p>)</span> <span class=o>+</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randn</span><span class=p>(</span><span class=n>m</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 初始化参数向量</span>
</span></span><span class=line><span class=cl><span class=n>w_init</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randn</span><span class=p>(</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># 求梯度</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>n_iteration</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>n_iterations</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>gradient</span> <span class=o>=</span> <span class=n>X</span><span class=o>.</span><span class=n>T</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>X</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>w_init</span><span class=p>)</span><span class=o>-</span><span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>w_init</span> <span class=o>=</span> <span class=n>w_init</span> <span class=o>-</span> <span class=n>learning_rate_schedule</span><span class=p>(</span><span class=n>n_iteration</span><span class=p>)</span><span class=o>*</span><span class=n>gradient</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;W_hat:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>w_init</span><span class=o>.</span><span class=n>reshape</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 预测</span>
</span></span><span class=line><span class=cl><span class=n>y_pre</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>c_</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ones</span><span class=p>((</span><span class=mi>3</span><span class=p>,</span><span class=mi>1</span><span class=p>)),</span><span class=n>x_pre</span><span class=p>]</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>w_init</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;X_pre: &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>x_pre</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Y_pre: &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>y_pre</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><pre><code>W_hat:
[[4.97242598 3.99644548 4.01333635 4.98719143 1.04554164]]
X_pre: 
[[0.03016482 4.79096225 5.74410225 4.2038564 ]
 [0.0650456  9.53496505 3.37288732 7.77475153]
 [2.68648726 5.44484467 6.07293252 8.00564199]]
Y_pre: 
[[57.36296538]
 [68.4494602 ]
 [76.21792798]]
</code></pre><h2 id=三坐标下降coordinate-descent>三、坐标下降（Coordinate Descent）</h2><ul><li>坐标下降：一次走一步，每次只动一个变量。将高维问题拆成一系列一维问题，逐个坐标迭代更新，直到收敛</li><li>核心思想：固定其他所有变量，只沿第i个坐标方向做一维最优化，循环往复</li><li>迭代公式：$\displaystyle{\theta_i^{(k+1)} = \arg\min_{\theta_i}Loss(\theta_1^{(k+1)}, \dots, \theta_{i-1}^{(k+1)}, \theta_i, \theta_{i+1}^{(k)}, \dots, \theta_n^{(k)})}$，其中 $Loss$ 为目标损失函数，$\theta^{(k)}$ 为第 $k$ 次迭代时的完整参数向量，$\theta^{(k)}_i$ 为第 $k$ 次迭代时向量 $\theta$ 的第 $i$ 个分量</li><li>对于MES的参数迭代公式（由MSE推导而来）：
$$
\displaystyle{\theta_j = \frac{\displaystyle{ \sum^m_{i=1}x^{(i)}_j(y^{(i)}-\sum_{k\neq j}\theta_kx^{(i)}_k)}}{\displaystyle{\sum^m_{i=1}(x_j^{(i)})^2}}}\Rightarrow \theta^{(k+1)}_j = \theta^{(k)}_j - \displaystyle{\frac{1}{X_{·j}^TX_{·j}}X_{·j}^T(X\theta-y)}
$$，其中 $m$ 为样本数量，$\theta_j$ 为 $\theta$ 的第 $j$ 个分量，$x^{(i)}_j$ 为第 $i$ 条样本的第 $j$ 个分量</li></ul><h3 id=代码实现-1>代码实现</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>seed</span><span class=p>(</span><span class=mi>20030428</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 维度</span>
</span></span><span class=line><span class=cl><span class=n>n</span> <span class=o>=</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl><span class=c1># 数据量</span>
</span></span><span class=line><span class=cl><span class=n>m</span> <span class=o>=</span> <span class=mi>1000</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 设置预测值</span>
</span></span><span class=line><span class=cl><span class=n>x_pre</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>random</span><span class=p>(</span><span class=n>size</span> <span class=o>=</span> <span class=p>(</span><span class=mi>3</span><span class=p>,</span><span class=n>n</span><span class=p>))</span><span class=o>*</span><span class=mi>10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 超参数</span>
</span></span><span class=line><span class=cl><span class=n>n_iterations</span> <span class=o>=</span> <span class=mi>1000</span> <span class=c1># 迭代次数</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 随机生成 x 序列</span>
</span></span><span class=line><span class=cl><span class=n>x</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>rand</span><span class=p>(</span><span class=n>m</span><span class=p>,</span><span class=n>n</span><span class=p>)</span> <span class=o>*</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=c1># 补充 x0 列</span>
</span></span><span class=line><span class=cl><span class=n>X</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>c_</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ones</span><span class=p>((</span><span class=n>m</span><span class=p>,</span><span class=mi>1</span><span class=p>)),</span><span class=n>x</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=c1># 模拟 x 对应的 y 标签，误差呈正态分布</span>
</span></span><span class=line><span class=cl><span class=n>w</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>6</span><span class=p>,</span><span class=n>size</span><span class=o>=</span><span class=p>(</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>y</span> <span class=o>=</span> <span class=n>X</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>w</span><span class=p>)</span> <span class=o>+</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randn</span><span class=p>(</span><span class=n>m</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 初始化参数向量</span>
</span></span><span class=line><span class=cl><span class=n>theta</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>(</span><span class=n>shape</span><span class=o>=</span><span class=p>(</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>n_iterations</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>theta</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>        <span class=n>theta</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=n>theta</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>-</span>  <span class=p>(</span><span class=mi>1</span><span class=o>/</span><span class=p>(</span><span class=n>X</span><span class=p>[:,</span><span class=n>j</span><span class=p>]</span><span class=nd>@X</span><span class=p>[:,</span><span class=n>j</span><span class=p>]))</span><span class=o>*</span><span class=n>X</span><span class=p>[:,</span><span class=n>j</span><span class=p>]</span><span class=o>@</span><span class=p>(</span><span class=n>X</span><span class=nd>@theta</span> <span class=o>-</span> <span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;W_hat:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>theta</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 预测</span>
</span></span><span class=line><span class=cl><span class=n>y_pre</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>c_</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ones</span><span class=p>((</span><span class=mi>3</span><span class=p>,</span><span class=mi>1</span><span class=p>)),</span><span class=n>x_pre</span><span class=p>]</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>theta</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;X_pre: &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>x_pre</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Y_pre: &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>y_pre</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><pre><code>W_hat:
[[5.02671056]
 [3.98404888]
 [4.00452019]
 [4.9783491 ]
 [1.02490084]]
X_pre: 
[[0.03016482 4.79096225 5.74410225 4.2038564 ]
 [0.0650456  9.53496505 3.37288732 7.77475153]
 [2.68648726 5.44484467 6.07293252 8.00564199]]
Y_pre: 
[[57.23707594]
 [68.2285754 ]
 [75.97196488]]
</code></pre><h2 id=四归一化normalization>四、归一化（Normalization）</h2><ul><li>归一化是将不同尺度、纲量和分布的数据缩放到同一标准区间的预处理技术</li><li>核心目的：消除纲量影响、加速模型收敛、提升数值稳定性，同时保留原始信息的相对关系</li><li>特征级归一化方法<ul><li>最大值最小值归一化（Min-Max）：受离心值影响较大<ul><li>对第j个特征值做归一化：$$\displaystyle{x^{*}_{i,j} = \frac{x_{i,j}-x_j^{\text{min}}}{x_j^{\text{max}}-x_j^{\text{min}}}}$$</li><li>对整个数据集做归一化：$\displaystyle{x^* = \frac{x-min(x)}{max(x)-min(x)}}$</li></ul></li><li>标准归一化（Z-score）：<ul><li>对第j个特征值做归一化：
$$
\displaystyle{x^*_{i,j} = \frac{x_{i,j} - \mu_j}{\sigma_j}}
$$
，其中
$$
\displaystyle{\mu_j=\frac{1}{n}\sum_{i=1}^n x_{i,j},\quad \sigma_j=\sqrt{\frac{1}{n} \sum_{i=1}^n (x_{i,j}-\mu_j)^2}}
$$</li></ul></li></ul></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.preprocessing</span> <span class=kn>import</span> <span class=n>MinMaxScaler</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.preprocessing</span> <span class=kn>import</span> <span class=n>StandardScaler</span>
</span></span><span class=line><span class=cl><span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>seed</span><span class=p>(</span><span class=mi>20030428</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 数据维度</span>
</span></span><span class=line><span class=cl><span class=n>n</span> <span class=o>=</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl><span class=c1># 数据规模</span>
</span></span><span class=line><span class=cl><span class=n>m</span> <span class=o>=</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 初始化数据</span>
</span></span><span class=line><span class=cl><span class=n>x</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>empty</span><span class=p>((</span><span class=n>m</span><span class=p>,</span> <span class=mi>2</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>x</span><span class=p>[:,</span> <span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>normal</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=n>m</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>x</span><span class=p>[:,</span> <span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>random</span><span class=p>(</span><span class=n>m</span><span class=p>)</span> <span class=o>*</span> <span class=mi>10</span><span class=o>-</span><span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>scatter</span><span class=p>(</span><span class=n>x</span><span class=p>[:,</span><span class=mi>0</span><span class=p>],</span><span class=n>x</span><span class=p>[:,</span><span class=mi>1</span><span class=p>],</span><span class=n>label</span><span class=o>=</span><span class=s1>&#39;original&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Min-Max归一化</span>
</span></span><span class=line><span class=cl><span class=n>minmax_scaler</span> <span class=o>=</span> <span class=n>MinMaxScaler</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>x_min_max_normalization</span> <span class=o>=</span> <span class=n>minmax_scaler</span><span class=o>.</span><span class=n>fit_transform</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>scatter</span><span class=p>(</span><span class=n>x_min_max_normalization</span><span class=p>[:,</span><span class=mi>0</span><span class=p>],</span><span class=n>x_min_max_normalization</span><span class=p>[:,</span><span class=mi>1</span><span class=p>],</span><span class=n>label</span><span class=o>=</span><span class=s1>&#39;min-max&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>minmax_scaler</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Z-score归一化</span>
</span></span><span class=line><span class=cl><span class=n>standar_scaler</span> <span class=o>=</span> <span class=n>StandardScaler</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>x_standar_scaler</span> <span class=o>=</span> <span class=n>standar_scaler</span><span class=o>.</span><span class=n>fit_transform</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>scatter</span><span class=p>(</span><span class=n>x_standar_scaler</span><span class=p>[:,</span><span class=mi>0</span><span class=p>],</span><span class=n>x_standar_scaler</span><span class=p>[:,</span><span class=mi>1</span><span class=p>],</span><span class=n>label</span><span class=o>=</span><span class=s1>&#39;z-score&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>standar_scaler</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;μ =&#39;</span><span class=p>,</span> <span class=n>standar_scaler</span><span class=o>.</span><span class=n>mean_</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;σ² =&#39;</span><span class=p>,</span> <span class=n>standar_scaler</span><span class=o>.</span><span class=n>var_</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>legend</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><pre><code>μ = [1.07725633 2.44897092]
σ² = [3.86482916 7.93336293]
</code></pre><p><img src=/p/%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/output_34_1.png width=546 height=413 srcset="/p/%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/output_34_1_hu_ecc0325949a87b79.png 480w, /p/%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/output_34_1_hu_2b8e9680da3f1bed.png 1024w" loading=lazy alt=png class=gallery-image data-flex-grow=132 data-flex-basis=317px></p><h2 id=五正则化regularization>五、正则化（Regularization）</h2><ul><li>过拟合与欠拟合<ul><li>欠拟合（underfit）：未拟合到位，训练集和测试集准确率未达到最高</li><li>过拟合（overfit）：拟合过度，训练集准确率升高的同时，测试集的准确率反而降低</li><li>适度拟合（just right）：过拟合前，训练集和测试集准确率都达到最高时刻</li></ul></li><li>正则化：防止过拟合，增加模型鲁棒性（Robust）<ul><li>鲁棒性调优：使模型具有更好的鲁棒性，让模型的的泛化能力和推广能力更加强大</li><li>正则化本质：牺牲模型在训练集上的正确率以提高模型的推广能力，参数 <strong>w</strong> 在数值上越小越好，进而抵抗数值扰动。但 <strong>w</strong> 的数值不能极小，故而将原来的损失函数加上一个惩罚项</li></ul></li><li>惩罚项（正则项）：<ul><li>L1 正则项：$\displaystyle{L_1(w) = \sum^m_{i=0}|w_i|}$（曼哈顿距离），$\displaystyle{\frac{\partial}{\partial w_i}L_1(w_i) = sign(w_i) = \pm 1}$</li><li>L2 正则项：$\displaystyle{L_2(w) = \sum^m_{i=0}|w_i|^2}$（欧式距离的平方），$\displaystyle{\frac{\partial}{\partial w_i}L_2(w_i) = 2w_i}$</li></ul></li><li>正则化后的多元线性回归的损失函数<ul><li>Lasso 回归（套索回归，稀疏性）：<ul><li>损失函数 $J_{lasso}(\theta)=MSE(\theta)+L_1(\theta)$</li><li>梯度 $\displaystyle{\nabla_{\theta}J_{Lasso}(\theta)=\frac{\partial}{\partial \theta}J(\theta)+\frac{\partial}{\partial \theta}L_1(\theta)=X^T(X\theta-y)+\lambda sign(\theta)}$</li></ul></li><li>Ridge 回归（岭回归，平滑性）：<ul><li>损失函数 $J_{ridge}(\theta)=MSE(\theta)+L_2(\theta)$</li><li>梯度 $\displaystyle{\nabla_{\theta}J_{Ridge}(\theta)=\frac{\partial}{\partial \theta}J(\theta)+\frac{\partial}{\partial \theta}L_2(\theta)=X^T(X\theta-y)+2\lambda \theta}$</li></ul></li><li>ElasticNet回归（弹性网络回归）：<ul><li>损失函数 $J_{lasso}(\theta)=MSE(\theta)+L_1(\theta)+L_2(\theta)$</li><li>梯度 $\displaystyle{\nabla_{\theta}J_{Lasso}(\theta)=\frac{\partial}{\partial \theta}J(\theta)+\frac{\partial}{\partial \theta}L_1(\theta)+\frac{\partial}{\partial \theta}L_2(\theta)=X^T(X\theta-y)+\lambda[(1-r)sign(\theta)+2r\theta)]}$</li></ul></li></ul></li><li>注：Lasso 回归与 Ridge 回归只定义了 Loss 函数模型，可以用梯度下降法、坐标下降法、最小角回归（LARS）、正规方程等方法进行求解。在 sklearn 库中 Lasso 和 ElasticNet 使用坐标下降；Ridge 使用正规方程；SVGRegressor 使用随机梯度下降，可自定义正则化类型、正则化强度、学习率、阈值、迭代次数等等</li></ul><h3 id=1lasso回归sklearn库>1、Lasso回归（sklearn库）</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.linear_model</span> <span class=kn>import</span> <span class=n>Lasso</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>seed</span><span class=p>(</span><span class=mi>20030428</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 维度</span>
</span></span><span class=line><span class=cl><span class=n>n</span> <span class=o>=</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl><span class=c1># 数据量</span>
</span></span><span class=line><span class=cl><span class=n>m</span> <span class=o>=</span> <span class=mi>1000</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 设置预测值</span>
</span></span><span class=line><span class=cl><span class=n>x_pre</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>random</span><span class=p>(</span><span class=n>size</span> <span class=o>=</span> <span class=p>(</span><span class=mi>3</span><span class=p>,</span><span class=n>n</span><span class=p>))</span><span class=o>*</span><span class=mi>10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 随机生成 x 序列</span>
</span></span><span class=line><span class=cl><span class=n>x</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>rand</span><span class=p>(</span><span class=n>m</span><span class=p>,</span><span class=n>n</span><span class=p>)</span> <span class=o>*</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=c1># 补充 x0 列</span>
</span></span><span class=line><span class=cl><span class=n>X</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>c_</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ones</span><span class=p>((</span><span class=n>m</span><span class=p>,</span><span class=mi>1</span><span class=p>)),</span><span class=n>x</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=c1># 模拟 x 对应的 y 标签，误差呈正态分布</span>
</span></span><span class=line><span class=cl><span class=n>w</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>6</span><span class=p>,</span><span class=n>size</span><span class=o>=</span><span class=p>(</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>y</span> <span class=o>=</span> <span class=n>X</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>w</span><span class=p>)</span> <span class=o>+</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randn</span><span class=p>(</span><span class=n>m</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>lasso_reg</span> <span class=o>=</span> <span class=n>Lasso</span><span class=p>(</span><span class=n>alpha</span><span class=o>=</span><span class=mf>0.0015</span><span class=p>,</span><span class=n>max_iter</span><span class=o>=</span><span class=mi>30000000</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>lasso_reg</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;W_hat:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>c_</span><span class=p>[</span><span class=n>lasso_reg</span><span class=o>.</span><span class=n>intercept_</span><span class=p>,</span><span class=n>lasso_reg</span><span class=o>.</span><span class=n>coef_</span><span class=o>.</span><span class=n>reshape</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>)])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 预测</span>
</span></span><span class=line><span class=cl><span class=n>y_pre</span> <span class=o>=</span> <span class=n>lasso_reg</span><span class=o>.</span><span class=n>predict</span><span class=p>(</span><span class=n>x_pre</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;X_pre: &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>x_pre</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Y_pre: &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>y_pre</span><span class=o>.</span><span class=n>reshape</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>W_hat:
</span></span><span class=line><span class=cl>[[5.0464025  3.97908982 3.99958499 4.97364032 1.01995191]]
</span></span><span class=line><span class=cl>X_pre: 
</span></span><span class=line><span class=cl>[[0.03016482 4.79096225 5.74410225 4.2038564 ]
</span></span><span class=line><span class=cl> [0.0650456  9.53496505 3.37288732 7.77475153]
</span></span><span class=line><span class=cl> [2.68648726 5.44484467 6.07293252 8.00564199]]
</span></span><span class=line><span class=cl>Y_pre: 
</span></span><span class=line><span class=cl>[[57.18512159]
</span></span><span class=line><span class=cl> [68.14652889]
</span></span><span class=line><span class=cl> [75.88324745]]
</span></span></code></pre></td></tr></table></div></div><h3 id=2ridge回归sklearn库>2、Ridge回归（sklearn库）</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.linear_model</span> <span class=kn>import</span> <span class=n>Ridge</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>seed</span><span class=p>(</span><span class=mi>20030428</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 维度</span>
</span></span><span class=line><span class=cl><span class=n>n</span> <span class=o>=</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl><span class=c1># 数据量</span>
</span></span><span class=line><span class=cl><span class=n>m</span> <span class=o>=</span> <span class=mi>1000</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 设置预测值</span>
</span></span><span class=line><span class=cl><span class=n>x_pre</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>random</span><span class=p>(</span><span class=n>size</span> <span class=o>=</span> <span class=p>(</span><span class=mi>3</span><span class=p>,</span><span class=n>n</span><span class=p>))</span><span class=o>*</span><span class=mi>10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 随机生成 x 序列</span>
</span></span><span class=line><span class=cl><span class=n>x</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>rand</span><span class=p>(</span><span class=n>m</span><span class=p>,</span><span class=n>n</span><span class=p>)</span> <span class=o>*</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=c1># 补充 x0 列</span>
</span></span><span class=line><span class=cl><span class=n>X</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>c_</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ones</span><span class=p>((</span><span class=n>m</span><span class=p>,</span><span class=mi>1</span><span class=p>)),</span><span class=n>x</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=c1># 模拟 x 对应的 y 标签，误差呈正态分布</span>
</span></span><span class=line><span class=cl><span class=n>w</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>6</span><span class=p>,</span><span class=n>size</span><span class=o>=</span><span class=p>(</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>y</span> <span class=o>=</span> <span class=n>X</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>w</span><span class=p>)</span> <span class=o>+</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randn</span><span class=p>(</span><span class=n>m</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ridge_reg</span> <span class=o>=</span> <span class=n>Ridge</span><span class=p>(</span><span class=n>alpha</span><span class=o>=</span><span class=mf>0.4</span><span class=p>,</span><span class=n>solver</span><span class=o>=</span><span class=s1>&#39;sag&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ridge_reg</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;W_hat:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>c_</span><span class=p>[</span><span class=n>ridge_reg</span><span class=o>.</span><span class=n>intercept_</span><span class=p>,</span><span class=n>ridge_reg</span><span class=o>.</span><span class=n>coef_</span><span class=o>.</span><span class=n>reshape</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>)])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 预测</span>
</span></span><span class=line><span class=cl><span class=n>y_pre</span> <span class=o>=</span> <span class=n>ridge_reg</span><span class=o>.</span><span class=n>predict</span><span class=p>(</span><span class=n>x_pre</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;X_pre: &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>x_pre</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Y_pre: &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>y_pre</span><span class=o>.</span><span class=n>reshape</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><pre><code>W_hat:
[[5.04469365 3.97896047 3.99922338 4.97248436 1.02326193]]
X_pre: 
[[0.03016482 4.79096225 5.74410225 4.2038564 ]
 [0.0650456  9.53496505 3.37288732 7.77475153]
 [2.68648726 5.44484467 6.07293252 8.00564199]]
Y_pre: 
[[57.18895127]
 [68.16319935]
 [75.89870099]]
</code></pre><h3 id=3elasticnet回归sklearn库>3、ElasticNet回归（sklearn库）</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.linear_model</span> <span class=kn>import</span> <span class=n>ElasticNet</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>seed</span><span class=p>(</span><span class=mi>20030428</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 维度</span>
</span></span><span class=line><span class=cl><span class=n>n</span> <span class=o>=</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl><span class=c1># 数据量</span>
</span></span><span class=line><span class=cl><span class=n>m</span> <span class=o>=</span> <span class=mi>1000</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 设置预测值</span>
</span></span><span class=line><span class=cl><span class=n>x_pre</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>random</span><span class=p>(</span><span class=n>size</span> <span class=o>=</span> <span class=p>(</span><span class=mi>3</span><span class=p>,</span><span class=n>n</span><span class=p>))</span><span class=o>*</span><span class=mi>10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 随机生成 x 序列</span>
</span></span><span class=line><span class=cl><span class=n>x</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>rand</span><span class=p>(</span><span class=n>m</span><span class=p>,</span><span class=n>n</span><span class=p>)</span> <span class=o>*</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=c1># 补充 x0 列</span>
</span></span><span class=line><span class=cl><span class=n>X</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>c_</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ones</span><span class=p>((</span><span class=n>m</span><span class=p>,</span><span class=mi>1</span><span class=p>)),</span><span class=n>x</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=c1># 模拟 x 对应的 y 标签，误差呈正态分布</span>
</span></span><span class=line><span class=cl><span class=n>w</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>6</span><span class=p>,</span><span class=n>size</span><span class=o>=</span><span class=p>(</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>y</span> <span class=o>=</span> <span class=n>X</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>w</span><span class=p>)</span> <span class=o>+</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randn</span><span class=p>(</span><span class=n>m</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>elasticnet_reg</span> <span class=o>=</span> <span class=n>ElasticNet</span><span class=p>(</span><span class=n>alpha</span><span class=o>=</span><span class=mf>0.01</span><span class=p>,</span><span class=n>l1_ratio</span><span class=o>=</span><span class=mf>0.2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>elasticnet_reg</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;W_hat:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>c_</span><span class=p>[</span><span class=n>elasticnet_reg</span><span class=o>.</span><span class=n>intercept_</span><span class=p>,</span><span class=n>elasticnet_reg</span><span class=o>.</span><span class=n>coef_</span><span class=o>.</span><span class=n>reshape</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>)])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 预测</span>
</span></span><span class=line><span class=cl><span class=n>y_pre</span> <span class=o>=</span> <span class=n>elasticnet_reg</span><span class=o>.</span><span class=n>predict</span><span class=p>(</span><span class=n>x_pre</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;X_pre: &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>x_pre</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Y_pre: &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>y_pre</span><span class=o>.</span><span class=n>reshape</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><pre><code>W_hat:
[[5.40784751 3.87770911 3.89554975 4.85588961 0.98362001]]
X_pre: 
[[0.03016482 4.79096225 5.74410225 4.2038564 ]
 [0.0650456  9.53496505 3.37288732 7.77475153]
 [2.68648726 5.44484467 6.07293252 8.00564199]]
Y_pre: 
[[56.21597338]
 [66.82977581]
 [74.39992651]]
</code></pre><h3 id=4随机梯度下降实现elasticnet正则化sklearn库>4、随机梯度下降实现elasticnet正则化（sklearn库）</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.linear_model</span> <span class=kn>import</span> <span class=n>SGDRegressor</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>seed</span><span class=p>(</span><span class=mi>20030428</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 维度</span>
</span></span><span class=line><span class=cl><span class=n>n</span> <span class=o>=</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl><span class=c1># 数据量</span>
</span></span><span class=line><span class=cl><span class=n>m</span> <span class=o>=</span> <span class=mi>1000</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 设置预测值</span>
</span></span><span class=line><span class=cl><span class=n>x_pre</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>random</span><span class=p>(</span><span class=n>size</span> <span class=o>=</span> <span class=p>(</span><span class=mi>3</span><span class=p>,</span><span class=n>n</span><span class=p>))</span><span class=o>*</span><span class=mi>10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 随机生成 x 序列</span>
</span></span><span class=line><span class=cl><span class=n>x</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>rand</span><span class=p>(</span><span class=n>m</span><span class=p>,</span><span class=n>n</span><span class=p>)</span> <span class=o>*</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=c1># 补充 x0 列</span>
</span></span><span class=line><span class=cl><span class=n>X</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>c_</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ones</span><span class=p>((</span><span class=n>m</span><span class=p>,</span><span class=mi>1</span><span class=p>)),</span><span class=n>x</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=c1># 模拟 x 对应的 y 标签，误差呈正态分布</span>
</span></span><span class=line><span class=cl><span class=n>w</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>6</span><span class=p>,</span><span class=n>size</span><span class=o>=</span><span class=p>(</span><span class=n>n</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>y</span> <span class=o>=</span> <span class=n>X</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>w</span><span class=p>)</span> <span class=o>+</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randn</span><span class=p>(</span><span class=n>m</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sgd_reg</span> <span class=o>=</span> <span class=n>SGDRegressor</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>penalty</span><span class=o>=</span><span class=s1>&#39;elasticnet&#39;</span><span class=p>,</span> <span class=c1># 正则化类型</span>
</span></span><span class=line><span class=cl>    <span class=n>max_iter</span> <span class=o>=</span> <span class=mi>100000</span><span class=p>,</span> <span class=c1># 迭代次数</span>
</span></span><span class=line><span class=cl>    <span class=n>alpha</span> <span class=o>=</span> <span class=mf>0.01</span><span class=p>,</span> <span class=c1># 正则化强度 λ</span>
</span></span><span class=line><span class=cl>    <span class=n>l1_ratio</span><span class=o>=</span><span class=mf>0.2</span><span class=p>,</span> <span class=c1># l1正则化比例</span>
</span></span><span class=line><span class=cl>    <span class=n>tol</span> <span class=o>=</span> <span class=mf>1e-10</span><span class=p>,</span> <span class=c1># 收敛阈值</span>
</span></span><span class=line><span class=cl>    <span class=c1># ……</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sgd_reg</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=o>.</span><span class=n>ravel</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;W_hat:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>c_</span><span class=p>[</span><span class=n>sgd_reg</span><span class=o>.</span><span class=n>intercept_</span><span class=p>,</span><span class=n>sgd_reg</span><span class=o>.</span><span class=n>coef_</span><span class=o>.</span><span class=n>reshape</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>)])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 预测</span>
</span></span><span class=line><span class=cl><span class=n>y_pre</span> <span class=o>=</span> <span class=n>sgd_reg</span><span class=o>.</span><span class=n>predict</span><span class=p>(</span><span class=n>x_pre</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;X_pre: &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>x_pre</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Y_pre: &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>y_pre</span><span class=o>.</span><span class=n>reshape</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><pre><code>W_hat:
[[5.1320958  3.93664843 3.95394899 4.913876   1.04281603]]
X_pre: 
[[0.03016482 4.79096225 5.74410225 4.2038564 ]
 [0.0650456  9.53496505 3.37288732 7.77475153]
 [2.68648726 5.44484467 6.07293252 8.00564199]]
Y_pre: 
[[56.80371943]
 [67.77050846]
 [75.42653888]]
</code></pre><h2 id=六升维方法--多项式回归polynomial-regression>六、升维方法 — 多项式回归（Polynomial Regression）</h2><ul><li>目的：解决欠拟合问题</li><li>常见手段：将已知维度进行相乘来构建新的维度，将非线性Data转换为线性Data</li><li>以二阶多项式升维为例：$y=w_0+w_1x_1+w_2x_2 $$\Rightarrow y^*=w_0+w_1x_1+w_2x_2+w_3x_1^2+w_4x_2^2+w_5x_1x_2$</li><li>以下面拟合过程为例：$D_3$ 达到最佳拟合。随着维度的增加，$D_3$ 以下训练集和测试集误差均减小，属于欠拟合；$D_3$ 以上训练集误差减小，测试集误差增大，属于过拟合</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>matplotlib.pyplot</span> <span class=k>as</span> <span class=nn>plt</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.preprocessing</span> <span class=kn>import</span> <span class=n>PolynomialFeatures</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.linear_model</span> <span class=kn>import</span> <span class=n>LinearRegression</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.metrics</span> <span class=kn>import</span> <span class=n>mean_squared_error</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>seed</span><span class=p>(</span><span class=mi>20030428</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>xlim</span><span class=p>(</span><span class=o>-</span><span class=mi>21</span><span class=p>,</span> <span class=mi>51</span><span class=p>)</span>      <span class=c1># 横轴</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>ylim</span><span class=p>(</span><span class=o>-</span><span class=mi>8000</span><span class=p>,</span> <span class=mi>4000</span><span class=p>)</span>   <span class=c1># 纵轴</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 预设函数</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>mapping</span><span class=p>(</span><span class=n>x</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mf>0.2</span><span class=o>*</span><span class=n>x</span><span class=o>**</span><span class=mi>3</span> <span class=o>-</span> <span class=mi>10</span><span class=o>*</span><span class=n>x</span><span class=o>**</span><span class=mi>2</span> <span class=o>+</span> <span class=mi>5</span><span class=o>*</span><span class=n>x</span> <span class=o>-</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 维度</span>
</span></span><span class=line><span class=cl><span class=n>n</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>x_show</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>linspace</span><span class=p>(</span><span class=o>-</span><span class=mi>20</span><span class=p>,</span><span class=mi>50</span><span class=p>,</span><span class=mi>10000</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>x_show</span><span class=p>,</span><span class=n>mapping</span><span class=p>(</span><span class=n>x_show</span><span class=p>),</span><span class=n>color</span><span class=o>=</span><span class=s1>&#39;C0&#39;</span><span class=p>,</span><span class=n>label</span><span class=o>=</span><span class=s1>&#39;scheduled model&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 训练集数据量</span>
</span></span><span class=line><span class=cl><span class=n>train_size</span><span class=o>=</span> <span class=mi>10000</span>
</span></span><span class=line><span class=cl><span class=c1># 测试集数据量</span>
</span></span><span class=line><span class=cl><span class=n>test_size</span> <span class=o>=</span> <span class=mi>10000</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 随机生成训练集</span>
</span></span><span class=line><span class=cl><span class=n>x_train</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>rand</span><span class=p>(</span><span class=n>m</span><span class=p>,</span><span class=n>n</span><span class=p>)</span> <span class=o>*</span> <span class=mi>60</span> <span class=o>-</span> <span class=mi>20</span>
</span></span><span class=line><span class=cl><span class=n>y_train</span> <span class=o>=</span> <span class=n>mapping</span><span class=p>(</span><span class=n>x_train</span><span class=p>)</span> <span class=o>+</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randn</span><span class=p>(</span><span class=n>m</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=mi>1111</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>scatter</span><span class=p>(</span><span class=n>x_train</span><span class=p>,</span><span class=n>y_train</span><span class=p>,</span><span class=n>color</span><span class=o>=</span><span class=s1>&#39;C1&#39;</span><span class=p>,</span><span class=n>s</span><span class=o>=</span><span class=mi>5</span><span class=p>,</span><span class=n>label</span><span class=o>=</span><span class=s1>&#39;train set data&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 随机生成测试集</span>
</span></span><span class=line><span class=cl><span class=n>x_test</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>rand</span><span class=p>(</span><span class=n>m</span><span class=p>,</span><span class=n>n</span><span class=p>)</span> <span class=o>*</span> <span class=mi>400</span> <span class=o>-</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl><span class=n>y_test</span> <span class=o>=</span> <span class=n>mapping</span><span class=p>(</span><span class=n>x_test</span><span class=p>)</span> <span class=o>+</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randn</span><span class=p>(</span><span class=n>m</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=mi>1111</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>scatter</span><span class=p>(</span><span class=n>x_test</span><span class=p>,</span><span class=n>y_test</span><span class=p>,</span><span class=n>color</span><span class=o>=</span><span class=s1>&#39;C2&#39;</span><span class=p>,</span><span class=n>s</span><span class=o>=</span><span class=mi>5</span><span class=p>,</span><span class=n>label</span><span class=o>=</span><span class=s1>&#39;train set data&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>### 升维预测 ###</span>
</span></span><span class=line><span class=cl><span class=c1># dimensions = {2:&#39;C3&#39;}</span>
</span></span><span class=line><span class=cl><span class=n>dimensions</span> <span class=o>=</span> <span class=p>{</span><span class=mi>1</span><span class=p>:</span><span class=s1>&#39;C8&#39;</span><span class=p>,</span><span class=mi>2</span><span class=p>:</span><span class=s1>&#39;C3&#39;</span><span class=p>,</span><span class=mi>3</span><span class=p>:</span><span class=s1>&#39;C4&#39;</span><span class=p>,</span><span class=mi>4</span><span class=p>:</span><span class=s1>&#39;C5&#39;</span><span class=p>,</span><span class=mi>5</span><span class=p>:</span><span class=s1>&#39;C9&#39;</span><span class=p>,</span><span class=mi>6</span><span class=p>:</span><span class=s1>&#39;C7&#39;</span><span class=p>,</span><span class=mi>7</span><span class=p>:</span><span class=s1>&#39;C6&#39;</span><span class=p>,</span><span class=mi>8</span><span class=p>:</span><span class=s1>&#39;C10&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>dim</span><span class=p>,</span><span class=n>color</span> <span class=ow>in</span> <span class=n>dimensions</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=c1># 多项式升维</span>
</span></span><span class=line><span class=cl>    <span class=n>poly_features</span> <span class=o>=</span> <span class=n>PolynomialFeatures</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>degree</span><span class=o>=</span><span class=n>dim</span><span class=p>,</span> <span class=c1># 设置维度</span>
</span></span><span class=line><span class=cl>        <span class=n>include_bias</span><span class=o>=</span><span class=kc>True</span> <span class=c1># 设置截距</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># 训练集和测试集升维</span>
</span></span><span class=line><span class=cl>    <span class=n>x_train_poly</span> <span class=o>=</span> <span class=n>poly_features</span><span class=o>.</span><span class=n>fit_transform</span><span class=p>(</span><span class=n>x_train</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>x_test_poly</span> <span class=o>=</span> <span class=n>poly_features</span><span class=o>.</span><span class=n>fit_transform</span><span class=p>(</span><span class=n>x_test</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># 线性回归</span>
</span></span><span class=line><span class=cl>    <span class=n>lin_reg</span> <span class=o>=</span> <span class=n>LinearRegression</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>fit_intercept</span><span class=o>=</span><span class=kc>False</span> <span class=c1># 不加偏置</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>lin_reg</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>x_train_poly</span><span class=p>,</span><span class=n>y_train</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>y_train_pre</span> <span class=o>=</span> <span class=n>lin_reg</span><span class=o>.</span><span class=n>predict</span><span class=p>(</span><span class=n>x_train_poly</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>y_test_pre</span> <span class=o>=</span> <span class=n>lin_reg</span><span class=o>.</span><span class=n>predict</span><span class=p>(</span><span class=n>x_test_poly</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>train_norm</span> <span class=o>=</span> <span class=n>mean_squared_error</span><span class=p>(</span><span class=n>y_train</span><span class=p>,</span><span class=n>y_train_pre</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>test_norm</span> <span class=o>=</span> <span class=n>mean_squared_error</span><span class=p>(</span><span class=n>y_test</span><span class=p>,</span><span class=n>y_test_pre</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>lab</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;D:</span><span class=si>{</span><span class=n>dim</span><span class=si>}</span><span class=s2>/Train:</span><span class=si>{</span><span class=n>train_norm</span><span class=o>/</span><span class=mf>1e6</span><span class=si>:</span><span class=s2>.5f</span><span class=si>}</span><span class=s2>/Test:</span><span class=si>{</span><span class=n>test_norm</span><span class=o>/</span><span class=mf>1e6</span><span class=si>:</span><span class=s2>.5f</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>x_show_poly</span> <span class=o>=</span> <span class=n>poly_features</span><span class=o>.</span><span class=n>fit_transform</span><span class=p>(</span><span class=n>x_show</span><span class=o>.</span><span class=n>reshape</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>x_show</span><span class=p>,</span><span class=n>lin_reg</span><span class=o>.</span><span class=n>predict</span><span class=p>(</span><span class=n>x_show_poly</span><span class=p>),</span><span class=n>color</span><span class=o>=</span><span class=n>dimensions</span><span class=p>[</span><span class=n>dim</span><span class=p>],</span><span class=n>label</span><span class=o>=</span><span class=n>lab</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>legend</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>loc</span><span class=o>=</span><span class=s1>&#39;upper left&#39;</span><span class=p>,</span> <span class=c1># 以legend左上角为基准点</span>
</span></span><span class=line><span class=cl>    <span class=n>bbox_to_anchor</span><span class=o>=</span><span class=p>(</span><span class=mf>1.02</span><span class=p>,</span> <span class=mi>1</span><span class=p>),</span> <span class=c1># 距离原点的相对位置，图像为0-1</span>
</span></span><span class=line><span class=cl>    <span class=n>borderaxespad</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=c1># 间距值</span>
</span></span><span class=line><span class=cl>    <span class=n>ncol</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=c1># 分几列</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><pre><code>&lt;matplotlib.legend.Legend at 0x1a768d8d150&gt;
</code></pre><p><img src=/p/%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/output_45_1.png width=993 height=418 srcset="/p/%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/output_45_1_hu_6158c7ba51946e0f.png 480w, /p/%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/output_45_1_hu_b2879fb357e3dfa4.png 1024w" loading=lazy alt=png class=gallery-image data-flex-grow=237 data-flex-basis=570px></p><h2 id=七实践--保险花销预测>七、实践 — 保险花销预测</h2><ul><li>数据集路径： &ldquo;.\Dataset\1_Insurance_Expense_Forecast\insurance.csv&rdquo;</li></ul><h3 id=1数据提取>1、数据提取</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pandas</span> <span class=k>as</span> <span class=nn>pd</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_csv</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;./Dataset/1_Insurance_Expense_Forecast/insurance.csv&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>sep</span><span class=o>=</span><span class=s1>&#39;,&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>data</span><span class=o>.</span><span class=n>head</span><span class=p>(</span><span class=mi>6</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><div><style scoped>.dataframe tbody tr th:only-of-type{vertical-align:middle}<pre><code>.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</code></pre><p></style></p><table border=1 class=dataframe><thead><tr style=text-align:right><th></th><th>age</th><th>sex</th><th>bmi</th><th>children</th><th>smoker</th><th>region</th><th>charges</th></tr></thead><tbody><tr><th>0</th><td>19</td><td>female</td><td>27.900</td><td>0</td><td>yes</td><td>southwest</td><td>16884.92400</td></tr><tr><th>1</th><td>18</td><td>male</td><td>33.770</td><td>1</td><td>no</td><td>southeast</td><td>1725.55230</td></tr><tr><th>2</th><td>28</td><td>male</td><td>33.000</td><td>3</td><td>no</td><td>southeast</td><td>4449.46200</td></tr><tr><th>3</th><td>33</td><td>male</td><td>22.705</td><td>0</td><td>no</td><td>northwest</td><td>21984.47061</td></tr><tr><th>4</th><td>32</td><td>male</td><td>28.880</td><td>0</td><td>no</td><td>northwest</td><td>3866.85520</td></tr><tr><th>5</th><td>31</td><td>female</td><td>25.740</td><td>0</td><td>no</td><td>southeast</td><td>3756.62160</td></tr></tbody></table></div><h3 id=2edaexploratory-data-analysis探索性数据分析>2、EDA（Exploratory Data Analysis，探索性数据分析）</h3><ul><li>本质：在把数据喂给算法之前，先用人眼和统计工具观察和清洗数据</li><li>目的：发现数据长什么样、哪里脏、哪里怪、哪里藏着有用的信号，从而为后续的特征工程、模型选择、甚至业务决策提供直觉和依据</li><li>发现charges出现右偏问题，通过特征工程中数值变换的取对数手段进行处理</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 观察数据结构信息</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>info</span><span class=p>())</span> <span class=c1># 结果显示数据质量较好，无缺失值</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>describe</span><span class=p>())</span>
</span></span></code></pre></td></tr></table></div></div><pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 1338 entries, 0 to 1337
Data columns (total 7 columns):
 #   Column    Non-Null Count  Dtype  
---  ------    --------------  -----  
 0   age       1338 non-null   int64  
 1   sex       1338 non-null   object 
 2   bmi       1338 non-null   float64
 3   children  1338 non-null   int64  
 4   smoker    1338 non-null   object 
 5   region    1338 non-null   object 
 6   charges   1338 non-null   float64
dtypes: float64(2), int64(2), object(3)
memory usage: 73.3+ KB
None
               age          bmi     children       charges
count  1338.000000  1338.000000  1338.000000   1338.000000
mean     39.207025    30.663397     1.094918  13270.422265
std      14.049960     6.098187     1.205493  12110.011237
min      18.000000    15.960000     0.000000   1121.873900
25%      27.000000    26.296250     0.000000   4740.287150
50%      39.000000    30.400000     1.000000   9382.033000
75%      51.000000    34.693750     2.000000  16639.912515
max      64.000000    53.130000     5.000000  63770.428010
</code></pre><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 观察数据分布</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>matplotlib.pyplot</span> <span class=k>as</span> <span class=nn>plt</span>
</span></span><span class=line><span class=cl><span class=c1># %matplotlib inline</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>rcParams</span><span class=p>[</span><span class=s1>&#39;font.family&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;sans-serif&#39;</span>      <span class=c1># 1. 启用 sans-serif 列表</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>rcParams</span><span class=p>[</span><span class=s1>&#39;font.sans-serif&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;SimHei&#39;</span><span class=p>]</span>    <span class=c1># 2. 把 SimHei 放在最前</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>rcParams</span><span class=p>[</span><span class=s1>&#39;axes.unicode_minus&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=kc>False</span>      <span class=c1># 3. 让负号正常显示（可选）</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>figure</span><span class=p>(</span><span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span> <span class=mi>8</span><span class=p>))</span> <span class=c1># 设置画布大小</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>subplot</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span> <span class=c1># 第一个子图</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>hist</span><span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=s1>&#39;age&#39;</span><span class=p>],</span> <span class=n>bins</span><span class=o>=</span><span class=mi>20</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;lightgreen&#39;</span><span class=p>,</span> <span class=n>edgecolor</span><span class=o>=</span><span class=s1>&#39;k&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>xlabel</span><span class=p>(</span><span class=s1>&#39;Ages&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>ylabel</span><span class=p>(</span><span class=s1>&#39;Count&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>title</span><span class=p>(</span><span class=s1>&#39;Distribution of Age&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>subplot</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span> <span class=c1># 第二个子图</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>hist</span><span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=s1>&#39;bmi&#39;</span><span class=p>],</span> <span class=n>bins</span><span class=o>=</span><span class=mi>25</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;salmon&#39;</span><span class=p>,</span> <span class=n>edgecolor</span><span class=o>=</span><span class=s1>&#39;k&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>xlabel</span><span class=p>(</span><span class=s1>&#39;BMI&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>ylabel</span><span class=p>(</span><span class=s1>&#39;Count&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>title</span><span class=p>(</span><span class=s1>&#39;Distribution of BMI&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>subplot</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span> <span class=c1># 第三个子图</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>hist</span><span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=s1>&#39;children&#39;</span><span class=p>],</span> <span class=n>bins</span><span class=o>=</span><span class=mi>6</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;gold&#39;</span><span class=p>,</span> <span class=n>edgecolor</span><span class=o>=</span><span class=s1>&#39;k&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>xlabel</span><span class=p>(</span><span class=s1>&#39;Children&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>ylabel</span><span class=p>(</span><span class=s1>&#39;Count&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>title</span><span class=p>(</span><span class=s1>&#39;Distribution of Children&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ax_charges</span><span class=o>=</span><span class=n>plt</span><span class=o>.</span><span class=n>subplot</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>4</span><span class=p>)</span> <span class=c1># 第四个子图</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>hist</span><span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=s1>&#39;charges&#39;</span><span class=p>],</span> <span class=n>bins</span><span class=o>=</span><span class=mi>30</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;skyblue&#39;</span><span class=p>,</span> <span class=n>edgecolor</span><span class=o>=</span><span class=s1>&#39;k&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>xlabel</span><span class=p>(</span><span class=s1>&#39;Charges&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>ylabel</span><span class=p>(</span><span class=s1>&#39;Count&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>title</span><span class=p>(</span><span class=s1>&#39;Distribution of Charges&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ax_charges</span><span class=o>.</span><span class=n>text</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=mf>0.95</span><span class=p>,</span><span class=mf>0.95</span><span class=p>,</span> <span class=c1># 百分比坐标</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;右偏（positively skewed / right-skewed）</span><span class=se>\n</span><span class=s1>指分布的尾部向右（值大的一侧）拖得很长</span><span class=se>\n</span><span class=s1>均值 &gt; 中位数&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>transform</span><span class=o>=</span><span class=n>ax_charges</span><span class=o>.</span><span class=n>transAxes</span><span class=p>,</span> <span class=c1># 用子图的坐标系</span>
</span></span><span class=line><span class=cl>    <span class=n>va</span><span class=o>=</span><span class=s1>&#39;top&#39;</span><span class=p>,</span><span class=n>ha</span><span class=o>=</span><span class=s1>&#39;right&#39;</span><span class=p>,</span> <span class=c1># 文本框基准点选取</span>
</span></span><span class=line><span class=cl>    <span class=n>fontsize</span> <span class=o>=</span> <span class=mi>10</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>bbox</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>boxstyle</span><span class=o>=</span><span class=s1>&#39;round,pad=0.3&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>facecolor</span><span class=o>=</span><span class=p>(</span><span class=mf>0.9</span><span class=p>,</span><span class=mf>0.9</span><span class=p>,</span><span class=mf>0.9</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=n>alpha</span><span class=o>=</span><span class=mf>0.5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>tight_layout</span><span class=p>()</span> <span class=c1># 自动调整间距</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/p/%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/output_51_0.png width=990 height=790 srcset="/p/%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/output_51_0_hu_731b240234b22934.png 480w, /p/%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/output_51_0_hu_dbbf73824ec82fec.png 1024w" loading=lazy alt=png class=gallery-image data-flex-grow=125 data-flex-basis=300px></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 压缩优化异常标签值</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ax</span> <span class=o>=</span> <span class=n>plt</span><span class=o>.</span><span class=n>subplot</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ax</span><span class=o>.</span><span class=n>text</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=mf>0.55</span><span class=p>,</span><span class=mf>0.95</span><span class=p>,</span> <span class=c1># 百分比坐标</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;通过ln函数将原右偏拖尾压缩，</span><span class=se>\n</span><span class=s1>使结果更接近正态&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>transform</span><span class=o>=</span><span class=n>ax</span><span class=o>.</span><span class=n>transAxes</span><span class=p>,</span> <span class=c1># 用子图的坐标系</span>
</span></span><span class=line><span class=cl>    <span class=n>va</span><span class=o>=</span><span class=s1>&#39;top&#39;</span><span class=p>,</span><span class=n>ha</span><span class=o>=</span><span class=s1>&#39;left&#39;</span><span class=p>,</span> <span class=c1># 文本框基准点选取</span>
</span></span><span class=line><span class=cl>    <span class=n>fontsize</span> <span class=o>=</span> <span class=mi>10</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>bbox</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>boxstyle</span><span class=o>=</span><span class=s1>&#39;round,pad=0.3&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>facecolor</span><span class=o>=</span><span class=p>(</span><span class=mf>0.9</span><span class=p>,</span><span class=mf>0.9</span><span class=p>,</span><span class=mf>0.9</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=n>alpha</span><span class=o>=</span><span class=mf>0.5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>hist</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>log1p</span><span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=s1>&#39;charges&#39;</span><span class=p>]),</span><span class=n>bins</span><span class=o>=</span><span class=mi>20</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;skyblue&#39;</span><span class=p>,</span> <span class=n>edgecolor</span><span class=o>=</span><span class=s1>&#39;k&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>title</span><span class=p>(</span><span class=s1>&#39;log of </span><span class=se>\&#39;</span><span class=s1>charges</span><span class=se>\&#39;</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 增加标签值压缩列</span>
</span></span><span class=line><span class=cl><span class=n>data</span><span class=p>[</span><span class=s1>&#39;log_charges&#39;</span><span class=p>]</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>log1p</span><span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=s1>&#39;charges&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>data</span><span class=o>.</span><span class=n>head</span><span class=p>(</span><span class=mi>6</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/p/%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/output_52_0.png width=546 height=431 srcset="/p/%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/output_52_0_hu_2b402f6d6b3dd287.png 480w, /p/%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/output_52_0_hu_facb1b1f2f768337.png 1024w" loading=lazy alt=png class=gallery-image data-flex-grow=126 data-flex-basis=304px></p><div><style scoped>.dataframe tbody tr th:only-of-type{vertical-align:middle}<pre><code>.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</code></pre><p></style></p><table border=1 class=dataframe><thead><tr style=text-align:right><th></th><th>age</th><th>sex</th><th>bmi</th><th>children</th><th>smoker</th><th>region</th><th>charges</th><th>log_charges</th></tr></thead><tbody><tr><th>0</th><td>19</td><td>female</td><td>27.900</td><td>0</td><td>yes</td><td>southwest</td><td>16884.92400</td><td>9.734236</td></tr><tr><th>1</th><td>18</td><td>male</td><td>33.770</td><td>1</td><td>no</td><td>southeast</td><td>1725.55230</td><td>7.453882</td></tr><tr><th>2</th><td>28</td><td>male</td><td>33.000</td><td>3</td><td>no</td><td>southeast</td><td>4449.46200</td><td>8.400763</td></tr><tr><th>3</th><td>33</td><td>male</td><td>22.705</td><td>0</td><td>no</td><td>northwest</td><td>21984.47061</td><td>9.998137</td></tr><tr><th>4</th><td>32</td><td>male</td><td>28.880</td><td>0</td><td>no</td><td>northwest</td><td>3866.85520</td><td>8.260455</td></tr><tr><th>5</th><td>31</td><td>female</td><td>25.740</td><td>0</td><td>no</td><td>southeast</td><td>3756.62160</td><td>8.231541</td></tr></tbody></table></div><h3 id=3特征工程>3、特征工程</h3><ul><li>类别：缺失值处理/数值变换/类别编码/高维稀疏/非线性交叉/时序&序列/业务先验</li><li>类别编码 — One-Hot编码：对某个特征从“分类”到“向量”的变化过程，例如：<ul><li>若简单地将“男”/“女”，编码为0/1，模型会误以为“女”>“男”，把颜色当成连续量，学到错误的序关系</li><li>将“男”/“女”编码为二维向量 $(0,1)$ 和 $(1,0)$</li><li>将本项目中的region特征中的southeast、southwest、northeast、northwest编码为$(1,0,0,0)，(0,1,0,0)，(0,0,1,0)，(0,0,0,1)$</li></ul></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 进行 One-Hot编码</span>
</span></span><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>get_dummies</span><span class=p>(</span><span class=n>data</span><span class=p>,</span><span class=n>dtype</span><span class=o>=</span><span class=nb>int</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>data</span><span class=o>.</span><span class=n>head</span><span class=p>(</span><span class=mi>6</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><div><style scoped>.dataframe tbody tr th:only-of-type{vertical-align:middle}<pre><code>.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</code></pre><p></style></p><table border=1 class=dataframe><thead><tr style=text-align:right><th></th><th>age</th><th>bmi</th><th>children</th><th>charges</th><th>log_charges</th><th>sex_female</th><th>sex_male</th><th>smoker_no</th><th>smoker_yes</th><th>region_northeast</th><th>region_northwest</th><th>region_southeast</th><th>region_southwest</th></tr></thead><tbody><tr><th>0</th><td>19</td><td>27.900</td><td>0</td><td>16884.92400</td><td>9.734236</td><td>1</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>1</td></tr><tr><th>1</th><td>18</td><td>33.770</td><td>1</td><td>1725.55230</td><td>7.453882</td><td>0</td><td>1</td><td>1</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td></tr><tr><th>2</th><td>28</td><td>33.000</td><td>3</td><td>4449.46200</td><td>8.400763</td><td>0</td><td>1</td><td>1</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td></tr><tr><th>3</th><td>33</td><td>22.705</td><td>0</td><td>21984.47061</td><td>9.998137</td><td>0</td><td>1</td><td>1</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td></tr><tr><th>4</th><td>32</td><td>28.880</td><td>0</td><td>3866.85520</td><td>8.260455</td><td>0</td><td>1</td><td>1</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td></tr><tr><th>5</th><td>31</td><td>25.740</td><td>0</td><td>3756.62160</td><td>8.231541</td><td>1</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td></tr></tbody></table></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 取出样本及标签值</span>
</span></span><span class=line><span class=cl><span class=n>x</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>drop</span><span class=p>(</span><span class=n>columns</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;charges&#39;</span><span class=p>,</span><span class=s1>&#39;log_charges&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>y</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=s1>&#39;log_charges&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 填充空值</span>
</span></span><span class=line><span class=cl><span class=n>x</span><span class=o>.</span><span class=n>fillna</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=n>inplace</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>y</span><span class=o>.</span><span class=n>fillna</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=n>inplace</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>x</span><span class=o>.</span><span class=n>head</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><div><style scoped>.dataframe tbody tr th:only-of-type{vertical-align:middle}<pre><code>.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</code></pre><p></style></p><table border=1 class=dataframe><thead><tr style=text-align:right><th></th><th>age</th><th>bmi</th><th>children</th><th>sex_female</th><th>sex_male</th><th>smoker_no</th><th>smoker_yes</th><th>region_northeast</th><th>region_northwest</th><th>region_southeast</th><th>region_southwest</th></tr></thead><tbody><tr><th>0</th><td>19</td><td>27.900</td><td>0</td><td>1</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>1</td></tr><tr><th>1</th><td>18</td><td>33.770</td><td>1</td><td>0</td><td>1</td><td>1</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td></tr><tr><th>2</th><td>28</td><td>33.000</td><td>3</td><td>0</td><td>1</td><td>1</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td></tr><tr><th>3</th><td>33</td><td>22.705</td><td>0</td><td>0</td><td>1</td><td>1</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td></tr><tr><th>4</th><td>32</td><td>28.880</td><td>0</td><td>0</td><td>1</td><td>1</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td></tr></tbody></table></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 划分训练集与测试集</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.model_selection</span> <span class=kn>import</span> <span class=n>train_test_split</span>
</span></span><span class=line><span class=cl><span class=n>x_train</span><span class=p>,</span><span class=n>x_test</span><span class=p>,</span><span class=n>y_train</span><span class=p>,</span><span class=n>y_test</span> <span class=o>=</span> <span class=n>train_test_split</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>test_size</span><span class=o>=</span><span class=mf>0.3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>x</span><span class=o>.</span><span class=n>shape</span><span class=p>,</span><span class=n>y</span><span class=o>.</span><span class=n>shape</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>x_train</span><span class=o>.</span><span class=n>shape</span><span class=p>,</span><span class=n>y_train</span><span class=o>.</span><span class=n>shape</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>x_test</span><span class=o>.</span><span class=n>shape</span><span class=p>,</span><span class=n>y_test</span><span class=o>.</span><span class=n>shape</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><pre><code>(1338, 11) (1338,)
(936, 11) (936,)
(402, 11) (402,)
</code></pre><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 归一化</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.preprocessing</span> <span class=kn>import</span> <span class=n>StandardScaler</span>
</span></span><span class=line><span class=cl><span class=n>x_scaler</span> <span class=o>=</span> <span class=n>StandardScaler</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>copy</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=c1># 非原地更改</span>
</span></span><span class=line><span class=cl>    <span class=n>with_mean</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=c1># 先减去平均值</span>
</span></span><span class=line><span class=cl>    <span class=n>with_std</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=c1># 除以标准差</span>
</span></span><span class=line><span class=cl><span class=p>)</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>x_train</span><span class=p>)</span> <span class=c1># 用测试集数据训练出均值和标准差</span>
</span></span><span class=line><span class=cl><span class=n>x_train_scaled</span> <span class=o>=</span> <span class=n>x_scaler</span><span class=o>.</span><span class=n>transform</span><span class=p>(</span><span class=n>x_train</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>x_test_scaled</span> <span class=o>=</span> <span class=n>x_scaler</span><span class=o>.</span><span class=n>transform</span><span class=p>(</span><span class=n>x_test</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 多项式升维以拟合非线性特征</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.preprocessing</span> <span class=kn>import</span> <span class=n>PolynomialFeatures</span>
</span></span><span class=line><span class=cl><span class=n>poly_features</span> <span class=o>=</span> <span class=n>PolynomialFeatures</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>degree</span> <span class=o>=</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>include_bias</span><span class=o>=</span><span class=kc>False</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>x_train_scaled</span> <span class=o>=</span> <span class=n>poly_features</span><span class=o>.</span><span class=n>fit_transform</span><span class=p>(</span><span class=n>x_train_scaled</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>x_test_scaled</span> <span class=o>=</span> <span class=n>poly_features</span><span class=o>.</span><span class=n>fit_transform</span><span class=p>(</span><span class=n>x_test_scaled</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=4模型训练>4、模型训练</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.linear_model</span> <span class=kn>import</span> <span class=n>LinearRegression</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.linear_model</span> <span class=kn>import</span> <span class=n>Ridge</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.linear_model</span> <span class=kn>import</span> <span class=n>SGDRegressor</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 线性回归</span>
</span></span><span class=line><span class=cl><span class=n>lin_reg</span> <span class=o>=</span> <span class=n>LinearRegression</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>lin_reg</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>x_train_scaled</span><span class=p>,</span><span class=n>y_train</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>y_train_predict_lin</span> <span class=o>=</span> <span class=n>lin_reg</span><span class=o>.</span><span class=n>predict</span><span class=p>(</span><span class=n>x_train_scaled</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>y_test_predict_lin</span> <span class=o>=</span> <span class=n>lin_reg</span><span class=o>.</span><span class=n>predict</span><span class=p>(</span><span class=n>x_test_scaled</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 岭回归</span>
</span></span><span class=line><span class=cl><span class=n>rid_reg</span> <span class=o>=</span> <span class=n>Ridge</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>rid_reg</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>x_train_scaled</span><span class=p>,</span><span class=n>y_train</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>y_train_predict_rid</span> <span class=o>=</span> <span class=n>rid_reg</span><span class=o>.</span><span class=n>predict</span><span class=p>(</span><span class=n>x_train_scaled</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>y_test_predict_rid</span> <span class=o>=</span> <span class=n>rid_reg</span><span class=o>.</span><span class=n>predict</span><span class=p>(</span><span class=n>x_test_scaled</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 随机梯度下降</span>
</span></span><span class=line><span class=cl><span class=n>sgd_reg</span> <span class=o>=</span> <span class=n>SGDRegressor</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>sgd_reg</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>x_train_scaled</span><span class=p>,</span><span class=n>y_train</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>y_train_predict_sgd</span> <span class=o>=</span> <span class=n>sgd_reg</span><span class=o>.</span><span class=n>predict</span><span class=p>(</span><span class=n>x_train_scaled</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>y_test_predict_sgd</span> <span class=o>=</span> <span class=n>sgd_reg</span><span class=o>.</span><span class=n>predict</span><span class=p>(</span><span class=n>x_test_scaled</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=5模型评估>5、模型评估</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.metrics</span> <span class=kn>import</span> <span class=n>mean_squared_error</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;LinearRegression(Train / Test): &#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>mean_squared_error</span><span class=p>(</span><span class=n>y_train</span><span class=p>,</span><span class=n>y_train_predict_lin</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>    <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>mean_squared_error</span><span class=p>(</span><span class=n>y_test</span><span class=p>,</span><span class=n>y_test_predict_lin</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;RidgeRegression(Train / Test): &#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>mean_squared_error</span><span class=p>(</span><span class=n>y_train</span><span class=p>,</span><span class=n>y_train_predict_rid</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>    <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>mean_squared_error</span><span class=p>(</span><span class=n>y_test</span><span class=p>,</span><span class=n>y_test_predict_rid</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;SGDRegression(Train / Test): &#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>mean_squared_error</span><span class=p>(</span><span class=n>y_train</span><span class=p>,</span><span class=n>y_train_predict_sgd</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>    <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>mean_squared_error</span><span class=p>(</span><span class=n>y_test</span><span class=p>,</span><span class=n>y_test_predict_sgd</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><pre><code>LinearRegression(Train / Test):  0.44905273756975034 0.43211955383967054
RidgeRegression(Train / Test):  0.44905315842354915 0.4321996372029468
SGDRegression(Train / Test):  0.449286159412961 0.43308751362633735
</code></pre><h3 id=6进阶>6、进阶</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pandas</span> <span class=k>as</span> <span class=nn>pd</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>matplotlib.pyplot</span> <span class=k>as</span> <span class=nn>plt</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>seaborn</span> <span class=k>as</span> <span class=nn>sns</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.preprocessing</span> <span class=kn>import</span> <span class=n>PolynomialFeatures</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.model_selection</span> <span class=kn>import</span> <span class=n>train_test_split</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.linear_model</span> <span class=kn>import</span> <span class=n>LinearRegression</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.linear_model</span> <span class=kn>import</span> <span class=n>Ridge</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.ensemble</span> <span class=kn>import</span> <span class=n>GradientBoostingRegressor</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.metrics</span> <span class=kn>import</span> <span class=n>mean_squared_error</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.preprocessing</span> <span class=kn>import</span> <span class=n>StandardScaler</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 数据读取</span>
</span></span><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_csv</span><span class=p>(</span><span class=s1>&#39;./Dataset/1_Insurance_Expense_Forecast/insurance.csv&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># EDA</span>
</span></span><span class=line><span class=cl><span class=c1># 如果对于某个特征对预测值几乎无影响，则可忽略（降噪）</span>
</span></span><span class=line><span class=cl><span class=n>data</span><span class=p>[</span><span class=s1>&#39;charges&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>log1p</span><span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=s1>&#39;charges&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>head</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>info</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>describe</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ax</span> <span class=o>=</span> <span class=n>plt</span><span class=o>.</span><span class=n>subplot</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>title</span><span class=p>(</span><span class=s1>&#39;sex&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>kdeplot</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>data</span><span class=o>.</span><span class=n>sex</span><span class=o>==</span><span class=s1>&#39;male&#39;</span><span class=p>,</span><span class=s1>&#39;charges&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>fill</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;male&#39;</span><span class=p>,</span> <span class=n>ax</span><span class=o>=</span><span class=n>ax</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>kdeplot</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>data</span><span class=o>.</span><span class=n>sex</span><span class=o>==</span><span class=s1>&#39;female&#39;</span><span class=p>,</span><span class=s1>&#39;charges&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>fill</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;female&#39;</span><span class=p>,</span> <span class=n>ax</span><span class=o>=</span><span class=n>ax</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>legend</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ax</span> <span class=o>=</span> <span class=n>plt</span><span class=o>.</span><span class=n>subplot</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>title</span><span class=p>(</span><span class=s1>&#39;smoke&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>kdeplot</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>data</span><span class=o>.</span><span class=n>smoker</span><span class=o>==</span><span class=s1>&#39;yes&#39;</span><span class=p>,</span><span class=s1>&#39;charges&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>fill</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;smoker_yes&#39;</span><span class=p>,</span> <span class=n>ax</span><span class=o>=</span><span class=n>ax</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>kdeplot</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>data</span><span class=o>.</span><span class=n>smoker</span><span class=o>==</span><span class=s1>&#39;no&#39;</span><span class=p>,</span><span class=s1>&#39;charges&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>fill</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;smoker_no&#39;</span><span class=p>,</span> <span class=n>ax</span><span class=o>=</span><span class=n>ax</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>legend</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ax</span> <span class=o>=</span> <span class=n>plt</span><span class=o>.</span><span class=n>subplot</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>title</span><span class=p>(</span><span class=s1>&#39;region&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>kdeplot</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>data</span><span class=o>.</span><span class=n>region</span><span class=o>==</span><span class=s1>&#39;southeast&#39;</span><span class=p>,</span><span class=s1>&#39;charges&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>           <span class=n>fill</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span><span class=n>label</span><span class=o>=</span><span class=s1>&#39;southeast&#39;</span><span class=p>,</span><span class=n>ax</span><span class=o>=</span><span class=n>ax</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>kdeplot</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>data</span><span class=o>.</span><span class=n>region</span><span class=o>==</span><span class=s1>&#39;southwest&#39;</span><span class=p>,</span><span class=s1>&#39;charges&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>           <span class=n>fill</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span><span class=n>label</span><span class=o>=</span><span class=s1>&#39;southwest&#39;</span><span class=p>,</span><span class=n>ax</span><span class=o>=</span><span class=n>ax</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>kdeplot</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>data</span><span class=o>.</span><span class=n>region</span><span class=o>==</span><span class=s1>&#39;northeast&#39;</span><span class=p>,</span><span class=s1>&#39;charges&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>           <span class=n>fill</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span><span class=n>label</span><span class=o>=</span><span class=s1>&#39;northeast&#39;</span><span class=p>,</span><span class=n>ax</span><span class=o>=</span><span class=n>ax</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>kdeplot</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>data</span><span class=o>.</span><span class=n>region</span><span class=o>==</span><span class=s1>&#39;northwest&#39;</span><span class=p>,</span><span class=s1>&#39;charges&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>           <span class=n>fill</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span><span class=n>label</span><span class=o>=</span><span class=s1>&#39;northwest&#39;</span><span class=p>,</span><span class=n>ax</span><span class=o>=</span><span class=n>ax</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>legend</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ax</span> <span class=o>=</span> <span class=n>plt</span><span class=o>.</span><span class=n>subplot</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>4</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>title</span><span class=p>(</span><span class=s1>&#39;children&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>kdeplot</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>data</span><span class=o>.</span><span class=n>children</span><span class=o>==</span><span class=mi>0</span><span class=p>,</span><span class=s1>&#39;charges&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>fill</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;children_0&#39;</span><span class=p>,</span> <span class=n>ax</span><span class=o>=</span><span class=n>ax</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>kdeplot</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>data</span><span class=o>.</span><span class=n>children</span><span class=o>==</span><span class=mi>1</span><span class=p>,</span><span class=s1>&#39;charges&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>fill</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;children_1&#39;</span><span class=p>,</span> <span class=n>ax</span><span class=o>=</span><span class=n>ax</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>kdeplot</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>data</span><span class=o>.</span><span class=n>children</span><span class=o>==</span><span class=mi>2</span><span class=p>,</span><span class=s1>&#39;charges&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>fill</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;children_2&#39;</span><span class=p>,</span> <span class=n>ax</span><span class=o>=</span><span class=n>ax</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>kdeplot</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>data</span><span class=o>.</span><span class=n>children</span><span class=o>==</span><span class=mi>3</span><span class=p>,</span><span class=s1>&#39;charges&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>fill</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;children_3&#39;</span><span class=p>,</span> <span class=n>ax</span><span class=o>=</span><span class=n>ax</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>kdeplot</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>data</span><span class=o>.</span><span class=n>children</span><span class=o>==</span><span class=mi>4</span><span class=p>,</span><span class=s1>&#39;charges&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>fill</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;children_4&#39;</span><span class=p>,</span> <span class=n>ax</span><span class=o>=</span><span class=n>ax</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>kdeplot</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>data</span><span class=o>.</span><span class=n>children</span><span class=o>==</span><span class=mi>5</span><span class=p>,</span><span class=s1>&#39;charges&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>fill</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s1>&#39;children_5&#39;</span><span class=p>,</span> <span class=n>ax</span><span class=o>=</span><span class=n>ax</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>legend</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>tight_layout</span><span class=p>()</span>  
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 特征工程</span>
</span></span><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>drop</span><span class=p>([</span><span class=s1>&#39;region&#39;</span><span class=p>,</span><span class=s1>&#39;sex&#39;</span><span class=p>],</span><span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span> <span class=c1># 删除无用特征</span>
</span></span><span class=line><span class=cl><span class=c1># 特征离散化</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>discretization</span><span class=p>(</span><span class=n>df</span><span class=p>,</span><span class=n>bmi</span><span class=o>=</span><span class=mi>30</span><span class=p>,</span><span class=n>child</span><span class=o>=</span><span class=mi>0</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>df</span><span class=p>[</span><span class=s1>&#39;bmi&#39;</span><span class=p>]</span><span class=o>=</span><span class=s1>&#39;over&#39;</span> <span class=k>if</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;bmi&#39;</span><span class=p>]</span><span class=o>&gt;=</span><span class=n>bmi</span> <span class=k>else</span> <span class=s1>&#39;under&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>df</span><span class=p>[</span><span class=s1>&#39;children&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;no&#39;</span> <span class=k>if</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;children&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=n>child</span> <span class=k>else</span> <span class=s1>&#39;yes&#39;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>df</span>
</span></span><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=n>discretization</span><span class=p>,</span><span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=mi>30</span><span class=p>,</span><span class=mi>0</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>head</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=c1># one-hot 编码</span>
</span></span><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>get_dummies</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># 解决右偏问题</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>head</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=c1># 样本获取与空值填充</span>
</span></span><span class=line><span class=cl><span class=n>x</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>drop</span><span class=p>(</span><span class=s1>&#39;charges&#39;</span><span class=p>,</span><span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>y</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=s1>&#39;charges&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>x</span><span class=o>.</span><span class=n>fillna</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=n>inplace</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>y</span><span class=o>.</span><span class=n>fillna</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=n>inplace</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>x</span><span class=o>.</span><span class=n>head</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>y</span><span class=o>.</span><span class=n>head</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 模型训练</span>
</span></span><span class=line><span class=cl><span class=c1># 划分</span>
</span></span><span class=line><span class=cl><span class=n>x_train</span><span class=p>,</span><span class=n>x_test</span><span class=p>,</span><span class=n>y_train</span><span class=p>,</span><span class=n>y_test</span> <span class=o>=</span> <span class=n>train_test_split</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>test_size</span><span class=o>=</span><span class=mf>0.3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># # 归一化</span>
</span></span><span class=line><span class=cl><span class=c1># x_scaler = StandardScaler().fit(x_train)</span>
</span></span><span class=line><span class=cl><span class=c1># x_train = x_scaler.transform(x_train)</span>
</span></span><span class=line><span class=cl><span class=c1># 升维</span>
</span></span><span class=line><span class=cl><span class=n>poly_featrues</span> <span class=o>=</span> <span class=n>PolynomialFeatures</span><span class=p>(</span><span class=n>degree</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span><span class=n>include_bias</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>x_train_poly</span> <span class=o>=</span> <span class=n>poly_features</span><span class=o>.</span><span class=n>fit_transform</span><span class=p>(</span><span class=n>x_train</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># 训练</span>
</span></span><span class=line><span class=cl><span class=n>reg_lin</span> <span class=o>=</span> <span class=n>LinearRegression</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>reg_lin</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>x_train_poly</span><span class=p>,</span><span class=n>y_train</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>reg_rid</span> <span class=o>=</span> <span class=n>Ridge</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>reg_rid</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>x_train_poly</span><span class=p>,</span><span class=n>y_train</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>reg_gra</span> <span class=o>=</span> <span class=n>GradientBoostingRegressor</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>reg_gra</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>x_train_poly</span><span class=p>,</span><span class=n>y_train</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 测试集预测</span>
</span></span><span class=line><span class=cl><span class=c1># # 归一化</span>
</span></span><span class=line><span class=cl><span class=c1># x_test = x_scaler.transform(x_test)</span>
</span></span><span class=line><span class=cl><span class=c1># 升维</span>
</span></span><span class=line><span class=cl><span class=n>x_test_poly</span> <span class=o>=</span> <span class=n>poly_features</span><span class=o>.</span><span class=n>fit_transform</span><span class=p>(</span><span class=n>x_test</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># 预测</span>
</span></span><span class=line><span class=cl><span class=n>y_test_pre_lin</span> <span class=o>=</span> <span class=n>reg_lin</span><span class=o>.</span><span class=n>predict</span><span class=p>(</span><span class=n>x_test_poly</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>y_test_pre_rid</span> <span class=o>=</span> <span class=n>reg_rid</span><span class=o>.</span><span class=n>predict</span><span class=p>(</span><span class=n>x_test_poly</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>y_test_pre_gra</span> <span class=o>=</span> <span class=n>reg_gra</span><span class=o>.</span><span class=n>predict</span><span class=p>(</span><span class=n>x_test_poly</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 模型评估</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;LinearRegression: &#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>mean_squared_error</span><span class=p>(</span><span class=n>y_test</span><span class=p>,</span><span class=n>y_test_pre_lin</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;RidgeRegression: &#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>mean_squared_error</span><span class=p>(</span><span class=n>y_test</span><span class=p>,</span><span class=n>y_test_pre_rid</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;GradientBoostingRegressor: &#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>mean_squared_error</span><span class=p>(</span><span class=n>y_test</span><span class=p>,</span><span class=n>y_test_pre_gra</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><pre><code>   age     sex     bmi  children smoker     region   charges
0   19  female  27.900         0    yes  southwest  9.734236
1   18    male  33.770         1     no  southeast  7.453882
2   28    male  33.000         3     no  southeast  8.400763
3   33    male  22.705         0     no  northwest  9.998137
4   32    male  28.880         0     no  northwest  8.260455
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 1338 entries, 0 to 1337
Data columns (total 7 columns):
 #   Column    Non-Null Count  Dtype  
---  ------    --------------  -----  
 0   age       1338 non-null   int64  
 1   sex       1338 non-null   object 
 2   bmi       1338 non-null   float64
 3   children  1338 non-null   int64  
 4   smoker    1338 non-null   object 
 5   region    1338 non-null   object 
 6   charges   1338 non-null   float64
dtypes: float64(2), int64(2), object(3)
memory usage: 73.3+ KB
None
               age          bmi     children      charges
count  1338.000000  1338.000000  1338.000000  1338.000000
mean     39.207025    30.663397     1.094918     9.098828
std      14.049960     6.098187     1.205493     0.919379
min      18.000000    15.960000     0.000000     7.023647
25%      27.000000    26.296250     0.000000     8.464064
50%      39.000000    30.400000     1.000000     9.146658
75%      51.000000    34.693750     2.000000     9.719618
max      64.000000    53.130000     5.000000    11.063061
</code></pre><p><img src=/p/%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/output_64_1.png width=630 height=469 srcset="/p/%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/output_64_1_hu_15ddab4c1f41b39c.png 480w, /p/%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/output_64_1_hu_b4d2b579c830e634.png 1024w" loading=lazy alt=png class=gallery-image data-flex-grow=134 data-flex-basis=322px></p><pre><code>   age    bmi children smoker   charges
0   19  under       no    yes  9.734236
1   18   over      yes     no  7.453882
2   28   over      yes     no  8.400763
3   33  under       no     no  9.998137
4   32  under       no     no  8.260455
   age   charges  bmi_over  bmi_under  children_no  children_yes  smoker_no  \
0   19  9.734236     False       True         True         False      False   
1   18  7.453882      True      False        False          True       True   
2   28  8.400763      True      False        False          True       True   
3   33  9.998137     False       True         True         False       True   
4   32  8.260455     False       True         True         False       True   

   smoker_yes  
0        True  
1       False  
2       False  
3       False  
4       False  
   age  bmi_over  bmi_under  children_no  children_yes  smoker_no  smoker_yes
0   19     False       True         True         False      False        True
1   18      True      False        False          True       True       False
2   28      True      False        False          True       True       False
3   33     False       True         True         False       True       False
4   32     False       True         True         False       True       False
0    9.734236
1    7.453882
2    8.400763
3    9.998137
4    8.260455
Name: charges, dtype: float64
LinearRegression:  0.41171540130927264
RidgeRegression:  0.4119283802418486
GradientBoostingRegressor:  0.3163566171772987
</code></pre></section><footer class=article-footer><section class=article-tags><a href=/tags/%E6%A2%AF%E5%BA%A6%E4%B8%8B%E9%99%8D/>梯度下降</a>
<a href=/tags/sgd/>SGD</a>
<a href=/tags/sk-learn/>Sk-Learn</a>
<a href=/tags/%E5%BD%92%E4%B8%80%E5%8C%96/>归一化</a>
<a href=/tags/%E6%AD%A3%E5%88%99%E5%8C%96/>正则化</a>
<a href=/tags/%E5%A4%9A%E9%A1%B9%E5%BC%8F%E5%8D%87%E7%BB%B4/>多项式升维</a>
<a href=/tags/eda/>EDA</a></section><section class=article-lastmod><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<span>最后更新于 Dec 02, 2025 00:00 UTC</span></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css integrity=sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js integrity=sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8 crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{const e=[".main-article",".widget--toc"];e.forEach(e=>{const t=document.querySelector(e);t&&renderMathInElement(t,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],ignoredClasses:["gist"]})})})</script></article><script src=https://utteranc.es/client.js repo=leuco-yuu/blog-comments issue-term=pathname crossorigin=anonymous async></script><style>.utterances{max-width:unset}</style><script>let utterancesLoaded=!1;function setUtterancesTheme(e){let t=document.querySelector(".utterances iframe");t&&t.contentWindow.postMessage({type:"set-theme",theme:`github-${e}`},"https://utteranc.es")}addEventListener("message",e=>{if(e.origin!=="https://utteranc.es")return;utterancesLoaded=!0,setUtterancesTheme(document.documentElement.dataset.scheme)}),window.addEventListener("onColorSchemeChange",e=>{if(!utterancesLoaded)return;setUtterancesTheme(e.detail)})</script><footer class=site-footer><section class=copyright>&copy;
2025 Leuco(leucoyuu@163.com)</section><section class=powerby>Embrace Bit Art<br>使用 <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> 构建<br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.32.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.f70ba9cc9ddd58ef1aafa6e349bfda1def4c3b51fc20b7de0ceba5511b908dfd.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>